<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/miyano/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/miyano/assets/apple-touch-icon.png"><link rel="alternate" href="/miyano/rss.xml" title="自分の為に楽しめ世界" type="application/rss+xml"><link rel="alternate" href="/miyano/atom.xml" title="自分の為に楽しめ世界" type="application/atom+xml"><link rel="alternate" type="application/json" title="自分の為に楽しめ世界" href="https://ei4869.github.io/miyano/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="preconnect" href="https://cloudflare-imgbed-9os.pages.dev"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/app.css?v=0.4.17"><link rel="modulepreload" href="/miyano/js/chunk-424DDEWW.js"><link rel="modulepreload" href="/miyano/js/chunk-GL47M7BI.js"><link rel="modulepreload" href="/miyano/js/chunk-LOCL5DEO.js"><link rel="modulepreload" href="/miyano/js/chunk-MTLQDVVJ.js"><link rel="modulepreload" href="/miyano/js/chunk-MWLQAVNJ.js"><link rel="modulepreload" href="/miyano/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/miyano/js/comments-QIVDG7X3.js"><link rel="modulepreload" href="/miyano/js/copy-tex-W2MNAMYO.js"><link rel="modulepreload" href="/miyano/js/index.esm-3GUGPDKE.js"><link rel="modulepreload" href="/miyano/js/post-WAGXKCY2.js"><link rel="modulepreload" href="/miyano/js/quicklink-DDPSWSOQ.js"><link rel="modulepreload" href="/miyano/js/search-5ACYIQUA.js"><link rel="modulepreload" href="/miyano/js/siteInit.js"><link rel="modulepreload" href="/miyano/js/waline-NVSVNCZW.js"><link rel="stylesheet" href="/miyano/css/comments-LAB2J3GR.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/siteInit.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/waline-7JVHAYE3.css" media="none" onload="this.media='all'"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_10.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_1.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_7.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_8.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_2.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_15.webp" as="image" fetchpriority="high"><meta name="keywords" content="工具"><meta name="description" content="对KrKr2引擎进行解包汉化和封包。"><link rel="canonical" href="https://ei4869.github.io/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%80)/"><script>window.sakuraConfig = {
  sakura: 30,
  xSpeed: 0.5,
  ySpeed: 0.5,
  rSpeed: 0.03,
  direction: "TopRight",
  zIndex: -1
};</script><script src="https://cdn.jsdelivr.net/gh/minz71/sakura-rain/sakura-rain.js" defer="defer"></script><title>KrKr引擎汉化(一)</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">KrKr引擎汉化(一)</h1><div class="meta"><span class="item" title="创建时间：2025-02-25 09:57:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-02-25T09:57:00+08:00">2025-02-25</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>12k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>10min</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/miyano/" rel="start">Rei の 手帳</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_10.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_1.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_7.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_8.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_2.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_15.webp&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/miyano/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/miyano/categories/Engine-Translation/" itemprop="item" rel="index" title="分类于引擎汉化"><span itemprop="name">引擎汉化<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://ei4869.github.io/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%80)/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/miyano/assets/ai-icon.webp"><meta itemprop="name" content="Rei"><meta itemprop="description" content=", "></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="自分の為に楽しめ世界"></span><div class="body md" itemprop="articleBody"><div class="tabs" id="summary"><div class="show-btn"></div><div class="nav"><ul class="special"></ul></div><div class="tab active" data-id="summary" data-title="自我介绍"><p>我是基于Kimi moonshot-v1-8k实现的AI助手，在此博客上负责整理和概括文章</p></div><div class="tab" data-id="summary" data-title="文章概括"><p>本文是一篇关于KrKr2引擎游戏汉化的经验教程，以《見上げた空におちていく》为例。文章介绍了使用KrKrExact、GalTransl、Xp3Viewer等工具进行游戏解包、文本处理和汉化的过程。首先，使用KrKrExact工具解包KrKr2引擎的游戏文件，然后将解包后的脚本文件通过GalTransl_DumpInjector提取文本，并检查提取的JSON文件是否正确。接着，使用GalTransl工具进行翻译，并将翻译后的JSON文件注入回脚本文件。最后，使用Xp3Viewer工具进行封包，替换原游戏目录内的data.xp3文件，实现游戏的汉化。文章还提到了处理选择项文本汉化和配置文件修改以优化中文显示效果。总结指出，KrKr2游戏通常支持UTF-8编码，KrKrExact是最简单实用的解包工具，不同游戏的文本处理可能有所不同。</p></div></div><details class="info"><summary>编辑记录</summary><div>
<div class="note info">
<p>2025-02-25 9:57:00 第一次编辑</p>
</div>
<ul>
<li>正文</li>
</ul>
</div></details>
<h1 id="简介"><a class="anchor" href="#简介">#</a> 简介</h1>
<p>本文章汉化 <strong>KrKr2 引擎</strong> 游戏的经验教程。示例游戏：《見上げた空におちていく》</p>
<h1 id="使用的工具"><a class="anchor" href="#使用的工具">#</a> 使用的工具</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/xmoezzz/KrkrExtract/releases/tag/4.0.1.5">KrKrExact</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xd2333/GalTransl">GalTransl</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/yangg1g/unpacktools">Xp3Viewer</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xd2333/GalTransl">GalTransl_DumpInjector</a> 实际上参考<a target="_blank" rel="noopener" href="https://github.com/arcusmaximus/VNTranslationTools"> VNTranslationTools</a><br>
 参考视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1qQ4y1k7Gs/?share_source=copy_web&amp;vd_source=8e65c67310132c58d9f9eae499cda356">KiriKiri2/Z  解包封包总结</a></li>
</ul>
<h1 id="解包"><a class="anchor" href="#解包">#</a> 解包</h1>
<p>使用工具：<strong>KrKrExact</strong>，把下载的 <code>KrkrExtract.dll</code>  和 <code>KrkrExtract.exe</code>  移动到游戏同目录下，然后把游戏拖入 <code>KrkrExtract.exe</code>  打开，如下图：<br>
<img loading="lazy" data-src="/miyano/img/post/engine_tools/krkr.webp" style="max-width: 100%; height: auto;"></p>
<p>接着，把需要解包的 <code>xp3</code>  文件拖入里面，就能实现解包，解包文件存放在游戏目录 <code>KrkrExtract_Output</code>  下，如果是 <code>data.xp3</code> ，里面就有 <code>data</code>  文件夹。<br>
这种方法能解包加密了的游戏，但注意得是 <code>KrKr2</code>  引擎的。</p>
<h1 id="处理文本和汉化"><a class="anchor" href="#处理文本和汉化">#</a> 处理文本和汉化</h1>
<h2 id="处理文本"><a class="anchor" href="#处理文本">#</a> 处理文本</h2>
<ol>
<li>需要的脚本文件一般在 <code>data\scenario</code>  里，对于该游戏，都是 <code>ks</code>  文件，记事本可直接查看，是 <code>UTF-8</code>  格式。需要使用 <code>GalTransl_DumpInjector</code>  进行提取。如图以解包 <code>data.xp3</code>  为例，<br>
<img loading="lazy" data-src="/miyano/img/post/engine_tools/krkr2.webp" style="max-width: 100%; height: auto;"></li>
</ol>
<p>这里需要注意：日文脚本文件夹存放的是前面的存放一系列 ks 文件的文件夹，日文 JSON 文件夹则是存放提取文本的 JSON 文件的文件夹，一定需要先创建好该文件夹，这里为 <code>script_jp</code> ，这样才能点击进行提取。<br>
后面的译文 JSON 文件夹则是存放翻译后的 JSON 文件的文件夹，这里为 <code>script_cn</code> ，译文脚本文件夹则是存放翻译好的 ks 文件的文件夹。注意：要注入 JSON 回脚本，前面的日文脚本文件夹和日文 JSON 文件夹也必须对应上才能正确注入回去。</p>
<ol start="2">
<li>检查提取后的 JSON 是否 <code>name</code>  和 <code>message</code>  正确，否则需要分析原 ks 文件使用正则表达式提取。<br>
若 JSON 没问题，需要进行合并为一个 JSON，方便翻译。<br>
代码如下：</li>
</ol>
<figure class="highlight python"><figcaption data-lang="python"><span>mergeJSON.py</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 输入目录：包含多个 JSON 文件的目录</span></pre></td></tr><tr><td data-num="5"></td><td><pre>input_dir <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\script_jp"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 输出目录：与 script_jp 同级的 script 文件夹</span></pre></td></tr><tr><td data-num="7"></td><td><pre>output_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"script"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 合并后的 JSON 文件保存路径</span></pre></td></tr><tr><td data-num="9"></td><td><pre>output_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_dir<span class="token punctuation">,</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".json"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 如果输出目录不存在，则创建它</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>merged_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 遍历输入目录下的所有文件</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># 只处理 .json 结尾的文件</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> filename<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token comment"># 检查读取的数据是否为列表格式</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                    merged_data<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"警告：文件 </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> 中的数据不是列表格式，已跳过。"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"读取文件 </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> 时发生错误: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># 将合并后的结果写入目标文件，使用 ensure_ascii=False 以保持非 ASCII 字符（例如日文）</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>merged_data<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"合并完成，结果保存在："</span><span class="token punctuation">,</span> output_file<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>该代码会在同目录创建 <code>script</code>  文件夹，存放需要翻译的文件 <code>script_jp.json</code></p>
<ol start="3">
<li>预处理 <code>script_jp.json</code> ，检查文本特殊符号是否有问题，对于该游戏，发现对于 <code>[ruby text=\"むく\"]椋</code> 的处理有问题，提取后会变成 <code>[椋\むく]</code> ，因此需要处理回去，使用正则匹配，检测到 <code>[前\后]</code>  的格式则转换为 <code>[ruby text="后"]前</code> 。<br>
代码如下：</li>
</ol>
<figure class="highlight python"><figcaption data-lang="python"><span>processRuby.py</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 正则匹配 [前 / 后] 格式</span></pre></td></tr><tr><td data-num="5"></td><td><pre>ruby_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'\[([^\]/]+)/([^\]]+)\]'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">replace_ruby_notation</span><span class="token punctuation">(</span>script_file<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    读取 script_jp.json，替换 "message" 中的 [前/后] 为 [ruby text="后"]前，并写入 output_file。</pre></td></tr><tr><td data-num="10"></td><td><pre>    """</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 读取 JSON 文件</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>script_file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        script_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">ruby_replace</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token triple-quoted-string string">"""替换匹配的文本"""</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'[ruby text="</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"]</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># 遍历 JSON 数据，处理 "message" 字段</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">for</span> item <span class="token keyword">in</span> script_data<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"message"</span> <span class="token keyword">in</span> item <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            item<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ruby_pattern<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>ruby_replace<span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment"># 写入新的 JSON 文件</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>script_data<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"转换完成，已保存至 </span><span class="token interpolation"><span class="token punctuation">{</span>output_file<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 文件路径</span></pre></td></tr><tr><td data-num="31"></td><td><pre>input_json <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\script\script_jp.json"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>output_json <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\script\script_jp.json"</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># 执行替换</span></pre></td></tr><tr><td data-num="35"></td><td><pre>replace_ruby_notation<span class="token punctuation">(</span>input_json<span class="token punctuation">,</span> output_json<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h2 id="汉化翻译与文本再处理"><a class="anchor" href="#汉化翻译与文本再处理">#</a> 汉化翻译与文本再处理</h2>
<p>把前面得到的 <code>script_jp.json</code>  使用 <strong>GalTransl</strong> 进行翻译。得到翻译文件后，这里重命名为 <code>script_cn.json</code> 。<br>
可以再次运行程序，导出人名替换表的.csv 文件，手动添加中文人名后，再进行重建结果，这样翻译后脚本中的 <code>name</code>  也会汉化。</p>
<ol>
<li>首先进行分割，将其还原为跟原来同结构的许多单个的 JSON 文件，代码为：</li>
</ol>
<figure class="highlight python"><figcaption data-lang="python"><span>JSONsplit.py</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 设定文件夹路径</span></pre></td></tr><tr><td data-num="5"></td><td><pre>input_dir <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\script_jp"</span>  <span class="token comment"># 原始日文 JSON 文件所在目录</span></pre></td></tr><tr><td data-num="6"></td><td><pre>translated_merged_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"script"</span><span class="token punctuation">,</span> <span class="token string">"script_cn.json"</span><span class="token punctuation">)</span>  <span class="token comment"># 翻译后的合并 JSON 文件路径</span></pre></td></tr><tr><td data-num="7"></td><td><pre>output_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"script_cn"</span><span class="token punctuation">)</span>  <span class="token comment"># 新的存放翻译后 JSON 的目录</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 如果输出目录不存在，则创建它</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 加载翻译后的合并 JSON 数据</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>translated_merged_file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    translated_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 计数器，用于从合并后的翻译列表中依次取出翻译内容</span></pre></td></tr><tr><td data-num="18"></td><td><pre>msg_index <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 对输入目录中的 JSON 文件按文件名进行排序，确保顺序与合并时一致</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> filename<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        input_file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>input_file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            original_json <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        </pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment"># 遍历当前文件中的每一条记录，并将 "message" 字段替换为翻译后的文本</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">for</span> obj <span class="token keyword">in</span> original_json<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">if</span> msg_index <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>translated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token comment"># 这里假设翻译后的合并 JSON 中，每个对象与原来的顺序一致，只替换 "message" 部分</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                obj<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">=</span> translated_data<span class="token punctuation">[</span>msg_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token keyword">if</span> <span class="token string">"name"</span> <span class="token keyword">in</span> translated_data<span class="token punctuation">[</span>msg_index<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                    obj<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> translated_data<span class="token punctuation">[</span>msg_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                msg_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"警告：翻译文本数量不足，文件 </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> 中部分记录未替换。"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        </pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token comment"># 在输出目录中生成新的 JSON 文件，文件名与原来一致</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        output_file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>original_json<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"所有文件已处理完毕，翻译后的 JSON 文件保存在："</span><span class="token punctuation">,</span> output_dir<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>该代码会生成 <code>script_cn</code>  文件夹，里面存放翻译后的许多 JSON 文件。</p>
<ol start="2">
<li>再使用 <code>GalTransl_DumpInjector</code>  注入 JSON 回脚本，需要先创建好存放新 ks 的文件夹，这里设为 <code>inject</code> ，接下来，需要对这里面的 ks 进行修正。<br>
理由是：前面的提取没有提取出脚本文件中的选择项的文本，即选择项文本没有得到汉化，于是需要再次提取出这些文本到 JSON，翻译后再注入回 ks 文件。<br>
分析这些 ks 文件，发现选择项文本的内容一般是下面格式的：</li>
</ol>
<pre><code>@exlink txt="それでも追い返すなんて出来ない" target="*select1_1"
@exlink txt="一度冷静に考えてみる" target="*select1_2"
@showlink
</code></pre>
<p>所以需要正则匹配到 <code>@exlink txt=</code> ，提取出后面的文本到 JSON，再进行翻译，得到翻译后的 JSON，再按顺序注入回 ks，即得到完整翻译了脚本和选择项的 ks 文件。<br>
注意：存放原脚本的 ks 文件是 <code>shiftjis</code>  编码的（这里和前面所说的 utf-8 编码可能冲突，但实际就是，使用 krkrexact 解包的 ks 文件在 vscode 打开是 jis 编码，但实际之前看到过是 utf-8 编码的，但无所谓了，因为没有做什么转编码 dll 注入什么的打包回去是可以读取的。）  读取时需要以 <code>jis</code>  编码读取，匹配到选择项文本，再以 <code>utf-8</code>  写到 JSON 用于翻译，翻译后，需要把翻译后的 JSON 写入前面的 <code>inject</code>  里的 ks，这里的 ks 都是 <code>utf16le</code>  编码的，JSON 写回后，新的 ks 也要以 <code>utf16le</code>  编码保存。<br>
代码如下：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># `@exlink txt="..."` 的正则匹配模式</span></pre></td></tr><tr><td data-num="7"></td><td><pre>exlink_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'(@exlink txt=")([^"]+)(")'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_options</span><span class="token punctuation">(</span>input_dir<span class="token punctuation">,</span> output_json<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    遍历 input_dir 目录下所有 .ks 文件，提取所有形如 @exlink txt="xxx" 中的 xxx，</pre></td></tr><tr><td data-num="12"></td><td><pre>    并保存为 JSON 文件，格式为：</pre></td></tr><tr><td data-num="13"></td><td><pre>    [</pre></td></tr><tr><td data-num="14"></td><td><pre>      {"message": "xxx"},</pre></td></tr><tr><td data-num="15"></td><td><pre>      ...</pre></td></tr><tr><td data-num="16"></td><td><pre>    ]</pre></td></tr><tr><td data-num="17"></td><td><pre>    读取 .ks 文件时使用 shift_jis 编码（原文件为 shift_jis 格式），</pre></td></tr><tr><td data-num="18"></td><td><pre>    写入 JSON 文件使用 utf-8 编码。</pre></td></tr><tr><td data-num="19"></td><td><pre>    """</pre></td></tr><tr><td data-num="20"></td><td><pre>    extracted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    ks_files <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>input_dir<span class="token punctuation">)</span> <span class="token keyword">if</span> f<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".ks"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">for</span> filename <span class="token keyword">in</span> ks_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"shift_jis"</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token comment"># 使用 findall 提取匹配结果</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                matches <span class="token operator">=</span> exlink_pattern<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token keyword">for</span> <span class="token keyword">match</span> <span class="token keyword">in</span> matches<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                    <span class="token comment"># 如果 match 是元组（有多个捕获组），取第二个，否则直接使用 match</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                        extracted_message <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                        extracted_message <span class="token operator">=</span> <span class="token keyword">match</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    extracted<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> extracted_message<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    </pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_json<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>extracted<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    </pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取完成，共提取 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>extracted<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 条数据，保存在：</span><span class="token interpolation"><span class="token punctuation">{</span>output_json<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">def</span> <span class="token function">update_options</span><span class="token punctuation">(</span>translation_dir<span class="token punctuation">,</span> extracted_json<span class="token punctuation">,</span> translation_json<span class="token punctuation">,</span> output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    遍历 translation_dir 下所有 UTF-16 LE 编码的 .ks 文件，查找 @exlink txt="原文"，</pre></td></tr><tr><td data-num="47"></td><td><pre>    在 extracted_json 里查找该原文的索引，并用 translated_options.json 里相同索引的翻译替换。</pre></td></tr><tr><td data-num="48"></td><td><pre>    处理后的 .ks 文件以 UTF-16 LE 编码保存在 output_dir。</pre></td></tr><tr><td data-num="49"></td><td><pre>    """</pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token comment"># 读取原始提取的 JSON（用于定位索引）</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>extracted_json<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        extracted_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    </pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token comment"># 读取翻译后的 JSON</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>translation_json<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        translated_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token comment"># 构建原文到索引的映射</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    text_to_index <span class="token operator">=</span> <span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> idx <span class="token keyword">for</span> idx<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>extracted_data<span class="token punctuation">)</span><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>    ks_files <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>translation_dir<span class="token punctuation">)</span> <span class="token keyword">if</span> f<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".ks"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    </pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">for</span> filename <span class="token keyword">in</span> ks_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>translation_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-16-le"</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"replace"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token comment"># 替换 @exlink txt="..." 的内容</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">def</span> <span class="token function">replace_exlink</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            original_text <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            <span class="token keyword">if</span> original_text <span class="token keyword">in</span> text_to_index<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                idx <span class="token operator">=</span> text_to_index<span class="token punctuation">[</span>original_text<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                <span class="token keyword">if</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>translated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                    translated_text <span class="token operator">=</span> translated_data<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>translated_text<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 如果找不到匹配项，则不替换</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>        updated_content <span class="token operator">=</span> exlink_pattern<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>replace_exlink<span class="token punctuation">,</span> content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token comment"># 写入新的 ks 文件（仍然使用 UTF-16 LE）</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        output_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-16-le"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>updated_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"文件 </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> 更新完成，保存到 </span><span class="token interpolation"><span class="token punctuation">{</span>output_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"所有文件更新完成。"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment"># 调用示例：你可以根据需要取消注释下面其中一个或两个调用进行测试</span></pre></td></tr><tr><td data-num="93"></td><td><pre></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    input_dir <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\data\scenario"</span> <span class="token comment"># 原始日文 ks 文件所在目录</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    extracted_json <span class="token operator">=</span> <span class="token string">"extracted_options.json"</span>           <span class="token comment"># 提取后的选项保存文件（待翻译）</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token comment"># 提取模式：提取所有 .ks 文件中的选项文本</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    extract_options<span class="token punctuation">(</span>input_dir<span class="token punctuation">,</span> extracted_json<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre>    translation_dir <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\inject"</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    translation_json <span class="token operator">=</span> <span class="token string">"translated_options.json"</span>     <span class="token comment"># 翻译后的 JSON</span></pre></td></tr><tr><td data-num="103"></td><td><pre>    output_dir <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\KrKr_Engine\見上げた空におちていく\inject_translated"</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    </pre></td></tr><tr><td data-num="105"></td><td><pre>    <span class="token comment"># 更新模式：将翻译后的文本写回到新的 .ks 文件中（请先完成 JSON 翻译后取消注释）</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token comment"># update_options(translation_dir, extracted_json, translation_json, output_dir)</span></pre></td></tr></tbody></table></figure><p>通过以上代码，得到 "extracted_options.json"，拿去翻译，得到 "translated_options.json"，再写到新的 ks 文件夹 "inject_translated"，里面的 ks 文件就都是翻译好的脚本和选择项。</p>
<h1 id="封包"><a class="anchor" href="#封包">#</a> 封包</h1>
<p>使用工具 <strong>Xp3Viewer</strong> ，将游戏拖到 xp3viewer，把下面的勾取消掉，如图：<br>
<img loading="lazy" data-src="/miyano/img/post/engine_tools/krkr3.webp" style="max-width: 100%; height: auto;"></p>
<p>再把 "inject_translated" 里的所有 ks 文件拖到 <code>\data\scenario</code>  替换原来的 ks；之后可以修改配置文件，使游戏内字体对中文的显示效果更好，修改文件 <code>data\system\Config.tjs</code> ，如下</p>
<pre><code>;userFace = "黑体"; // deffont タグの face 属性に相当
</code></pre>
<p>和后面的：</p>
<pre><code>// メッセージ履歴の設定です
// ◆ フォント名
;fontName = "黑体";
// ◆ フォントを太字にするか
;fontBold = true;
// ◆ フォントのサイズ ( pixel単位)
;fontHeight = 24;
// ◆ ラインの高さ
;lineHeight = 26;
</code></pre>
<p>这里的字体只要电脑有的就行。可参考<a target="_blank" rel="noopener" href="https://tieba.baidu.com/p/702500406">链接</a>，保存文件后，开始打包。<br>
把 <code>data</code>  文件夹拖到 xp3viewer 即可进行打包，得到 <code>data.xp3</code>  文件。注意：此时 <code>data</code>  文件夹一定不能在游戏目录内。</p>
<p>之后替换原游戏目录内的 <code>data.xp3</code>  即可，游戏可正常显示中文。<br>
注意：对于该游戏，由于之前打了补丁即加了 <code>patch.xp3</code>  文件，因此有些脚本实际是放在该文件里面的，要全汉化该游戏需要解包该 <code>patch,xp3</code>  并按前面流程完成翻译和打包，之后即可实现脚本全汉化。</p>
<h1 id="总结"><a class="anchor" href="#总结">#</a> 总结</h1>
<p>通过该游戏汉化实践发现，一般 KrKr2 游戏都是可以读取 <code>UTF-8</code>  的，并且最简单实用的解包工具还是选择 <code>KrKrExact</code> ，虽然该工具的 <code>Make Universal Patch</code>  和 <code>Make Package</code>  对本游戏没有用，也无法打包。但能简单的实现对加密游戏的解包，后续操作则使用其他工具即可。对于不同的游戏，可能对文本的处理会不一致，需要根据实际解包的脚本处理。</p>
<div class="tags"><a href="/miyano/tags/%E5%B7%A5%E5%85%B7/" rel="tag"><i class="ic i-tag"></i>工具</a></div></div><footer><div class="meta"></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Rei<i class="ic i-at"><em>@</em></i>自分の為に楽しめ世界</li><li class="link"><strong>本文链接：</strong><a href="https://ei4869.github.io/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%80)/" title="KrKr引擎汉化(一)">https://ei4869.github.io/miyano/Engine-Translation/KrKr引擎汉化(一)/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/miyano/Playful-Exploration/shokaX-%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%9B%B4%E6%8D%A2/" rel="prev" itemprop="url" data-background-image="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_16.webp" title="shokaX-图床搭建及更换"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>整活探索</span><h3>shokaX-图床搭建及更换</h3></a></div><div class="item right"><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%BA%8C)/" rel="next" itemprop="url" data-background-image="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_19.webp" title="KrKr引擎汉化(二)"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>引擎汉化</span><h3>KrKr引擎汉化(二)</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><div class="toc-article" id="toc-div"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text"> 使用的工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E5%8C%85"><span class="toc-number">3.</span> <span class="toc-text"> 解包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E5%92%8C%E6%B1%89%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text"> 处理文本和汉化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC"><span class="toc-number">4.1.</span> <span class="toc-text"> 处理文本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%89%E5%8C%96%E7%BF%BB%E8%AF%91%E4%B8%8E%E6%96%87%E6%9C%AC%E5%86%8D%E5%A4%84%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text"> 汉化翻译与文本再处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%81%E5%8C%85"><span class="toc-number">5.</span> <span class="toc-text"> 封包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text"> 总结</span></a></li></ol></div></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%B8%80)/" rel="bookmark" title="Escu:de汉化(一)——GBK编码">Escu:de汉化(一)——GBK编码</a></li><li><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%BA%8C)%20/" rel="bookmark" title="Escu:de汉化(二)——jis替换">Escu:de汉化(二)——jis替换</a></li><li class="active"><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%80)/" rel="bookmark" title="KrKr引擎汉化(一)">KrKr引擎汉化(一)</a></li><li><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%BA%8C)/" rel="bookmark" title="KrKr引擎汉化(二)">KrKr引擎汉化(二)</a></li><li><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%89)/" rel="bookmark" title="KrKr引擎汉化(三)">KrKr引擎汉化(三)</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Rei" src="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/ai-icon.webp"><p class="name" itemprop="name">Rei</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/miyano/archives/"><span class="count">43</span><span class="name">文章</span></a></div><div class="item categories"><a href="/miyano/categories/"><span class="count">10</span><span class="name">分类</span></a></div><div class="item tags"><a href="/miyano/tags/"><span class="count">9</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/ei4869" class="item github" title="https://github.com/ei4869"><i class="ic i-github"></i></a><a href="mailto:ai4869@gmail.com" class="item email" title="mailto:ai4869@gmail.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/miyano/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/miyano/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/miyano/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/miyano/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-baibaoxiang"></i>宝箱</a><ul class="submenu"><li class="item"><a href="/miyano/gallery/" rel="section"><i class="ic i-xiangce"></i>相册</a></li><li class="item"><a href="/miyano/anime/" rel="section"><i class="ic i-pc-dongman"></i>追番</a></li></ul></li><li class="item"><a href="/miyano/about/" rel="section"><i class="ic i-user"></i>关于</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%BA%8C)/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/miyano/Playful-Exploration/shokaX-%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%9B%B4%E6%8D%A2/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Scientific-Notes/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Scientific-Notes/Literature-Translation/2024-11-25-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%BA%94/">文献翻译(五)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Scientific-Notes/Opening-Report/" title="分类于开题报告">开题报告</a></div><span><a href="/miyano/Scientific-Notes/Opening-Report/%E5%BC%80%E9%A2%98%E6%8A%A5%E5%91%8A-%E5%8F%82%E8%80%83%E8%AE%BA%E6%96%87(%E4%BA%8C)/">开题报告-参考论文(二)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Course-Study/" title="分类于课程学习">课程学习</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Course-Study/Japanese/" title="分类于日语">日语</a></div><span><a href="/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC4%E5%8D%95%E5%85%83/">单元四——小李的公司生活</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Scientific-Notes/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Scientific-Notes/Literature-Translation/2024-11-24-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E5%9B%9B/">文献翻译(四)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Course-Study/" title="分类于课程学习">课程学习</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Course-Study/Japanese/" title="分类于日语">日语</a></div><span><a href="/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8B-%E7%AC%AC8%E5%8D%95%E5%85%83/">单元八——余暇</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div style="width: 100%; text-align: center;"><span id="time">此站已存活 0 天 0 小时 0 分 0 秒</span></div><script src="/miyano/js/create-time.js" defer="defer"></script><div class="status"><div class="copyright">© 2024 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Rei @ Rei の 手帳</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">598k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">9h4min</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
        path: `Engine-Translation/KrKr引擎汉化(一)/`,
        favicon: {
        show: `（●´3｀●）萌え萌えキュン`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    justifiedGallery: true,
    jquery: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4H41ZSPP7G"></script><script data-pjax="data-pjax">window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-4H41ZSPP7G');</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/miyano/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer=""></script></body></html>