<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/miyano/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/miyano/assets/apple-touch-icon.png"><link rel="alternate" href="/miyano/rss.xml" title="自分の為に楽しめ世界" type="application/rss+xml"><link rel="alternate" href="/miyano/atom.xml" title="自分の為に楽しめ世界" type="application/atom+xml"><link rel="alternate" type="application/json" title="自分の為に楽しめ世界" href="https://ei4869.github.io/miyano/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="preconnect" href="https://cloudflare-imgbed-9os.pages.dev"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/app.css?v=0.4.17"><link rel="modulepreload" href="/miyano/js/chunk-424DDEWW.js"><link rel="modulepreload" href="/miyano/js/chunk-GL47M7BI.js"><link rel="modulepreload" href="/miyano/js/chunk-LOCL5DEO.js"><link rel="modulepreload" href="/miyano/js/chunk-MTLQDVVJ.js"><link rel="modulepreload" href="/miyano/js/chunk-MWLQAVNJ.js"><link rel="modulepreload" href="/miyano/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/miyano/js/comments-QIVDG7X3.js"><link rel="modulepreload" href="/miyano/js/copy-tex-W2MNAMYO.js"><link rel="modulepreload" href="/miyano/js/index.esm-3GUGPDKE.js"><link rel="modulepreload" href="/miyano/js/post-WAGXKCY2.js"><link rel="modulepreload" href="/miyano/js/quicklink-DDPSWSOQ.js"><link rel="modulepreload" href="/miyano/js/search-5ACYIQUA.js"><link rel="modulepreload" href="/miyano/js/siteInit.js"><link rel="modulepreload" href="/miyano/js/waline-NVSVNCZW.js"><link rel="stylesheet" href="/miyano/css/comments-LAB2J3GR.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/siteInit.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/waline-7JVHAYE3.css" media="none" onload="this.media='all'"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_15.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_10.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_1.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_2.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_8.webp" as="image" fetchpriority="high"><link rel="preload" href="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_3.webp" as="image" fetchpriority="high"><meta name="keywords" content="工具"><meta name="description" content="使用dll注入，使编码为GBK的脚本能在游戏显示中文。"><link rel="canonical" href="https://ei4869.github.io/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%B8%80)/"><script>window.sakuraConfig = {
  sakura: 30,
  xSpeed: 0.5,
  ySpeed: 0.5,
  rSpeed: 0.03,
  direction: "TopRight",
  zIndex: -1
};</script><script src="https://cdn.jsdelivr.net/gh/minz71/sakura-rain/sakura-rain.js" defer="defer"></script><title>Escu:de汉化(一)——GBK编码</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Escu:de汉化(一)——GBK编码</h1><div class="meta"><span class="item" title="创建时间：2025-02-17 10:00:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-02-17T10:00:00+08:00">2025-02-17</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>17k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>16min</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/miyano/" rel="start">Rei の 手帳</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_15.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_10.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_1.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_2.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_8.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_3.webp&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/miyano/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/miyano/categories/Engine-Translation/" itemprop="item" rel="index" title="分类于引擎汉化"><span itemprop="name">引擎汉化<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://ei4869.github.io/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%B8%80)/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/miyano/assets/ai-icon.webp"><meta itemprop="name" content="Rei"><meta itemprop="description" content=", "></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="自分の為に楽しめ世界"></span><div class="body md" itemprop="articleBody"><div class="tabs" id="summary"><div class="show-btn"></div><div class="nav"><ul class="special"></ul></div><div class="tab active" data-id="summary" data-title="自我介绍"><p>我是基于Kimi moonshot-v1-8k实现的AI助手，在此博客上负责整理和概括文章</p></div><div class="tab" data-id="summary" data-title="文章概括"><p></p></div></div><details class="info"><summary>编辑记录</summary><div>
<div class="note info">
<p>2025-02-17 10:00:00 第一次编辑</p>
</div>
<ul>
<li>正文</li>
</ul>
</div></details>
<h2 id="简介"><a class="anchor" href="#简介">#</a> 简介</h2>
<p>本文章为使 <strong>Escu:de</strong> 游戏显示 GBK 编码的脚本的教程。包括解包、翻译、编码转换、封包、dll 注入。</p>
<h2 id="使用的工具"><a class="anchor" href="#使用的工具">#</a> 使用的工具</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://cottony-vase-131.notion.site/EsuBinE-6f81af237d414e2397f8e98a2104e2a1">EsuBinE</a></li>
<li><a target="_blank" rel="noopener" href="https://cottony-vase-131.notion.site/EsuBinL-9c0b183c22ef425794bf6740e1d5548d">EsuBinL</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Chenx221/EscudeTools">EsucudeTools</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xd2333/GalTransl">GalTransl</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bodong1987/AHeadLib.Net">AHeadLib.Net</a></li>
<li>x32dbg</li>
<li>Extreme Injector</li>
</ul>
<h2 id="解包"><a class="anchor" href="#解包">#</a> 解包</h2>
<p>使用工具：<a target="_blank" rel="noopener" href="https://cottony-vase-131.notion.site/EsuBinE-6f81af237d414e2397f8e98a2104e2a1">EsuBinE</a>、<a target="_blank" rel="noopener" href="https://cottony-vase-131.notion.site/EsuBinL-9c0b183c22ef425794bf6740e1d5548d">EsuBinL</a>。</p>
<ol>
<li>取出 script.bin 的文件</li>
</ol>
<ul>
<li>可以使用<strong> GARbro</strong> 手动解包 script.bin 取出其中的所有文件，一般包括 staff 文件夹和其他.001 和.bin 文件。把这些文件解包到一个文件夹中，例如 script_source/output/script 中。</li>
<li>也可以使用<strong> EscudeTools</strong> 工具，运行命令:</li>
</ul>
<figure class="highlight bash"><figcaption data-lang="bash"><span>解包script.bin</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>Tool<span class="token punctuation">\</span>汉化工具<span class="token punctuation">\</span>net8.0<span class="token punctuation">\</span>EscudeTools.exe <span class="token parameter variable">-u</span> D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source</pre></td></tr></tbody></table></figure><p>其中 script_source 含有 script.bin 文件。运行命令后文件解包在 script_source/output/script 中。</p>
<p>最好使用<strong> EscudeTools</strong> 工具进行解包，因为方便后续封包，该方式解包会生成附加的包信息文件，能封回原包。</p>
<ol start="2">
<li>处理解包的文件<br>
控制台运行命令：</li>
</ol>
<figure class="highlight bash"><figcaption data-lang="bash"><span>把.001文件解包为txt</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>Tool<span class="token punctuation">\</span>汉化工具<span class="token punctuation">\</span>EsuBinE<span class="token punctuation">\</span>EsuBinE200_ORG.exe <span class="token parameter variable">-dump</span> <span class="token parameter variable">-b</span> <span class="token parameter variable">-enc</span> D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source<span class="token punctuation">\</span>output<span class="token punctuation">\</span>script D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source<span class="token punctuation">\</span>output<span class="token punctuation">\</span>script_txt</pre></td></tr></tbody></table></figure><p>注意要创建好 <code>script_source\output\script_txt</code>  文件夹才能成功。</p>
<h2 id="处理txt文件用于翻译"><a class="anchor" href="#处理txt文件用于翻译">#</a> 处理 txt 文件用于翻译</h2>
<p>原编码默认为 <strong>shift-jis</strong>，需要先转为 <strong>UTF-8</strong> 用于翻译。</p>
<figure class="highlight python"><figcaption data-lang="python"><span>转为utf-8</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> chardet</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">convert_encoding</span><span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token triple-quoted-string string">""" 将文件夹内所有文本文件从 Shift-JIS 转为 UTF-8 """</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    target_encodings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'shift_jis'</span><span class="token punctuation">,</span> <span class="token string">'shift-jis'</span><span class="token punctuation">,</span> <span class="token string">'sjis'</span><span class="token punctuation">,</span> <span class="token string">'cp932'</span><span class="token punctuation">,</span> <span class="token string">'windows-31j'</span><span class="token punctuation">,</span> <span class="token string">'mskanji'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment"># 检测文件编码</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            raw_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            detected <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            encoding <span class="token operator">=</span> detected<span class="token punctuation">[</span><span class="token string">'encoding'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            confidence <span class="token operator">=</span> detected<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'confidence'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment"># 判断是否为目标编码（不区分大小写）</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        is_target <span class="token operator">=</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> encoding<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            is_target <span class="token operator">=</span> encoding<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> target_encodings</pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token comment"># 编码检测失败时，强制尝试转换</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            is_target <span class="token operator">=</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">if</span> is_target<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token comment"># 优先使用 cp932 解码并替换非法字符</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'cp932'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                    content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                </pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token comment"># 写回 UTF-8 编码</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[OK] 已转换: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Error] 转换失败: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[跳过] 非目标文件: </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> (检测编码: </span><span class="token interpolation"><span class="token punctuation">{</span>encoding<span class="token punctuation">}</span></span><span class="token string">, 置信度: </span><span class="token interpolation"><span class="token punctuation">{</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    folder_path <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\Escude_Translate\script_source\output\script_txt"</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    convert_encoding<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"编码转换完成！"</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>接下来，对 txt 进行处理，转化为用于翻译的 json 格式，已知前面生成的 txt 的格式为：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>##000001##|凜有思考過『故事的后続』龜。</pre></td></tr><tr><td data-num="2"></td><td><pre>%%000001%%|凜有思考過『故事的后続』龜。</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>##000002##|我第一次意識到這件事，已経是很久以前的事了。</pre></td></tr><tr><td data-num="5"></td><td><pre>%%000002%%|我第一次意識到這件事，已経是很久以前的事了。</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>##000003##|我曾経有過祖母。</pre></td></tr><tr><td data-num="8"></td><td><pre>%%000003%%|我曾経有過祖母。</pre></td></tr></tbody></table></figure><p>需要的 json 格式为：</p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"既然是梦的話ーー那我継続齣浸其中也无妨槇。"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"「那就這樣槇」"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></tbody></table></figure><p>转换 txt 到 json 的代码：</p>
<figure class="highlight python"><figcaption data-lang="python"><span>转化为json</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> glob</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">process_text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    处理文本：</pre></td></tr><tr><td data-num="9"></td><td><pre>      1. 将 &lt;ruby text='XXX'&gt;YYY&lt;/ruby&gt; 替换为 YYY</pre></td></tr><tr><td data-num="10"></td><td><pre>      2. （如有需要，可以添加其它处理规则）</pre></td></tr><tr><td data-num="11"></td><td><pre>    """</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># 使用正则表达式替换 ruby 标签</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 匹配形式：&lt;ruby text=' くさかべあきら '&gt; 日下部彰 &amp; lt;/ruby&gt; 替换为 日下部彰</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># text = re.sub(r"&lt;ruby\s+text='[^']*'&gt;(.*?)&lt;/ruby&gt;", r"\1", text)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 如果需要去掉 &lt;r&gt; 标签（如果它确实需要被删除），可以取消下面代码的注释</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># text = text.replace("&lt;r&gt;", "")</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> text</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 用于存放所有处理后的对话列表</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    dialogues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># 读取文件夹中所有 txt 文件</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    txt_files <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token string">"*.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">for</span> file_path <span class="token keyword">in</span> txt_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token comment"># 使用 set 来去重同一文件内的重复文本</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            seen_texts <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                    <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token comment"># 分割字符串，取 | 后面的文本（假定每行只有一个 | 分隔符）</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token keyword">if</span> <span class="token string">"|"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    parts <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    text <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token comment"># 如果文本已存在则跳过（去除重复）</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token keyword">if</span> text <span class="token keyword">in</span> seen_texts<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                        <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    seen_texts<span class="token punctuation">.</span>add<span class="token punctuation">(</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                    <span class="token comment"># 处理文本</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                    processed_text <span class="token operator">=</span> process_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                    <span class="token comment"># 添加到对话列表中，name 暂时为空字符串</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                    dialogues<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                        <span class="token string">"message"</span><span class="token punctuation">:</span> processed_text</pre></td></tr><tr><td data-num="46"></td><td><pre>                    <span class="token punctuation">}</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    </pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token comment"># 最终写入 JSON 文件（可根据需要修改输出路径）</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    output_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token string">"output.json"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>dialogues<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"处理完成，结果保存在 </span><span class="token interpolation"><span class="token punctuation">{</span>output_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token comment"># 指定需要处理的文件夹路径</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    folder_path <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\Escude_Translate\script_source\output\script_txt"</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    convert<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h2 id="进行翻译"><a class="anchor" href="#进行翻译">#</a> 进行翻译</h2>
<p>使用工具<a target="_blank" rel="noopener" href="https://github.com/xd2333/GalTransl"><strong> GalTransl</strong></a>，按照要求，编写字典，配置文件，完成翻译。</p>
<h2 id="编码转换处理翻译好的json回txt"><a class="anchor" href="#编码转换处理翻译好的json回txt">#</a> 编码转换，处理翻译好的 json 回 txt</h2>
<p>方法为读取原先的 txt 文件，按其原格式，把翻译好的 json 的文本，转换为 GBK 编码后再写回 txt，用于后续打包。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> glob</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> chardet  <span class="token comment"># 需要安装 `pip install chardet`</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">detect_encoding</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        raw_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>  <span class="token comment"># 读取部分数据用于检测</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    result <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> result<span class="token punctuation">[</span><span class="token string">"encoding"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    translated_json_path <span class="token operator">=</span> <span class="token string">r"D:\Tool\GalTransl\GalTransl-v5.9.1-win\sampleProject\gt_output\script_jp.json"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    original_folder <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\Escude_Translate\script_source\output\script_txt"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    new_folder <span class="token operator">=</span> <span class="token string">r"D:\Data\python_prj\Escude_Translate\script_source\output\script_txt"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>new_folder<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    output_encoding <span class="token operator">=</span> <span class="token string">"gbk"</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>translated_json_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        translated_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    translated_index <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    total_translated <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>translated_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    txt_files <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>original_folder<span class="token punctuation">,</span> <span class="token string">"*.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">for</span> file_path <span class="token keyword">in</span> txt_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        detected_encoding <span class="token operator">=</span> detect_encoding<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">if</span> detected_encoding <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"警告：无法检测文件 </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 的编码，默认使用 GBK。"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            detected_encoding <span class="token operator">=</span> <span class="token string">"gbk"</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>        new_lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        mapping <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>detected_encoding<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"replace"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                    line <span class="token operator">=</span> line<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    <span class="token keyword">if</span> <span class="token string">"|"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                        new_lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                        <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>                    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                        prefix<span class="token punctuation">,</span> orig_msg <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                        new_lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                        <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>                    <span class="token keyword">if</span> orig_msg <span class="token keyword">not</span> <span class="token keyword">in</span> mapping<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                        <span class="token keyword">if</span> translated_index <span class="token operator">&gt;=</span> total_translated<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"错误：翻译后的条目不足以覆盖文件 </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                            <span class="token keyword">return</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                        mapping<span class="token punctuation">[</span>orig_msg<span class="token punctuation">]</span> <span class="token operator">=</span> translated_data<span class="token punctuation">[</span>translated_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                        translated_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>                    new_line <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">|</span><span class="token interpolation"><span class="token punctuation">{</span>mapping<span class="token punctuation">[</span>orig_msg<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="58"></td><td><pre>                    new_lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"读取文件 </span><span class="token interpolation"><span class="token punctuation">{</span>file_path<span class="token punctuation">}</span></span><span class="token string"> 失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>        new_file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_folder<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>new_file_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>output_encoding<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"replace"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_out<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            f_out<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_lines<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token comment"># print (f"写入 {new_file_path}，共更新 {len (new_lines)} 行。")</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token keyword">if</span> translated_index <span class="token operator">&lt;</span> total_translated<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"注意：还有未使用的翻译条目。"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token keyword">elif</span> translated_index <span class="token operator">&gt;</span> total_translated<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"错误：翻译条目不足以覆盖所有文件中的对话条目！"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"转换完成，所有翻译条目已按原始文件对应写入新 txt 文件中。"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>这样，原来 Escude_Translate\script_source\output\script_txt 的编码转为了 GBK。</p>
<h2 id="封包"><a class="anchor" href="#封包">#</a> 封包</h2>
<ol>
<li>把翻译、编码转换后的 txt 打包回.001 文件，替换了原来的.001<br>
 运行命令：</li>
</ol>
<figure class="highlight bash"><figcaption data-lang="bash"><span>打包txt回.001文件</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>Tool<span class="token punctuation">\</span>汉化工具<span class="token punctuation">\</span>EsuBinE<span class="token punctuation">\</span>EsuBinE200_ORG.exe <span class="token parameter variable">-repack</span> <span class="token parameter variable">-b</span> <span class="token parameter variable">-enc</span> D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source<span class="token punctuation">\</span>output<span class="token punctuation">\</span>script_txt D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source<span class="token punctuation">\</span>output<span class="token punctuation">\</span>script</pre></td></tr></tbody></table></figure><ol start="2">
<li>封包回 script.bim<br>
 使用<strong> EscudeTools</strong> 工具，运行命令：</li>
</ol>
<figure class="highlight bash"><figcaption data-lang="bash"><span>打包回script.bin</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>Tool<span class="token punctuation">\</span>汉化工具<span class="token punctuation">\</span>net8.0<span class="token punctuation">\</span>EscudeTools.exe <span class="token parameter variable">-r</span> D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>script_source<span class="token punctuation">\</span>output</pre></td></tr></tbody></table></figure><p>至此，得到了编码为 GBK 的 script.bin，替换游戏目录里的 script.bin。</p>
<h2 id="dll注入"><a class="anchor" href="#dll注入">#</a> dll 注入</h2>
<h3 id="修改游戏文件"><a class="anchor" href="#修改游戏文件">#</a> 修改游戏文件</h3>
<p>以悠刻のファムファタル为例，主程序名字是 femme_fatale.exe，那么它的配置 bin 名字就叫 femme_fatale.bin。该文件保存到 Escude_Translate\femme，进行解包：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>Tool<span class="token punctuation">\</span>汉化工具<span class="token punctuation">\</span>net8.0<span class="token punctuation">\</span>EscudeTools.exe <span class="token parameter variable">-u</span> D:<span class="token punctuation">\</span>Data<span class="token punctuation">\</span>python_prj<span class="token punctuation">\</span>Escude_Translate<span class="token punctuation">\</span>femme</pre></td></tr></tbody></table></figure><p>得到 Escude_Translate\femme\output\femme_fatale，进入 misc 目录，找到 text.c 文件。打开这个文件后，找到 init_default_font 函数的调用，内容改为：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">init_default_font</span><span class="token punctuation">(</span><span class="token keyword">int</span> font_id<span class="token punctuation">,</span> <span class="token keyword">int</span> weight<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  default_font_id <span class="token operator">=</span> FT_USER<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  default_font_weight <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">strcpy</span><span class="token punctuation">(</span>user_font_name<span class="token punctuation">,</span><span class="token string">"SimHei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  </pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">//ini_gets("Font", "Face", "", user_font_name, sizeof(user_font_name), NULL);</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">//if(user_font_name[0] != '\0'){</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">//  default_font_id = FT_USER;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">//  default_font_weight = 400;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">//  if(ini_geti("Font", "Bold", 0, NULL)){</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">//    default_font_weight = 700;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">//  }</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">//}</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>修改字符检测，去到 lib 目录下 string.h 注释掉原来的即可显示中文。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">//#define ISKANJI(x)((((x)^0x20)-0xa1) &lt;= 0x3b)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ISKANJI</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0x81</span><span class="token punctuation">)</span></span></span></pre></td></tr></tbody></table></figure><p>同样修改文件后封包回 femme_fatale.bin。</p>
<pre><code>D:\Tool\汉化工具\net8.0\EscudeTools.exe -r D:\Data\python_prj\Escude_Translate\femme\output
</code></pre>
<p>在 Escude_Translate\femme\output 找到 femme_fatale.bin，替换原游戏目录里的。</p>
<h3 id="生成dll"><a class="anchor" href="#生成dll">#</a> 生成 dll</h3>
<p>编写一个 CreateFontIndirectA 的 hook，在调用前判断 LOGFONT 的 lfCharSet 字段，如果为 0x80（Shift-JIS），则修改为 0x86（GB2312/GBK），然后调用原函数。<br>
方法是利用 MinHook 库实现 DLL 注入后 hook CreateFontIndirectA ，达到在游戏启动时将 LOGFONT 中 lfCharSet 从 0x80 修改为 0x86 的目的。</p>
<ol>
<li>
<p>创建 DLL 工程<br>
用 Visual Studio 新建一个 Win32 DLL 工程（例如项目名 “FontHook”）。可以选择 “动态链接库 (DLL)” 的模板。</p>
</li>
<li>
<p>集成 MinHook 库<br>
从 <a target="_blank" rel="noopener" href="https://github.com/TsudaKageyu/minhook">MinHook 官方 GitHub</a> 下载最新版本，（下载 include 和 src 文件夹）将 MinHook 的头文件和静态库（或源码）添加到工程中，并在项目设置中链接相应库。</p>
</li>
<li>
<p>添加 DLL 代码文件</p>
</li>
</ol>
<ul>
<li>添加源代码文件
<ul>
<li>在 “解决方案资源管理器” 中，右键点击项目 “FontHook”，选择 “添加” -&gt; “新建项…”。</li>
<li>在弹出的 “添加新项” 窗口中选择 “C++ 文件 (.cpp)”。</li>
<li>文件名输入 “DllMain.cpp”，点击 “添加”。</li>
</ul>
</li>
<li>编写代码<br>
该代码基于 MinHook 实现对 CreateFontIndirectA 的 hook，检测 LOGFONTA 结构中的 lfCharSet 字段，若值为 0x80（Shift-JIS）则修改为 0x86（GB2312/GBK）。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;tchar.h&gt;</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MinHook.h"</span>   <span class="token comment">// 请确保该头文件可以被找到</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 定义 CreateFontIndirectA 的函数指针类型</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> <span class="token function">HFONT</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> PFN_CreateFontIndirectA<span class="token punctuation">)</span><span class="token punctuation">(</span>CONST LOGFONTA<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>PFN_CreateFontIndirectA fpCreateFontIndirectA <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// 保存原始函数地址</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// Hook 后的 CreateFontIndirectA 实现</span></pre></td></tr><tr><td data-num="10"></td><td><pre>HFONT WINAPI <span class="token function">Hooked_CreateFontIndirectA</span><span class="token punctuation">(</span>CONST LOGFONTA<span class="token operator">*</span> lpLogFont<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 拷贝一份 LOGFONTA 结构，避免修改原内存</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    LOGFONTA newLogFont <span class="token operator">=</span> <span class="token operator">*</span>lpLogFont<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 如果 lfCharSet 为 0x80（Shift-JIS），则修改为 0x86（GB2312/GBK）</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newLogFont<span class="token punctuation">.</span>lfCharSet <span class="token operator">==</span> <span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        newLogFont<span class="token punctuation">.</span>lfCharSet <span class="token operator">=</span> <span class="token number">0x86</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 调用原始函数</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">fpCreateFontIndirectA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newLogFont<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">// 初始化 Hook 的函数</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">InitHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 初始化 MinHook</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment">// 获取 gdi32.dll 模块句柄</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    HMODULE hGDI32 <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"gdi32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hGDI32 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 获取 CreateFontIndirectA 函数地址</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    FARPROC pCreateFontIndirectA <span class="token operator">=</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hGDI32<span class="token punctuation">,</span> <span class="token string">"CreateFontIndirectA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pCreateFontIndirectA <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token comment">// 创建 Hook，将 pCreateFontIndirectA 替换为 Hooked_CreateFontIndirectA，并保存原始函数地址</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_CreateHook</span><span class="token punctuation">(</span>pCreateFontIndirectA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Hooked_CreateFontIndirectA<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>LPVOID<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fpCreateFontIndirectA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token comment">// 启用 Hook</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_EnableHook</span><span class="token punctuation">(</span>pCreateFontIndirectA<span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">// DLL 主入口函数</span></pre></td></tr><tr><td data-num="60"></td><td><pre>BOOL APIENTRY <span class="token function">DllMain</span><span class="token punctuation">(</span>HMODULE hModule<span class="token punctuation">,</span> DWORD ul_reason_for_call<span class="token punctuation">,</span> LPVOID lpReserved<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ul_reason_for_call<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">case</span> DLL_PROCESS_ATTACH<span class="token operator">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token comment">// 禁用 DLL_THREAD_ATTACH/DLL_THREAD_DETACH 通知（可选）</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token function">DisableThreadLibraryCalls</span><span class="token punctuation">(</span>hModule<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token comment">// 调用初始化 Hook 的函数</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token function">InitHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token keyword">case</span> DLL_PROCESS_DETACH<span class="token operator">:</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token function">MH_Uninitialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><ol start="4">
<li>集成 MinHook 库</li>
</ol>
<ul>
<li>添加包含目录
<ul>
<li>在 “解决方案资源管理器” 中右键点击项目 “FontHook”，选择 “属性”（Properties）。</li>
<li>在左侧选择 “C/C++” -&gt; “常规” -&gt; “附加包含目录”（Additional Include Directories）。点击编辑按钮，添加你存放 MinHook 头文件的目录，例如：D:/Data/Design/C_project/minhook/include.</li>
</ul>
</li>
<li>将 MinHook 的源码（例如 minhook.c）添加到你的项目中进行编译。<br>
在 “源文件” 中右键点击 “添加”-&gt; “现有项”，把 D:/Data/Design/C_project/minhook/src 里的所有文件包括子文件里的文件添加进去。</li>
</ul>
<ol start="5">
<li>配置项目生成 DLL</li>
</ol>
<ul>
<li>在项目属性中，确保 “配置” 设置为 “所有配置”（All Configurations）。</li>
<li>选择 “配置属性” -&gt; “常规”，确保 “配置类型” 设置为 “动态库 (.dll)”。</li>
</ul>
<ol start="6">
<li>修改项目平台为 Win32</li>
</ol>
<ul>
<li>
<p>打开项目的配置管理器<br>
在 Visual Studio 中，点击菜单 “生成” → “配置管理器”。</p>
</li>
<li>
<p>添加或切换平台</p>
<ul>
<li>在 “活动解决方案平台” 下拉框中查看是否有 “Win32”。</li>
<li>如果没有，则点击 “&lt;新建…&gt;”，在弹出的 “新建解决方案平台” 对话框中，选择 “Win32” 作为新平台，并选择 “复制自” 当前平台（如 x64），然后点击 “确定”。</li>
</ul>
</li>
<li>
<p>设置 Win32 为当前平台<br>
确保 “活动解决方案平台” 选择的是 “Win32”。这时项目将以 32 位方式编译。</p>
</li>
</ul>
<ol start="7">
<li>禁用预编译头</li>
</ol>
<ul>
<li>在 解决方案资源管理器 中右键点击你的项目（例如 “FontHook”），选择 属性。</li>
<li>在弹出的 “属性页” 中，展开 C/C++ -&gt; 预编译头。</li>
<li>将 预编译头 选项修改为 不使用预编译头（Not Using Precompiled Headers）。</li>
<li>点击 确定 保存设置。</li>
<li>删除 pch.h 和 pch.c。</li>
</ul>
<ol start="8">
<li>生成解决方案<br>
输出目录（例如 Debug 下）会生成一个 32 位的 FontHook.dll。</li>
</ol>
<h3 id="注入dll方式一"><a class="anchor" href="#注入dll方式一">#</a> 注入 dll (方式一)</h3>
<p>使用<strong> Extreme Injector</strong> 工具。</p>
<ol>
<li>选择目标进程</li>
</ol>
<ul>
<li>在 Extreme Injector 的界面中，点击 “Select” 按钮，在弹出的进程列表中找到目标游戏进程（例如游戏的 exe 名称）。</li>
<li>如果游戏还没有启动，你需要先启动游戏，然后再用注入器选择其进程。</li>
</ul>
<ol start="2">
<li>添加 DLL 文件</li>
</ol>
<ul>
<li>点击 “Add” 按钮，浏览到你生成的 FontHook.dll 所在目录（例如 D:\Data\Design\C_project\FontHook\Debug）。</li>
<li>选择 FontHook.dll 添加到列表中。</li>
</ul>
<ol start="3">
<li>
<p>设置注入参数<br>
这里选择了 inject method 为 thread hijacking 后注入成功。</p>
</li>
<li>
<p>执行注入</p>
</li>
</ol>
<ul>
<li>点击 “Inject” 按钮，注入器会将 FontHook.dll 加载到目标游戏进程中。</li>
<li>如果注入成功，注入器一般会显示成功提示。</li>
</ul>
<h3 id="注入dll方式二"><a class="anchor" href="#注入dll方式二">#</a> 注入 dll (方式二)</h3>
<p>DLL 劫持。<br>
当 Windows 应用程序启动时，它会尝试加载所需的 DLL 文件。Windows 按以下顺序搜索 DLL：</p>
<ul>
<li>应用程序目录（当前 EXE 目录）</li>
<li>C:\Windows\System32</li>
<li>C:\Windows\SysWOW64（对于 32 位程序在 64 位 Windows 上运行时）</li>
<li>其他注册表指定的路径<br>
如果你在 应用程序目录 放置一个与程序加载的 DLL 同名的文件，那么程序会 优先加载你自己的 DLL，从而实现自动注入。</li>
</ul>
<p>可以使用 <strong>x32dbg</strong> 工具，打开游戏 exe，在” 日志 “中可以看到调用的 dll。</p>
<p>这里准备对  <code>version.dll</code>  进行劫持。<br>
使用<a target="_blank" rel="noopener" href="https://github.com/bodong1987/AHeadLib.Net"> AHeadLib.Net</a> 工具，先把 <code>C:\Windows\SysWOW64\version.dll</code>  文件复制出来，然后使用该工具，得到一个该 dll 的工程文件，修改其 <code>version_DllMain.cpp</code>  的代码，加入 Hook 的功能，并且同样在 <code>Win32</code>  平台下，导入 MinHook 的 include 和 src 里的文件，禁用预编译功能。修改后的代码为：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"><span>version_DllMain.cpp</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// generated by tools</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// AHeadLib.Net</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// https://github.com/bodong1987/AHeadLib.Net</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Powered by bodong</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;tchar.h&gt;</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MinHook.h"</span>   <span class="token comment">// 请确保该头文件可以被找到</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 定义 CreateFontIndirectA 的函数指针类型</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">typedef</span> <span class="token function">HFONT</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> PFN_CreateFontIndirectA<span class="token punctuation">)</span><span class="token punctuation">(</span>CONST LOGFONTA<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>PFN_CreateFontIndirectA fpCreateFontIndirectA <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// 保存原始函数地址</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">CheckedLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">ApplyBuiltinPatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">ExecuteUserCustomCodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">extern</span> <span class="token keyword">bool</span> <span class="token function">ShouldExecuteAttachCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// Hook 后的 CreateFontIndirectA 实现</span></pre></td></tr><tr><td data-num="20"></td><td><pre>HFONT WINAPI <span class="token function">Hooked_CreateFontIndirectA</span><span class="token punctuation">(</span>CONST LOGFONTA<span class="token operator">*</span> lpLogFont<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 拷贝一份 LOGFONTA 结构，避免修改原内存</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    LOGFONTA newLogFont <span class="token operator">=</span> <span class="token operator">*</span>lpLogFont<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 如果 lfCharSet 为 0x80（Shift-JIS），则修改为 0x86（GB2312/GBK）</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newLogFont<span class="token punctuation">.</span>lfCharSet <span class="token operator">==</span> <span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        newLogFont<span class="token punctuation">.</span>lfCharSet <span class="token operator">=</span> <span class="token number">0x86</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">// 调用原始函数</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">fpCreateFontIndirectA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newLogFont<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">// 初始化 Hook 的函数</span></pre></td></tr><tr><td data-num="34"></td><td><pre>VOID <span class="token function">InitHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">// 初始化 MinHook</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token comment">// 获取 gdi32.dll 模块句柄</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    HMODULE hGDI32 <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"gdi32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hGDI32 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token comment">// 获取 CreateFontIndirectA 函数地址</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    FARPROC pCreateFontIndirectA <span class="token operator">=</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hGDI32<span class="token punctuation">,</span> <span class="token string">"CreateFontIndirectA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pCreateFontIndirectA <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token comment">// 创建 Hook，将 pCreateFontIndirectA 替换为 Hooked_CreateFontIndirectA，并保存原始函数地址</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_CreateHook</span><span class="token punctuation">(</span>pCreateFontIndirectA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Hooked_CreateFontIndirectA<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>LPVOID<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fpCreateFontIndirectA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token comment">// 启用 Hook</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">MH_EnableHook</span><span class="token punctuation">(</span>pCreateFontIndirectA<span class="token punctuation">)</span> <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>BOOL WINAPI <span class="token function">DllMain</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    HINSTANCE <span class="token comment">/*hInstance*/</span><span class="token punctuation">,</span>  <span class="token comment">// handle to DLL module</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token module">DWORD</span> fdwReason<span class="token punctuation">,</span>     <span class="token comment">// reason for calling function</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    LPVOID lpvReserved<span class="token punctuation">)</span>  <span class="token comment">// reserved</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token comment">// Perform actions based on the reason for calling.</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>fdwReason<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token keyword">case</span> DLL_PROCESS_ATTACH<span class="token operator">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token comment">// Initialize once for each new process.</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token comment">// Return FALSE to fail DLL load.</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token function">CheckedLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token function">InitHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ShouldExecuteAttachCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token comment">// apply internal patches</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token function">ApplyBuiltinPatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token comment">// apply user custom codes</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token function">ExecuteUserCustomCodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        </pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token keyword">case</span> DLL_THREAD_ATTACH<span class="token operator">:</span> <span class="token comment">// Do thread-specific initialization.</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token keyword">case</span> DLL_THREAD_DETACH<span class="token operator">:</span> <span class="token comment">// Do thread-specific cleanup.        </span></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token keyword">case</span> DLL_PROCESS_DETACH<span class="token operator">:</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lpvReserved <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// do not do cleanup if process termination scenario</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token comment">// Perform any necessary cleanup.</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>  <span class="token comment">// Successful DLL_PROCESS_ATTACH.</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>生成解决方案后，即可得到 <code>version.dll</code> ，将其复制到游戏目录下，游戏启动后，就会优先调用该目录下的 <code>version.dll</code> ，从而实现自动注入。</p>
<h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2>
<p>通过以上 DLL 注入的两种方式能成功使游戏显示中文，但是游戏内原来的日语会乱码，所以这种方式一般只适用于只注重脚本翻译的情况，很粗糙。<br>
而且对于 data.bin 的数据，难以转化为 GBK 的编码，原因有下：</p>
<ul>
<li>使用 <strong>EsuBinL</strong> 工具，解包会生成 json 文件，而对于 json 文件，难以使其编码转为 GBK。</li>
<li>使用 <strong>EscudeTools</strong> 工具，解包会生成 db 文件，无论如何处理，db 文件的内容都会以 shift-jis 的格式读取打包回.bin，无法实现转换。</li>
</ul>
<p>因此该方案局限性很大。</p>
<div class="tags"><a href="/miyano/tags/%E5%B7%A5%E5%85%B7/" rel="tag"><i class="ic i-tag"></i>工具</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/Engine-Translation/Gal汉化-Escude(一)/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-02-17 15:33:00" itemprop="dateModified" datetime="2025-02-17T15:33:00+08:00">2025-02-17</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Rei<i class="ic i-at"><em>@</em></i>自分の為に楽しめ世界</li><li class="link"><strong>本文链接：</strong><a href="https://ei4869.github.io/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%B8%80)/" title="Escu:de汉化(一)——GBK编码">https://ei4869.github.io/miyano/Engine-Translation/Gal汉化-Escude(一)/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="prev" itemprop="url" data-background-image="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_18.webp" title="shokaX主题-笔记"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>整活探索</span><h3>shokaX主题-笔记</h3></a></div><div class="item right"><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%BA%8C)%20/" rel="next" itemprop="url" data-background-image="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/kon_20.webp" title="Escu:de汉化(二)——jis替换"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>引擎汉化</span><h3>Escu:de汉化(二)——jis替换</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><div class="toc-article" id="toc-div"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text"> 使用的工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%8C%85"><span class="toc-number">3.</span> <span class="toc-text"> 解包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86txt%E6%96%87%E4%BB%B6%E7%94%A8%E4%BA%8E%E7%BF%BB%E8%AF%91"><span class="toc-number">4.</span> <span class="toc-text"> 处理 txt 文件用于翻译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E7%BF%BB%E8%AF%91"><span class="toc-number">5.</span> <span class="toc-text"> 进行翻译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%E5%A4%84%E7%90%86%E7%BF%BB%E8%AF%91%E5%A5%BD%E7%9A%84json%E5%9B%9Etxt"><span class="toc-number">6.</span> <span class="toc-text"> 编码转换，处理翻译好的 json 回 txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E5%8C%85"><span class="toc-number">7.</span> <span class="toc-text"> 封包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dll%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text"> dll 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%B8%B8%E6%88%8F%E6%96%87%E4%BB%B6"><span class="toc-number">8.1.</span> <span class="toc-text"> 修改游戏文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90dll"><span class="toc-number">8.2.</span> <span class="toc-text"> 生成 dll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5dll%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-number">8.3.</span> <span class="toc-text"> 注入 dll (方式一)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5dll%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-number">8.4.</span> <span class="toc-text"> 注入 dll (方式二)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text"> 总结</span></a></li></ol></div></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%B8%80)/" rel="bookmark" title="Escu:de汉化(一)——GBK编码">Escu:de汉化(一)——GBK编码</a></li><li><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%BA%8C)%20/" rel="bookmark" title="Escu:de汉化(二)——jis替换">Escu:de汉化(二)——jis替换</a></li><li><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%80)/" rel="bookmark" title="KrKr引擎汉化(一)">KrKr引擎汉化(一)</a></li><li><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%BA%8C)/" rel="bookmark" title="KrKr引擎汉化(二)">KrKr引擎汉化(二)</a></li><li><a href="/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%89)/" rel="bookmark" title="KrKr引擎汉化(三)">KrKr引擎汉化(三)</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Rei" src="https://miyano.oss-cn-wuhan-lr.aliyuncs.com/img/ai-icon.webp"><p class="name" itemprop="name">Rei</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/miyano/archives/"><span class="count">43</span><span class="name">文章</span></a></div><div class="item categories"><a href="/miyano/categories/"><span class="count">10</span><span class="name">分类</span></a></div><div class="item tags"><a href="/miyano/tags/"><span class="count">9</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/ei4869" class="item github" title="https://github.com/ei4869"><i class="ic i-github"></i></a><a href="mailto:ai4869@gmail.com" class="item email" title="mailto:ai4869@gmail.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/miyano/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/miyano/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/miyano/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/miyano/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-baibaoxiang"></i>宝箱</a><ul class="submenu"><li class="item"><a href="/miyano/gallery/" rel="section"><i class="ic i-xiangce"></i>相册</a></li><li class="item"><a href="/miyano/anime/" rel="section"><i class="ic i-pc-dongman"></i>追番</a></li></ul></li><li class="item"><a href="/miyano/about/" rel="section"><i class="ic i-user"></i>关于</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/miyano/Engine-Translation/Gal%E6%B1%89%E5%8C%96-Escude(%E4%BA%8C)%20/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Scientific-Notes/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Scientific-Notes/Literature-Translation/2024-11-25-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%BA%94/">文献翻译(五)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Graduation-Project/" title="分类于毕设笔记">毕设笔记</a></div><span><a href="/miyano/Scientific-Notes/Graduation-Project/%E6%AF%95%E8%AE%BE%E5%AE%9E%E9%AA%8C%E6%96%B9%E6%A1%88/">毕设实验方案</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Course-Study/" title="分类于课程学习">课程学习</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Course-Study/FPGA/" title="分类于FPGA">FPGA</a></div><span><a href="/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%BA%8C)-Verilog%E8%AF%AD%E6%B3%95/">FPGA学习(二)-Verilog语法</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Scientific-Notes/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Scientific-Notes/Literature-Translation/2024-12-06-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E5%85%AD/">文献翻译(六)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Course-Study/" title="分类于课程学习">课程学习</a><i class="ic i-angle-right"></i><a href="/miyano/categories/Course-Study/Japanese/" title="分类于日语">日语</a></div><span><a href="/miyano/Course-Study/Japanese/%E5%8A%A8%E8%AF%8D%E5%92%8C%E5%BD%A2%E5%AE%B9%E8%AF%8D%E7%9F%A5%E8%AF%86%E7%82%B9/">动词和形容词知识点</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div style="width: 100%; text-align: center;"><span id="time">此站已存活 0 天 0 小时 0 分 0 秒</span></div><script src="/miyano/js/create-time.js" defer="defer"></script><div class="status"><div class="copyright">© 2024 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Rei @ Rei の 手帳</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">598k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">9h4min</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
        path: `Engine-Translation/Gal汉化-Escude(一)/`,
        favicon: {
        show: `（●´3｀●）萌え萌えキュン`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    justifiedGallery: true,
    jquery: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4H41ZSPP7G"></script><script data-pjax="data-pjax">window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-4H41ZSPP7G');</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/miyano/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer=""></script></body></html>