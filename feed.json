{
    "version": "https://jsonfeed.org/version/1",
    "title": "自分の為に楽しめ世界",
    "subtitle": "",
    "icon": "https://ei4869.github.io/miyano/assets/favicon.ico",
    "description": "",
    "home_page_url": "https://ei4869.github.io/miyano",
    "items": [
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8B-%E7%AC%AC8%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8B-%E7%AC%AC8%E5%8D%95%E5%85%83/",
            "title": "单元八——余暇",
            "date_published": "2025-04-07T09:36:00.000Z",
            "content_html": "<h1 id=\"第二十九课電気でんきを消けせ\"><a class=\"anchor\" href=\"#第二十九课電気でんきを消けせ\">#</a> 第二十九课：<ruby>電気<rp> (</rp><rt>でんき</rt><rp>)</rp></ruby> を<ruby>消<rp> (</rp><rt>け</rt><rp>)</rp></ruby> せ</h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"动词的命令形\"><a class=\"anchor\" href=\"#动词的命令形\">#</a> 动词的命令形</h3>\n<p>命令形是说话人对听话人下命令时使用的表达形式。<br />\n一类动词：基本形的う段变え段。<br />\n二类动词：基本形的る变ろ。<br />\n三类动词：<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp></ruby> る变<ruby>来<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> い，する变しろ。</p>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>基本形 → 命令形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>一类动词</td>\n<td><ruby>書<rp> (</rp><rt>か</rt><rp>)</rp> く<rt></rt></ruby> → かけ<br><ruby>急<rp> (</rp><rt>いそ</rt><rp>)</rp> ぐ<rt></rt></ruby> → いそげ<br><ruby>飛<rp> (</rp><rt>と</rt><rp>)</rp> ぶ<rt></rt></ruby> → とべ<br><ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp> む<rt></rt></ruby> → よめ<br><ruby>死<rp> (</rp><rt>し</rt><rp>)</rp> ぬ<rt></rt></ruby> → しね<br><ruby>待<rp> (</rp><rt>ま</rt><rp>)</rp> つ<rt></rt></ruby> → まて<br><ruby>売<rp> (</rp><rt>う</rt><rp>)</rp> る<rt></rt></ruby> → うれ<br><ruby>買<rp> (</rp><rt>か</rt><rp>)</rp> う<rt></rt></ruby> → かえ<br><ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp> す<rt></rt></ruby> → はなせ</td>\n</tr>\n<tr>\n<td>二类动词</td>\n<td><ruby>食<rp> (</rp><rt>た</rt><rp>)</rp> べる<rt></rt></ruby> → たべろ<br><ruby>見<rp> (</rp><rt>み</rt><rp>)</rp> る<rt></rt></ruby> → みろ<br><ruby>寝<rp> (</rp><rt>ね</rt><rp>)</rp> る<rt></rt></ruby> → ねろ</td>\n</tr>\n<tr>\n<td>三类动词</td>\n<td><ruby>来<rp> (</rp><rt>く</rt><rp>)</rp> る<rt></rt></ruby> → こい<br><ruby>する<rt></rt></ruby> → しろ</td>\n</tr>\n</tbody>\n</table>\n<p>eg:<ruby> 書類<rp> (</rp><rt>しょるい</rt><rp>)</rp></ruby> を早く　<ruby>提出<rp> (</rp><rt>ていしゅつ</rt><rp>)</rp></ruby> しろ。   快交文件！</p>\n<h3 id=\"动-なさい\"><a class=\"anchor\" href=\"#动-なさい\">#</a> [动]　なさい</h3>\n<p>比命令形客气一些，多用于老师对学生或父母对孩子提出要求。构成为：动词ます形去掉ます加 “なさい”。（ます形去掉ます也叫动词的连用形。）</p>\n<table>\n<thead>\n<tr>\n<th>ます形</th>\n<th>～なさい</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>書きます</td>\n<td>書きなさい</td>\n</tr>\n<tr>\n<td>急ぎます</td>\n<td>急ぎなさい</td>\n</tr>\n<tr>\n<td>見ます</td>\n<td>見なさい</td>\n</tr>\n<tr>\n<td>来ます</td>\n<td>来なさい</td>\n</tr>\n<tr>\n<td>します</td>\n<td>しなさい</td>\n</tr>\n</tbody>\n</table>\n<p>eg: 質問に　答え　なさい。   回答问题！</p>\n<h3 id=\"动基本形-な-禁止\"><a class=\"anchor\" href=\"#动基本形-な-禁止\">#</a> [动 (基本形)] な     [禁止]</h3>\n<p>用于禁止听话人做某事。</p>\n<table>\n<thead>\n<tr>\n<th>基本形</th>\n<th>禁止</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>書く</td>\n<td>書くな</td>\n</tr>\n<tr>\n<td>急ぐ</td>\n<td>急ぐな</td>\n</tr>\n<tr>\n<td>見る</td>\n<td>見るな</td>\n</tr>\n<tr>\n<td>来る</td>\n<td>来るな</td>\n</tr>\n<tr>\n<td>する</td>\n<td>するな</td>\n</tr>\n</tbody>\n</table>\n<p>eg：タバコを　吸う　な。    不要吸烟！</p>\n<h3 id=\"动-て-动-ないで\"><a class=\"anchor\" href=\"#动-て-动-ないで\">#</a> [动] て　/ [动] ないで</h3>\n<p>“动词て形” 和 “动词ない形 + で” 是日常生活中经常使用的表示祈使的说法，但一般用于关系亲密的人之间。</p>\n<p>もうちょっと　急いで。  再稍微快一点。<br />\n<ruby>遠慮<rp> (</rp><rt>えんりょ</rt><rp>)</rp></ruby> し　ないで。 别客气！</p>\n<p>辨析：命令形、～なさい、～な 和 ～て /～ないで 相比，前三者一般限于上下、尊卑关系非常明确的非正式场合，不过紧急情况下对上级或尊长也可以说 “<ruby>逃<rp> (</rp><rt>に</rt><rp>)</rp></ruby> げろ（快逃）”。另外，虽然是在紧急情况下，但要求对方救助、帮助自己时也不能用命令形而用 “动词て形”，比如 “<ruby>助<rp> (</rp><rt>たす</rt><rp>)</rp></ruby> けて（救命）”。</p>\n<h3 id=\"名1-という-名2\"><a class=\"anchor\" href=\"#名1-という-名2\">#</a> [名 1] + という + [名 2]</h3>\n<p>提供对方不知道的新信息的时候，在表示新信息的词语后要加 “という”。</p>\n<p>それは　フジ　という　花　です。    那是一种叫 “紫藤” 的话。  （花名是听话人不知道的新信息）</p>\n<p>私は東京の　<ruby>世田谷<rp> (</rp><rt>せたがや</rt><rp>)</rp></ruby>　という　所ところ　に<ruby>住<rp> (</rp><rt>す</rt><rp>)</rp></ruby> んでいます。  我住在东京应该叫 “世田谷” 的地方。（地名是听话人不知道的新信息）</p>\n<p>田中　という　名前　は日本人の名前です。    “田中” 这个姓是日本人的姓。  （人名是听话人不知道的新信息）</p>\n<h3 id=\"名1は-名小句-という-名2-です\"><a class=\"anchor\" href=\"#名1は-名小句-という-名2-です\">#</a> [名 1] は　[名]/[小句] + という + [名 2]　です</h3>\n<p>“～という” 也可以用于给 “名 1” 下定义或对 “名 1” 做解释。这时 “名 2” 多为 “<ruby>意味<rp> (</rp><rt>いみ</rt><rp>)</rp></ruby>（意思）” 等词语。这里的小句可以是 “命令形”“简体形”“简体形 + な”。</p>\n<p>このマークは　タバコを吸うな　という　意味です。    这个符号是 “禁止吸烟” 的意思。<br />\nこの<ruby>標識<rp> (</rp><rt>ひょうしき</rt><rp>)</rp></ruby> は　<ruby>駐車禁止<rp> (</rp><rt>ちゅうしゃきんし</rt><rp>)</rp></ruby>　という　意味です。    这个标识是 “禁止停车” 的意思。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>命令形、禁止形的用法<br />\n命令形、禁止形应用场景</li>\n</ol>\n<ul>\n<li>用于男性为主的工作单位的上司对不下，长辈对晚辈以及同辈之间：おい，早く<ruby>片<rp> (</rp><rt>かた</rt><rp>)</rp></ruby> づけろ。   哎，早点收拾！</li>\n<li>用于关系亲密的男性朋友之间：さあ，もっと飲めよ。  来吧，多喝点。</li>\n<li>但如果年龄相差悬殊，即使是关系比较亲密的男性朋友，也不应对年长者使用。</li>\n<li>用于紧急场合：<ruby>危<rp> (</rp><rt>あぶ</rt><rp>)</rp></ruby> ない！<ruby>止<rp> (</rp><rt>と</rt><rp>)</rp></ruby> まれ！    危险，停住！</li>\n<li>用于观看比赛，这种场合女性有时也使用：頑張れ！    加油！</li>\n<li>用于直接引用含有委托、要求等祈使意义的话语或用于解释词语。这种场合，男性、女性都可以使用：課長は「書類を早く提出しろ」と言いました。  科长说了 “快交文件”。</li>\n</ul>\n<ol start=\"2\">\n<li>“～ないといけません” 的省略形式<br />\n省略为 “～ないと”；<br />\n另外，“～なければなりません” 也可以省略为 “～なければ”。</li>\n</ol>\n<p>この　場合ばあいは　「歌ってください」　と言わないとね。    这种场合要说 “歌ってください”。<br />\n時間がないから，急がないと…。   没时间了，不快一点就...</p>\n<ol start=\"3\">\n<li>～<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby> をする<br />\n第 22 课学习了 “动词 +<ruby> 方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>” 表示动作方式的用法，描述用这种方式进行动作时，可用 “～<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>+ をします” 的形式。</li>\n</ol>\n<p>そんな<ruby>乱暴<rp> (</rp><rt>らんぼう</rt><rp>)</rp></ruby> な<mark>言い方をしないで</mark>ください。  别用那样粗暴的说法。 (&quot;言い方をします&quot; 不涉及说的内容，而指说的方法，“怎么说的”)。</p>\n<h1 id=\"第三十课もう11時だから寝よう\"><a class=\"anchor\" href=\"#第三十课もう11時だから寝よう\">#</a> 第三十课：もう 11 時だから寝よう</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"动词的意志形\"><a class=\"anchor\" href=\"#动词的意志形\">#</a> 动词的意志形</h3>\n<p>动词的意志形是说话人当场表示自己的决心、意志的表达形式。变形为：</p>\n<ul>\n<li>一类动词：基本形的う段变お段的长音（おう）</li>\n<li>二类动词：基本形的る变よう</li>\n<li>三类动词：<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp></ruby> る变<ruby>来<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> よう，する变しよう</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>基本形 → 意志形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>一类动词</td>\n<td>書く → かこう<br>急ぐ → いそごう<br>飛ぶ → とぼう<br>読む → よもう<br>死ぬ → しのう<br>待つ → まとう<br>売る → うろう<br>買う → かおう<br>話す → はなそう</td>\n</tr>\n<tr>\n<td>二类动词</td>\n<td>食べる → たべよう<br>見る → みよう<br>寝る → ねよう</td>\n</tr>\n<tr>\n<td>三类动词</td>\n<td>来る → こよう<br>する → しよう</td>\n</tr>\n</tbody>\n</table>\n<p>动词的意志形实际是 17 课学的 “～ましょう” 的简体形，因此除了表示意志外，还可表示提议。</p>\n<p>仕事が終わってから，飲みに　行こうよ。  工作结束后去喝酒吧。</p>\n<h3 id=\"动意志形-と思います\"><a class=\"anchor\" href=\"#动意志形-と思います\">#</a> [动 (意志形)] と思います</h3>\n<p>说话人向听话人表示自己要做某事的意志时使用。比单纯用 “意志形” 表达说话时的意志更加礼貌、温和。</p>\n<p>今日，会社を　休もう　と思います。     我今天不想上班。</p>\n<h3 id=\"动意志形-と思っています\"><a class=\"anchor\" href=\"#动意志形-と思っています\">#</a> [动 (意志形)] と思っています</h3>\n<p>表示自己已把某种意志持续了一段实际时使用。（某种意志，但还没下定决心）</p>\n<p>明日病院へ　行こう　と思っています。    明天我想去医院。</p>\n<div class=\"note info\">\n<p>“意志形” “～ようと思います”　“～ようと思っています” 区别：</p>\n<ul>\n<li>表示当场形成的意志时使用 “意志形” 而不能使用另两个。</li>\n<li>“～ようと思います”　“～ようと思っています” 都表示决心或意志，但由于后者用 “～ています” 的形式，有一种决心或意志尚未最后形成的语感。</li>\n</ul>\n</div>\n<h3 id=\"小句1ので小句2\"><a class=\"anchor\" href=\"#小句1ので小句2\">#</a> [小句 1] ので，[小句 2]</h3>\n<p>“～ので” 表示原因、理由，既可以接在简体形后，也可以放在敬体形后，但接简体形较多。<br />\n小句 1 为:</p>\n<ul>\n<li>形 1、动词简体形 + ので（から）</li>\n<li>形 2、名词 + なので（だから）</li>\n</ul>\n<p><ruby>荷物<rp> (</rp><rt>にもつ</rt><rp>)</rp></ruby> が<ruby>重<rp> (</rp><rt>おも</rt><rp>)</rp></ruby> いので，<ruby>宅配便<rp> (</rp><rt>たくはいびん</rt><rp>)</rp></ruby> で<ruby>送<rp> (</rp><rt>おく</rt><rp>)</rp></ruby> ります。    行李很重，所以用送货上门的方式送达。<br />\n<ruby>香港<rp> (</rp><rt>ほんこん</rt><rp>)</rp></ruby> からお客さんが来るので，<ruby>空港<rp> (</rp><rt>くうこう</rt><rp>)</rp></ruby> へ<ruby>迎<rp> (</rp><rt>むか</rt><rp>)</rp></ruby> えに行きます。 有客户从香港来，我要去机场迎接。<br />\nここは静かなので，とても<ruby>気<rp> (</rp><rt>き</rt><rp>)</rp></ruby> に<ruby>入<rp> (</rp><rt>い</rt><rp>)</rp></ruby> っています。    这里很安静，我非常喜欢。<br />\nもう<ruby>終電<rp> (</rp><rt>しゅうでん</rt><rp>)</rp></ruby> の時間なので，帰ります。   已经是末班电车的时间了，我回去了。</p>\n<p>注：“～ので” 和 “～から” 相比，更为礼貌郑重，多用于正式场合。“～ので” 口语中常发成 “～んで”。</p>\n<p>小句 2 表示提议时，必须使用 “～から”。</p>\n<p>電車が<ruby>遅<rp> (</rp><rt>おく</rt><rp>)</rp></ruby> れたんで，<ruby>遅刻<rp> (</rp><rt>ちこく</rt><rp>)</rp></ruby> しました。すみません。    电车晚点我迟到了，对不起。<br />\n電車が<ruby>遅<rp> (</rp><rt>おく</rt><rp>)</rp></ruby> れたから，<ruby>遅刻<rp> (</rp><rt>ちこく</rt><rp>)</rp></ruby> しました。すみません。    [申述理由的感觉强烈]<br />\n もう時間がないから，早く行こうよ。  已经没有时间了，快走吧。    （表示提议，不能用ので）</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>そろそろ<br />\n用于做某事或某事态发生的时间渐渐迫近时。<br />\nそろそろ食事の時間ですよ。  快到进餐的时间了。</li>\n</ol>\n<p>去别人家里做客，发觉该到回家的时间时一般要说 “そろそろ<ruby>失礼<rp> (</rp><rt>しつれい</rt><rp>)</rp></ruby> します（我该告辞了。）”</p>\n<p>另外，使用 “そろそろ＋～ましょうか” 或 “そろそろ＋意志形＋か” 的形式，表示随着时间的迫近该一起做某事，是提醒或催促对方和自己行动的一种说法。<br />\nそろそろ<ruby>出発<rp> (</rp><rt>しゅっぱつ</rt><rp>)</rp></ruby> しようか。 准备出发吧。</p>\n<ol start=\"2\">\n<li>\n<p>それじゃ<br />\n是 “それでは（那么）” 的比较随便的说法，用于口语。</p>\n</li>\n<li>\n<p>まあ<br />\n表示不十分理想，但还能过得去的程度，用于调控自己或对方的不满情绪。</p>\n</li>\n<li>\n<p>自言自语的な<br />\n自言自语时，可在简体形后续接 “な” 表示感叹。拖长音 “なあ” 表示较强烈的感叹。</p>\n</li>\n<li>\n<p><ruby>楽<rp> (</rp><rt>たの</rt><rp>)</rp></ruby> しみです<br />\n意思同 “楽しみにしています”，表示盼望、期待的心情。在表示 “请你愉快地期待着” 的意思时，用 “楽しみにしていてください”。</p>\n</li>\n</ol>\n<p>另外，指感到 “愉悦” 的事物、兴趣或娱乐等时，也可以说 “楽しみです”。<br />\n<ruby>時<rp> (</rp><rt>ときどき</rt><rp>)</rp>々<rt></rt></ruby><ruby>孫<rp> (</rp><rt>まご</rt><rp>)</rp></ruby> に会うのが，父の楽しみです。    时不时见见孙子是父亲的乐趣。</p>\n<ol start=\"6\">\n<li>\n<p><ruby>行楽地<rp> (</rp><rt>こうらくち</rt><rp>)</rp></ruby><br />\n 众人去游览的名胜古迹，设有旅游设施以及娱乐设施的场所。</p>\n</li>\n<li>\n<p>～でいっぱい<br />\n表示某个场所或某个容器已达饱和状态，不可能再容纳更多的人或物。<br />\nこの季節は，どの行楽地も人でいっぱいですよ。    这个季节，任何一个景点都是游客爆满。</p>\n</li>\n</ol>\n<h1 id=\"第三十一课このボタンを押おすと電源でんげんが入はいります\"><a class=\"anchor\" href=\"#第三十一课このボタンを押おすと電源でんげんが入はいります\">#</a> 第三十一课：このボタンを<ruby>押<rp> (</rp><rt>お</rt><rp>)</rp></ruby> すと，<ruby>電源<rp> (</rp><rt>でんげん</rt><rp>)</rp></ruby> が<ruby>入<rp> (</rp><rt>はい</rt><rp>)</rp></ruby> ります</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"小句1动词基本形ない形と小句2\"><a class=\"anchor\" href=\"#小句1动词基本形ない形と小句2\">#</a> 小句 1（动词基本形 / ない形）と，小句 2</h3>\n<p>“～と” 用在表述恒常性状态、真理、反复性状态、习惯等内容的复句里，表述 “小句 1” 是 “小句 2” 的条件。</p>\n<p>このボタンを<ruby>押<rp> (</rp><rt>お</rt><rp>)</rp></ruby> すと，<ruby>電源<rp> (</rp><rt>でんげん</rt><rp>)</rp></ruby> が<ruby>入<rp> (</rp><rt>はい</rt><rp>)</rp></ruby> ります。  按下这个按钮，电源就接通了。   [恒常性状态]</p>\n<p>食べ物を食べないと，<ruby>人間<rp> (</rp><rt>にんげん</rt><rp>)</rp></ruby> は<ruby>生<rp> (</rp><rt>い</rt><rp>)</rp></ruby> きることができません。  不吃食物，人就没法活。  [真理]</p>\n<p>私は，その店へ行くと，いつもコーヒーを飲みます。    我去那个店的时候总要喝咖啡。    [反复的状态]</p>\n<p>另外，“～と” 还可表示由于某种行为而发现了新的情况。</p>\n<p>この道をまっすぐ行くと，デパートがあります。    沿着这条路一直走，有一家百货商店。</p>\n<p>用 “～と” 的复句，小句 2 不能是自己的意志、愿望或向听话人提出要求、提议等内容。<br />\n夜になると，電気がつきます。    到了晚上灯就亮了。<br />\n夜になると，食事に行きましょう。    （表示提议，不能使用）</p>\n<h3 id=\"动基本形ない形-ことがあります\"><a class=\"anchor\" href=\"#动基本形ない形-ことがあります\">#</a> [动 (基本形 / ない形)] ことがあります</h3>\n<p>表示有时会发生某种事态。往往和 “たまに”“時々” 等副词呼应使用。</p>\n<p>そのパソコンは，たまに　フリーズする　ことがあります。  那台电脑偶尔会死机。<br />\n時々　<ruby>寝坊<rp> (</rp><rt>ねぼう</rt><rp>)</rp></ruby> する　ことがあります。     有时睡懒觉。</p>\n<p>注：本句型和 21 课学的 “～たことがあります” 是两种完全不同的句型。</p>\n<h3 id=\"形容词的副词性用法\"><a class=\"anchor\" href=\"#形容词的副词性用法\">#</a> 形容词的副词性用法</h3>\n<p>有的形容词可以像副词一样修饰动词。这时：</p>\n<ul>\n<li>一类形容词词尾的い变く</li>\n<li>二类形容词后加に</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>一类形容词</th>\n<th>二类形容词</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>早い → 早く <br> 大きい　→ 大きく</td>\n<td>上手　→　上手に　<br> 静か　→　静かに</td>\n</tr>\n</tbody>\n</table>\n<p>早く家に帰りましょう。  早点回家吧。<br />\n静かにドアを<ruby>閉<rp> (</rp><rt>し</rt><rp>)</rp></ruby> めてください。   请轻轻地关门。</p>\n<h3 id=\"小句简体形でしょうか\"><a class=\"anchor\" href=\"#小句简体形でしょうか\">#</a> [小句 (简体形)] でしょうか</h3>\n<p>句尾用 “でしょうか” 来表示疑问，是礼貌程度较高的表达方式。如 “<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp></ruby> るでしょうか” 比 “<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ますか” 更礼貌。</p>\n<ul>\n<li>动词小句和一类形容词小句以简体形后续 “でしょうか”。</li>\n<li>二类形容词小句和名词小句则把简体形的 “だ” 换成 “でしょうか”。</li>\n</ul>\n<p>馬さんはもう帰ったでしょうか。  小马已经回家了吗？  （馬さんはもう帰りましたか。）<br />\n<ruby>三月<rp> (</rp><rt>さんがつ</rt><rp>)</rp></ruby> の東京は寒いでしょうか。     3 月的东京冷吗？<br />\nこれは中国の<ruby>菓子<rp> (</rp><rt>かし</rt><rp>)</rp></ruby> でしょうか。     这是中国的点心吗？</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>\n<p>きちんと<br />\n用于表示正确、无误、恰当等意思。<br />\n朝ご飯は毎日きちんと食べますか。    你每天都好好吃早饭吗？</p>\n</li>\n<li>\n<p><ruby>卓球<rp> (</rp><rt>たっきゅう</rt><rp>)</rp></ruby> ですか？公園で？   [叮问的说法]<br />\n 正常语序为 “公園で卓球をするんですか（在公园打乒乓球吗？）”，但吃惊的时候，抛开语序规则，先去询问自己最关心的部分，所以变成了两个短句。  （表示吃惊、疑问）</p>\n</li>\n</ol>\n<p>私が<ruby>浴衣<rp> (</rp><rt>ゆかた</rt><rp>)</rp></ruby> を作ります。  我自己做浴衣。<br />\n—— 浴衣ですか？自分で？     浴衣吗？自己做？</p>\n<ol start=\"3\">\n<li>～でできた～<br />\n表示 “用～做成的～”。</li>\n</ol>\n<p>それはプラスチックでできた<ruby>箱<rp> (</rp><rt>はこ</rt><rp>)</rp></ruby> です。   那是塑料做的盒子。</p>\n<ol start=\"4\">\n<li>ほど　和 ぐらい<br />\n “数量词 + ほど” 和 “数量词 + ぐらい” 都表示大致的数量或分量。但是，表示某序列中的一点时，只能用 “ぐらい”（即不能用小数点表达的东西只能ぐらい）。</li>\n</ol>\n<p>ここから３００メートルほど行くと，スポーツセンターがあります。  从这里大概走 300 米左右，有个体育中心。   （可用ぐらい）</p>\n<p>私は３０歳ぐらいからスポーツを始めました。  我大概从 30 岁左右开始体育运动。  （不可用ほど）</p>\n<p>另外，ぐらい可以接在 “この / その / あの / どの” 后面，ほど不能。<br />\nこのぐらいのサイズの箱が欲しいんですが。    我想要这么大小的箱子。</p>\n<ol start=\"5\">\n<li>ただし<br />\n表示基本肯定前面句子内容的基础上，附加一些条件、限制，或者补充一些例外的情况，意思与 “しかし” 相似，但 “しかし” 用于接续与前句完全相反的内容，而 “ただし” 则只能用来表示对前面内容的部分限制或补充。</li>\n</ol>\n<p>このスポーツセンターは，誰でも<ruby>利用<rp> (</rp><rt>りよう</rt><rp>)</rp></ruby> することができます。ただし，<ruby>会費<rp> (</rp><rt>かいひ</rt><rp>)</rp></ruby> は高いです。   谁都可以利用这个体育中心，但是会费有点高。</p>\n<p>このプールは<ruby>女性<rp> (</rp><rt>じょせい</rt><rp>)</rp></ruby> は<ruby>利用<rp> (</rp><rt>りよう</rt><rp>)</rp></ruby> することができます。しかし，<ruby>男性<rp> (</rp><rt>だんせい</rt><rp>)</rp></ruby> はだめです。   这个游泳池女性可以使用，但是男性不可以。</p>\n<h1 id=\"第三十二课今度の日曜日に遊園地ゆうえんちへ行くつもりです\"><a class=\"anchor\" href=\"#第三十二课今度の日曜日に遊園地ゆうえんちへ行くつもりです\">#</a> 第三十二课：今度の日曜日に<ruby>遊園地<rp> (</rp><rt>ゆうえんち</rt><rp>)</rp></ruby> へ行くつもりです</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"动基本形ない形-つもりです\"><a class=\"anchor\" href=\"#动基本形ない形-つもりです\">#</a> [动 (基本形 / ない形)] つもりです</h3>\n<p>表示说话之前已经形成的意志、打算。 “打算怎么样”。与 30 课学的 “动词意志形 + と思っています” 意思相同。</p>\n<p>ボーナスで車を　買う　つもりです。      打算用奖金买车。<br />\nもうタバコは　吸わない　つもりです。    已经决定戒烟了。</p>\n<p>注：对长辈或上级用 “～つもりですか” 直接提问不太礼貌，30 课学的 “～ようと思います” 和 “～ようと思っています” 也不可以用于向长辈或上级提问。</p>\n<h3 id=\"动基本形ない形-ことにしますことにしました\"><a class=\"anchor\" href=\"#动基本形ない形-ことにしますことにしました\">#</a> [动 (基本形 / ない形)] ことにします / ことにしました</h3>\n<p>表示说话人自己决定实施某种行为时使用。“ことにします” 用于说话的时候或刚刚决定。“ことにしました” 用于已经决定好了。<br />\n“こと” 不能用 “の” 替换。</p>\n<p>明日から毎日　運動する　ことにします。  我从明天起每天做运动。<br />\n明日，友達と映画を　見に行く　ことにしました。  明天和朋友去看电影。</p>\n<h3 id=\"动基本形ない形-ことになりました\"><a class=\"anchor\" href=\"#动基本形ない形-ことになりました\">#</a> [动 (基本形 / ない形)] ことになりました</h3>\n<p>表示由于某种外在的原因导致形成了某种决定。<br />\n“こと” 不能用 “の” 替换。</p>\n<p>来月から<ruby>給料<rp> (</rp><rt>きゅうりょう</rt><rp>)</rp></ruby> が　<ruby>上<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> がる　ことになりました。  从下个月其工资涨了。</p>\n<p>今週は会議を　<ruby>行<rp> (</rp><rt>おこな</rt><rp>)</rp></ruby> わない　ことになりました。 这个星期不开会了。</p>\n<p>“～ことになりました” 也可用于委婉表述根据自己的意志决定的事情。<br />\n私たち，結婚することになりました。  我们要结婚了。</p>\n<h3 id=\"小句简体形-そうです-传闻\"><a class=\"anchor\" href=\"#小句简体形-そうです-传闻\">#</a> [小句 (简体形)]　そうです    [传闻]</h3>\n<p>用 “～そうです” 明确表示某信息不是源于自己的直接感知而是从别人那里听到的，提示消息来源时则用 “～によると”。</p>\n<p>馬さんの<ruby>息子<rp> (</rp><rt>むすこ</rt><rp>)</rp></ruby> は，<ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby><ruby> 小学校<rp> (</rp><rt>しょうがっこう</rt><rp>)</rp></ruby> に<ruby>入学<rp> (</rp><rt>にゅうがく</rt><rp>)</rp></ruby> するそうです。  听说小马的儿子今年上小学。</p>\n<p><ruby>天気予報<rp> (</rp><rt>てんきよほう</rt><rp>)</rp></ruby> によると，明日は雨だそうです。   据天气预报说明天下雨。</p>\n<p>うわさによると，あの店のラーメンは<ruby>美味<rp> (</rp><rt>おい</rt><rp>)</rp></ruby> しくないそうです。 听说那家店的面条不好吃。（うわさ 传言）</p>\n<div class=\"note info\">\n<p>“～そうです” 没有过去、否定和疑问的形式。如：そうではありません是错的。</p>\n</div>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>今度の日曜日<br />\n日语的 “今度” 语义范围更广，可能是 “这次”，也可能 “下次”，根据上下文判断。</li>\n</ol>\n<p>今度の日曜日に遊園地に行くつもりです。  这个星期天打算去游乐园。<br />\n今度の会議は午前 10 時からです。      下次的会议上午 10 点开始。</p>\n<ol start=\"2\">\n<li>\n<p>ボーナス bonus<br />\n 工资外另外支付的奖金。</p>\n</li>\n<li>\n<p>ずっと   [期间]<br />\n 第 12 课学的 “ずっと” 表示程度差异很大。本课表示：在某一期限内动作、状态一直持续。</p>\n</li>\n</ol>\n<p>天気予報によると，<ruby>連休中<rp> (</rp><rt>れんきゅうちゅう</rt><rp>)</rp></ruby> はずっと晴れだそうですよ。   天气预报说，连休期间一直是晴天。</p>\n<p>佐藤さんは先月からずっと<ruby>入院<rp> (</rp><rt>にゅういん</rt><rp>)</rp></ruby> しています。   佐藤先生上个月起就一直在住院。</p>\n<ol start=\"4\">\n<li>メールがあって<br />\n表示收到了电子邮件的意思。（在句子中间，所以用 “あって”）<br />\n“電話 / 手紙 / ファックス”  也可以用 “～がある” 的表达。</li>\n</ol>\n<p>先週，小野さんからメールがありました。  上周小野女士发来了邮件。</p>\n<ol start=\"5\">\n<li>\n<p>お<ruby>邪<rp> (</rp><rt>じゃ</rt><rp>)</rp></ruby><ruby> 魔<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> する<br />\n “<ruby>邪<rp> (</rp><rt>じゃ</rt><rp>)</rp></ruby><ruby> 魔<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> する” 原意为妨碍别人做某事，但引申可表示到别人家里拜访，进门时说 “<ruby>邪<rp> (</rp><rt>じゃ</rt><rp>)</rp></ruby><ruby> 魔<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> します（打扰您了）”。告辞时则说 “お<ruby>邪<rp> (</rp><rt>じゃ</rt><rp>)</rp></ruby><ruby> 魔<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> しました（打扰您了）”。</p>\n</li>\n<li>\n<p>～てほしい   [表示对他人愿望]<br />\n 第 17 课学的表示愿望的 “～たい” 表示说话人自己想做某事的愿望，而表示希望别人去做某事时，则用 “～てほしい”。但不能对长辈或上级使用。</p>\n</li>\n</ol>\n<p>田中さんに日本人の友達を<ruby>紹介<rp> (</rp><rt>しょうかい</rt><rp>)</rp></ruby> してほしいです。   想请田中先生给我介绍日本朋友。</p>\n<ol start=\"7\">\n<li>～って   （“～と”“～という人は” 的缩略形式）<br />\n第 22 课学的 “～って” 表示传闻。<br />\n这里用于省略地表达引用：如 “～と言います” → “～って言います”。<br />\n如果 “と” 前面的音节为 “ん” 时，常只保留 “て”，促音 “っ” 脱落。</li>\n</ol>\n<p>もしもし，今何て言った？    喂，你刚才说什么？  （何と言いますか　→　何って　→　何て）<br />\n—— 「少し<ruby>遅<rp> (</rp><rt>おく</rt><rp>)</rp></ruby> れる」って言ったの。      我说晚点到。</p>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Scientific-Notes/Graduation-Project/%E6%AF%95%E8%AE%BE%E5%AE%9E%E9%AA%8C%E6%96%B9%E6%A1%88/",
            "url": "https://ei4869.github.io/miyano/Scientific-Notes/Graduation-Project/%E6%AF%95%E8%AE%BE%E5%AE%9E%E9%AA%8C%E6%96%B9%E6%A1%88/",
            "title": "毕设实验方案",
            "date_published": "2025-04-03T03:22:52.000Z",
            "content_html": "<h1 id=\"实验细节\"><a class=\"anchor\" href=\"#实验细节\">#</a> 实验细节</h1>\n<ol>\n<li>参数</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>沉积温度</th>\n<th>氧压</th>\n<th>打点数</th>\n<th>激光能量</th>\n<th>激光频率</th>\n<th>退火</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SRO</td>\n<td>750℃</td>\n<td>13Pa</td>\n<td>10000</td>\n<td>2.5J/cm²</td>\n<td>4Hz</td>\n<td>先在氧压和温度不变下保温 15 分钟，然后自然冷却 7h</td>\n</tr>\n<tr>\n<td>SCO</td>\n<td>750℃</td>\n<td>15Pa;5pa;0.5Pa</td>\n<td>6000</td>\n<td>2.0J/cm²</td>\n<td>4Hz</td>\n<td>先在氧压和温度不变下保温 15 分钟，然后自然冷却 7h</td>\n</tr>\n</tbody>\n</table>\n<p>一次氧压下制备两片 SCO，一片用于制作器件，一片用于形貌观察和表征。<br />\n使用光刻和电子束蒸镀制作顶电极 Au，面积为 80um×80um。</p>\n<ol start=\"2\">\n<li>表征</li>\n</ol>\n<ul>\n<li>使用 XRD 观察衍射图像；</li>\n<li>使用 AFM 观察表面形貌；</li>\n<li>使用 XPS 表征 Sr、Co、O 价态变化；</li>\n<li>TEM 成本太高估计难以用到。</li>\n</ul>\n<ol start=\"3\">\n<li>器件电学测试<br />\n I-V 特性曲线、循环稳定性测试、保持性能测试、耐久性能测试、开关比</li>\n</ol>\n<h1 id=\"问题\"><a class=\"anchor\" href=\"#问题\">#</a> 问题</h1>\n<ol>\n<li>沉积温度对薄膜性能的影响大不大？跟程老师讨论过，如果 PLD 实验紧张且温度影响不如氧压显著，后续可以先考虑只测氧压的影响。<br />\n<span class=\"red\">优先考虑氧压</span></li>\n<li>如果后续需要补充实验数据，如果不想考虑沉积温度，能否考虑顶电极面积的影响（程老师说影响因素这块可以不一定和任务书完全一致），据论文显示顶电极的面积是会影响器件的电学性能例如开关比什么的，所以相比于 PLD 多做几次实验，制备不同面积的顶电极的方案是否更容易且可行？例如在最适合的氧压下一次做 3 个片子后续做三个不同面积的顶电极（问题是做完表征的膜之后能否继续做器件，还是一次能同时做四个片子）<br />\n<span class=\"red\">表征最后做，先做器件测电特性</span></li>\n<li>前面制备 SRO 需要 750℃的温度下，而 SCO 需要 600℃的衬底温度，能否在 SRO 退火冷却到 600℃时直接沉积 SCO，而不需要等到 SRO 整个自然冷却过程，以节约时间？<br />\n<span class=\"red\">我之前做的是 750℃SCO，必须等降温完全后再升温，保证成膜的完整性</span></li>\n<li>前面的激光打点的次数和膜厚有没有什么经验上的对应？</li>\n</ol>\n<p>if. 如果后续实验进度紧张，学长那边是否有部分做好的电学测试数据，进行补救。</p>\n",
            "tags": [
                "毕设笔记",
                "毕设"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8B-%E7%AC%AC7%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8B-%E7%AC%AC7%E5%8D%95%E5%85%83/",
            "title": "单元七——森赴北京",
            "date_published": "2025-03-30T08:57:00.000Z",
            "content_html": "<h1 id=\"第二十五课これは明日会議かいぎで使つかう資料しりょうです\"><a class=\"anchor\" href=\"#第二十五课これは明日会議かいぎで使つかう資料しりょうです\">#</a> 第二十五课：これは明日<ruby>会議<rp> (</rp><rt>かいぎ</rt><rp>)</rp></ruby> で<ruby>使<rp> (</rp><rt>つか</rt><rp>)</rp></ruby> う<ruby>資料<rp> (</rp><rt>しりょう</rt><rp>)</rp></ruby> です</h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"动词简体形-名-小句动词简体形-名\"><a class=\"anchor\" href=\"#动词简体形-名-小句动词简体形-名\">#</a> [动词 (简体形)] + [名]、[小句 (动词简体形)] + [名]</h3>\n<p>动词或由动词作谓语的小句（简称动词小句）修饰名词时，用动词的简体形。      <mark>动词修饰名词</mark><br />\n具体说，表示某种习惯或将要发生的动作时用动词的基本形，表示动作已经完成时用动词的 “た形”。</p>\n<p>あれは　<ruby>倒産<rp> (</rp><rt>とうさん</rt><rp>)</rp></ruby> した　会社　です。   那是一家倒闭的公司。</p>\n<div class=\"note info\">\n<p>注：名词前不用敬体形。</p>\n</div>\n<p>さっき森さんが　<ruby>座<rp> (</rp><rt>すわ</rt><rp>)</rp></ruby> った　<ruby>場所<rp> (</rp><rt>ばしょ</rt><rp>)</rp></ruby>。  森先生刚才坐过的地方。  （た形）<br />\n森さんが　知らない　ニュース。  森先生不知道的新闻。    （未然形）</p>\n<div class=\"note info\">\n<p>注：名词前不能加 “の”。</p>\n</div>\n<p>森さんが　座る場所。    森先生要做的地方。<br />\nあれは　<ruby>昨夜<rp> (</rp><rt>ゆうべ</rt><rp>)</rp></ruby>　<ruby>泊<rp> (</rp><rt>と</rt><rp>)</rp></ruby> まった　ホテルです。    那是昨天晚上住的宾馆。</p>\n<h3 id=\"小句动词简体形-名は-名形-です\"><a class=\"anchor\" href=\"#小句动词简体形-名は-名形-です\">#</a> [小句 (动词简体形)] + [名] は　[名]/[形] です</h3>\n<p>动词小句修饰名词而形成的名词短语常常用来作主语。</p>\n<p>私が明日<ruby>乗<rp> (</rp><rt>の</rt><rp>)</rp></ruby> る<ruby>飛行機<rp> (</rp><rt>ひこうき</rt><rp>)</rp></ruby> は　中国<ruby>航空<rp> (</rp><rt>こうくう</rt><rp>)</rp></ruby> です。   我明天乘坐的飞机是中国航空公司的。<br />\n<span class=\"red\">小句中的主语要用 “が” 连接谓语。</span><br />\n小野さんが作る料理　は　おいしい　です。    小野女士做的菜很好吃。</p>\n<p>即名词前面跟一个长的定语用于修饰名词。如：<ins class=\"wavy\">昨日<ruby>父<rp> (</rp><rt>ちち</rt><rp>)</rp></ruby> がデパートで<ruby>買<rp> (</rp><rt>か</rt><rp>)</rp></ruby> った日本<ruby>製<rp> (</rp><rt>せい</rt><rp>)</rp></ruby></ins> の<mark>カメラ</mark>はとても安やすかったです。    昨天爸爸在百货商店买的日本造的照相机很便宜。</p>\n<h3 id=\"小句动词简体形-名をにから-动ます\"><a class=\"anchor\" href=\"#小句动词简体形-名をにから-动ます\">#</a> [小句 (动词简体形)] + [名] を / に / から [动] ます</h3>\n<p>动词小句修饰名词而形成的名词短语也可以用作主语以外的其他句子成分。</p>\n<p>中国で買った<ruby> CD<rp>(</rp><rt>シーディー</rt><rp>)</rp></ruby>  を　<ruby>友達<rp> (</rp><rt>ともだち</rt><rp>)</rp></ruby> に　<ruby>貸<rp> (</rp><rt>か</rt><rp>)</rp></ruby> しました。   我把在中国买的 CD 借给朋友了。<br />\n私<mark>が</mark>知らない<ruby>人<rp> (</rp><rt>ひと</rt><rp>)</rp></ruby>　から　手紙が<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ました。  一个不认识的人给我来了信。</p>\n<div class=\"note info\">\n<p>注：修饰名词的动词小句中的主语，不能用は必须用が表示。</p>\n</div>\n<p>私<mark>が</mark>知らない<ruby>人<rp> (</rp><rt>ひと</rt><rp>)</rp></ruby>（我不认识的人）<br />\n森さん<mark>が</mark>買った本（森先生买的书）</p>\n<h3 id=\"小句一类性二类形名-名\"><a class=\"anchor\" href=\"#小句一类性二类形名-名\">#</a> [小句 (一类性 / 二类形 / 名)] + [名]</h3>\n<ul>\n<li>“名词 + が + 一类形容词 + です” 修饰名词时，一类形容词要用基本形。</li>\n<li>“名词 + が + 二类形容词 + です” 修饰名词时，“二类形容词 + です” 变成 “二类形容词加な”。</li>\n<li>“名词 1 + が + 名词 2 + です” 修饰名词时，“名词 2 + です” 变成 “名词 2 + の”。</li>\n</ul>\n<p><ruby>入<rp> (</rp><rt>い</rt><rp>)</rp> り<rt></rt>口<rp> (</rp><rt>ぐち</rt><rp>)</rp></ruby> が<mark>広い</mark> <ins class=\"wavy\">あの<ruby>建物<rp> (</rp><rt>たてもの</rt><rp>)</rp></ruby></ins> が私の会社です。  入口很大的那座楼是我们的公司。（形 1 基本形 修饰名词）</p>\n<p><ruby>操作<rp> (</rp><rt>そうさ</rt><rp>)</rp></ruby> が<mark>簡単な</mark> <ins class=\"wavy\">パソコン</ins>が欲しいです。     我想要操作简单的个人电脑。 （形 2 + な 修饰名词）</p>\n<p><ruby>数学<rp> (</rp><rt>すうがく</rt><rp>)</rp></ruby> が<mark>専門の</mark> <ins class=\"wavy\"><ruby>先生<rp> (</rp><rt>せんせい</rt><rp>)</rp></ruby></ins> が休みました。   教数学的老师休息了。 （名词 + の 修饰名词）</p>\n<p>注：<ruby>専門<rp> (</rp><rt>せんもん</rt><rp>)</rp></ruby></p>\n<div class=\"note info\">\n<p>形容词修饰名词不能加 “の”。</p>\n</div>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>～のところ<br />\n名词后加 “～のところ” 的形式，可以把本来不表示场所的名称变为表示场所的名称。 即 “～那里”。</li>\n</ol>\n<p>あの　<ins class=\"wavy\"><ruby>窓<rp> (</rp><rt>まど</rt><rp>)</rp></ruby> のところ</ins>　にいる人はだれですか。    在<ins class=\"wavy\">窗户那儿</ins>的人是谁啊？</p>\n<ol start=\"2\">\n<li>\n<p>あれ [指人的词]<br />\n“これ / あれ” 本来是指示事物的词，但有时也用于指人，不过礼貌程度较低，一般用于指示或介绍自己的家人或部下，当然如果所指的人不在场，或者在远处而听不到谈话时，可以使用。</p>\n</li>\n<li>\n<p>～でしたね<br />\n “～でしたね” 用于表示确认。“对吧，是吗”。<br />\n“～でしたね” 表示确认时，可以与副词 “たしか” 呼应使用。</p>\n</li>\n</ol>\n<p>日本と中国の<ruby>時差<rp> (</rp><rt>じさ</rt><rp>)</rp></ruby> は１時間でしたね。   日本和中国的时差时 1 小时来着，对吗？<br />\n—— ええ，日本のほうが１時間<ruby>早<rp> (</rp><rt>はや</rt><rp>)</rp></ruby> いです。    对，日本早一小时。</p>\n<ol start=\"4\">\n<li>\n<p><ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きな<br />\n和 “大きい”“小さい” 表示同样意思的还有 “<ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きな”“<ruby>小<rp> (</rp><rt>ちい</rt><rp>)</rp></ruby> さな” 两个词，不过 “<ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きな”“<ruby>小<rp> (</rp><rt>ちい</rt><rp>)</rp></ruby> さな” 只能用于修饰名词（不能作谓语，如 “～は　<ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きなです），不能用来结句。其他的一类形容词没有这种情况。<br />\n<mark>小さなかばん</mark>が欲しいです。  想要小的提包。</p>\n</li>\n<li>\n<p>このあたり<br />\n “あたり” 表示某一场所的周边，除可接在 “この / その / あの / どの” 等词后面外，还可接在一些表示具体场所的名词后面，如 “<ruby>新宿<rp> (</rp><rt>しんじゅく</rt><rp>)</rp></ruby> あたり（新宿一带）”。</p>\n</li>\n</ol>\n<p>このあたりはよく<ruby>渋滞<rp> (</rp><rt>じゅうたい</rt><rp>)</rp></ruby> します。   这一带经常堵车。</p>\n<h1 id=\"第二十六课自転車に2人ふたりで乗るのは危あぶないです\"><a class=\"anchor\" href=\"#第二十六课自転車に2人ふたりで乗るのは危あぶないです\">#</a> 第二十六课：自転車に<ruby> 2<rt></rt> 人<rp> (</rp><rt>ふたり</rt><rp>)</rp></ruby> で乗るのは<ruby>危<rp> (</rp><rt>あぶ</rt><rp>)</rp></ruby> ないです</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"小句动词简体形-の-は-形-です\"><a class=\"anchor\" href=\"#小句动词简体形-の-は-形-です\">#</a> [小句 (动词简体形)] + の + は [形]　です</h3>\n<p>动词小句加の使其名词化，表示 “做某动作” 的意思。这种名词化形式作主语而谓语是表示性质、状态的一类形容词或二类形容词是，主语要用助词 “は” 表示。</p>\n<p>パソコンで<ruby>表<rp> (</rp><rt>ひょう</rt><rp>)</rp></ruby> を作るのは　<ruby>楽<rp> (</rp><rt>たの</rt><rp>)</rp></ruby> しいです。    用电脑制表是很愉快的。</p>\n<ul>\n<li>\n<p>注：如果形容词是 “<ruby>好<rp> (</rp><rt>す</rt><rp>)</rp></ruby> きです”“<ruby>嫌<rp> (</rp><rt>きら</rt><rp>)</rp></ruby> いです”“<ruby>上手<rp> (</rp><rt>じょうず</rt><rp>)</rp></ruby> です”“<ruby>下手<rp> (</rp><rt>へた</rt><rp>)</rp></ruby> です” 等主观性很强烈的形容词，如果名词化形式是这些形容词的对象时，要用助词 “が”。<br />\n私は　自転車に乗るのが　下手です。  我骑车技术不行。</p>\n</li>\n<li>\n<p>注：“<ruby>好<rp> (</rp><rt>す</rt><rp>)</rp></ruby> きです” 等表示好恶的形容词的对象作为话题使用时，要用助词 “は” 表示。<br />\n絵えをかくのは好きですか。      画画你喜欢吗？<br />\n—— いいえ，絵をかくのは嫌いです。      不，画画我不喜欢。</p>\n</li>\n</ul>\n<div class=\"note info\">\n<p>如果是评价某人对于什么什么 是什么感情，用 “が”；如果是讨论话题，用 “は”。</p>\n</div>\n<h3 id=\"小句动词简体形-の-を-动\"><a class=\"anchor\" href=\"#小句动词简体形-の-を-动\">#</a> [小句 (动词简体形)] + の　+ を　[动]</h3>\n<p>动词小句加 “の” 的名词化形式还可以做宾语。</p>\n<p>手紙を<ruby>出<rp> (</rp><rt>だ</rt><rp>)</rp></ruby> すのを　<ruby>忘<rp> (</rp><rt>わす</rt><rp>)</rp></ruby> れました。    我忘了寄信。<br />\n森さんが<ruby>発言<rp> (</rp><rt>はつげん</rt><rp>)</rp></ruby> するのを　<ruby>聞<rp> (</rp><rt>き</rt><rp>)</rp></ruby> きました。  听了森先生的发言。</p>\n<p>注：这种名词化形式作宾语时 “の” 和 “こと” 可以互换。</p>\n<ul>\n<li>\n<p>不过句尾的动词时 “知らせます（告诉）”“<ruby>伝<rp> (</rp><rt>つた</rt><rp>)</rp></ruby> えます（告诉）”“<ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp></ruby> します（说）” 等表示语言行为的动词时，只能用 “こと”。<br />\n李さんは森さんが休むことを伝えました。     小李转告了森先生请假的事情。</p>\n</li>\n<li>\n<p>句尾的动词时 “見ます（看）”“聞きます（听）” 等表示感知的动词或 “<ruby>手伝<rp> (</rp><rt>てつだ</rt><rp>)</rp></ruby> います（帮忙）”“やめます（停止）”“<ruby>防<rp> (</rp><rt>ふせ</rt><rp>)</rp></ruby> ぎます（防御）” 等表示直接作用于动作对象的动词时，只能用 “の”。<br />\n李さんは森さんが車から<ruby>降<rp> (</rp><rt>お</rt><rp>)</rp></ruby> りるのを見ました。 小李看见森先生从车上下来了。</p>\n</li>\n</ul>\n<h3 id=\"小句简体形-でしょう-推测\"><a class=\"anchor\" href=\"#小句简体形-でしょう-推测\">#</a> [小句 (简体形)] でしょう [推测]</h3>\n<p>表示说话人对自己和听话人都不能断定的事情进行推测，常与 “たぶん” 呼应使用。动词小句和一类形容词小句用简体形后续 “でしょう”，二类形容词小句和名词小句则把简体形的 “だ” 换成 “でしょう” 即可。“でしょう” 的简体形是 “だろう”。</p>\n<p>明日に<ruby>朝<rp> (</rp><rt>あさ</rt><rp>)</rp></ruby> は<ruby>大雨<rp> (</rp><rt>おおあめ</rt><rp>)</rp></ruby> になるでしょう。    明天早晨会下大雨吧。    （动词）</p>\n<p>この本の<ruby>値段<rp> (</rp><rt>ねだん</rt><rp>)</rp></ruby> は分かりませんが，たぶん高いでしょう。 我不知道这本书的价格，大概很贵吧。  （一类形容词）</p>\n<p>桜さくらの季節きせつですから，京都はたぶんにぎやかでしょう。    现在正是观赏樱花的季节，京都大概很热闹吧。 （二类形容词）</p>\n<p><ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby> はたぶん<ruby>豊作<rp> (</rp><rt>ほうさく</rt><rp>)</rp></ruby> だろう。    今年大概是个丰收年吧。  （名词）</p>\n<h3 id=\"小句简体形-かもしれません\"><a class=\"anchor\" href=\"#小句简体形-かもしれません\">#</a> [小句 (简体形)] かもしれません</h3>\n<p>表示可能发生某事，其可能性为 50% 左右。动词小句和一类形容词小句用简体形后续 “かもしれません”，二类形容词小句和名词小句则把简体形的 “だ” 换成 “かもしれません” 即可。  <span class=\"blue\">同上一点的语法</span></p>\n<p>明日は雪かもしれません。    明天也许下雪。</p>\n<p>注：与 “～でしょう” 相比，“～かもしれません” 表示的概率较低。</p>\n<p>可以在同一动作的肯定形和否定形后面并列使用两个 “かもしれません”。<br />\n明日は雨が降るかもしれませんが，降らないかもしれません。    明天也许下雨，也许不下雨。</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p>もしかしたら<br />\n口语形式，用于可能性较低的场合。一般与 “～かもしれません”“～ではありませんか” 等呼应使用。<br />\n馬さんはまだ来ませんね。        小马还没来啊？<br />\n—— もしかしたら，今日は来ないかもしれませんよ。     也许今天不来了。</p>\n</li>\n<li>\n<p>それで<br />\n表示前面句子的事态为后面句子事态的原因、理由。<br />\n日本には<ruby>握手<rp> (</rp><rt>あくしゅ</rt><rp>)</rp></ruby> の<ruby>習慣<rp> (</rp><rt>しゅうかん</rt><rp>)</rp></ruby> がありません。それで，つい<ruby>握手<rp> (</rp><rt>あくしゅ</rt><rp>)</rp></ruby> するのを忘れます。   日本没有握手的习惯，因此，一部注意就忘记握手了。</p>\n</li>\n</ol>\n<p>这里以对方叙述的事情为理由，说话人使用 “それで” 引出其导致的结果。</p>\n<p>注：“だから（所以）” 也表示原因、理由。但与 “それで” 相比，语气较强，且后面可以是表示祈使或推测的句子，而 “それで” 不行。<br />\nすぐに会議が始まります。だから，<ruby>急<rp> (</rp><rt>いそ</rt><rp>)</rp></ruby> いでください。     会议就要开始了，所以你快点吧。  （祈使要求，不能用それで）</p>\n<ol start=\"3\">\n<li>\n<p>つい<br />\n表示并非有意所为却形成了某种后果，并含有对意想不到的后果感到不快、后悔的语感。</p>\n</li>\n<li>\n<p>あいさつ<ruby>回<rp> (</rp><rt>まわ</rt><rp>)</rp></ruby> り<br />\n指到了新单位或迁入新居后，去拜访有关单位或周围邻居的行为。本来是 “あいさつして回ります（寒暄拜访）”，但现在多用 “あいさつ<ruby>回<rp> (</rp><rt>まわ</rt><rp>)</rp></ruby> り” 这种名词形式，如 “あいさつ<ruby>回<rp> (</rp><rt>まわ</rt><rp>)</rp></ruby> りをします”“あいさつ<ruby>回<rp> (</rp><rt>まわ</rt><rp>)</rp></ruby> りに行きます”。</p>\n</li>\n</ol>\n<h1 id=\"第二十七课子供の時大きな地震じしんがありました\"><a class=\"anchor\" href=\"#第二十七课子供の時大きな地震じしんがありました\">#</a> 第二十七课：子供の時，大きな<ruby>地震<rp> (</rp><rt>じしん</rt><rp>)</rp></ruby> がありました</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"小句简体形-時\"><a class=\"anchor\" href=\"#小句简体形-時\">#</a> [小句 (简体形)] + 時</h3>\n<p>“小句 + 時” 是表示时间的名词短语。     <span class=\"blue\">相当于动词、名词、形容词和名词连接时的语法</span></p>\n<ol>\n<li>小句为动词小句是分两种情况：</li>\n</ol>\n<ul>\n<li>“～する（基本形）+ 時” 表示后项动作实现时前项动作尚未完成。</li>\n<li>“～した（た形）+ 時” 表示后项动作实现时前项动作已完成。</li>\n</ul>\n<ol start=\"2\">\n<li>小句为一类形容词小句时：形 1 简体形 + 時</li>\n<li>小句为二类形容词或名词小句时：形 2 + な + 時，名词 + の + 時</li>\n</ol>\n<p>对于 2 和 3，前项是后项的动作进行的时间。</p>\n<p>子供の時，大きな<ruby>地震<rp> (</rp><rt>じしん</rt><rp>)</rp></ruby> がありました。 我小时候，发生过大地震。<br />\n日本に行く　時，たくさんお土産を買いました。    去日本的时候买了许多礼物。（基本形，还没到日本买的）<br />\n日本に行った　時，たくさんお土産を買いました。  去了日本的时候买了很大礼物。    （た形，去了日本才买的）<br />\n忙しい　時，家族みんなで仕事をします。  忙时全家人一起干活。<br />\n<ruby>暇<rp> (</rp><rt>ひま</rt><rp>)</rp></ruby> な　時，私は<ruby>町<rp> (</rp><rt>まち</rt><rp>)</rp></ruby> で買い物をします。    有空时我上街买东西。</p>\n<div class=\"note info\">\n<p>注：<mark>只有名词作修饰语时</mark>，如 “子供の時” 才在名词 “子供” 与 “時” 之间加 “の”，其他词语作修饰语则一律不加 “の”，如 “忙しいの時” 是错误的用法。</p>\n</div>\n<p>表示一次性的、个别的情况时，也可以在 “～時” 后面加 “に”。<br />\nこの前，友達が<ruby>病気<rp> (</rp><rt>びょうき</rt><rp>)</rp></ruby> の時に，私が<ruby>看病<rp> (</rp><rt>かんびょう</rt><rp>)</rp></ruby> しました。    前些天朋友生病时我护理他了。</p>\n<h3 id=\"动-ながら\"><a class=\"anchor\" href=\"#动-ながら\">#</a> [动]　ながら</h3>\n<p>表示同一主体进行两个动作，其中后面的动作是主要动作。“ます” 形去掉 “ます” 加 “ながら”。</p>\n<p>李さんはテレビを見ながら<ruby>食事<rp> (</rp><rt>しょくじ</rt><rp>)</rp></ruby> をしています。   小李边看电视边吃饭。</p>\n<h3 id=\"小句简体形-でしょう-确认\"><a class=\"anchor\" href=\"#小句简体形-でしょう-确认\">#</a> [小句 (简体形)] でしょう？   [确认]</h3>\n<p>如果是确认对方比自己更为熟悉的事情时，“～でしょう” 读升调，含有说话人请听话人告诉自己某种信息的语感。<br />\n如果是用于对方和自己意见不同，或者叮问对方时，读降调。</p>\n<p>注：“ね” 也可用于向对方进行确认，但 “～ね” 仅仅用于说话人认为自己和听话人双方意见一致的情况。而 “～でしょう” 可用于对方和自己意见不一致时。所以一般意见一致时用 “ね”。</p>\n<h3 id=\"动-ています-反复习惯\"><a class=\"anchor\" href=\"#动-ています-反复习惯\">#</a> [动] ています   [反复][习惯]</h3>\n<p>之前 15、16 课学过 “动词て形 + います” 表示动作正在进行和动作的结果、状态的用法。<br />\n这里还可以表示反复或习惯性的动作，在表示习惯性动作时可以用动词ます形代替。</p>\n<p><ruby>葉子<rp> (</rp><rt>ようこ</rt><rp>)</rp></ruby> さんはアルバイトをしながら学校に<ruby>通<rp> (</rp><rt>かよ</rt><rp>)</rp></ruby> っています。  叶子边打工边上学。 [反复]<br />\n 私は毎日散歩しています。    我每天散步。    [习惯]<br />\n 私は毎日散歩します。        我明天散步。 [习惯，但用ます形表示]</p>\n<p>注：表示习惯性动作时，二者都可以使用，但句子里如果有使用 “<ruby>先月<rp> (</rp><rt>せんげつ</rt><rp>)</rp></ruby> から” 这种表示时间起点的形式时，一般不用 “ます”。<br />\n私は先月から毎朝<ruby>太極拳<rp> (</rp><rt>たいきょくけん</rt><rp>)</rp></ruby> をしています。   我从上个月开始每天早上打太极拳。</p>\n<p>注：表示现在正在从事的工作，有时可用 “[表示职业的名词]+ を + しています” 的形式。<br />\n私は<ruby>高校<rp> (</rp><rt>こうこう</rt><rp>)</rp></ruby> の<ruby>教師<rp> (</rp><rt>きょうし</rt><rp>)</rp></ruby> をしています。  我在做高中教师。</p>\n<h3 id=\"名-で-原因-理由\"><a class=\"anchor\" href=\"#名-で-原因-理由\">#</a> [名] で     [原因、理由]</h3>\n<p>仕事で，<ruby>楊<rp> (</rp><rt>よう</rt><rp>)</rp></ruby> さんと<ruby>会<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> っていた んですよ。      因工作我和杨先生见面来着。<br />\n小语法：</p>\n<ul>\n<li><ruby>会<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> っていた<br />\n动词「会う」的て形 + いる（过去式）。<br />\n「会う」是 “见面” 的意思，て形「会って」后接「いる」表示动作的持续或结果状态。<br />\n「会っていた」是「会っている」的过去式，表示过去某段时间内的持续状态，即 “当时正在见面” 或 “当时见过面”。</li>\n<li>んですよ<br />\n「んです」是「のです」的口语形式，用于解释或强调原因。<br />\n「よ」是语气助词，用于加强语气，表示说话人向听话人传递信息或强调某事。</li>\n</ul>\n<h3 id=\"名-と会います\"><a class=\"anchor\" href=\"#名-と会います\">#</a> [名] と会います</h3>\n<p>第 8 课学习了 “～に会います” 中的 “に” 表示对象的用法，而使用表示互动行为的动词时，进行同一动作的另一方要用 “と” 表示。如 “<ruby>結婚<rp> (</rp><rt>けっこん</rt><rp>)</rp></ruby> します（结婚）”“けんかします（吵架）” 等表示互动行为的动作只能用 “と”。<br />\n“会います” 既能用に也能用と，但と时含有互动的语感。</p>\n<p>田中さんは佐藤さんと結婚しました。</p>\n<p>在 “A は B と～” 中，A 为主语，而在 “A と B とが～” 中，A 和 B 都是主语（A と B と中的第二个と有时省略不用。）<br />\n田中さんと佐藤さん（と）が結婚しました。</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>\n<p>アルバイト<br />\n “打工”，日语中多指学生利用课外时间去工作的情况。</p>\n</li>\n<li>\n<p>学校に通っています<br />\n “<ruby>通<rp> (</rp><rt>かよ</rt><rp>)</rp></ruby> います” 表示定期往返于同一个场所，与表示目的地的 “に” 一起使用；“行きます” 也和 “に” 一起使用，但只表示从一个地方移动到另一个地方，没有往返的意思。</p>\n</li>\n<li>\n<p><ruby>大勢<rp> (</rp><rt>おおぜい</rt><rp>)</rp></ruby><br />\n 表示人多，如 “<ruby>大勢<rp> (</rp><rt>おおぜい</rt><rp>)</rp></ruby> の人（很多人）”“人が<ruby>大勢<rp> (</rp><rt>おおぜい</rt><rp>)</rp></ruby> ます（有许多人）”。用于修饰名词、动词而一般不能用来做谓语（不能 “人が大勢です”）。<br />\n“たくさん” 也可用来表示人多，但同时可用于人以外的事物，但 “<ruby>大勢<rp> (</rp><rt>おおぜい</rt><rp>)</rp></ruby>” 只能用于人。</p>\n</li>\n</ol>\n<p><ruby>今朝<rp> (</rp><rt>けさ</rt><rp>)</rp></ruby>，公園を散歩している時，<ruby>大勢<rp> (</rp><rt>おおぜい</rt><rp>)</rp></ruby> の人が<ruby>集<rp> (</rp><rt>あつ</rt><rp>)</rp></ruby> まっているのを見ました。  我今天早晨在公园散步时，看见许多人聚在一起。</p>\n<ol start=\"4\">\n<li>\n<p>お<ruby>年<rp> (</rp><rt>とし</rt><rp>)</rp></ruby><ruby> 寄<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> り<br />\n “<ruby>年<rp> (</rp><rt>とし</rt><rp>)</rp></ruby><ruby> 寄<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> り” 前加上敬语的 “お”，是既有敬意又有亲切感的 “老人” 的说法，但是，“お<ruby>年<rp> (</rp><rt>とし</rt><rp>)</rp></ruby><ruby> 寄<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> り” 不能直接用来称呼对方。 直接称呼时用 “おじいさん（老爷爷）”“おばあさん（老奶奶）”<br />\n お<ruby>年<rp> (</rp><rt>とし</rt><rp>)</rp></ruby><ruby> 寄<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> りが<ruby>多<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> かったでしょう？ 老年人很多吧。</p>\n</li>\n<li>\n<p>そう<ruby>言<rp> (</rp><rt>い</rt><rp>)</rp></ruby> えば<br />\n “说起来”，表示由正在进行的对话或说话现场的某种情况联想到另外一些情况时使用。</p>\n</li>\n<li>\n<p>へえ [叹词]<br />\n 表示对听起来的信息感到敬佩或惊讶。</p>\n</li>\n</ol>\n<h1 id=\"第二十八课馬さんはわたしに地図をくれました\"><a class=\"anchor\" href=\"#第二十八课馬さんはわたしに地図をくれました\">#</a> 第二十八课：馬さんはわたしに地図をくれました</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"名1人は-名2人に-名3物をくれます\"><a class=\"anchor\" href=\"#名1人は-名2人に-名3物をくれます\">#</a> [名 1 (人)] は　[名 2 (人)] に　[名 3 (物)] をくれます</h3>\n<p>“くれます” 表示别人给说话人或说话人一方的人某物。</p>\n<p>辨析：<br />\nあげる：1. 我给别人 2. 别人给别人<br />\nくれる：1. 别人给我 2. 别人给我这边的人（亲人等）</p>\n<p>小野さん，この本をわたしにくれますか。  小野，这本书送给我吗？  （别人给我）<br />\n昨日，馬さんが<ruby>妹<rp> (</rp><rt>いもうと</rt><rp>)</rp></ruby> に旅行のお土産をくれました。 昨天，小马把旅行时买的礼物给了我妹妹。  （别人给我的妹妹）</p>\n<p>注：日语中，一般采用以说话人作主语进行叙述的说法。如，相比于 “馬さんがわたしに本をくれました。”，更常用 “わたしは馬さんに本をもらいました。”</p>\n<h3 id=\"动-てあげます\"><a class=\"anchor\" href=\"#动-てあげます\">#</a> [动] てあげます</h3>\n<p>即 “动词て形 + あげます”，表示说话人或说话人一方的人为别人做某事。“别人” 用助词 “に” 表示。</p>\n<p>森さんは<ruby>お<rt></rt>年寄<rp> (</rp><rt>としよ</rt><rp>)</rp> り<rt></rt></ruby>の<ruby>荷物<rp> (</rp><rt>にもつ</rt><rp>)</rp></ruby> を　<ruby>持<rp> (</rp><rt>も</rt><rp>)</rp></ruby> って　あげました。   森先生帮老年人拿行李了。<br />\nおじいさんが<ruby>孫<rp> (</rp><rt>まご</rt><rp>)</rp></ruby> に本を　読んで　あげました。   爷爷念书给孙子听。</p>\n<h3 id=\"动-てもらいます\"><a class=\"anchor\" href=\"#动-てもらいます\">#</a> [动]　てもらいます</h3>\n<p>即 “动词て形 + もらいます”，具有 “说话人请别人做某事” 以及 “说话人承受了由于别人的动作而带来的恩惠” 两种含义。“别人” 用助词 “に” 表示。</p>\n<p>森さんは李さんに北京を　<ruby>案内<rp> (</rp><rt>あんない</rt><rp>)</rp></ruby> して　もらいました。 森先生请小李带他游览了北京。<br />\n<ruby>係<rp> (</rp><rt>かかり</rt><rp>)</rp></ruby> の人に<ruby>切符<rp> (</rp><rt>きっぷ</rt><rp>)</rp></ruby> を　<ruby>交換<rp> (</rp><rt>こうかん</rt><rp>)</rp></ruby> して　もらいました。  请工作人员给我换了票。</p>\n<p><ruby>林<rp> (</rp><rt>はやし</rt><rp>)</rp></ruby> さん，もう<ruby>少<rp> (</rp><rt>すこ</rt><rp>)</rp></ruby> し　待って　もらいたいのですが。  林先生，我想请你再稍微等一等。<br />\n—— 分かりました。   知道了。</p>\n<h3 id=\"动-てくれます\"><a class=\"anchor\" href=\"#动-てくれます\">#</a> [动] てくれます</h3>\n<p>即 “动词て形 + くれます”，表示说话人以外的主语为说话人或说话人一方的人做某事（别人为我或我这边的人做某事）。如果整个句子为疑问形式时也可用于委托关系亲密的人为自己做某事。</p>\n<p><ruby>女<rp> (</rp><rt>おんな</rt><rp>)</rp></ruby> の人がわたしの<ruby>財布<rp> (</rp><rt>さいふ</rt><rp>)</rp></ruby> を　<ruby>拾<rp> (</rp><rt>ひろ</rt><rp>)</rp></ruby> って　くれました。   一位妇女帮我捡起了钱包。<br />\nごみを　<ruby>出<rp> (</rp><rt>だ</rt><rp>)</rp></ruby> して　くれますか。  —— いいですよ。  帮我倒一下垃圾好吗？ —— 好的。</p>\n<p>委托别人帮自己做某事时，使用否定形式 “～てくれませんか” 更礼貌。<br />\n森君，この手紙をコピーしてくれますか。  森君，能帮我把这封信复印一下吗？</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>\n<p>～てあげます<br />\n “～てあげます” 表示说话人或者说话人一方的人为别人做某事，但含有赐恩于对方的意思，不太礼貌，不能面对面直接对尊长使用。<br />\n对尊长说话时，用征求对方意见的形式 “～ましょうか”。</p>\n</li>\n<li>\n<p>それに<br />\n “而且”。用于前后句的内容为累加关系，多用于口语。</p>\n</li>\n<li>\n<p>～<ruby>先<rp> (</rp><rt>さき</rt><rp>)</rp></ruby><br />\n 表示移动性动作的到达地点或归属。如 “<ruby>引<rp> (</rp><rt>ひ</rt><rp>)</rp></ruby> っ<ruby>越<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> し先（搬迁的地址）” 指搬迁后居住的地方。</p>\n</li>\n</ol>\n<p><ruby>出張<rp> (</rp><rt>しゅっちょう</rt><rp>)</rp></ruby> 先のホテルから電話がありました。 从出差地的宾馆打来了电话。</p>\n<p>其他例如：行き先（目的地，要去的地方）；旅行先（旅行的目的地）；<ruby>就職<rp> (</rp><rt>しゅうしょく</rt><rp>)</rp></ruby> 先（就业的单位）；<ruby>送<rp> (</rp><rt>おき</rt><rp>)</rp></ruby> り先（邮件的接受人和地点）</p>\n<ol start=\"4\">\n<li>どの<ruby>辺<rp> (</rp><rt>へん</rt><rp>)</rp></ruby><br />\n 询问大致的场所时使用。回答时回答一个大致的场所，也可以只回答地名。<br />\n甲：引っ越し先が<ruby>決<rp> (</rp><rt>き</rt><rp>)</rp></ruby> まりました。 （搬迁的地址定下来了。）<br />\n乙：どの辺ですか。 （在哪儿？）<br />\n甲 ：新宿です。    （在新宿。）</li>\n</ol>\n<p>注：类似 “～あたり”，“～辺” 也表示周边的意思，但 “辺” 必须和 “この / その / あの / どの” 等一起使用，不能加在表示具体场所的名词后。</p>\n<ol start=\"5\">\n<li><ruby>家具<rp> (</rp><rt>かぐ</rt><rp>)</rp></ruby> はどうしたんですか<br />\n日语的 “どうしたんですか” 可以用于不同的场面表示多种意思，在这里表示询问某物的购入方式。<br />\n<ruby>家具<rp> (</rp><rt>かぐ</rt><rp>)</rp></ruby> はどうしたんですか。     家具怎么样了。<br />\n—— もう買いました。明日<ruby>届<rp> (</rp><rt>とど</rt><rp>)</rp></ruby> けてもらいます。    已经买好了，明天送来。<br />\nそのチケット，どうしたんですか。    入场券怎么搞到手的？<br />\n—— インターネットで買ったんです。   在网上买的。</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC6%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC6%E5%8D%95%E5%85%83/",
            "title": "单元六——再见！日本",
            "date_published": "2025-03-24T08:59:00.000Z",
            "content_html": "<h1 id=\"第二十一课わたしは-すき焼やきを-食べた-ことが-あります\"><a class=\"anchor\" href=\"#第二十一课わたしは-すき焼やきを-食べた-ことが-あります\">#</a> 第二十一课：わたしは　すき<ruby>焼<rp> (</rp><rt>や</rt><rp>)</rp></ruby> きを　食べた　ことが　あります</h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"动词的た形\"><a class=\"anchor\" href=\"#动词的た形\">#</a> 动词的た形</h3>\n<p>即把て形的て换成た，把で换成だ。</p>\n<h3 id=\"动た形-ことが-あります\"><a class=\"anchor\" href=\"#动た形-ことが-あります\">#</a> [动 (た形)] ことが　あります</h3>\n<p>表示过去的经历，即 “（曾经）~ 过”。通常用于至少半年以前发生的事情，而在叙述 “昨天” 等离现在很近的以前的经历时，不能用此句型。本句型即可用于叙述经历的时间、次数，也可用于谈论某种经历。<br />\n否定形式是：“动词た形 + ことが  ありません”。强调完全没有某种经历时，可以加 “<ruby>一度<rp> (</rp><rt>いちど</rt><rp>)</rp></ruby> も”。<br />\n疑问形式是：“动词た形 + ことが  ありますか” 。疑问句一般只问有无某种经历。回答时，可以重复问句中的部分词语，也可以只说 “はい ，あります”“いいえ，ありません”。</p>\n<p>北京へ　行った　ことが　ありますか。        你去过北京吗？<br />\n—— いいえ，一度も　行った　ことが　ありません。  没有，一次也没去过。<br />\n—— いいえ，ありません。                  不，没有。</p>\n<h3 id=\"动た形-後あとで~\"><a class=\"anchor\" href=\"#动た形-後あとで~\">#</a> [动 (た形)] <ruby>後<rp> (</rp><rt>あと</rt><rp>)</rp></ruby> で，～</h3>\n<p>表示动作在另一个动作之后发生时，使用该句型。<br />\neg：映画を　見た　後で，<ruby>食事<rp> (</rp><rt>しょくじ</rt><rp>)</rp></ruby> を　しました。   看完电影后吃了饭。</p>\n<p>这个句型也可以以 “名词 + の + 後で” 的形式使用。<br />\neg：仕事の　後で，映画を　見ます。  工作之后看电影。</p>\n<div class=\"note info\">\n<p>前面学过 “前に”，后面必须是 “に”，而这里 “後で” 后面必须为 “で”，且 “～前に” 前面的动词必须为基本形，而 “～後で” 前面的动词必须为た形。</p>\n</div>\n<h3 id=\"动た形-ほうが-いいです\"><a class=\"anchor\" href=\"#动た形-ほうが-いいです\">#</a> [动 (た形)] ほうが　いいです</h3>\n<p>用于在两种事物中进行选择时。“最好做～”。<br />\n否定表达形式为：“动词未然形 + ない ほうが　いいです”，也即 “动词ない形 + ほうが　いいです”，表示 “最好别那么做”。<br />\n当建议对方做理想的动作、行为时，句尾可加 “よ”。</p>\n<p>eg：<br />\nもっと　野菜を食べた　ほうが　いいですよ。      还是多吃点蔬菜好啊。<br />\nそんなに　<ruby>慌<rp> (</rp><rt>あわ</rt><rp>)</rp></ruby> てない　ほうが　いいです。   别那么慌张啊。</p>\n<h3 id=\"动ましょうか-提议\"><a class=\"anchor\" href=\"#动ましょうか-提议\">#</a> [动] ましょうか  [提议]</h3>\n<p>用于提议对方和自己一起做某事或向对方提议自己为对方做某事。 另外还有向对方确认自己的提议是否可行的意思。<br />\n何か　食べましょうか。  吃点什么吗？</p>\n<p>回答时，若意思为 A 向 B 提议为对方做某事时，则 B 说 “お<ruby>願<rp> (</rp><rt>ねが</rt><rp>)</rp></ruby> いします”。若意思为 A 向 B 提议双方一起做某事时，则 B 说 “はい，そうしましょう” 或 “いいですね”。反对或拒绝提议时则说 “～ないで　ください” 或 “いいえ，ちょっと…”。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>その　ほうが　いいです<br />\n名词及指示事物的词也可以后续 “ほうが　いいです” 来表示比较、选择的意思。<br />\n形式为：</li>\n</ol>\n<ul>\n<li>“名词の　ほうがいいです”</li>\n<li>“これ / それ / あれ　の　ほうがいいです”</li>\n<li>“この / その / あの ほうがいいです”</li>\n</ul>\n<p>eg:<br />\n<ruby> 速<rp> (</rp><rt>はや</rt><rp>)</rp></ruby> いですから，<ruby>飛行機<rp> (</rp><rt>ひこうき</rt><rp>)</rp></ruby> の　ほうがいいです。  因为速度快，还是坐飞机去比较好。</p>\n<ol start=\"2\">\n<li>\n<p><ruby>何度<rp> (</rp><rt>なんど</rt><rp>)</rp></ruby> か<br />\n “几次”，在表示不定数量时，日语中疑问词后面必须加 “か”。类似还有 “いつか　どこか　何か”。<br />\neg：仕事の　後で，何度か　見に　行った　ことが　あります。  下班后，去看过几次。</p>\n</li>\n<li>\n<p>９時<ruby>過<rp> (</rp><rt>す</rt><rp>)</rp></ruby> ぎ<br />\n “～<ruby>過<rp> (</rp><rt>す</rt><rp>)</rp></ruby> ぎ” 用在表示时间或年龄的词语后面表示超过了该时间或年龄。用在表示时间的词语后面时，是 “数词 + 時 / 分 + 過ぎ” 的形式。用在表示年龄的词语后面时，是 “数词 + 過ぎ” 的形式，中间不加 “<ruby>歳<rp> (</rp><rt>さい</rt><rp>)</rp></ruby>”。<br />\neg：<ruby>昨夜<rp> (</rp><rt>ゆうべ</rt><rp>)</rp></ruby>　１０時過ぎに　<ruby>地震<rp> (</rp><rt>じしん</rt><rp>)</rp></ruby> が　ありました。  昨晚 10 点刚过发生了地震。</p>\n</li>\n</ol>\n<h1 id=\"第二十二课森さんは-毎晩-テレビを-見る\"><a class=\"anchor\" href=\"#第二十二课森さんは-毎晩-テレビを-見る\">#</a> 第二十二课：森さんは　毎晩　テレビを　見る</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"敬体形和简体形\"><a class=\"anchor\" href=\"#敬体形和简体形\">#</a> 敬体形和简体形</h3>\n<p>之前学习的 “～ます”“～です” 是对长辈或关系不太亲密的人使用的形式，为敬体形。与此相反，若对方是同辈或晚辈，或者关系较密切时则使用 “简体形”。<br />\n动词本身具有敬体形和简体形，如敬体形包括：ます　ません　ました　ませんでした；简体形包括：动词基本形、ない形、た形。<br />\n但一类形容词、二类形容词、名词本身没有敬体形和简体形之分，只有在做谓语时，其谓语形式才有敬体形和简体形。</p>\n<h3 id=\"动词的简体形\"><a class=\"anchor\" href=\"#动词的简体形\">#</a> 动词的简体形</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>敬体形</th>\n<th>简体形</th>\n<th>敬体形</th>\n<th>简体形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>现在将来形式</td>\n<td>肯定</td>\n<td>買います (买)</td>\n<td>買う （基本形）</td>\n<td>あります (有)</td>\n<td>ある</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>買いません</td>\n<td>買わない (ない形)</td>\n<td>ありません</td>\n<td>ない</td>\n</tr>\n<tr>\n<td>过去形式</td>\n<td>肯定</td>\n<td>買いました</td>\n<td>買った （た形）</td>\n<td>ありました</td>\n<td>あった</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>買いませんでした</td>\n<td>買わなかった (なかった形)</td>\n<td>ありませんでした</td>\n<td>なかった</td>\n</tr>\n</tbody>\n</table>\n<p>コーヒー，飲む？        喝咖啡吗？<br />\n—— ううん，飲まない。   不，不喝。  （飲みません -&gt; 飲まない）</p>\n<p>注：简体的会话中常省略助词。</p>\n<h3 id=\"一类形容词谓语形式的简体形\"><a class=\"anchor\" href=\"#一类形容词谓语形式的简体形\">#</a> 一类形容词谓语形式的简体形</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>敬体形</th>\n<th>简体形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>现在将来形式</td>\n<td>肯定</td>\n<td>忙しいです (忙)</td>\n<td>忙しい</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>忙しくないです</td>\n<td>忙しくない</td>\n</tr>\n<tr>\n<td>过去形式</td>\n<td>肯定</td>\n<td>忙しかったです</td>\n<td>忙しかった</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>忙しく　なかったです</td>\n<td>忙しく　なかった</td>\n</tr>\n</tbody>\n</table>\n<p>就是去掉です即为简体形。 （形容词的肯定、否定、过去、过去否定语法见<a href=\"../%E5%8A%A8%E8%AF%8D%E5%92%8C%E5%BD%A2%E5%AE%B9%E8%AF%8D%E7%9F%A5%E8%AF%86%E7%82%B9/\"> “动词和形容词知识点”</a>）</p>\n<p>昨日の　試験，どうだった？          昨天的考试怎么样啊？<br />\n—— ちょっと　<ruby>難<rp> (</rp><rt>むずか</rt><rp>)</rp></ruby> しかった。     稍微有点难。</p>\n<p>注：形 1 的简体形与形二以及名词不同，后面不能加 “だ”。</p>\n<h3 id=\"二类形容词谓语形式的简体形\"><a class=\"anchor\" href=\"#二类形容词谓语形式的简体形\">#</a> 二类形容词谓语形式的简体形</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>敬体形</th>\n<th>简体形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>现在将来形式</td>\n<td>肯定</td>\n<td>簡単です (简单)</td>\n<td>簡単だ</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>簡単では　ありません</td>\n<td>簡単ではない</td>\n</tr>\n<tr>\n<td>过去形式</td>\n<td>肯定</td>\n<td>簡単でした</td>\n<td>簡単だった</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td>簡単では　ありませんでした</td>\n<td>簡単では　なかった</td>\n</tr>\n</tbody>\n</table>\n<p>现在将来形式的肯定疑问句用去掉简体形中的 “だ” 的形式（名词也一样）。</p>\n<p>この　ネクタイ，<ruby>派手<rp> (</rp><rt>はで</rt><rp>)</rp></ruby>？           这台领带花哨吗？<br />\n—— ううん，全然　派手じゃ　ないわ。     不，一点都不花哨。</p>\n<p>森さんの　アパート，<ruby>静<rp> (</rp><rt>しず</rt><rp>)</rp></ruby> か？   森先生居住的公寓安静吗？<br />\n—— うん，静かだよ。         嗯，很安静。</p>\n<h3 id=\"名词谓语形式的简体形\"><a class=\"anchor\" href=\"#名词谓语形式的简体形\">#</a> 名词谓语形式的简体形</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>敬体形</th>\n<th>简体形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>现在将来形式</td>\n<td>肯定</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れです (简单)</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れだ</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れでは　ありません</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れではない</td>\n</tr>\n<tr>\n<td>过去形式</td>\n<td>肯定</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れでした</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れだった</td>\n</tr>\n<tr>\n<td></td>\n<td>否定</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れでは　ありませんでした</td>\n<td><ruby>晴<rp> (</rp><rt>は</rt><rp>)</rp></ruby> れでは　なかった</td>\n</tr>\n</tbody>\n</table>\n<p>和第二类形容词谓语形式的简体形同种变法。</p>\n<p>昨日，スキー<ruby>場<rp> (</rp><rt>じょう</rt><rp>)</rp></ruby> は　雪だった？                  昨天滑雪场下雪了吗？<br />\n—— ううん，雪じゃ　なかったよ。いい　天気だった。   没有下雪啊，天气挺好的。</p>\n<h3 id=\"小句けど小句-转折-铺垫\"><a class=\"anchor\" href=\"#小句けど小句-转折-铺垫\">#</a> [小句] けど，[小句]　[转折、铺垫]</h3>\n<p>“けど” 连接两个句子，表示转折，起着把两个句子归纳成一个句子的作用，用于口语。</p>\n<p>昨日の　試験，どうだった？          昨天的考试怎么样啊？<br />\n—— ちょっと　難しかったけど，まあまあ　できたよ。   有点难，不过都做出来了。</p>\n<p>另外，“けど” 花园不表示转折而表示铺垫的用法。<br />\n来週，<ruby>送別会<rp> (</rp><rt>そうべつかい</rt><rp>)</rp></ruby> を　するけど，<ruby>都合<rp> (</rp><rt>つごう</rt><rp>)</rp></ruby> は　どうかな？    下星期要开一个欢送会，你时间方便吗？</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>敬体和简体<br />\n正式场合和书信一般用敬体；与家人、朋友交谈时用简体，有关法律的文章、报纸、商业文件等也都用简体。</li>\n</ol>\n<p>お母さん，あの　<ruby>玩具<rp> (</rp><rt>おもちゃ</rt><rp>)</rp></ruby> が　欲しい。         妈妈，我想要那个玩具。<br />\n昨日　駅前で　<ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きい　<ruby>火事<rp> (</rp><rt>かじ</rt><rp>)</rp></ruby> が　あった。    昨天车站附近发生了很大的火灾。</p>\n<ol start=\"2\">\n<li>\n<p>简体疑问<br />\n用简体表示疑问时，一般名词句、形容词句省略敬体形的 “～ですか”，句尾读升调。动词句则把动词敬体形变成简体形，去掉疑问助词 “か”，句尾读升调。另外书写时为例表示疑问需要加 “？”<br />\n これ，日本<ruby>製<rp> (</rp><rt>せい</rt><rp>)</rp></ruby>？  这个，是日本货？</p>\n</li>\n<li>\n<p>うん　和 ううん<br />\n简体会话中，“はい” 说成 “うん”，“いいえ” 说成 “ううん”。</p>\n</li>\n<li>\n<p>简体助词<br />\n “かな” 和 “の” 这两个助词只能接在简体形后面。</p>\n</li>\n</ol>\n<ul>\n<li>\n<p>助词 “かな” 一般用于自言自语的场合，如有听话人在场则表示通过让对方听到自己的自问自答而向对方提供一种不太确定的信息。<br />\n今日　李さんは　<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp></ruby> るかな。 小李今天会来吗？</p>\n</li>\n<li>\n<p>助词 “の” 用于要求说明或确认某事。<br />\nああ，小野さん，どうしたの？    小野女士，你好。有什么事吗？<br />\n寒いの？    冷吗？</p>\n</li>\n</ul>\n<ol start=\"5\">\n<li>\n<p>～って  [传闻]<br />\n“<ruby>太田<rp> (</rp><rt>おおた</rt><rp>)</rp></ruby>，<ruby>今度<rp> (</rp><rt>こんど</rt><rp>)</rp></ruby>　中国へ　<ruby>転勤<rp> (</rp><rt>てんきん</rt><rp>)</rp></ruby> だって（听说太田要调到中国去工作）”，这里的 “<ruby>転勤<rp> (</rp><rt>てんきん</rt><rp>)</rp></ruby> だって” 是在简体形 “<ruby>転勤<rp> (</rp><rt>てんきん</rt><rp>)</rp></ruby> だ” 的后面加 “って” 表示听说、传闻。</p>\n</li>\n<li>\n<p>省略 [简体句的省略]<br />\n 在口语中，简体句中的一些音往往不发，如 “森さんの　<ruby>電話番号<rp> (</rp><rt>でんわばんご</rt><rp>)</rp></ruby>，知ってる？”，其中省略了 “ている” 的 “い”，“電話番号を” 中的助词 “を” 也省略了。</p>\n</li>\n<li>\n<p>“わ” 和 “よ”<br />\n 都可用于简体句或敬体句句尾。“便利よ”“大きいですわ”。</p>\n</li>\n<li>\n<p>电话号码的读法<br />\n数字要一个一个读。</p>\n</li>\n<li>\n<p>“～<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>”<br />\n 动词 “ます” 形去掉 “ます” 的形式加上 “<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>” 就有 “~ 的做法” 的意思，用来表示动作的方式。</p>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>ます形</th>\n<th>去掉ます</th>\n<th>~<ruby> 方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>      做法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp></ruby> します</td>\n<td>話し</td>\n<td>話し<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>     说法</td>\n</tr>\n<tr>\n<td><ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> みます</td>\n<td>読み</td>\n<td>読み<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>     读法</td>\n</tr>\n<tr>\n<td><ruby>作<rp> (</rp><rt>つく</rt><rp>)</rp></ruby> ります</td>\n<td>作り</td>\n<td>作り<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>     做法</td>\n</tr>\n<tr>\n<td>やります</td>\n<td>やり</td>\n<td>やり<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>     办法</td>\n</tr>\n<tr>\n<td><ruby>使<rp> (</rp><rt>つか</rt><rp>)</rp></ruby> います</td>\n<td>使い</td>\n<td>使い<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>     用法</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"第二十三课休みの-日ひ散歩したり-買い物に-行ったり-します\"><a class=\"anchor\" href=\"#第二十三课休みの-日ひ散歩したり-買い物に-行ったり-します\">#</a> 第二十三课：休みの　<ruby>日<rp> (</rp><rt>ひ</rt><rp>)</rp></ruby>，散歩したり　買い物に　行ったり　します</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"动たり-动たり-します\"><a class=\"anchor\" href=\"#动たり-动たり-します\">#</a> [动] たり [动] たり します</h3>\n<p>用于列举若干种有代表性的动作时，即 “动词た形 + り　します”，“します” 需要根据上下文判断时态。</p>\n<p><ruby>吉田<rp> (</rp><rt>よしだ</rt><rp>)</rp></ruby> さんは　<ruby>日曜日<rp> (</rp><rt>にちようび</rt><rp>)</rp></ruby> には　何を　しますか。      吉田先生，你星期天都做什么？<br />\n—— 家の　<ruby>掃除<rp> (</rp><rt>そうじ</rt><rp>)</rp></ruby> を　したり　<ruby>洗濯<rp> (</rp><rt>せんたく</rt><rp>)</rp></ruby> を　したり　します。   打扫打扫房间，洗洗衣服。<br />\n（する -&gt; して -&gt; した -&gt; したり）</p>\n<p>注：动词た形即动词简体的过去式。</p>\n<h3 id=\"形1かったり-形1かったりです形2だったり-形2だったりです名だったり-名だったりです\"><a class=\"anchor\" href=\"#形1かったり-形1かったりです形2だったり-形2だったりです名だったり-名だったりです\">#</a> [形 1] かったり　[形 1] かったりです；[形 2] だったり　[形 2] だったりです；[名] だったり　[名] だったりです</h3>\n<p>用于表示状态或状况有多种可能时，其构成形式是把形 1 た形、形 2 た形、名词た形之后加り。</p>\n<p>飛行機の　チケットは　高かったり　安かったりです。          飞机票有时贵，有时便宜。<br />\nこの公園は　時間に　よって　静だったり　にぎやかだったりです。  根据时间，这个公园有时寂静有时热闹。<br />\n日本語の　先生は　中国人だったり　日本人だったりです。      日语老师既有中国人也有日本人。</p>\n<h3 id=\"小句-か\"><a class=\"anchor\" href=\"#小句-か\">#</a> [小句] + か</h3>\n<p>用于表示某种不确定的内容。</p>\n<h3 id=\"小句-か-どうか\"><a class=\"anchor\" href=\"#小句-か-どうか\">#</a> [小句] + か　どうか</h3>\n<ol>\n<li>将不包含疑问词的疑问句作为一个长句中的一部分时，将动词、一类形容词的敬体形变成<mark>简体形</mark>，并在后面加上 “か　どうか”。</li>\n</ol>\n<p>eg：<br />\n私は　<ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby> の　夏，北京へ　行きますか。+ 私は　分かりません。<br />\n可以简化为：私は　今年の　夏，北京へ　<ins class=\"dot\">行くか　どうか</ins>　分かりません。  我今年夏天去不去北京，还不知道。</p>\n<p>私は　この料理が　辛いか　どうか　知りません。  我不知道这道菜辣不辣。</p>\n<p>小野さんは　仕事が　<ruby>終<rp> (</rp><rt>お</rt><rp>)</rp></ruby> わったか　どうか　<ruby>聞<rp> (</rp><rt>き</rt><rp>)</rp></ruby> いて　ください。    问一下小野女士，工作完了没有。</p>\n<ol start=\"2\">\n<li>\n<p>另外，也可以重复使用动词的 “基本形” 和 “ない形”，表达和上面相同的含义。<br />\n私は　今年の　夏，北京へ　<ins class=\"dot\">行く</ins>か　<ins class=\"dot\">行かない</ins>か　分かりません。<br />\n私は　この　料理が　<ins class=\"dot\">辛い</ins>か　<ins class=\"dot\">辛くない</ins>か　知りません。</p>\n</li>\n<li>\n<p>如果 “～か　どうか” 的前面为名词或二类形容词时，“～か　どうか” 直接接在名词或二类形容词后，<mark>其间不加 “だ”</mark>。另外，“～か どうか” 小句中的主语后面必须用 “が”，而不能用 “は”。</p>\n</li>\n</ol>\n<p>私は　キムさん<ins class=\"dot\">が</ins>　中国人か　どうか　知りません。        我不知道金女士是不是中国人。<br />\n私は　キムさん<ins class=\"dot\">が</ins>　<ins class=\"dot\">中国人</ins>か　<ins class=\"dot\">中国人では　ない</ins>か　知りません。</p>\n<h3 id=\"疑问词小句-か\"><a class=\"anchor\" href=\"#疑问词小句-か\">#</a> [疑问词小句] + か</h3>\n<p>将包含 “<ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby>　<ruby>誰<rp> (</rp><rt>だれ</rt><rp>)</rp></ruby>　どこ” 等的疑问句，作为一个长句中的一部分使用时，需将疑问词小句的动词、一类形容词的敬体形变成简体形，再加 “か”。<br />\nかぎが　どこに　<ins class=\"dot\">ある</ins>か　教えて　ください。 请告诉我钥匙在哪？   あります + か -&gt; ある + か<br />\n昨日　何を　<ins class=\"dot\">食べた</ins>か　忘れました。  忘记昨天吃什么了。<br />\nどの　料理が　<ins class=\"dot\">辛い</ins>か　知りません。    不知道哪道菜辣。</p>\n<p>与上面的 “～か　どうか” 相同，“か” 前面出现名词或二类形容词时，“～か　どうか” 直接接在名词或二类形容词后，其间不加 “だ”。<br />\nこの　<ruby>歌<rp> (</rp><rt>うた</rt><rp>)</rp></ruby> が　誰の　<ins class=\"dot\"><ruby>歌<rp> (</rp><rt>うた</rt><rp>)</rp></ruby></ins> か　知って　いますか。  你知道这是谁的歌吗？</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>～に　よって<br />\n “根据...”，在句子根据上下文灵活翻译。也可用 “～に　よります” 的形式用于句尾。<br />\n<ruby>結婚式<rp> (</rp><rt>けっこんしき</rt><rp>)</rp></ruby> の　やり方は　<ruby>国<rp> (</rp><rt>くに</rt><rp>)</rp></ruby> に　よって　<ruby>違<rp> (</rp><rt>ちが</rt><rp>)</rp></ruby> います。   结婚典礼的形式因国别而异。</li>\n</ol>\n<p>この　電車は　いつも　<ruby>込<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> みますか。 这电车总是很挤吗？<br />\n—— いえ，時間に　よります。 不，分时间。</p>\n<ol start=\"2\">\n<li>\n<p>高かったり　安かったり，いるいる　あります<br />\n一类形容词、二类形容词以及名词后续 “たり” 时，句尾并不是总要后续 “です”。可根据情况接其他形式。<br />\neg：<ruby>通勤<rp> (</rp><rt>つうきん</rt><rp>)</rp></ruby> は　電車だったり　車だったり，日に　よって　違います。   有时坐电车上班，有时开车上班，不一定。</p>\n</li>\n<li>\n<p>あっ，そうだ<br />\n突然想到某事，或突然想起某事时的表达，“啊，对了”，“啊，想起来了”。</p>\n</li>\n<li>\n<p><ruby>浴衣<rp> (</rp><rt>ゆかた</rt><rp>)</rp></ruby><br />\n 浴衣，日本典型的夏季和服。</p>\n</li>\n</ol>\n<h1 id=\"第二十四课李さんは-もう-すぐ-来くると-思おもいます\"><a class=\"anchor\" href=\"#第二十四课李さんは-もう-すぐ-来くると-思おもいます\">#</a> 第二十四课：李さんは　もう　すぐ　<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp></ruby> ると　<ruby>思<rp> (</rp><rt>おも</rt><rp>)</rp></ruby> います</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"小句简体形と-思います\"><a class=\"anchor\" href=\"#小句简体形と-思います\">#</a> [小句 (简体形)] と　思います</h3>\n<p>表示<mark>说话人的思考内容</mark>时，在句子后面加 “と　思います”，“～と　思います” 前的小句谓语必须是简体形。</p>\n<p>田中さんは　<mark><ruby>来<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> ない</mark>　と思います。   我想田中先生不会来。    (动词)<br />\n 日本は　<mark>きれいだ</mark>　と思います。  我觉得日本很干净。          (形 2)<br />\n 明日は　いい　<mark>天気だ</mark>　と思います。  我觉得明天会是个好天气。 （名词）</p>\n<div class=\"note info\">\n<p>注：一般习惯把小句谓语和と连起来读，即 “天気だと”。</p>\n</div>\n<p>“～と　思います”（思考的根据为现在时）只能表示说话人的思考内容，但 “～と　思いました”（发表感想或曾经认为怎么样）和 “～と　思っています”（思考的根据为过去时）既可以表示说话人的思考内容，也可以表示说话人以外的人的思考内容。</p>\n<p><ruby>馬<rp> (</rp><rt>ば</rt><rp>)</rp></ruby> さんは　日本へ　行きたい　と　思って　います。　　小马想去日本。</p>\n<h3 id=\"名人は-小句简体形と-言いいました\"><a class=\"anchor\" href=\"#名人は-小句简体形と-言いいました\">#</a> [名 (人)] は　[小句 (简体形)] と　<ruby>言<rp> (</rp><rt>い</rt><rp>)</rp></ruby> いました</h3>\n<p>向第三者转述他人所说的话时，在所说的话后加 “～と　<ruby>言<rp> (</rp><rt>い</rt><rp>)</rp></ruby> いました”。<br />\n<ruby>陳<rp> (</rp><rt>ちん</rt><rp>)</rp></ruby> さんは　パーティーに　行く　と　<ruby>言<rp> (</rp><rt>い</rt><rp>)</rp></ruby> いました。  老陈说要去参加联欢会。</p>\n<p>如果想明确指出是向谁说的，则在句子中加入 “名词 + に”。<br />\n小野さんは　李さんに　ちょっと　休みたい　と　<ruby>言<rp> (</rp><rt>い</rt><rp>)</rp></ruby> いました。 小野女士跟小李说想休息一下。</p>\n<p>如果转述某人反复说起的事情时，用 “～と　言って　います”。<br />\n来週の　ハイキングに　<ruby>張<rp> (</rp><rt>ちょう</rt><rp>)</rp></ruby> さんも　行きたい　と　言って　います。  小张说他也想参加下星期的郊游。</p>\n<p>注：“～と　思います” 和 “～と　言いました” 前面出现名词或二类形容词小句时必须加 “だ”。<br />\nあそこは　駅だと　思います。    我想那儿是车站。</p>\n<h3 id=\"~のです-んです\"><a class=\"anchor\" href=\"#~のです-んです\">#</a> ～のです　/ んです</h3>\n<ol>\n<li>～のです　/ んです<br />\n “～のです　/ んです” 表示所讲的内容与前句或前项内容有所关联。用于说明状况或解释原因、理由。“～のです” 多用于书面语，而 “～んです” 是 “～のです” 的口语形式。“～のです　/ んです” 前接简体形，但是名词和二类形容词的现在将来形的肯定形，“だ” 要换成 “な”。</li>\n</ol>\n<p>すみません，頭が　<ruby>痛<rp> (</rp><rt>いた</rt><rp>)</rp></ruby> いんです。       对不起，我头疼。        （形 1）</p>\n<p>パソコンは　<ruby>止<rp> (</rp><rt>や</rt><rp>)</rp></ruby> めた　ほうがいいですよ。     烟还是戒了为好。<br />\n—— そうなんですが，やめる　ことが　できないんです。     是啊，但就是戒不掉。    （动词）</p>\n<p>すごい　人気にんきですね。      他可真受欢迎啊。<br />\n—— ええ，あの　<ruby>歌手<rp> (</rp><rt>かしゅ</rt><rp>)</rp></ruby> は　日本では　とても　<ruby>有名<rp> (</rp><rt>ゆうめいなん</rt><rp>)</rp></ruby> です。     是，那个歌手在日本非常有名。  （名词）</p>\n<ol start=\"2\">\n<li>どうして　～のですか / んですか<br />\n前面学过询问理由的 “どうしてですか”。询问理由更完整的形式是 “どうして　～のですか / んですか”。回答词问句时也要用 “～のです / んです” 的形式。</li>\n</ol>\n<p>どうして　食べないんですか。        为什么不吃？<br />\n—— もう　お<ruby>腹<rp> (</rp><rt>なか</rt><rp>)</rp></ruby> が　いっぱいなんです。  已经吃饱了。</p>\n<h3 id=\"小句が小句-铺垫\"><a class=\"anchor\" href=\"#小句が小句-铺垫\">#</a> [小句] が，[小句]  [铺垫]</h3>\n<p>&quot;が&quot; 用于提示接下来要说的内容，即铺垫。与前面学过的表示铺垫的 “けど” 相比，“が” 多用于书面语。</p>\n<p>李さんを　<ruby>探<rp> (</rp><rt>さが</rt><rp>)</rp></ruby> して　いるんですが，どこに　いますか。  我在找小李，她在哪儿。</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>\n<p>～と　思います<br />\n用于向别人陈述自己的想法。</p>\n</li>\n<li>\n<p>どうやって～ [询问方法]<br />\n“どう” 和动词 “やる” 的て形 “やって” 组成。一般询问方法时用 “どうやって”，而询问理由时则用 “どうして”。</p>\n</li>\n</ol>\n<p>東京タワーへ　行きたいんですが，どうやって　いきますか。    我想去东京塔，请问怎么走？</p>\n<ol start=\"3\">\n<li>\n<p>～に　ついて<br />\n “关于～”，一般后续 “<ruby>考<rp> (</rp><rt>かんが</rt><rp>)</rp></ruby> えます（思考）”“思います（想）”“<ruby>研究<rp> (</rp><rt>けんきゅう</rt><rp>)</rp></ruby>（研究）” 等表示思维活动的词语。用作标题时，如 “日本の　音楽に　やって（关于日本音乐）” 时，一般省略后面的动词。</p>\n</li>\n<li>\n<p>とうとう<br />\n副词，相当于 “终于”“结局”“到底” 等，表示不论结果好坏，想到的事态经过一定的阶段终于实现了。</p>\n</li>\n</ol>\n<p>とうとう お<ruby>別<rp> (</rp><rt>わか</rt><rp>)</rp></ruby> れですね。  终于要分别了。</p>\n<ol start=\"5\">\n<li>分别的寒暄语</li>\n</ol>\n<ul>\n<li>お<ruby>世話<rp> (</rp><rt>せわ</rt><rp>)</rp></ruby> に　なりました ：收到别人的照顾和帮助，分手时所说的表示感谢的话。</li>\n<li>お世話になります　：今后将要得到别人的帮助或指导时使用。</li>\n<li>～に　よろしく　お<ruby>伝<rp> (</rp><rt>つた</rt><rp>)</rp></ruby> え　ください :“请向～问好”，如果双方关系亲密，则直接 “～に　よろしく”。</li>\n<li>お<ruby>元気<rp> (</rp><rt>げんき</rt><rp>)</rp></ruby> で : “请多保重”，一般用于时间较长的分别，意为祝愿对方身体健康，对方必须是健康状况良好的人，“お<ruby>大事<rp> (</rp><rt>だいじ</rt><rp>)</rp></ruby> に（请多保重）” 则只能对生病的人或受伤的人使用。<br />\nお<ruby>気<rp> (</rp><rt>き</rt><rp>)</rp></ruby> をつけて ： “小心”，用于一般性分别，意为祝愿对方路途平安。</li>\n</ul>\n<ol start=\"6\">\n<li><ruby>出張中<rp> (</rp><rt>しゅっちょうちゅう</rt><rp>)</rp></ruby><br />\n 表示某个动作正在进行用 “～<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby>”，一类、二类动词后续 “<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby>” 时，用 “ます形” 去掉 “ます” 的形式。三类动词后续 “<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby>” 用 “ます形” 去掉 “します” 的形式。三类动词 “<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ます” 不能后续 “<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby>”。另外并非所有的一类、二类动词都可以后续 “<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby>”。</li>\n</ol>\n<p>森さんに　何度も　電話を　かけましたが，<ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp></ruby> し<ruby>中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby> でした。  给森先生打了好多次电话，一直占线。</p>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%83)-IP%E6%A0%B8%E4%B9%8BPLL/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%83)-IP%E6%A0%B8%E4%B9%8BPLL/",
            "title": "FPGA学习(七)-IP核之PLL",
            "date_published": "2025-03-24T02:16:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>IP 核即 intellectual property core，知识产权核，是 ASIC 或 FPGA 中预先设计好的电路功能模块，特点是：常用、复杂、可靠性高、提高开发效率。但也有局限性：IP 不能跨平台使用即移植性差、功能可调整空间小、部分需付费。</p>\n<p>Xilinx 的 Vivado 一般自带许多常用的 IP 核，例如 ILA (Integrated Logic Analyzer) 集成逻辑分析器，用于进行在线逻辑分析仪调试。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/7.1.jpg\" title=\"ILA模块图\" style=\"max-width: 70%; height: auto;\"></p>\n<p>如图，一般 ILA 用于监控逻辑内部信号和端口信号，信号流向是 FPGA 到电脑，用于在电脑观测信号；VIO 即 Virtual Input/Outpu 用于实时监控和驱动逻辑内部信号和端口信号，信号流向是电脑到 FPGA，用于电脑发送驱动信号到 FPGA 触发某些信号或动作。</p>\n<p>ILA 属于通过软件实现的逻辑分析仪，需要调用 FPGA 的逻辑资源。添加 ILA 的方法一般是：</p>\n<ul>\n<li>添加 ILA 的 IP 核，并在代码中对其例化，需要调试的信号在哪里，就需要在哪里例化。   ☑</li>\n<li>在原理图、网表文件中 <code>make debug</code>     ☑</li>\n<li>手动在 XDC 约束文件中编写 TCL XDC 调试命令</li>\n</ul>\n<p>对于第二种方法，如果在网表中的信号端口被 Vivado 编译中优化后位宽发生变化了，需要在代码中进行修改如：</p>\n<pre><code>(*make_debug = &quot;true&quot;*) reg [9:0] cnt_2ms\n</code></pre>\n<p>改好代码后重新综合，从而确保正确添加需要调试的信号。</p>\n<h1 id=\"时钟管理\"><a class=\"anchor\" href=\"#时钟管理\">#</a> 时钟管理</h1>\n<p>Xilinx FPGA 的时钟管理 CMT（Clock Management Tiles）：时钟管理单元，可以对时钟进行管理，具有时钟倍频、分频、相位偏移、可编程占空比和优化抖动等功能。<br />\nCMT 由 PLL（Phase Locked Loop，锁相环）和 MMCM（mixed-mode clock，混合模式时钟）组成，PLL 是一种时钟反馈控制电路，其特点是利用外部输入的参考信号控制环路内部震荡信号的频率和相位。MMCM 是在 PLL 基础上加入 DCM（数字时钟管理单元）的一部分以进行精细的相移，即 MMCM 在 PLL 的基础上加上了相位动态调整功能 MMCM 相对 PLL 的优势就是相位可动态调整，但 PLL 占用的面积更小。（即 MMCM 包括了 PLL）<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/7.2.jpg\" title=\"PLL分频原理\" style=\"max-width: 70%; height: auto;\"></p>\n<h1 id=\"实验任务\"><a class=\"anchor\" href=\"#实验任务\">#</a> 实验任务</h1>\n<p>使用开发板输出 4 路不同频率或相位的时钟，时钟分别为 100Mhz，100Mhz（相位偏移 180 度）、50Mhz 和 25Mhz。将四路时钟分别输出至扩展口的端口，并通过示波器来测量输出结果是否正确。</p>\n<h1 id=\"实现思路\"><a class=\"anchor\" href=\"#实现思路\">#</a> 实现思路</h1>\n<div style=\"max-width: 550px; margin: 0 auto;\">\n  <div style=\"position: relative; padding-bottom: 72.73%; height: 0; overflow: hidden;\">\n    <iframe \n      src=\"https://zhimap.com/m/apZgwBLR\" \n      frameborder=\"0\" \n      style=\"position: absolute; top:0; left:0; width:100%; height:100%;\" \n      sandbox=\"allow-scripts allow-same-origin\">\n    </iframe>\n  </div>\n</div>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>ip_clk_wiz.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: ip_clk_wiz</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: ip_clk_wiz.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: PLL 时钟模块，输出四路时钟，验证 IP 核的时钟输出</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.24</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> ip_clk_wiz <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">output</span>          clk_100m<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">output</span>          clk_100m_180deg<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">output</span>          clk_50m<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">output</span>          clk_25m</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">wire</span>        locked<span class=\"token punctuation\">;</span>                       <span class=\"token comment\">// 锁定信号，锁定信号有效时，表示时钟已经稳定</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">wire</span>        rst_n<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">assign</span>      rst_n <span class=\"token operator\">=</span> sys_rst_n <span class=\"token operator\">&amp;</span> locked<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 该信号一般用于其他信号的复位信号，即复位信号与锁定信号同时有效时，复位信号有效</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    clk_wiz_0 <span class=\"token function\">u_clk_wiz_0</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">.</span>clock_out1     <span class=\"token punctuation\">(</span>clk_100m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>           <span class=\"token comment\">// 100MHz 时钟输出</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">.</span>clock_out2     <span class=\"token punctuation\">(</span>clk_100m_180deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 100MHz 时钟输出，180 度相位</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">.</span>clock_out3     <span class=\"token punctuation\">(</span>clk_50m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// 50MHz 时钟输出</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">.</span>clock_out4     <span class=\"token punctuation\">(</span>clk_25m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// 25MHz 时钟输出</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">.</span>reset          <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// 复位信号</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">.</span>locked         <span class=\"token punctuation\">(</span>locked<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// 锁定信号</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">.</span>clk_in1        <span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span>              <span class=\"token comment\">// 输入时钟</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>就是简单的端口定义，以及根据时钟 IP 核模板进行例化，但首先需要在 Vivado 中进行时钟 IP 核的配置。</p>\n<h1 id=\"仿真结果\"><a class=\"anchor\" href=\"#仿真结果\">#</a> 仿真结果</h1>\n<p>由于 IP 核的封闭性，Xilinx 的 IP 核不能直接在 Modelsim 里仿真，因此有两种仿真方式：一是直接使用 Vivado 自带调试器；二是 Vivado 生成仿真库，并进行相关配置，之后在 Vivado 里运行仿真就能跳转到 Modelsim 进行仿真。</p>\n<p>测试代码：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_ip_clk_wiz.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns  <span class=\"token comment\">// Time scale is set to 1ns/1ns</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">tb_ip_clk_wiz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">parameter</span> CLK_PERIOD <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 50MHz</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_clk<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">wire</span>        clk_100m            <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">wire</span>        clk_100m_180deg     <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">wire</span>        clk_50m             <span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">wire</span>        clk_25m             <span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 时钟周期为 20ns</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>ip_clk_wiz u_ip_clk_wiz <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span>                           <span class=\"token punctuation\">,</span>          </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span>                       <span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">.</span>clk_100m               <span class=\"token punctuation\">(</span>clk_100m<span class=\"token punctuation\">)</span>          <span class=\"token punctuation\">,</span>                    </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">.</span>clk_100m_180deg        <span class=\"token punctuation\">(</span>clk_100m_180deg<span class=\"token punctuation\">)</span>   <span class=\"token punctuation\">,</span>               </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">.</span>clk_50m                <span class=\"token punctuation\">(</span>clk_50m<span class=\"token punctuation\">)</span>           <span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">.</span>clk_25m                <span class=\"token punctuation\">(</span>clk_25m<span class=\"token punctuation\">)</span>           </pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure>",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E5%85%AD)-%E5%91%BC%E5%90%B8%E7%81%AF/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E5%85%AD)-%E5%91%BC%E5%90%B8%E7%81%AF/",
            "title": "FPGA学习(六)-呼吸灯",
            "date_published": "2025-03-21T02:33:00.000Z",
            "content_html": "<h1 id=\"目的\"><a class=\"anchor\" href=\"#目的\">#</a> 目的</h1>\n<p>利用脉冲宽度调制 (PWM) 实现呼吸灯效果，使呼吸灯有亮到暗，由暗到亮，每个过程 2s。</p>\n<h1 id=\"实现思路\"><a class=\"anchor\" href=\"#实现思路\">#</a> 实现思路</h1>\n<div style=\"max-width: 550px; margin: 0 auto;\">\n  <div style=\"position: relative; padding-bottom: 72.73%; height: 0; overflow: hidden;\">\n    <iframe \n      src=\"https://zhimap.com/m/NwWIYBFP\" \n      frameborder=\"0\" \n      style=\"position: absolute; top:0; left:0; width:100%; height:100%;\" \n      sandbox=\"allow-scripts allow-same-origin\">\n    </iframe>\n  </div>\n</div>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<div class=\"tab\" data-id=\"id1\" data-title=\"原方法\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>breath_led.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: breath_led</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: breath_led.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 呼吸灯，2s 周期呼吸，1000 份</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.19</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">breath_led</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 系统时钟</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 系统复位（低有效）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>      led          <span class=\"token comment\">// LED PWM 输出</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">parameter</span> CNT_2US_MAX <span class=\"token operator\">=</span> <span class=\"token number\">7'd100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">parameter</span> CNT_2MS_MAX <span class=\"token operator\">=</span> <span class=\"token number\">10'd1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">parameter</span> CNT_2S_MAX <span class=\"token operator\">=</span> <span class=\"token number\">10'd1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt_2us<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt_2ms<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt_2s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">reg</span> inc_dec_flag<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 亮度变化方向：1 为下降（从亮到暗），0 为上升（从暗到亮）</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 计时器计时 2us</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            cnt_2us <span class=\"token operator\">&lt;=</span> <span class=\"token number\">7'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            cnt_2us <span class=\"token operator\">&lt;=</span> <span class=\"token number\">7'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            cnt_2us <span class=\"token operator\">&lt;=</span> cnt_2us <span class=\"token operator\">+</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 计时器计时 2ms</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            cnt_2ms <span class=\"token operator\">&lt;=</span> <span class=\"token number\">10'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2MS_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            cnt_2ms <span class=\"token operator\">&lt;=</span> <span class=\"token number\">10'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            cnt_2ms <span class=\"token operator\">&lt;=</span> cnt_2ms <span class=\"token operator\">+</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">else</span>   </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            cnt_2ms <span class=\"token operator\">&lt;=</span> cnt_2ms<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// 计时器计时 2s</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            cnt_2s <span class=\"token operator\">&lt;=</span> <span class=\"token number\">10'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2MS_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2s <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2S_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            cnt_2s <span class=\"token operator\">&lt;=</span> <span class=\"token number\">10'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2MS_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            cnt_2s <span class=\"token operator\">&lt;=</span> cnt_2s <span class=\"token operator\">+</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            cnt_2s <span class=\"token operator\">&lt;=</span> cnt_2s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\">// 亮度递增递减标志</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            inc_dec_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt_2us <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2US_MAX <span class=\"token operator\">-</span> <span class=\"token number\">7'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2MS_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2s <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>CNT_2S_MAX <span class=\"token operator\">-</span> <span class=\"token number\">10'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            inc_dec_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>inc_dec_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">else</span>    </pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            inc_dec_flag <span class=\"token operator\">&lt;=</span> inc_dec_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token comment\">// 控制 LED PWM 输出</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inc_dec_flag <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">&lt;=</span> cnt_2s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inc_dec_flag <span class=\"token operator\">==</span> <span class=\"token number\">1'b1</span> <span class=\"token operator\">&amp;&amp;</span> cnt_2ms <span class=\"token operator\">>=</span> cnt_2s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id1\" data-title=\"份数可调的方法\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: breath_led_param</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: breath_led_param.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 呼吸灯，带参数化的呼吸周期和分辨率</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.19</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> breath_led_param #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">parameter</span> BREATH_TIME_S  <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>          <span class=\"token comment\">// 呼吸周期，单位：秒</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">parameter</span> SUBDIV_COUNT   <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">//s、ms、us 之间的分割份数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">parameter</span> CLK_FREQ       <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span>   <span class=\"token comment\">// 时钟频率：50 MHz</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_clk<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 系统时钟</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_rst_n<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 系统复位（低有效）</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  led           <span class=\"token comment\">// LED PWM 输出</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 总时钟周期数 = BREATH_TIME_S * CLK 频率</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> TOTAL_CYCLES <span class=\"token operator\">=</span> BREATH_TIME_S <span class=\"token operator\">*</span> CLK_FREQ<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 每一细分步所需的时钟周期数</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> BASE_MAX <span class=\"token operator\">=</span> TOTAL_CYCLES <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>SUBDIV_COUNT <span class=\"token operator\">*</span> SUBDIV_COUNT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 保证 BASE_MAX 不低于 1（最低 20ns 计数器由时钟保证）</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> BASE_WIDTH   <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>BASE_MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> SUBDIV_WIDTH <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>SUBDIV_COUNT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// 细分计数器：每个细分步长 BASE_MAX 个时钟周期</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>BASE_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> base_cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 中间计数器：范围 0 ~ SUBDIV_COUNT-1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>SUBDIV_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> mid_cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// 粗计数器：范围 0 ~ SUBDIV_COUNT-1，用于 PWM 调制比较</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>SUBDIV_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> top_cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 亮度变化方向标志：0 表示上升，1 表示下降</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">reg</span> inc_dec_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">// 细分计数器，每个时钟周期递增</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            base_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>base_cnt <span class=\"token operator\">==</span> BASE_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            base_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            base_cnt <span class=\"token operator\">&lt;=</span> base_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// 中间计数器：当细分计数器溢出时递增</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            mid_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>base_cnt <span class=\"token operator\">==</span> BASE_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mid_cnt <span class=\"token operator\">==</span> SUBDIV_COUNT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                mid_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                mid_cnt <span class=\"token operator\">&lt;=</span> mid_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token comment\">// 粗计数器：当中间计数器溢出时递增</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            top_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>base_cnt <span class=\"token operator\">==</span> BASE_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>mid_cnt <span class=\"token operator\">==</span> SUBDIV_COUNT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>top_cnt <span class=\"token operator\">==</span> SUBDIV_COUNT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                top_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                top_cnt <span class=\"token operator\">&lt;=</span> top_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token comment\">// 亮度变化方向：当粗计数器满值时翻转方向</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            inc_dec_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>base_cnt <span class=\"token operator\">==</span> BASE_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>mid_cnt <span class=\"token operator\">==</span> SUBDIV_COUNT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>top_cnt <span class=\"token operator\">==</span> SUBDIV_COUNT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            inc_dec_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>inc_dec_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token comment\">// LED PWM 输出逻辑：</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token comment\">// 当处于上升阶段（inc_dec_flag == 0）时，若中间计数器小于粗计数器则点亮 LED，</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token comment\">// 否则熄灭；下降阶段则比较 (SUBDIV_COUNT - top_cnt)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inc_dec_flag <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span> <span class=\"token operator\">&amp;&amp;</span> mid_cnt <span class=\"token operator\">&lt;=</span> top_cnt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inc_dec_flag <span class=\"token operator\">==</span> <span class=\"token number\">1'b1</span> <span class=\"token operator\">&amp;&amp;</span> mid_cnt <span class=\"token operator\">>=</span> top_cnt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"91\"></td><td><pre></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<p><strong>对于原方法</strong>，实现思路为：</p>\n<ol>\n<li>\n<p><strong>分层计数器设计与级联</strong></p>\n<ul>\n<li>\n<p><strong>计数器 cnt_2us（2μs 级别）</strong></p>\n<ul>\n<li>每当系统时钟上升沿到来时，cnt_2us 递增，直到达到预设的上限（CNT_2US_MAX - 1）后清零。</li>\n<li>这一计数器负责产生基本的 2μs 时间单位。</li>\n</ul>\n</li>\n<li>\n<p><strong>计数器 cnt_2ms（2ms 级别）</strong></p>\n<ul>\n<li>当 cnt_2us 计数到达上限时（即完成一个 2μs 周期），cnt_2ms 递增；</li>\n<li>若 cnt_2ms 也达到预设上限（CNT_2MS_MAX - 1），则清零。</li>\n<li>cnt_2ms 相当于累积多个 2μs 的周期。</li>\n</ul>\n</li>\n<li>\n<p><strong>计数器 cnt_2s（2s 级别）</strong></p>\n<ul>\n<li>同理，在 cnt_2us 和 cnt_2ms 均溢出时，cnt_2s 递增；</li>\n<li>当 cnt_2s 达到预设上限（CNT_2S_MAX - 1）时，清零。</li>\n<li>cnt_2s 相当于累积多个 2ms 的周期。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>呼吸效果实现 —— 亮度调节逻辑</strong></p>\n<ul>\n<li><strong>亮度递增 / 递减标志（inc_dec_flag）</strong>\n<ul>\n<li>每当所有三个计数器同时溢出（完成一个完整的 2s 周期）时，inc_dec_flag 取反。</li>\n<li>当 inc_dec_flag 为 0 时，表示 LED 亮度处于上升阶段（从暗到亮）；为 1 时表示下降阶段（从亮到暗）。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>PWM 输出实现</strong></p>\n<ul>\n<li>LED 的 PWM 控制采用 cnt_2ms 与 cnt_2s 的比较：\n<ul>\n<li><strong>上升阶段（inc_dec_flag==0）：</strong>\n<ul>\n<li>当 cnt_2ms 小于或等于 cnt_2s 时，LED 输出高电平；否则 LED 低电平。</li>\n<li>这样 cnt_2s 的数值越大，LED 点亮的时长越长，亮度越高。</li>\n</ul>\n</li>\n<li><strong>下降阶段（inc_dec_flag==1）：</strong>\n<ul>\n<li>当 cnt_2ms 大于或等于 cnt_2s 时，LED 输出高电平；否则 LED 低电平。</li>\n<li>随着 cnt_2s 逐渐增大，LED 点亮时长缩短，亮度逐步降低。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>整体效果</strong></p>\n<ul>\n<li>利用多级计数器构成了一个从微秒到秒级的分辨率体系，生成 PWM 波形；</li>\n<li>通过周期性地翻转亮度变化方向（inc_dec_flag），实现 LED 从暗到亮再到暗的平滑呼吸效果。</li>\n</ul>\n</li>\n</ol>\n<p>实现的效果将是：每个 cnt_2s 内，会有一个 LED PWM 波形，以由暗到亮时为例，此时该波形的高电平个数递增，单个高电平的持续时间为一个 cnt_2us 完整周期的时间。cnt_2ms 的作用是决定高电平的个数，已知每个 cnt_2s 包含着一个完整的 cnt_2ms 从 0 到 CNT_2MS_MAX - 1 的周期，当 cnt_2s 为 0 时，满足 cnt_2ms&lt;=cnt_2s 的条件只有 cnt_2ms 为 0 时，即此时为高电平，而又因为每个 cnt_2ms 包含着一个完整的 cnt_2us 从 0 到 CNT_2US_MAX - 1 的周期，所以该高电平持续时间为一个 cnt_2us 完整周期的时间。之后随着 cnt_2s 的递增，满足 cnt_2ms&lt;=cnt_2s 的情况递增，即高电平个数递增。 直到最后完整一个 cnt_2s 周期时标志翻转，开始由亮到暗。</p>\n<p><strong>对于第二个方法</strong>，即份数可调，不再局限于 1000，虽然第一个代码也可调整，但需要手动计算最底层计数器的计数阈值（如果分 500 份，最底层计数时间为：2s/500/500，需要计算此时的计数最大值及位宽）。第二个方法设置呼吸周期和份数的参数，具体计数器和位宽用如下代码确定：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 总时钟周期数 = BREATH_TIME_S * CLK 频率</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> TOTAL_CYCLES <span class=\"token operator\">=</span> BREATH_TIME_S <span class=\"token operator\">*</span> CLK_FREQ<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 每一细分步所需的时钟周期数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> BASE_MAX <span class=\"token operator\">=</span> TOTAL_CYCLES <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>SUBDIV_COUNT <span class=\"token operator\">*</span> SUBDIV_COUNT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 保证 BASE_MAX 不低于 1（最低 20ns 计数器由时钟保证）</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> BASE_WIDTH   <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>BASE_MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> SUBDIV_WIDTH <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>SUBDIV_COUNT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 细分计数器：每个细分步长 BASE_MAX 个时钟周期</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>BASE_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> base_cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 中间计数器：范围 0 ~ SUBDIV_COUNT-1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>SUBDIV_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> mid_cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 粗计数器：范围 0 ~ SUBDIV_COUNT-1，用于 PWM 调制比较</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>SUBDIV_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> top_cnt<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>但实现的效果是相同的。</p>\n<h1 id=\"仿真结果\"><a class=\"anchor\" href=\"#仿真结果\">#</a> 仿真结果</h1>\n<p>测试代码：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_breath_led.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns  <span class=\"token comment\">// Time scale is set to 1ns/1ns</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">tb_breath_led</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">parameter</span> CLK_PERIOD <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 50MHz</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_clk<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">wire</span>        led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 时钟周期为 20ns</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">parameter</span> CNT_2US_MAX <span class=\"token operator\">=</span> <span class=\"token number\">7'd10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">parameter</span> CNT_2MS_MAX <span class=\"token operator\">=</span> <span class=\"token number\">10'd100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">parameter</span> CNT_2S_MAX <span class=\"token operator\">=</span> <span class=\"token number\">10'd100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>breath_led #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">CNT_2US_MAX</span><span class=\"token punctuation\">(</span>CNT_2US_MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">CNT_2MS_MAX</span><span class=\"token punctuation\">(</span>CNT_2MS_MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">CNT_2S_MAX</span><span class=\"token punctuation\">(</span>CNT_2S_MAX<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">)</span> u_breath_led <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">led</span><span class=\"token punctuation\">(</span>led<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//parameter BREATH_TIME_S  = 0.00015;         // 呼吸周期，单位：秒</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">//parameter SUBDIV_COUNT   = 50;       //s、ms、us 之间的分割份数</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">// breath_led_param #(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//     .BREATH_TIME_S(BREATH_TIME_S),</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//     .SUBDIV_COUNT(SUBDIV_COUNT)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">// ) u_breath_led (</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">//     .sys_clk(sys_clk),</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//     .sys_rst_n(sys_rst_n),</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">//     .led(led)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">// );</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>仿真结果如图：</p>\n<ol>\n<li>\n<p>完整的 cnt_2us 周期为 20ns*10=200ns，完整的 cnt_2ms 周期为 200ns*100=20000ns，完整的 cnt_2s 周期为 200000ns*100=2000000ns。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/6.1.jpg\" title=\"呼吸灯仿真（一）\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n<li>\n<p>BREATH_TIME_S 为 0.00015s，SUBDIV_COUNT 为 50，即完整的 top_cnt 周期为 0.00015s=150000ns，完整的 mid_cnt 周期为 150000ns/50=3000ns，完整的 base_cnt 周期为 3000ns/50=60ns。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/6.2.jpg\" title=\"呼吸灯仿真（二）\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC5%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC5%E5%8D%95%E5%85%83/",
            "title": "单元五——小李在日本迎新春",
            "date_published": "2025-03-20T09:13:00.000Z",
            "content_html": "<h1 id=\"第十七课わたしは-新あたらしい-洋服ようふくが-欲ほしいです\"><a class=\"anchor\" href=\"#第十七课わたしは-新あたらしい-洋服ようふくが-欲ほしいです\">#</a> 第十七课：わたしは　<ruby>新<rp> (</rp><rt>あたら</rt><rp>)</rp></ruby> しい　<ruby>洋服<rp> (</rp><rt>ようふく</rt><rp>)</rp></ruby> が　<ruby>欲<rp> (</rp><rt>ほ</rt><rp>)</rp></ruby> しいです</h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"名が-欲しいです\"><a class=\"anchor\" href=\"#名が-欲しいです\">#</a> [名] が　欲しいです</h3>\n<p>表示愿望时使用。<br />\neg：わたしは　<ruby>新<rp> (</rp><rt>あたら</rt><rp>)</rp></ruby> しい　<ruby>洋服<rp> (</rp><rt>ようふく</rt><rp>)</rp></ruby> が　<ruby>欲<rp> (</rp><rt>ほ</rt><rp>)</rp></ruby> しいです。　我想有套新西服。</p>\n<h3 id=\"名を-动たいです\"><a class=\"anchor\" href=\"#名を-动たいです\">#</a> [名] を　[动] たいです</h3>\n<p>表示 “想～”，“名 1 は　名 2 を　～たいです”。名词 1 为愿望的主体，名词 2 表示希望进行动作的对象。<mark>“たい” 前接动词 “ます形” 去掉 “ます” 的形式。</mark><br />\n使用 “欲しいです” 或 “～たいです” 时，如果是<mark>陈述句</mark>，则第一人称 “わたし” 为主语。如果句子是<mark>疑问句</mark>，则第二人称 “あなた” 是主语，这两种情况的主语通常可以从句子前后关系判断出来，常省略。  注：不能用在第三人称上。<br />\neg: 今日は　お酒を　飲みたく　ないです。     今天不想喝酒。</p>\n<p>注意： 如 “わたしは　お茶が　飲みたいです” 所示，“たい” 的对象有时不用 “を”，而用 “が” 表示，但 “欲しい” 的对象只能用 “が” 表示。<br />\n水を　飲みたいです。<br />\n水が　飲みたいです。<br />\n水が　欲しいです。</p>\n<ol>\n<li>全面否定 “名词 + を + 动词” 时，使用：“疑问词 + も + 动词否定形式”。</li>\n<li>全面否定 “名词 + に / から / と + 动词” 时，使用：“疑问词 + にも / からも / とも + 动词否定形式”。</li>\n<li>全面否定 “名词 + へ + 动词” 时，既可以使用 “疑问词 + も + 动词否定形式”，也可以使用 “疑问词 + へも + 动词否定形式”。</li>\n</ol>\n<p>eg: 誰に　会いたいですか。   —— 誰にも　会いたくないです。   你想见谁？ 谁也不想见。</p>\n<h3 id=\"动ませんか\"><a class=\"anchor\" href=\"#动ませんか\">#</a> [动] ませんか</h3>\n<p>动词的否定形式 “~ ませんか”，表示一种提议。“做某事怎么样”。</p>\n<h3 id=\"动ましょう\"><a class=\"anchor\" href=\"#动ましょう\">#</a> [动] ましょう</h3>\n<p>把动词 “ます形” 去掉 “ます” 换成 “ましょう”，可表示提议。<br />\neg: ちょっと　休みましょう。　休息一下吧。</p>\n<div class=\"note info\">\n<p>“ましょう” 的礼貌程度没有 “ませんか” 高。</p>\n</div>\n<h3 id=\"疑问词でも\"><a class=\"anchor\" href=\"#疑问词でも\">#</a> 疑问词 + でも</h3>\n<p>表示在任何情况下事态都相同时使用。<br />\neg:<br />\n 誰も　<ruby>分<rp> (</rp><rt>わ</rt><rp>)</rp></ruby> かります。  　谁都明白。<br />\n誰も　<ruby>分<rp> (</rp><rt>わ</rt><rp>)</rp></ruby> かりません。   谁都不明白。</p>\n<p>注：いつも表示 “常常，经常” 的意思，而いつでも表示 “不论任何时候”。<br />\nいつでも　行きます。　随时去或有必要的话任何时候都去。<br />\nいつも　行きます。  经常去。</p>\n<h3 id=\"ね\"><a class=\"anchor\" href=\"#ね\">#</a> ね</h3>\n<p>缓和语气。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>“欲しいです” 和 “飲みませんか” 愿望、希望和邀请<br />\n “何が　欲しいですか”“何を　食べたいですか” 等直接询问他人的愿望，可用于朋友，上级对下级之间，但如果对方是上级、长辈，应使用 “どうですか”“～ませんか” 等。</li>\n</ol>\n<p>另外，别人邀请自己参加某一活动时，可用 “<sub>ましょう” 回答，“</sub>ましょう” 有一起、共同做某事的含义，既可以用于提议，也可以用于对别人提议的回答。</p>\n<ol start=\"2\">\n<li><ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby><ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby> に<br />\n “~<ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby> に” 表示该期间结束之前的意思，一般接在表示未来某一特定时间的词后，如 “今日”“明日”“<ruby>今週<rp> (</rp><rt>こんしゅう</rt><rp>)</rp></ruby>”“<ruby>来週<rp> (</rp><rt>らいしゅう</rt><rp>)</rp></ruby>”“<ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby>” 等后面。“今日”“明日”“<ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby>” 后续 “~<ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby> に” 时，读 “じゅうに”，“~<ruby> 週<rp> (</rp><rt>しゅう</rt><rp>)</rp></ruby>”“~<ruby> 月<rp> (</rp><rt>がつ / げつ</rt><rp>)</rp></ruby>” 后续 “~<ruby> 中<rp> (</rp><rt>ちゅう</rt><rp>)</rp></ruby> に” 时，读 “ちゅうに”。</li>\n</ol>\n<p>eg: <ruby>今年<rp> (</rp><rt>ことし</rt><rp>)</rp></ruby><ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby> に 結婚したいです。    我想今年结婚。</p>\n<ol start=\"3\">\n<li>ぜひ<br />\n “一定，必定”，后接 “~ たい”“~ てください”“~ ましょう” 等，表达强烈愿望、意志。</li>\n</ol>\n<h1 id=\"第十八课携帯電話けいたいでんわは-とても-小ちいさく-なりました\"><a class=\"anchor\" href=\"#第十八课携帯電話けいたいでんわは-とても-小ちいさく-なりました\">#</a> 第十八课：<ruby>携帯電話<rp> (</rp><rt>けいたいでんわ</rt><rp>)</rp></ruby> は　とても　<ruby>小<rp> (</rp><rt>ちい</rt><rp>)</rp></ruby> さく　なりました</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"形1-なります\"><a class=\"anchor\" href=\"#形1-なります\">#</a> [形 1] なります</h3>\n<p>表示性质或状态的变化，构成方式是：形 1 的词尾 “い” 变成 “く” 再加 “なります”。<br />\n<mark>“自然地变化”</mark></p>\n<p>eg: パソコンは　<ruby>安<rp> (</rp><rt>やす</rt><rp>)</rp></ruby> く　なりました。   个人电脑便宜了。</p>\n<h3 id=\"形1-します\"><a class=\"anchor\" href=\"#形1-します\">#</a> [形 1] します</h3>\n<p>表示因主语的意志性动作、作用而引起事物发生变化的场合。构成方式是：形 1 的词尾 “い” 变成 “く” 再加 “します”。<br />\n<mark>“人为地变化”</mark></p>\n<p>eg: ジュースを　<ruby>冷<rp> (</rp><rt>つめ</rt><rp>)</rp></ruby> たく　します。     把果汁冰镇一下。</p>\n<h3 id=\"形2名に-なります\"><a class=\"anchor\" href=\"#形2名に-なります\">#</a> [形 2]/[名] に　なります</h3>\n<p>同语法一，同样表示性质或状态的变化，构成形式：直接在形 2 和名词后加 “になります”。<br />\n<mark>“自然地变化”</mark></p>\n<p>eg:<br />\n<ruby> 息子<rp> (</rp><rt>むすこ</rt><rp>)</rp></ruby> は　<ruby>医者<rp> (</rp><rt>いしゃ</rt><rp>)</rp></ruby> に　なりました。  儿子当医生了。<br />\nもう　元気に　なりました。      已经恢复健康了。</p>\n<h3 id=\"形2名に-します\"><a class=\"anchor\" href=\"#形2名に-します\">#</a> [形 2]/[名] に　します</h3>\n<p>同语法二，同样表示因主语的意志性的动作、作用等引起事物发生变化。<br />\n<mark>“人为地改变”</mark></p>\n<p>eg:<br />\n 部屋を　<ruby>綺麗<rp> (</rp><rt>きれい</rt><rp>)</rp></ruby> に　して　ください。       请把房间打扫干净。<br />\n<ruby>会議室<rp> (</rp><rt>かいぎしつ</rt><rp>)</rp></ruby>　禁煙きんえんに　します。   会议室里禁烟。</p>\n<p>注：在餐馆里回答服务员的点餐询问时，可以使用 “~ に　します” 这一形式。表示把自己决定的事情告诉对方。“コーヒーに　します（我要咖啡。）”</p>\n<h3 id=\"形1形2-ほうが-いいです\"><a class=\"anchor\" href=\"#形1形2-ほうが-いいです\">#</a> [形 1]/[形 2] ほうが　いいです</h3>\n<p>比较两个以上事物的性质，认为其中一个比较好。  <ins class=\"dot\">形 2 要多加一个 “な”</ins>。<br />\neg:<br />\n 部屋は　広い　ほうが いいです。         房间还是宽敞一点好。<br />\n子供は　元気な　ほうが　いいです。      孩子还是精神一点好。</p>\n<h3 id=\"自动词和他动词\"><a class=\"anchor\" href=\"#自动词和他动词\">#</a> 自动词和他动词</h3>\n<ol>\n<li>自动词：现象、状态  是谁做的？（和我没关系）<br />\n不带宾语的动词，不考虑外力影响的情况下，主语自主地进行动作，或自然地发生变化。主语用 “が” 表示。</li>\n</ol>\n<p><ruby>窓<rp> (</rp><rt>まど</rt><rp>)</rp></ruby> が <ruby>開<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> きました。   窗子开了。<br />\nタイムサービスが　始はじまります。  时段廉价销售就要开始了。</p>\n<ol start=\"2\">\n<li>他动词：动作、行为  强调是谁做的<br />\n主语作用于宾语使其发生变化，宾语用 “を” 表示<br />\n (李さんが)  <ruby>窓<rp> (</rp><rt>まど</rt><rp>)</rp></ruby> を <ruby>開<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> けました。   (小李) 打开窗户了。<br />\n(デパートが)　タイムサービスを　始はじめます。  百货公司开始时段廉价销售。</li>\n</ol>\n<div class=\"note info\">\n<p>日语的一部分自、他动词在词形上有对应关系，即需要多记单词，作为自动词和他动词时单词形式可能不同。</p>\n</div>\n<div class=\"note info\">\n<p>本课中 “~ なります” 为自动词，“~ します” 为他动词。</p>\n</div>\n<p>注：特殊情况：当自动词表示移动行为时，移动的 “经过点” 和 “起点” 用助词 “を” 表示，这里的 “を” 不表示宾语。<br />\neg:<br />\n 公園を　散歩する。  （移动性自动词）<br />\n<ruby>学校<rp> (</rp><rt>がっこう</rt><rp>)</rp></ruby> を　<ruby>卒業<rp> (</rp><rt>そつぎょう</rt><rp>)</rp></ruby> する。  （离开的场所）<br />\nパレーを　<ruby>踊<rp> (</rp><rt>おど</rt><rp>)</rp> る<rt></rt></ruby>。   （解释一：同族目的语，可用を，因为芭蕾是舞蹈，<ruby>踊<rp> (</rp><rt>おど</rt><rp>)</rp> る<rt></rt></ruby>是跳舞，所以用を ——“踊りを　踊る”；解释二：古日语里踊る为移动性动词）</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>声<rp> (</rp><rt>こえ</rt><rp>)</rp></ruby>　和 <ruby>音<rp> (</rp><rt>おと</rt><rp>)</rp></ruby><br />\n 人和动物发出的声音为<ruby>声<rp> (</rp><rt>こえ</rt><rp>)</rp></ruby>；物体发出的声音为<ruby>音<rp> (</rp><rt>おと</rt><rp>)</rp></ruby>。类似英语中 voice 和 sound。</p>\n</li>\n<li>\n<p>まとめて<br />\n “汇总”。<br />\neg:<ruby> お<rt></rt>正月<rp> (</rp><rt>しょうがつ</rt><rp>)</rp></ruby> は　洋服が　<ruby>安<rp> (</rp><rt>やす</rt><rp>)</rp></ruby> く　なりますから，まとめて　買います。     过年时，西式服装降价，所以我一下子买很多。</p>\n</li>\n<li>\n<p><ruby>三割引<rp> (</rp><rt>さんわりびき</rt><rp>)</rp></ruby><br />\n 表示 “七折” 的意思，即降价三成。<br />\n“八五折” 即 “<ruby>15<rp>(</rp><rt>じゅうご</rt><rp>)</rp></ruby><ruby>％<rp>(</rp><rt>パーセント</rt><rp>)</rp></ruby>　<ruby>引<rp> (</rp><rt>びき</rt><rp>)</rp></ruby>”。</p>\n</li>\n<li>\n<p><ruby>似合<rp> (</rp><rt>にあ</rt><rp>)</rp></ruby> います<br />\n “<ruby>似合<rp> (</rp><rt>にあ</rt><rp>)</rp></ruby> います” 为自动词，表示 “相称”“适合”。<br />\neg: 赤い　ほうが　いいですね。よく　<ruby>似合<rp> (</rp><rt>にあ</rt><rp>)</rp></ruby> いますよ。      红的好吧，很适合你。</p>\n</li>\n<li>\n<p>“<ruby>間<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> もなく”　和 “もう　よぐ”<br />\n 两者都是副词，表示 &quot;一会儿&quot;&quot; 不久 &quot;，但 “<ruby>間<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> もなく” 更郑重些，用于书面语，而 “もう　よぐ” 多用于口语。<br />\neg:<br />\n<ruby> 間<rp> (</rp><rt>ま</rt><rp>)</rp></ruby> もなく　タイムサービスの　時間です。 时段廉价销售时间马上就要到了。<br />\nもうよぐ　六時に　なります。       马上就到六点了。</p>\n</li>\n<li>\n<p>“さらに”　和 “もっと”<br />\n 都表示 “更加” 的意思，但 “さらに” 更郑重些，而 “もっと” 较随便。</p>\n</li>\n<li>\n<p>さあ<br />\n用于向对方提出建议或促使对方做某事，只用于口语。<br />\neg：さあ，今から　<ruby>試験<rp> (</rp><rt>しけん</rt><rp>)</rp></ruby> を　始めますよ。<ruby>準備<rp> (</rp><rt>じゅんび</rt><rp>)</rp></ruby> は　いいですか。   好了，现在开始考试，准备好了吗？</p>\n</li>\n</ol>\n<h1 id=\"第十九课部屋の-かぎを-忘れないで-ください\"><a class=\"anchor\" href=\"#第十九课部屋の-かぎを-忘れないで-ください\">#</a> 第十九课：部屋の　かぎを　忘れないで　ください</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"动词的ない形\"><a class=\"anchor\" href=\"#动词的ない形\">#</a> 动词的ない形</h3>\n<ol>\n<li>动 1：把ます形去掉ます后的最后一个音变成相应的あ段音，再加ない。如果最后音为い时，则い变わ加ない。<br />\n（或者，对于动词原型，结尾う段变あ段加ない即可，但对于う结尾，う变わ，再加ない）</li>\n<li>动 2：把ます形去掉再加ない。（或者，对于动词原型，る变ない）</li>\n<li>动 3：把 “<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ます” 变成 “<ruby>来<rp> (</rp><rt>こ</rt><rp>)</rp></ruby> ない”，把 “します” 变成 “しない”。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>一类动词</td>\n<td>書く → <ruby>書<rp> (</rp><rt>か</rt><rp>)</rp> きます<rt></rt></ruby> → <ruby>かき<rt></rt></ruby> → <ruby>かかない<rt></rt></ruby> <br> 急ぐ → <ruby>急<rp> (</rp><rt>いそ</rt><rp>)</rp> ぎます<rt></rt></ruby> → <ruby>いそぎ<rt></rt></ruby> → <ruby>いそがない<rt></rt></ruby> <br> 飛ぶ　→　<ruby>飛<rp> (</rp><rt>と</rt><rp>)</rp> びます<rt></rt></ruby> → <ruby>とび<rt></rt></ruby> → <ruby>とばない<rt></rt></ruby> <br> 読む　→　<ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp> みます<rt></rt></ruby> → <ruby>よみ<rt></rt></ruby> → <ruby>よまない<rt></rt></ruby> <br> 死ぬ　→　<ruby>死<rp> (</rp><rt>し</rt><rp>)</rp> にます<rt></rt></ruby> → <ruby>しに<rt></rt></ruby> → <ruby>しなない<rt></rt></ruby> <br> 待つ　→　<ruby>待<rp> (</rp><rt>ま</rt><rp>)</rp> ちます<rt></rt></ruby> → <ruby>まち<rt></rt></ruby> → <ruby>またない<rt></rt></ruby> <br> 売る　→　<ruby>売<rp> (</rp><rt>う</rt><rp>)</rp> ります<rt></rt></ruby> → <ruby>うり<rt></rt></ruby> → <ruby>うらない<rt></rt></ruby> <br> 買う　→　<ruby>買<rp> (</rp><rt>か</rt><rp>)</rp> います<rt></rt></ruby> → <ruby>かい<rt></rt></ruby> → <ruby>かわない<rt></rt></ruby> <br> 話す　→　<ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp> します<rt></rt></ruby> → <ruby>はなし<rt></rt></ruby> → はなさない</td>\n</tr>\n<tr>\n<td>二类动词</td>\n<td>食べる　→　<ruby>食<rp> (</rp><rt>た</rt><rp>)</rp> べます<rt></rt></ruby> → <ruby>たべ<rt></rt></ruby> → <ruby>たべない<rt></rt></ruby> <br> 見る　→　<ruby>見<rp> (</rp><rt>み</rt><rp>)</rp> ます<rt></rt></ruby> → <ruby>み<rt></rt></ruby> → <ruby>みない<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>三类动词</td>\n<td>来る　→　<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp> ます<rt></rt></ruby> → <ruby>き<rt></rt></ruby> → <ruby>こない<rt></rt></ruby> <br> する　→　<ruby>します<rt></rt></ruby> → <ruby>し<rt></rt></ruby> → <ruby>しない<rt></rt></ruby></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"动ないで-ください\"><a class=\"anchor\" href=\"#动ないで-ください\">#</a> [动] ないで　ください</h3>\n<p>表示否定的命令。即 “动词未然形 + ないで　ください” 或者 “动词ない形 + でください”。<mark>动词未然形是ない形去掉ない的形式。</mark><br />\neg：<ruby>無理<rp> (</rp><rt>むり</rt><rp>)</rp></ruby> を　しないで　ください。 请不要勉强。</p>\n<h3 id=\"动なければ-なりません\"><a class=\"anchor\" href=\"#动なければ-なりません\">#</a> [动] なければ　なりません</h3>\n<p>表示必须，“未然形 + なければ　なりません” 或者 “未然形 + ないと　いけません”。<br />\neg: すぐに　<ruby>書類<rp> (</rp><rt>しょるい</rt><rp>)</rp></ruby> を　<ruby>送<rp> (</rp><rt>おく</rt><rp>)</rp></ruby> ら　ないと　いけません。    得马上把文件寄出去。<br />\nこの　<ruby>薬<rp> (</rp><rt>くすり</rt><rp>)</rp></ruby> は　毎日　飲まなければ　なりません。       这个药必须每天吃。</p>\n<h3 id=\"动なくても-いいです\"><a class=\"anchor\" href=\"#动なくても-いいです\">#</a> [动] なくても　いいです</h3>\n<p>表示不做某事也可以。“未然形 + なくても　いいです”。<br />\neg: <ruby>慌<rp> (</rp><rt>あわ</rt><rp>)</rp></ruby> て　なくても　いいですよ。　 不要慌慌张张的。</p>\n<h3 id=\"名1が-名2です\"><a class=\"anchor\" href=\"#名1が-名2です\">#</a> [名 1] が　[名 2] です</h3>\n<p>区别：<br />\n旧信息 は　新信息 です<br />\n新信息 が　旧信息 です</p>\n<p>其中旧信息指的是话题的对象。</p>\n<p><ruby>山田<rp> (</rp><rt>やまだ</rt><rp>)</rp></ruby> 先生は　どの　<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby> ですか。<br />\n—— <ruby>山田<rp> (</rp><rt>やまだ</rt><rp>)</rp></ruby> 先生は あの<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>　です。<br />\n—— あの　<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby> が　<ruby>山田<rp> (</rp><rt>やまだ</rt><rp>)</rp></ruby> 先生です。<br />\n问题提到了话题即 “<ruby>山田<rp> (</rp><rt>やまだ</rt><rp>)</rp></ruby> 先生”，故 “<ruby>山田<rp> (</rp><rt>やまだ</rt><rp>)</rp></ruby> 先生” 为旧信息。</p>\n<p>注：叙述直接观察到的某事物，而不是作为话题谈论该事物时，使用 “[名词] が　[动词]” 的形式。因为这里同样是新信息作主语。<br />\neg：子供が　公園で　<ruby>遊<rp> (</rp><rt>あそ</rt><rp>)</rp></ruby> んで　います。     孩子在公园里玩。<br />\nパスが　<ruby>来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ました。     公共汽车来了。</p>\n<p>注：“<ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby>　<ruby>誰<rp> (</rp><rt>だれ</rt><rp>)</rp></ruby>　どこ　いつ” 等表示疑问的词作主语时不能用 “は”，只能用 “が”，因为这些词不能表示旧信息。<br />\neg: 何が　好きですか。  喜欢什么？</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>\n<p>&quot;~ なければ　なりません&quot; 和 &quot;~ ないと　いけません&quot;<br />\n两者都表示义务、必要性，但&quot;~ なければ　なりません &quot;更正式，用于书面语，&quot;~ ないと　いけません &quot;多用于口语，并且可以省略为 “&quot;~ ないと”<br />\neg: あっ，８時ですね。もう　駅へ　行かないと。  啊，8 点了，我得去车站了。  （っ（ltu））</p>\n</li>\n<li>\n<p><ruby>初心者<rp> (</rp><rt>しょしんしゃ</rt><rp>)</rp></ruby>　<ruby>上級者<rp> (</rp><rt>じょうきゅうしゃ</rt><rp>)</rp></ruby><br />\n<ruby> 初心者<rp> (</rp><rt>しょしんしゃ</rt><rp>)</rp></ruby> 表示 “初学者”。在日语中，表示技能等级为高级时，使用 “<ruby>上級<rp> (</rp><rt>じょうきゅう</rt><rp>)</rp></ruby>”，而 “<ruby>高級<rp> (</rp><rt>こうきゅう</rt><rp>)</rp></ruby>” 不用于描述人的技能、技术等，只限于表示高质量的物品。</p>\n</li>\n<li>\n<p><ruby>何度<rp> (</rp><rt>なんど</rt><rp>)</rp></ruby> も<br />\n &quot;何 + 量词 + も + 肯定形式&quot; 表示数量多。<br />\neg：何度も　<ruby>転<rp> (</rp><rt>ころ</rt><rp>)</rp></ruby> びましたが，とても　おもしろいです。  我摔了好几次，不过挺有意思的。</p>\n</li>\n<li>\n<p>だいぶ　 [表示程度的副词]<br />\n 表示程度相当高，用于 “~ なりました” 等表示变化的句型中，突出强调变化的程度。<br />\neg: 昨日は　だいぶ　お酒を　飲みました。        昨天喝了不少酒。</p>\n</li>\n<li>\n<p><ruby>大丈夫<rp> (</rp><rt>だいじょうぶ</rt><rp>)</rp></ruby> です<br />\n “没问题”“可以”“没事的”，但可以根据上下文有不同的解释。</p>\n</li>\n<li>\n<p><ruby>残業<rp> (</rp><rt>ざんぎょう</rt><rp>)</rp></ruby><br />\n 在工作时间以外工作，即 “加班”。</p>\n</li>\n</ol>\n<h1 id=\"第二十课スミスさんは-ピアノを-弾ひく-ことが-できます\"><a class=\"anchor\" href=\"#第二十课スミスさんは-ピアノを-弾ひく-ことが-できます\">#</a> 第二十课：スミスさんは　ピアノを　<ruby>弾<rp> (</rp><rt>ひ</rt><rp>)</rp></ruby> く　ことが　できます</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"动词的基本形\"><a class=\"anchor\" href=\"#动词的基本形\">#</a> 动词的基本形</h3>\n<p>即动词原形，详见 “动词和形容词知识点”。</p>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>ます形</th>\n<th>去掉ます</th>\n<th>基本形</th>\n<th>基本形</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>一类动词</td>\n<td>書きます</td>\n<td>かき</td>\n<td>書く</td>\n<td>かく</td>\n</tr>\n<tr>\n<td></td>\n<td>急ぎます</td>\n<td>いそぎ</td>\n<td>急ぐ</td>\n<td>いそぐ</td>\n</tr>\n<tr>\n<td></td>\n<td>飛びます</td>\n<td>とび</td>\n<td>飛ぶ</td>\n<td>とぶ</td>\n</tr>\n<tr>\n<td></td>\n<td>読みます</td>\n<td>よみ</td>\n<td>読む</td>\n<td>よむ</td>\n</tr>\n<tr>\n<td></td>\n<td>死にます</td>\n<td>しに</td>\n<td>死ぬ</td>\n<td>しぬ</td>\n</tr>\n<tr>\n<td></td>\n<td>待ちます</td>\n<td>まち</td>\n<td>待つ</td>\n<td>まつ</td>\n</tr>\n<tr>\n<td></td>\n<td>売ります</td>\n<td>うり</td>\n<td>売る</td>\n<td>うる</td>\n</tr>\n<tr>\n<td></td>\n<td>買います</td>\n<td>かい</td>\n<td>買う</td>\n<td>かう</td>\n</tr>\n<tr>\n<td></td>\n<td>話します</td>\n<td>はなし</td>\n<td>話す</td>\n<td>はなす</td>\n</tr>\n<tr>\n<td>二类动词</td>\n<td>食べます</td>\n<td>たべ</td>\n<td>食べる</td>\n<td>たべる</td>\n</tr>\n<tr>\n<td></td>\n<td>見ます</td>\n<td>み</td>\n<td>見る</td>\n<td>みる</td>\n</tr>\n<tr>\n<td>三类动词</td>\n<td>来ます</td>\n<td>き</td>\n<td>来る</td>\n<td>くる</td>\n</tr>\n<tr>\n<td></td>\n<td>します</td>\n<td>し</td>\n<td>する</td>\n<td>する</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"名人は-动基本形-ことが-できます\"><a class=\"anchor\" href=\"#名人は-动基本形-ことが-できます\">#</a> [名 (人)] は　[动 (基本形)] ことが　できます</h3>\n<p>“某人会做某事”。“[动 (基本形)] + ことが　できます” 表示能力，在回答别人的询问时，肯定情况下可用 “できます”，否定情况下可用 “できません”。<br />\n森さんは　<ruby>中華料理<rp> (</rp><rt>ちゅうかりょうり</rt><rp>)</rp></ruby> を　<ruby>作<rp> (</rp><rt>つく</rt><rp>)</rp></ruby> る　ことが　できますか。  森先生会做中国菜吗？<br />\n—— はい，できます。     是的，会做。</p>\n<h3 id=\"名は-动基本形-ことです\"><a class=\"anchor\" href=\"#名は-动基本形-ことです\">#</a> [名] は　[动 (基本形)]　ことです</h3>\n<p>当谓语部分的内容是一种动作、行为时使用这个句型。<br />\neg:<br />\n 私は　<ruby>趣味<rp> (</rp><rt>しゅみ</rt><rp>)</rp></ruby> は　<ruby>切手<rp> (</rp><rt>きって</rt><rp>)</rp></ruby> を　<ruby>集<rp> (</rp><rt>あつ</rt><rp>)</rp></ruby> める　ことです。   我的爱好是集邮。<br />\n王さんの　<ruby>特技<rp> (</rp><rt>とくぎ</rt><rp>)</rp></ruby> は　<ruby>胡弓<rp> (</rp><rt>こきゅう</rt><rp>)</rp></ruby> を　弾く　ことです。      小王的特长是拉胡琴。</p>\n<p>“<ruby>切手<rp> (</rp><rt>きって</rt><rp>)</rp></ruby> を　<ruby>集<rp> (</rp><rt>あつ</rt><rp>)</rp></ruby> める　こと” 和 “<ruby>胡弓<rp> (</rp><rt>こきゅう</rt><rp>)</rp></ruby> を　弾く　こと” 相当于名词，即 “动词基本词 + こと” 起到和名词同样的作用，因此也可以用名词或名词短语代替。（类似英语中动名词。）<br />\n小野さんは　<ins class=\"dot\"><ruby>車<rp> (</rp><rt>くるま</rt><rp>)</rp></ruby> を　<ruby>運転<rp> (</rp><rt>うんてん</rt><rp>)</rp></ruby> する　こと</ins>が　できません。    小野不会开车。<br />\n小野さんは　<ins class=\"dot\">車の運転</ins>　が　できません。      小野不会开车。</p>\n<h3 id=\"动基本形-前に~\"><a class=\"anchor\" href=\"#动基本形-前に~\">#</a> [动 (基本形)] 前に，～</h3>\n<p>表示一个动作在另一个动作之前发生时，使用该句型。<br />\neg：毎日　寝る　前に　シャワーを　<ruby>浴<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> びます。   每天睡觉前淋浴。</p>\n<p>这个句型也可以用 “名词 + の + 前に” 的形式使用。<br />\n<ruby>会議<rp> (</rp><rt>かいぎ</rt><rp>)</rp></ruby>　の　前に，<ruby>資料<rp> (</rp><rt>しりょう</rt><rp>)</rp></ruby> を　コピー　します。　开会之前复印资料。</p>\n<h3 id=\"疑问词-か\"><a class=\"anchor\" href=\"#疑问词-か\">#</a> 疑问词 + か</h3>\n<p>疑问词 “いつ　どこ　だれ” 等词后续 “か”，表示 “某时 某地 某人” 等意思。<br />\n部屋に　誰<mark>か</mark>　いますか。    房间里有人吗？  “誰か” 指什么人，某个人<br />\n部屋に　誰<mark>が</mark>　いますか。    房间里有谁？    “が” 是助词</p>\n<p>“いつか　どこか　だれか　なにか” 等本身并不表示疑问的意思，所以也用于陈述句。<br />\n<ruby>冬休<rp> (</rp><rt>ふゆやす</rt><rp>)</rp></ruby> み，<mark>どこか</mark>へ　行きたいです。    寒假想去个什么地方。</p>\n<h3 id=\"~よね\"><a class=\"anchor\" href=\"#~よね\">#</a> ～よね</h3>\n<p>表示提出自己的意见，以征求对方的同意。<br />\n当说话人确信对方和自己的意见、想法完全相同时，只用 “ね”，而说话人对自己的意见、想法没有足够的把握时用 “よね”。<br />\nこの　<ruby>傘<rp> (</rp><rt>かさ</rt><rp>)</rp></ruby> は　森さんのですよね。   这把伞是森先生的吧？</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>\n<p>写真を　<ruby>撮<rp> (</rp><rt>と</rt><rp>)</rp></ruby> る　ことが　できます  [可能和允许]<br />\n“[动 (基本形)] + ことが　できます” 基本功能是表示可能，但有时根据上下文关系可表示允许。<br />\n<ruby>寮<rp> (</rp><rt>りょう</rt><rp>)</rp></ruby> の　<ruby>洗濯機<rp> (</rp><rt>せんたくき</rt><rp>)</rp></ruby> は　何時まで　<ruby>使<rp> (</rp><rt>つか</rt><rp>)</rp></ruby> う　ことが　できますか。   宿舍的洗衣机可以用到几点？<br />\n——　８時までです。それからは　使う　ことが　できません。    用到 8 点，那以后就不能用了。</p>\n</li>\n<li>\n<p>みんなで<br />\n “みんな + で” 组成，这里的で表示动作主体的样态。如：“<ruby>一人<rp> (</rp><rt>ひとり</rt><rp>)</rp></ruby> で（一个人）”“<ruby>自分<rp> (</rp><rt>じぶん</rt><rp>)</rp></ruby> で（自己）”“<ruby>全員<rp> (</rp><rt>ぜんいん</rt><rp>)</rp></ruby> で（全体人员）”。<br />\neg： みんなで　<ruby>餃子<rp> (</rp><rt>ギョウザ</rt><rp>)</rp></ruby> を　作ります。    大家在一起包饺子。</p>\n</li>\n<li>\n<p><ruby>趣味<rp> (</rp><rt>しゅみ</rt><rp>)</rp></ruby>　和 <ruby>興味<rp> (</rp><rt>きょうみ</rt><rp>)</rp></ruby><br />\n 日语的 “<ruby>趣味<rp> (</rp><rt>しゅみ</rt><rp>)</rp></ruby>” 是 “爱好，喜好” 的意思，表示兴趣的时候，使用 “<ruby>興味<rp> (</rp><rt>きょうみ</rt><rp>)</rp></ruby>”。<br />\n私の　<ruby>趣味<rp> (</rp><rt>しゅみ</rt><rp>)</rp></ruby> は　切手を集める　ことです。             我的爱好是集邮。<br />\n私は　日本の　<ruby>書道<rp> (</rp><rt>しょどう</rt><rp>)</rp></ruby> に　<ruby>興味<rp> (</rp><rt>きょうみ</rt><rp>)</rp></ruby> が　あります。 我对日本的书法感兴趣。</p>\n</li>\n<li>\n<p>ごちそうします<br />\n “ごちそう” 本身指奢华而高级的菜肴，后续动词 “します” 表示 “请别人吃饭”。</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%BA%94)-%E6%8C%89%E9%94%AE%E8%87%AA%E9%94%81%E4%B8%8E%E6%B6%88%E6%8A%96%E6%B1%87%E6%80%BB/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%BA%94)-%E6%8C%89%E9%94%AE%E8%87%AA%E9%94%81%E4%B8%8E%E6%B6%88%E6%8A%96%E6%B1%87%E6%80%BB/",
            "title": "FPGA学习(五)-按键自锁与消抖汇总",
            "date_published": "2025-03-17T09:25:00.000Z",
            "content_html": "<h1 id=\"介绍\"><a class=\"anchor\" href=\"#介绍\">#</a> 介绍</h1>\n<p>以按键控制蜂鸣器实验为例，设计消抖模块，自锁模块，按键控制蜂鸣器模块，顶层模块。<br />\n任务是：按键默认为高，蜂鸣器默认为高 鸣叫。按键按下时鸣叫结束，松开后保持。再次按下时，重新开始鸣叫，松开后保持。</p>\n<h1 id=\"实现思路\"><a class=\"anchor\" href=\"#实现思路\">#</a> 实现思路</h1>\n<div style=\"max-width: 550px; margin: 0 auto;\">\n  <div style=\"position: relative; padding-bottom: 72.73%; height: 0; overflow: hidden;\">\n    <iframe \n      src=\"https://zhimap.com/m/hVghkEjF\" \n      frameborder=\"0\" \n      style=\"position: absolute; top:0; left:0; width:100%; height:100%;\" \n      sandbox=\"allow-scripts allow-same-origin\">\n    </iframe>\n  </div>\n</div>\n<p>预期波形图：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/5.1.png\" title=\"消抖模块预期波形图\" style=\"max-width: 70%; height: auto;\"></p>\n<h1 id=\"消抖模块\"><a class=\"anchor\" href=\"#消抖模块\">#</a> 消抖模块</h1>\n<p>采样三种代码实现方式：</p>\n<div class=\"tab\" data-id=\"id1\" data-title=\"方法一\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>key_debounce.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: key_debounce</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: key_debounce.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 按键消抖模块。已知按键默认为高电平，按下时为低电平。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.17</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> key_debounce <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>           key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">output</span>  <span class=\"token keyword\">reg</span>     key_filter   <span class=\"token comment\">// 滤除抖动的 key</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>       <span class=\"token comment\">// 消抖参数定义，假设系统时钟为 50MHz，若需要 20ms 的消抖时间，则阈值为：20ms * 50MHz = 1,000,000</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME                 <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ                     <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD   <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH                    <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 key_d0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 key_d1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 根据阈值选择足够宽度的计数器</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// 打两拍采集按键信号</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            key_d0 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            key_d1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            key_d0 <span class=\"token operator\">&lt;=</span> key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            key_d1 <span class=\"token operator\">&lt;=</span> key_d0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token comment\">// 按键消抖计时</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token function\">if</span><span class=\"token punctuation\">(</span>key_d0 <span class=\"token operator\">!=</span> key_d1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span>     <span class=\"token comment\">// 按键状态发生变化</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token function\">if</span><span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span>     <span class=\"token comment\">// 按键状态未发生变化且计数器未到 0</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span>                          <span class=\"token comment\">// 按键状态未发生变化且计数器已到 0 表明达到稳定时间，计数器清零</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token comment\">// 输出消抖后的按键信号</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            key_filter <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token function\">if</span><span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span>    <span class=\"token comment\">// 计数器从最大到 1 时，经过了一个消抖时间，输出滤波后的按键信号</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token comment\">//key_filter &lt;= key_d1;        // 可以把 key_d1 赋值给 key_filter</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            key_filter <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>key_filter<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 也可以取反</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            key_filter <span class=\"token operator\">&lt;=</span> key_filter<span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id1\" data-title=\"方法二\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">toggle_switch</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> btn<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 轻触开关原始输入（异步）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  toggle_out  <span class=\"token comment\">// 消抖信号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 消抖电路</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_0<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 同步后的按钮信号</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 根据阈值选择足够宽度的计数器</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 消抖后稳定的按钮信号</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 首先对异步信号进行两级同步（或更多级同步）以防止亚稳态问题</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_1<span class=\"token punctuation\">,</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            btn_sync_0   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            btn_sync_0   <span class=\"token operator\">&lt;=</span> btn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> btn_sync_0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> btn_sync_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 消抖逻辑：只有当采样值与稳定值不一致时，计数器开始计数</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            btn_debounced <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 假设未按时为高电平</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_sync_2 <span class=\"token operator\">!=</span> btn_debounced<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token comment\">// 状态不一致，开始计数</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    <span class=\"token comment\">// 达到稳定时间，更新消抖信号</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    btn_debounced <span class=\"token operator\">&lt;=</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token comment\">// 信号稳定，清零计数器</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id1\" data-title=\"方法三\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">toggle_switch</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> btn<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 轻触开关原始输入（异步）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  toggle_out  <span class=\"token comment\">// 自锁输出状态</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 消抖计数阈值</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 计数器所需位宽</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 消抖电路</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_0<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 同步后的按钮信号</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 递增计数器</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 消抖后稳定的按钮信号</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 多级同步，防止亚稳态问题</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_1<span class=\"token punctuation\">,</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            btn_sync_0 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            btn_sync_0 <span class=\"token operator\">&lt;=</span> btn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> btn_sync_0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> btn_sync_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 消抖逻辑（递增计数器版）</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// 当采样信号（btn_sync_2）与当前消抖信号（btn_debounced）不同时，</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">// 计数器开始递增；如果计数器达到阈值，则更新消抖信号，</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">// 否则当采样信号与稳定信号一致时立即清零计数器。</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            btn_debounced <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 假设空闲时按键为高电平</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_sync_2 <span class=\"token operator\">==</span> btn_debounced<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 采样信号与当前稳定状态一致，清零计数器</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 递增计数器</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token comment\">// 达到稳定时间，更新消抖信号</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    btn_debounced <span class=\"token operator\">&lt;=</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<p>这三种方法的不同重点在于消抖时间的计数方式。</p>\n<ul>\n<li>方法一：采用递减的计数器，从最大值 DEBOUNCE_THRESHOLD 开始，当一级同步和二级同步信号不一致时，表明按键状态未稳定，计数器赋最大值。接下来，若信号一致，则递减，但一旦又不一致则赋最大值（前面的递减失效）。这样，只有当信号一致且一直递减到 0，才表示达到消抖时间，在计数器为 1 时（消抖时间为计数器最大值到 1）对消抖的信号 key_filter 进行翻转或者赋为 key_d1 的值。</li>\n<li>方法二：采用递增的计数器，先定义了消抖的信号 btn_debounced，当 btn_debounced 与同步后的信号不一致时，消抖计数器 debounce_cnt 开始计数。但如果未计满时两者一致表明是抖动，则清零重新开始计数。反之若开始计数后两者没有一致的情况，能让计数一直计到最大值时，表明信号稳定，给 btn_debounced 赋为同步信号的值，计数器清零。<br />\n- 方法三：采用递增的计数器，先定义了消抖的信号 btn_debounced，当 btn_debounced 与同步后的信号一致时，表明处于抖动或者已经稳定，计数器归零，若不一致，则计数器从 0 递增。当不一致的时间达到消抖时间，表明稳定，更新消抖信号，给 btn_debounced 赋为同步信号的值，同时清零计数器。</li>\n</ul>\n<h1 id=\"自锁模块\"><a class=\"anchor\" href=\"#自锁模块\">#</a> 自锁模块</h1>\n<p>代码如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>g key_locked.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: key_locked</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: key_locked.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 按键自锁模块。已知按键默认为高电平，按下时为低电平。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.17</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> key_locked <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>           key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>      key_locked</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">reg</span> key_d0<span class=\"token punctuation\">,</span> key_d1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 打两拍，两级同步</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token important\">always@</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token function\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            key_d0 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            key_d1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            key_d0 <span class=\"token operator\">&lt;=</span> key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            key_d1 <span class=\"token operator\">&lt;=</span> key_d0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 采集按键下降沿</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token important\">always@</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token function\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            key_locked <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token function\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>key_d0 <span class=\"token operator\">&amp;&amp;</span> key_d1<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            key_locked <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>key_locked<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            key_locked <span class=\"token operator\">&lt;=</span> key_locked<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>对于自锁模块，则是通过打两拍（更保险三拍），然后取最后两个同步信号进行采集下降沿（若按下为低电平则采集下降沿，否则采集上升沿），并进行翻转，这样只有在再次遇到下降沿才会翻转信号，实现自锁。（前提是按键消抖过。）</p>\n<h1 id=\"按键控制蜂鸣器模块\"><a class=\"anchor\" href=\"#按键控制蜂鸣器模块\">#</a> 按键控制蜂鸣器模块</h1>\n<p>代码如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>key_beep.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: key_beep</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: key_beep.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 按键控制蜂鸣器，蜂鸣器默认为高电平鸣叫，按键为高电平时停止鸣叫，按键为低电平又继续鸣叫。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.17</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> key_beep <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>           key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>      beep</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            beep <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            beep <span class=\"token operator\">&lt;=</span> key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">end</span>    </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>输入为消抖并能自锁的按键信号，根据需求控制蜂鸣器即可，这里通过 beep 同步 key 的信号实现需求。</p>\n<h1 id=\"顶层模块\"><a class=\"anchor\" href=\"#顶层模块\">#</a> 顶层模块</h1>\n<p>代码如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>top_key_beep.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: top_key_beep</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: top_key_beep.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 按键控制蜂鸣器顶层模块，对按键进行消抖，再实现自锁，实现，蜂鸣器默认为高，按下按键为低，松开保持，再按下为高，松开保持。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.17</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> top_key_beep <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>           key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">output</span>          beep</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 20ms</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">wire</span> key_filter<span class=\"token punctuation\">,</span> key_locked<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    key_debounce #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">DEBOUNCE_TIME</span><span class=\"token punctuation\">(</span>DEBOUNCE_TIME<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">)</span> key_debounce_inst <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">key</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">key_filter</span><span class=\"token punctuation\">(</span>key_filter<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    key_locked key_locked_inst <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">key</span><span class=\"token punctuation\">(</span>key_filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">key_locked</span><span class=\"token punctuation\">(</span>key_locked<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    key_beep key_beep_inst <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">key</span><span class=\"token punctuation\">(</span>key_locked<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">beep</span><span class=\"token punctuation\">(</span>beep<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>调用并例化各个子模块，实现最终功能：按键按下时鸣叫结束，松开后保持。再次按下时，重新开始鸣叫，松开后保持。</p>\n<div class=\"note info\">\n<p>在例化子模块时，对于子模块的输出信号，在顶层模块里一般声明为 wire 类型，如这里的 key_filter、key_locked、beep</p>\n</div>\n<p>一般对于：</p>\n<pre><code>module top_key_beep (\n    input           sys_clk,\n    input           sys_rst_n,\n    input           key,\n\n    output          beep\n);\n</code></pre>\n<p>没有特别说明 reg 时（如 output  reg  beep），都默认是 wire 类型。</p>\n<h1 id=\"仿真结果\"><a class=\"anchor\" href=\"#仿真结果\">#</a> 仿真结果</h1>\n<p>测试代码为：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_top_key_beep.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns  <span class=\"token comment\">// Time scale is set to 1ns/1ns</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">tb_top_key_beep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">parameter</span> CLK_PERIOD <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 50MHz</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_clk<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">reg</span>         key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">wire</span>        beep<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">parameter</span> DEBOUNCE_TIME <span class=\"token operator\">=</span> <span class=\"token number\">0.0000002</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 200ns</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token number\">#100</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按下按键</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token number\">#40</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token number\">#30</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动结束</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token number\">#1000</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 松开按键</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token number\">#50</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token number\">#30</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动结束</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 再次按下按键</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token number\">#1000</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按下按键</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token number\">#40</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token number\">#30</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动结束</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token number\">#1000</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 松开按键</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token number\">#50</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token number\">#30</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 按键抖动结束    </span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 时钟周期为 20ns</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>top_key_beep #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">DEBOUNCE_TIME</span><span class=\"token punctuation\">(</span>DEBOUNCE_TIME<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    u_top_key_beep <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">key</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">beep</span><span class=\"token punctuation\">(</span>beep<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>仿真结果为：</p>\n<ol>\n<li>\n<p>消抖模块<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/5.2.jpg\" title=\"消抖模块仿真结果\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n<li>\n<p>顶层模块<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/5.3.jpg\" title=\"顶层模块仿真结果\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%8A%A8%E8%AF%8D%E5%92%8C%E5%BD%A2%E5%AE%B9%E8%AF%8D%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%8A%A8%E8%AF%8D%E5%92%8C%E5%BD%A2%E5%AE%B9%E8%AF%8D%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "title": "动词和形容词知识点",
            "date_published": "2025-03-15T07:45:00.000Z",
            "content_html": "<h1 id=\"动词三分类\"><a class=\"anchor\" href=\"#动词三分类\">#</a> 动词三分类</h1>\n<p>所有的动词原型都是う段结尾。</p>\n<h2 id=\"一类动词五う段动词\"><a class=\"anchor\" href=\"#一类动词五う段动词\">#</a> 一类动词（五 (う) 段动词）</h2>\n<ol>\n<li>结尾是う段非る的动词，肯定是五段动词。</li>\n<li>あ段 + る、う段 + る、お段 + る 是五段动词</li>\n<li>特例：\n<ul>\n<li>かく　さがす　かつ　あそぶ　よむ</li>\n<li>こまる　おこる　やる</li>\n<li>きる　かえる　はしる</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"二类动词上一段动词い段-下一段动词え段\"><a class=\"anchor\" href=\"#二类动词上一段动词い段-下一段动词え段\">#</a> 二类动词（上一段动词 (い段)、下一段动词 (え段)）</h2>\n<p>い段 + る、え段 + る<br />\n eg:<br />\n おきる (い段 + る)<br />\n たべる (え段 + る)<br />\n みえる (え段 + る)<br />\n きる (い段 + る)</p>\n<h2 id=\"三类动词か变-サ变\"><a class=\"anchor\" href=\"#三类动词か变-サ变\">#</a> 三类动词（か变、サ变）</h2>\n<p><ruby>来<rp> (</rp><rt>く</rt><rp>)</rp> る<rt></rt></ruby> - か变<br />\nする　- サ变</p>\n<p>但サ变有很多，通过 ” 名词 + する “ 作动词。<br />\neg: 勉強する　運動する　散歩する    (一般可活用动词的名词才可加する)</p>\n<h1 id=\"动词变形-原型-ます形\"><a class=\"anchor\" href=\"#动词变形-原型-ます形\">#</a> 动词变形  <mark>原型 -&gt; ます形</mark></h1>\n<h2 id=\"五段动词一类\"><a class=\"anchor\" href=\"#五段动词一类\">#</a> 五段动词（一类）</h2>\n<p>う段 -&gt; い段 + ます （う段变同行い段）<br />\neg:<br />\n<ruby> 書<rp> (</rp><rt>か</rt><rp>)</rp> く<rt></rt></ruby>　-&gt; <ruby>書<rp> (</rp><rt>か</rt><rp>)</rp> き<rt></rt></ruby>ます<br />\n<ruby>吸<rp> (</rp><rt>す</rt><rp>)</rp> う<rt></rt></ruby> -&gt; <ruby>吸<rp> (</rp><rt>す</rt><rp>)</rp> い<rt></rt></ruby>ます<br />\n<ruby>切<rp> (</rp><rt>き</rt><rp>)</rp> る<rt></rt></ruby> -&gt; <ruby>切<rp> (</rp><rt>き</rt><rp>)</rp> り<rt></rt></ruby>ます<br />\n<ruby>呼<rp> (</rp><rt>よ</rt><rp>)</rp> ぶ<rt></rt></ruby> -&gt; <ruby>呼<rp> (</rp><rt>よ</rt><rp>)</rp> び<rt></rt></ruby>ます</p>\n<h2 id=\"上一段动词-下一段动词二类\"><a class=\"anchor\" href=\"#上一段动词-下一段动词二类\">#</a> 上一段动词、下一段动词（二类）</h2>\n<p>る -&gt; ます<br />\n eg:<br />\n<ruby> 教<rp> (</rp><rt>おし</rt><rp>)</rp> える<rt></rt></ruby>   -&gt; <ruby>教<rp> (</rp><rt>おし</rt><rp>)</rp> えます<rt></rt></ruby><br />\n<ruby>開<rp> (</rp><rt>あ</rt><rp>)</rp> ける<rt></rt></ruby> -&gt; <ruby>開<rp> (</rp><rt>あ</rt><rp>)</rp> けます<rt></rt></ruby><br />\n<ruby>調<rp> (</rp><rt>しら</rt><rp>)</rp> べる<rt></rt></ruby> -&gt; <ruby>調<rp> (</rp><rt>しら</rt><rp>)</rp> べます<rt></rt></ruby><br />\n<ruby>得<rp> (</rp><rt>え</rt><rp>)</rp> る<rt></rt></ruby>　-&gt; <ruby>得<rp> (</rp><rt>え</rt><rp>)</rp> ます<rt></rt></ruby></p>\n<h2 id=\"か变-サ变动词三类\"><a class=\"anchor\" href=\"#か变-サ变动词三类\">#</a> か变、サ变动词（三类）</h2>\n<p><ruby>来<rp> (</rp><rt>く</rt><rp>)</rp> る<rt></rt></ruby> -&gt; <ruby>来<rp> (</rp><rt>き</rt><rp>)</rp> ます<rt></rt></ruby><br />\nする　-&gt; します<br />\n eg:<br />\n<ruby> 勉強<rp> (</rp><rt>べんきょう</rt><rp>)</rp></ruby> する   -&gt; 勉強します</p>\n<h1 id=\"て形动词-原型-て形\"><a class=\"anchor\" href=\"#て形动词-原型-て形\">#</a> て形动词  <mark>原型 -&gt; て形</mark></h1>\n<ol>\n<li>\n<p>三类动词的变形：する　-&gt; して、<ruby>来<rp> (</rp><rt>く</rt><rp>)</rp> る<rt></rt></ruby> -&gt; <ruby>来<rp> (</rp><rt>き</rt><rp>)</rp> て<rt></rt></ruby></p>\n</li>\n<li>\n<p>二类动词的变形：る -&gt; て<br />\n eg: <ruby>食<rp> (</rp><rt>た</rt><rp>)</rp></ruby> べる　-&gt; <ruby>食<rp> (</rp><rt>た</rt><rp>)</rp></ruby> べて   <ruby>調<rp> (</rp><rt>しら</rt><rp>)</rp></ruby> べる -&gt; <ruby>調<rp> (</rp><rt>しら</rt><rp>)</rp></ruby> べて</p>\n</li>\n<li>\n<p>一类动词（う段动词的变形）：</p>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>结尾</th>\n<th>变形规则</th>\n<th>例子</th>\n<th>变形后</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>す</td>\n<td>-&gt; して</td>\n<td><ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp> す<rt></rt></ruby></td>\n<td><ruby>話<rp> (</rp><rt>はな</rt><rp>)</rp> して<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>く</td>\n<td>-&gt; いて</td>\n<td><ruby>磨<rp> (</rp><rt>みが</rt><rp>)</rp> く<rt></rt></ruby></td>\n<td><ruby>磨<rp> (</rp><rt>みが</rt><rp>)</rp> いて<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>ぐ</td>\n<td>-&gt; いで</td>\n<td><ruby>急<rp> (</rp><rt>いそ</rt><rp>)</rp> ぐ<rt></rt></ruby></td>\n<td><ruby>急<rp> (</rp><rt>いそ</rt><rp>)</rp> いで<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>う、つ、る</td>\n<td>-&gt; って</td>\n<td><ruby>洗<rp> (</rp><rt>あら</rt><rp>)</rp> う<rt></rt></ruby></td>\n<td><ruby>洗<rp> (</rp><rt>あら</rt><rp>)</rp> って<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>う、つ、る</td>\n<td>-&gt; って</td>\n<td><ruby>待<rp> (</rp><rt>ま</rt><rp>)</rp> つ<rt></rt></ruby></td>\n<td><ruby>待<rp> (</rp><rt>ま</rt><rp>)</rp> って<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>う、つ、る</td>\n<td>-&gt; って</td>\n<td>やる</td>\n<td>やって</td>\n</tr>\n<tr>\n<td>ぶ、む、ね</td>\n<td>-&gt; んで</td>\n<td><ruby>遊<rp> (</rp><rt>あそ</rt><rp>)</rp> ぶ<rt></rt></ruby></td>\n<td><ruby>遊<rp> (</rp><rt>あそ</rt><rp>)</rp> んで<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>ぶ、む、ね</td>\n<td>-&gt; んで</td>\n<td><ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp> む<rt></rt></ruby></td>\n<td><ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp> んで<rt></rt></ruby></td>\n</tr>\n<tr>\n<td>ぶ、む、ね</td>\n<td>-&gt; んで</td>\n<td><ruby>死<rp> (</rp><rt>し</rt><rp>)</rp> ね<rt></rt></ruby></td>\n<td><ruby>死<rp> (</rp><rt>し</rt><rp>)</rp> んで<rt></rt></ruby></td>\n</tr>\n</tbody>\n</table>\n<p>特例：<ruby>行<rp> (</rp><rt>い</rt><rp>)</rp> く<rt></rt></ruby> -&gt; <ruby>行<rp> (</rp><rt>い</rt><rp>)</rp> って<rt></rt></ruby></p>\n<h1 id=\"た形动词\"><a class=\"anchor\" href=\"#た形动词\">#</a> た形动词</h1>\n<p>把て形动词的て换成た即可。</p>\n<h1 id=\"形容词\"><a class=\"anchor\" href=\"#形容词\">#</a> 形容词</h1>\n<ol>\n<li>一类形容词\n<ul>\n<li>以い结尾</li>\n<li><ruby>漢字<rp> (</rp><rt>かんじ</rt><rp>)</rp></ruby>　+ い</li>\n</ul>\n</li>\n</ol>\n<p>eg: <ruby>寒<rp> (</rp><rt>さむ</rt><rp>)</rp> い<rt></rt></ruby>　<ruby>暖<rp> (</rp><rt>あたた</rt><rp>)</rp> かい<rt></rt></ruby></p>\n<ol start=\"2\">\n<li>二类形容词<br />\n eg: <ruby>綺麗<rp> (</rp><rt>きれい</rt><rp>)</rp></ruby>　<ruby>詳細<rp> (</rp><rt>しょうさい</rt><rp>)</rp></ruby>　<ruby>愉快<rp> (</rp><rt>ゆかい</rt><rp>)</rp></ruby></li>\n</ol>\n<p>形 1 表肯定时： い　+ です　（<ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> い<rt></rt></ruby>　-&gt; 熱いです）<br />\n表否定时：い -&gt; くない　（<ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> い<rt></rt></ruby>　-&gt; 熱くない　です　=　熱くありません）<br />\n表过去时：い -&gt; かった    （<ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> い<rt></rt></ruby> -&gt; 熱かった）<br />\n表过去否定时：い -&gt; くなかった   （<ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> い<rt></rt></ruby> -&gt; 熱くなかった）</p>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E5%9B%9B)-%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6LED/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E5%9B%9B)-%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6LED/",
            "title": "FPGA学习(四)-按键控制LED",
            "date_published": "2025-03-14T02:11:00.000Z",
            "content_html": "<h1 id=\"目的\"><a class=\"anchor\" href=\"#目的\">#</a> 目的</h1>\n<ol>\n<li>基本功能<br />\n两个按键控制两个 LED。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>按键状态</th>\n<th>LED 显示效果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>无按键按下</td>\n<td>两个 LED 全灭</td>\n</tr>\n<tr>\n<td>按下 Key0</td>\n<td>两个灯交替闪烁</td>\n</tr>\n<tr>\n<td>按下 Key1</td>\n<td>两个灯同时闪烁</td>\n</tr>\n<tr>\n<td>两个都按下</td>\n<td>两个灯全亮</td>\n</tr>\n</tbody>\n</table>\n<p>已知按键默认为高电平，按下时拉低；且需要设置 LED 流水间隔或闪烁间隔时间。</p>\n<ol start=\"2\">\n<li>进阶功能 1<br />\n 四个按键控制四个 LED。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>按键状态</th>\n<th>LED 显示效果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>无按键按下</td>\n<td>四个 LED 全灭</td>\n</tr>\n<tr>\n<td>按下 Key0</td>\n<td>自左向右流水灯</td>\n</tr>\n<tr>\n<td>按下 Key1</td>\n<td>自右向左流水灯</td>\n</tr>\n<tr>\n<td>按下 Key2</td>\n<td>四个灯同时闪烁</td>\n</tr>\n<tr>\n<td>按下 Key3</td>\n<td>四个灯全亮</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"3\">\n<li>进阶功能 2<br />\n 原本的开关是轻触开关，需要设计为自锁开关。且进行按键消抖。</li>\n</ol>\n<h1 id=\"基本功能\"><a class=\"anchor\" href=\"#基本功能\">#</a> 基本功能</h1>\n<h2 id=\"实现思路\"><a class=\"anchor\" href=\"#实现思路\">#</a> 实现思路</h2>\n<p>实现思路为：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.1.jpg\" title=\"两按键控制LED\" style=\"max-width: 70%; height: auto;\"></p>\n<h2 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h2>\n<p>对于基本功能，verilog 代码如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>key_led_2.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: key_led_2 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: key_led_2.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: LED 流水或闪烁间隔为 0.5s</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//  按键状态        LED 显示效果</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//  无按键按下      两个 LED 全灭</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//  按下 Key0        两个灯交替闪烁</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//  按下 Key1        两个灯同时闪烁</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//  同时按下        两个灯全亮</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 按下时按键为低电平，默认为高电平</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.12</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">module</span> key_led_2 #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">parameter</span> BLINK_INTERVAL  <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>                       <span class=\"token comment\">// 闪烁间隔（秒）</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">input</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>         key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>    led</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">localparam</span> INTERVAL        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> BLINK_INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>     cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">reg</span>                     led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// 计数器计时 0.5s</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">&lt;</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">//led 状态切换标志位</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">////led 控制，根据按键状态和 led_flag 切换 led 状态 (使用 if-else)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\">// always @(posedge sys_clk or negedge sys_rst_n) begin</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">//     if (!sys_rst_n) </span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">//         led &lt;= 2'b00;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">//     else if (key == 2'b00)                  // 同时按下</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">//         led &lt;= 2'b11;                       </span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//     else if (key == 2'b11)                  // 两个都没按</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">//         led &lt;= 2'b00;  </span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">//     else if (key == 2'b10)                  // 按下 Key0</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">//         led &lt;= led_flag ? 2'b01 : 2'b10;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">//     else if (key == 2'b01)                  // 按下 Key1</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">//         led &lt;= led_flag ? 2'b11 : 2'b00;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">//     else ;                                  // 其他情况灯状态不变</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token comment\">// end</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">//led 控制，根据按键状态和 led_flag 切换 led 状态 (使用 case)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b00</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token number\">2'b00</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b11</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 同时按下</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token number\">2'b11</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b00</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 两个都没按</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token number\">2'b10</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> led_flag <span class=\"token operator\">?</span> <span class=\"token number\">2'b01</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">2'b10</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 按下 Key0</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token number\">2'b01</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> led_flag <span class=\"token operator\">?</span> <span class=\"token number\">2'b11</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">2'b00</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 按下 Key1</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> led<span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 其他情况灯状态不变   或者写成：default: ;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token keyword\">endcase</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token keyword\">end</span>                               </pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>其中的 led 控制逻辑可采用 case 和 if-else 块，但多分支下，case 块结构更加清晰易读。该代码最主要的思路就是：当计数器计数到所需时间时，对 led_flag 进行取反，则 led_flag 的每个电平的持续时间都表示需要的时间间隔，led 的闪烁状态即根据 led_flag 进行切换保证闪烁间隔满足要求，led 状态模式则有按键控制。</p>\n<h2 id=\"仿真结果\"><a class=\"anchor\" href=\"#仿真结果\">#</a> 仿真结果</h2>\n<p>测试代码为：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_key_led_2.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span>  <span class=\"token number\">1</span>ns <span class=\"token operator\">/</span> <span class=\"token number\">1</span>ns</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> tb_key_led_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Parameters</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">parameter</span> PERIOD          <span class=\"token operator\">=</span> <span class=\"token number\">20</span>                            <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">parameter</span> BLINK_INTERVAL  <span class=\"token operator\">=</span> <span class=\"token number\">0.0000005</span>                           <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// Inputs</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">reg</span>             sys_clk                           <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">reg</span>             sys_rst_n                         <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">reg</span>     <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>   key                               <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// Outputs</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">wire</span>    <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>   led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    sys_clk     <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    sys_rst_n   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    key         <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b11</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b10</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key0</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b11</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b01</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b11</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b00</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 同时按下</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token number\">#2000</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b11</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>key_led_2 #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">.</span>BLINK_INTERVAL <span class=\"token punctuation\">(</span> BLINK_INTERVAL <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">)</span> u_key_led_2 <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_clk                 <span class=\"token punctuation\">(</span> sys_clk                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_rst_n               <span class=\"token punctuation\">(</span> sys_rst_n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">.</span>key                     <span class=\"token punctuation\">(</span> key                      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">.</span>led                     <span class=\"token punctuation\">(</span> led                      <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.2.jpg\" title=\"Modelsim 两按键控制LED-仿真结果\" style=\"max-width: 70%; height: auto;\"> \n<p>设置的参数是闪烁间隔为 500ns。</p>\n<h1 id=\"进阶功能1\"><a class=\"anchor\" href=\"#进阶功能1\">#</a> 进阶功能 1</h1>\n<h2 id=\"实现思路-2\"><a class=\"anchor\" href=\"#实现思路-2\">#</a> 实现思路</h2>\n<p>实现思路为：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.3.jpg\" title=\"四按键控制LED\" style=\"max-width: 70%; height: auto;\"></p>\n<h2 id=\"代码实现-2\"><a class=\"anchor\" href=\"#代码实现-2\">#</a> 代码实现</h2>\n<p>verilog 代码如下：</p>\n<div class=\"tab\" data-id=\"id1\" data-title=\"方法一\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>key_led_4.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: key_led_4 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: key_led_4.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: LED 流水或闪烁间隔为 0.5s</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//  按键状态        LED 显示效果</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//  无按键按下      四个 LED 全灭</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//  按下 Key0        自左向右流水灯</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//  按下 Key1        自右向左流水灯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//  按下 Key2        四个灯同时闪烁</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//  按下 Key3        四个灯全亮 </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.12</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">module</span> key_led_4  #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">parameter</span> BLINK_INTERVAL  <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>                       <span class=\"token comment\">// 闪烁间隔（秒）</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">input</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>         key<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>    led</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">localparam</span> INTERVAL        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> BLINK_INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>     cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">reg</span>                     led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">integer</span>                 flow_led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// 计数器计时 0.5s</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">&lt;</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">//led 状态切换标志位</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        led_flag <span class=\"token operator\">&lt;=</span> led_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">//led 流水灯控制位</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        flow_led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            flow_led_flag <span class=\"token operator\">&lt;=</span> flow_led_flag <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            flow_led_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">//led 控制，根据按键状态和 led_flag 切换 led 状态 (使用 case)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0000</span><span class=\"token punctuation\">;</span>                            <span class=\"token comment\">// 两个都没按</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token number\">4'b1110</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">// 按下 Key0</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token keyword\">else</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0010</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token number\">4'b1101</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">// 按下 Key1</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0010</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flow_led_flag <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token keyword\">else</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token number\">4'b1011</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> led_flag <span class=\"token operator\">?</span> <span class=\"token number\">4'b1111</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">4'b0000</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 按下 Key2</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token number\">4'b0111</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>                            <span class=\"token comment\">// 按下 Key3</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">endcase</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token keyword\">end</span>                               </pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id1\" data-title=\"方法二\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>key_led_controller.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> key_led_controller #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">parameter</span> BLINK_INTERVAL <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// 闪烁或流水间隔（秒）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">parameter</span> LED_NUM        <span class=\"token operator\">=</span> <span class=\"token number\">4</span>          <span class=\"token comment\">// LED 个数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> key<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 按键输入，假设低有效：key [3]=Key3，key [0]=Key0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  <span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> led</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> CLK_FREQ  <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 计算定时更新周期（周期数），例如：50MHz 时 0.5s = 25_000_000 个时钟周期</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> INTERVAL  <span class=\"token operator\">=</span> CLK_FREQ <span class=\"token operator\">*</span> BLINK_INTERVAL<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> CNT_WIDTH <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 定时计数器，每 INTERVAL 个时钟周期产生一次更新时刻</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 按键检测：低有效（0 表示按下）</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">wire</span> key0_pressed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">wire</span> key1_pressed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">wire</span> key2_pressed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">wire</span> key3_pressed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 模式定义</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">localparam</span> MODE_OFF    <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 无按键按下：LED 全灭</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">localparam</span> MODE_FLOW_L <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Key0：自左向右流水</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">localparam</span> MODE_FLOW_R <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Key1：自右向左流水</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">localparam</span> MODE_BLINK  <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Key2：全闪烁（交替全灭 / 全亮）</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">localparam</span> MODE_ALL_ON <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Key3：全部 LED 全亮</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> mode<span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// 当前工作模式</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> led_reg<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 内部 LED 状态寄存器</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// 状态更新：在每个定时更新时刻，根据按键优先级更新模式及 LED 状态</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            mode    <span class=\"token operator\">&lt;=</span> MODE_OFF<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>LED_NUM<span class=\"token operator\">&#123;</span><span class=\"token number\">1'b0</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// 按键优先级：Key3 > Key2 > Key1 > Key0</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key3_pressed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                mode    <span class=\"token operator\">&lt;=</span> MODE_ALL_ON<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>LED_NUM<span class=\"token operator\">&#123;</span><span class=\"token number\">1'b1</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key2_pressed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mode <span class=\"token operator\">!=</span> MODE_BLINK<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    mode    <span class=\"token operator\">&lt;=</span> MODE_BLINK<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>LED_NUM<span class=\"token operator\">&#123;</span><span class=\"token number\">1'b0</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 初始化全灭，下个周期取反</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>led_reg<span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 取反实现闪烁</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key1_pressed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mode <span class=\"token operator\">!=</span> MODE_FLOW_L<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    mode    <span class=\"token operator\">&lt;=</span> MODE_FLOW_L<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                    <span class=\"token comment\">// 初始化：最低位为 1（左侧流水）</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                    <span class=\"token comment\">// 循环左移：最高位移到最低位</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>LED_NUM <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">&#123;</span>led_reg<span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> led_reg<span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&#125;</span> <span class=\"token punctuation\">:</span> led_reg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key0_pressed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mode <span class=\"token operator\">!=</span> MODE_FLOW_R<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    mode    <span class=\"token operator\">&lt;=</span> MODE_FLOW_R<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token comment\">// 初始化：最高位为 1（右侧流水），当 LED_NUM==1 时仍有效</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>LED_NUM <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token punctuation\">(</span>LED_NUM <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                    <span class=\"token comment\">// 循环右移：最低位移到最高位</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                    led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>LED_NUM <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">&#123;</span>led_reg<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> led_reg<span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&#125;</span> <span class=\"token punctuation\">:</span> led_reg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token comment\">// 无按键按下：LED 全部关闭</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                mode    <span class=\"token operator\">&lt;=</span> MODE_OFF<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                led_reg <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>LED_NUM<span class=\"token operator\">&#123;</span><span class=\"token number\">1'b0</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token comment\">// 输出同步更新 LED 状态</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>LED_NUM<span class=\"token operator\">&#123;</span><span class=\"token number\">1'b0</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            led <span class=\"token operator\">&lt;=</span> led_reg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<p>方法一和方法二的不同主要在于流水灯方向的控制思路上，方法一根据 flow_led_flag 的不同值设置不同的 led 置位，方法二则根据不同方向，先设置最低位或最高位为 1，再进行移位控制。<br />\n且方法二将 led 的数量进行参数化了，且具备按键优先级：Key3 &gt; Key2 &gt; Key1 &gt; Key0，如同时按下 key3 和 key2 时，会优先执行 key3 的任务。且对五种 MODE 进行参数化，以便对 MODE 的初始状态进行控制，如 MODE_FLOW_R 的初始状态需要保证最高位为 1，MODE_BLINK 的初始状态需要保证全为 0，确保了初始状态后，该 MODE 下的功能对应实现即可。</p>\n<p>注：对于方法二，还使用了 led_reg 作为内部 LED 状态寄存器，而不是直接使用 output reg led，意义如下：</p>\n<ol>\n<li>确保在状态更新时，LED 的状态不会受到干扰。在某些情况下，直接使用 led 可能会导致毛刺（glitch），即在状态变化的瞬间出现短暂的不稳定状态。使用 led_reg 可以有效避免这种情况。</li>\n<li>在状态更新时，led_reg 可以在一个时钟周期内完成所有的状态变化，而 led 的更新则是在下一个时钟周期内完成。这种方式可以避免在状态变化过程中出现不稳定的输出。<br />\n<mark>（当某个时钟上升沿下，led_reg 的状态需要进行更新，但与此同时，并行执行下，也执行了 led &lt;= led_reg ，但此时 led 继承的其实是 led_reg 在这个时钟上升沿前一刻的状态，而 led_reg 的状态更新发生在这个时钟上升沿后一刻，所以，需要在下个时钟上升沿，led 才能同步上 led_reg 在上个时钟上升沿更新的状态，所以 led 的状态更新始终会比 led_reg 慢一个时钟周期。 但能有效避免直接使用 led 作为状态更新时 状态变化过程可能出现的不稳定输出。）</mark></li>\n<li>将内部逻辑和输出逻辑分离，可以使代码更加清晰和易于维护。led_reg 负责内部状态的计算和更新，而 led 负责将最终的状态输出到外部。</li>\n</ol>\n<h2 id=\"仿真结果-2\"><a class=\"anchor\" href=\"#仿真结果-2\">#</a> 仿真结果</h2>\n<p>测试代码为：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_key_led_4.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span>  <span class=\"token number\">1</span>ns <span class=\"token operator\">/</span> <span class=\"token number\">1</span>ns</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> tb_key_led_4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Parameters</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">parameter</span> PERIOD          <span class=\"token operator\">=</span> <span class=\"token number\">20</span>                            <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">parameter</span> BLINK_INTERVAL  <span class=\"token operator\">=</span> <span class=\"token number\">0.0000005</span>                           <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// Inputs</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">reg</span>             sys_clk                           <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">reg</span>             sys_rst_n                         <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">reg</span>     <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>   key                               <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// Outputs</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">wire</span>    <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>   led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    sys_clk     <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    sys_rst_n   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    key         <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1110</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key0</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1101</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1011</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key2</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按下 Key3</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token number\">#4000</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    key <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1111</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 按键没按下</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>key_led_controller #<span class=\"token punctuation\">(</span>           <span class=\"token comment\">// 或者 key_led_4 </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">.</span>BLINK_INTERVAL <span class=\"token punctuation\">(</span> BLINK_INTERVAL <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">)</span> u_key_led_4 <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_clk                 <span class=\"token punctuation\">(</span> sys_clk                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_rst_n               <span class=\"token punctuation\">(</span> sys_rst_n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">.</span>key                     <span class=\"token punctuation\">(</span> key                      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">.</span>led                     <span class=\"token punctuation\">(</span> led                      <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>使用方法 2，即对 key_led_controller 进行例化的仿真结果为：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.4.jpg\" title=\"Modelsim 四按键控制LED-仿真结果1\" style=\"max-width: 70%; height: auto;\"></p>\n<p>设置的参数是闪烁间隔为 500ns。由图可见，led 确实比 led_reg 慢了一个时钟周期，且当前按下 key0 有自左向右的流水效果。</p>\n<p>使用方法 1，即对 key_led_4 进行例化的仿真结果为：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.5.jpg\" title=\"Modelsim 四按键控制LED-仿真结果2\" style=\"max-width: 70%; height: auto;\"></p>\n<p>由图可见，按下 key0 和 key1 后出现了理想的流水效果。且时间间隔控制在了设定的 500ns。</p>\n<h1 id=\"进阶功能2\"><a class=\"anchor\" href=\"#进阶功能2\">#</a> 进阶功能 2</h1>\n<p>verilog 实现将轻触开关转为自锁开关的效果，且考虑抖动现象。</p>\n<h2 id=\"实现思路-3\"><a class=\"anchor\" href=\"#实现思路-3\">#</a> 实现思路</h2>\n<h3 id=\"异步实现\"><a class=\"anchor\" href=\"#异步实现\">#</a> 异步实现</h3>\n<ol>\n<li>内部信号定义：</li>\n</ol>\n<p>debounce_cnt：计数器，用于计数连续稳定的时钟周期数，判断按键信号是否消抖。<br />\ndebounce_flag：消抖启动标志。当检测到预期边沿（下降或上升）时，该标志置 1，开始计数。<br />\nstable_flag：信号稳定标志，当计数器达到消抖阈值后，置 1 表示按键状态稳定。<br />\ncheck_neg_flag、check_pos_flag：边沿检测标志，用于交替检测按键下降沿（按下）和上升沿（释放）。初始状态期望下降沿。</p>\n<ol start=\"2\">\n<li>功能模块划分：</li>\n</ol>\n<ul>\n<li>\n<p>异步边沿检测模块：<br />\n在 always @(btn or negedge sys_rst_n) 块中，模块对按键信号进行边沿检测。根据当前按键状态与预期的边沿标志（check_neg_flag 或 check_pos_flag）比较，当按键状态与预期一致时，设置 debounce_flag，同时清除 stable_flag 以便重新开始计数。</p>\n</li>\n<li>\n<p>消抖计数器模块：<br />\n在 always @(posedge sys_clk or negedge sys_rst_n) 块中，模块在系统时钟上升沿计数。当 debounce_flag 有效时，计数器递增；当计数达到 DEBOUNCE_THRESHOLD 时，说明按键信号已经稳定，置 stable_flag 为 1，并将计数器复位；如果按键信号未触发，则始终保持计数器归零，确保只在状态稳定时进行判断。</p>\n</li>\n<li>\n<p>自锁切换逻辑模块：<br />\n在 always @(posedge stable_flag or negedge sys_rst_n) 块中，利用消抖后的稳定信号触发切换逻辑。若当前检测到的是预期的下降沿（即 check_neg_flag 为 1 时），则对输出 toggle_out 取反，完成自锁翻转；同时清除 debounce_flag，并切换边沿检测标志，为下一次按键事件做好准备，实现按下与释放交替检测。</p>\n</li>\n</ul>\n<p>实现的流程图为：</p>\n<iframe id=\"embed_dom\" name=\"embed_dom\" frameborder=\"0\" style=\"display:block;margin: 0px;margin-left: auto;margin-right: auto;width:550px; height:400px;\"  src=\"https://www.processon.com/embed/67d3ad041ca5222c94a0324a\"></iframe>\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.6.jpg\" title=\"自锁开关异步实现\" style=\"max-width: 70%; height: auto;\"> \n<p>预期的波形图：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.8.jpg\" title=\"自锁开关预期波形图（异步）\" style=\"max-width: 70%; height: auto;\"></p>\n<h3 id=\"同步实现\"><a class=\"anchor\" href=\"#同步实现\">#</a> 同步实现</h3>\n<ol>\n<li>\n<p>异步信号同步<br />\n由于 btn 是一个异步输入，为避免亚稳态问题，模块采用两级同步结构（btn_sync 与 btn_sync_d）。通过连续两个时钟周期的同步，保证后续消抖逻辑接收到的是稳定的按键采样信号。</p>\n</li>\n<li>\n<p>计数器机制<br />\n方案一：当同步后的按键信号 btn_sync_d 与当前消抖后的信号 btn_debounced 不一致时，说明按键状态可能发生了变化，消抖计数器 debounce_cnt 开始计数。但如果未计满时两者一致表明是抖动，则清零重新开始计数。<br />\n如果 btn_sync_d 和 btn_debounced 不一致持续了一个消抖时间（即计数到达最大值）（也即，例如，btn_sync_d 完整按下后为低，而 btn_debounced 默认为没按下的高，若不一致时间达到消抖时间，也即确认了完整按下，此时 btn_debounced 翻转或者说赋为 btn_sync_d 的值），此时默认按键状态已经稳定，随后将 btn_debounced 更新为当前采样值，并将计数器清零。<br />\n若当前采样值与 btn_debounced 一致，则计数器保持归零状态，若已达到消抖时间则表示信号稳定，否则表示为信号抖动，都需要使计数器归零，且无需更新 btn_debounced。</p>\n</li>\n</ol>\n<p>方案二：当同步后的按键信号 btn_sync_d 与当前消抖后的信号 btn_debounced 一致时，计数器归零，若不一致，则计数器从 0 递增。当不一致的时间达到消抖时间，表明稳定，更新消抖信号同时清零计数器<br />\n 3. 稳定信号输出<br />\n消抖后的稳定信号 btn_debounced 就代表了经过滤波后真实有效的按键状态，后续自锁逻辑将基于该信号进行边沿检测。</p>\n<ol start=\"4\">\n<li>\n<p>边沿检测：<br />\n为了检测按键的有效触发（例如轻触按键时的下降沿），模块使用寄存器 btn_debounced_last 存储上一个时钟周期的消抖信号。<br />\n在每个时钟周期内，通过比较当前 btn_debounced 与上一周期的 btn_debounced_last，即可检测出从高到低的下降沿。</p>\n</li>\n<li>\n<p>自锁开关逻辑：<br />\n在检测到按键有效下降沿（即 btn_debounced_last 为高而当前 btn_debounced 为低）时，将输出信号 toggle_out 取反，实现自锁状态的翻转。<br />\n这样，每次按键有效触发后，输出状态在高与低之间交替变化，实现自锁开关的功能。</p>\n</li>\n</ol>\n<p>实现的流程图：</p>\n<iframe id=\"embed_dom\" name=\"embed_dom\" frameborder=\"0\" style=\"display:block;margin: 0px;margin-left: auto;margin-right: auto;width:550px; height:400px;\" src=\"https://www.processon.com/embed/67d3ed0017cd0c3f0a3ad54a?cid=67d3ed0017cd0c3f0a3ad54d\"></iframe>\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.7.jpg\" title=\"自锁开关同步实现\" style=\"max-width: 70%; height: auto;\"> \n<h2 id=\"代码实现-3\"><a class=\"anchor\" href=\"#代码实现-3\">#</a> 代码实现</h2>\n<p>实现的 verilog 代码分别如下：</p>\n<div class=\"tab\" data-id=\"id2\" data-title=\"异步实现（优化代码）\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>debounce_opti.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> debounce_opti <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span>  sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span>  sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">input</span>  btn<span class=\"token punctuation\">,</span>         <span class=\"token comment\">// 按键输入（低有效）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> toggle_out  <span class=\"token comment\">// 自锁开关输出</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// -----------------------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 消抖参数定义</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// 这里为了仿真方便使用较低时间 60ns，实际应用时请调高</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.00000006</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// -----------------------------------------</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 内部信号定义</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 消抖计数器，根据阈值选宽度</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 debounce_flag<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 当检测到边沿时置 1，开始计数</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 stable_flag<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 当计数达到阈值，信号稳定后置 1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 check_neg_flag<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 边沿检测标志：预期下降沿时为 1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">reg</span>                 check_pos_flag<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 边沿检测标志：预期上升沿时为 1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// -----------------------------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">// 异步边沿检测（合并 posedge 与 negedge 检测）</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// 当 btn 状态与预期（check_*_flag）相符时，置 debounce_flag 有效</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span>btn <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            debounce_flag   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            check_neg_flag  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 初始状态预期下降沿（按下）</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            check_pos_flag  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            toggle_out      <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 未按下时为高</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>btn <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span> <span class=\"token operator\">&amp;&amp;</span> check_neg_flag<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>btn <span class=\"token operator\">==</span> <span class=\"token number\">1'b1</span> <span class=\"token operator\">&amp;&amp;</span> check_pos_flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                stable_flag   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                debounce_flag <span class=\"token operator\">&lt;=</span> debounce_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                stable_flag   <span class=\"token operator\">&lt;=</span> stable_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token comment\">// 若不满足条件，保持原有 flag 不变</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// -----------------------------------------</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">// 消抖计数器：在系统时钟域内计数</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            stable_flag  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_flag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    stable_flag  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 当输入稳定时，重置计数器</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// -----------------------------------------</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token comment\">// 当消抖计数完成（stable_flag 上升）时，执行自锁切换</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token comment\">// 使用稳定信号作为触发条件保持原有逻辑</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> stable_flag <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            toggle_out     <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            debounce_flag  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            check_neg_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            check_pos_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token comment\">// 若当前是检测下降沿状态，则翻转输出实现自锁切换</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>check_neg_flag <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>check_pos_flag<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>toggle_out<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token comment\">// 清除消抖标志，为下一次检测做准备</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token comment\">// 切换边沿检测标志：交替处理按下和释放</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            check_neg_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>check_neg_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            check_pos_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>check_pos_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id2\" data-title=\"异步实现（初始代码）\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>debounce.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> debounce <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span> sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span> sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">input</span> btn<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> toggle_out</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 消抖参数定义</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// 假设系统时钟为 50MHz，若需要 20ms 的消抖时间，则阈值为：20ms * 50MHz = 1,000,000</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// localparam integer DEBOUNCE_THRESHOLD = 1000000;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.00000006</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 根据阈值选择足够宽度的计数器</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">reg</span> debounce_flag<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 消抖标志位</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">reg</span> stable_flag<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 稳定标志位</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">reg</span> check_neg_flag<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 检测下降沿标志位</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">reg</span> check_pos_flag<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 检测上升沿标志位</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">negedge</span> btn <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 假设未按时为高电平</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 消抖标志位清零</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            check_neg_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 检测下降沿标志位默认为高</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            check_pos_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 检测上升沿标志位默认为低</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>check_neg_flag <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>check_pos_flag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                stable_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">else</span> debounce_flag <span class=\"token operator\">&lt;=</span> debounce_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">end</span>   </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> btn<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span>  </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>check_neg_flag <span class=\"token operator\">&amp;&amp;</span> check_pos_flag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            stable_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">else</span> debounce_flag <span class=\"token operator\">&lt;=</span> debounce_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            stable_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_flag <span class=\"token operator\">==</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    stable_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 信号稳定，清零计数器</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token keyword\">end</span>      </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> stable_flag <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">else</span>    <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>check_neg_flag <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>check_pos_flag<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>toggle_out<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                toggle_out <span class=\"token operator\">&lt;=</span> toggle_out<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            debounce_flag <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            check_neg_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>check_neg_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            check_pos_flag <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>check_pos_flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id2\" data-title=\"同步实现\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>toggle_switch.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Desc: 一个简单的轻触开关消抖与自锁模块 同步设计</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Design Name: toggle_switch</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// File Name: toggle_switch.v</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Function: 轻触开关实现消抖和自锁功能。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.13</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">toggle_switch</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> btn<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 轻触开关原始输入（异步）</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  toggle_out  <span class=\"token comment\">// 自锁输出状态</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD        <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 计算计数器所需位宽。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">// 消抖电路</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_0<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 同步后的按钮信号</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 根据阈值选择足够宽度的计数器</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 消抖后稳定的按钮信号</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// 首先对异步信号进行两级同步（或更多级同步）以防止亚稳态问题</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_1<span class=\"token punctuation\">,</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            btn_sync_0   <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            btn_sync_0   <span class=\"token operator\">&lt;=</span> btn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> btn_sync_0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> btn_sync_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// 消抖逻辑：只有当采样值与稳定值不一致时，计数器开始计数</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            btn_debounced <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 假设未按时为高电平</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_sync_2 <span class=\"token operator\">!=</span> btn_debounced<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token comment\">// 状态不一致，开始计数</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    <span class=\"token comment\">// 达到稳定时间，更新消抖信号</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    btn_debounced <span class=\"token operator\">&lt;=</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token comment\">// 信号稳定，清零计数器</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token comment\">// 边沿检测与自锁功能</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced_last<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            btn_debounced_last <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            btn_debounced_last <span class=\"token operator\">&lt;=</span> btn_debounced<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token comment\">// 自锁输出：检测下降沿（由高到低）有效跳变时，翻转输出状态</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 初始状态可根据需求设定为高或低</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token comment\">// 仅在检测到按下有效边沿（从高到低）时触发翻转</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_debounced_last <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">~</span>btn_debounced<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>toggle_out<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id2\" data-title=\"同步实现2\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: toggle_switch</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: toggle_switch.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 轻触开关实现消抖和自锁功能。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.13</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">toggle_switch</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> btn<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 轻触开关原始输入（异步）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span>  toggle_out  <span class=\"token comment\">// 自锁输出状态</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">;</span>                     <span class=\"token comment\">// 消抖时间（秒）</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">localparam</span> <span class=\"token keyword\">integer</span> DEBOUNCE_THRESHOLD <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> DEBOUNCE_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 消抖计数阈值</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH       <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 计数器所需位宽</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 消抖电路</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_0<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 同步后的按钮信号</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> debounce_cnt<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 递增计数器</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 消抖后稳定的按钮信号</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 多级同步，防止亚稳态问题</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_sync_1<span class=\"token punctuation\">,</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            btn_sync_0 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            btn_sync_0 <span class=\"token operator\">&lt;=</span> btn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            btn_sync_1 <span class=\"token operator\">&lt;=</span> btn_sync_0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            btn_sync_2 <span class=\"token operator\">&lt;=</span> btn_sync_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token comment\">// 消抖逻辑（递增计数器版）</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">// 当采样信号（btn_sync_2）与当前消抖信号（btn_debounced）不同时，</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// 计数器开始递增；如果计数器达到阈值，则更新消抖信号，</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// 否则当采样信号与稳定信号一致时立即清零计数器。</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            btn_debounced <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 假设空闲时按键为高电平</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_sync_2 <span class=\"token operator\">==</span> btn_debounced<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                debounce_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 采样信号与当前稳定状态一致，清零计数器</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">end</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>debounce_cnt <span class=\"token operator\">&lt;</span> DEBOUNCE_THRESHOLD<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    debounce_cnt <span class=\"token operator\">&lt;=</span> debounce_cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 递增计数器</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    <span class=\"token comment\">// 达到稳定时间，更新消抖信号</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    btn_debounced <span class=\"token operator\">&lt;=</span> btn_sync_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    debounce_cnt  <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// 边沿检测与自锁功能</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn_debounced_last<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            btn_debounced_last <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            btn_debounced_last <span class=\"token operator\">&lt;=</span> btn_debounced<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token comment\">// 自锁输出：仅在检测到按下有效边沿（从高到低）时触发翻转</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 初始状态，可根据需求设为高或低</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>btn_debounced_last <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">~</span>btn_debounced<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                toggle_out <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>toggle_out<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<p>对于异步实现的代码，优化后的代码合并了 btn 的 posedge 与 negedge 检测，针对两种情形分别对应着 btn 为低且 check_neg_flag 为高即处于下降沿 以及 btn 为高且 check_pos_flag 为高即处于上升沿，此时对消抖标志置 1 和稳定标志置 0 表示开始进行消抖时间计数。在消抖稳定后计数器清零且标记为稳定，再通过检测 stable_flag 上升沿触发判断条件：如果当前按钮为按下的下降沿则翻转 toggle_out，否则不变。并对消抖标志清零，翻转 check_neg_flag 和 check_pos_flag。</p>\n<p>对于同步实现的代码，则是先对异步的原始按钮信号进行两层同步，再对同步后的第二层信号进行消抖，当消抖计数结束后进行同步状态更新，即得到稳定的消抖后的信号 btn_debounced。再对该信号进行一层同步得到 btn_debounced_last，可知 btn_debounced_last 的状态比 btn_debounced 落后一个时钟周期，那么当 btn_debounced_last 为高但 btn_debounced 为低时，则表明此时为按钮按下的下降沿阶段，翻转 toggle_out。</p>\n<h2 id=\"仿真结果-3\"><a class=\"anchor\" href=\"#仿真结果-3\">#</a> 仿真结果</h2>\n<p>测试的代码为：</p>\n<div class=\"tab\" data-id=\"id3\" data-title=\"异步的tb\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_debounce.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> tb_debounce<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">reg</span> clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">reg</span> rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn<span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 按键输入：低有效表示按下</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">wire</span> toggle_out<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 自锁开关输出状态</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">parameter</span> DEBOUNCE_TIME  <span class=\"token operator\">=</span> <span class=\"token number\">0.00000006</span>  <span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// 实例化待测模块（toggle_switch）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    debounce_opti#<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">.</span>DEBOUNCE_TIME <span class=\"token punctuation\">(</span> DEBOUNCE_TIME <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">)</span>  uut <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">btn</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">toggle_out</span><span class=\"token punctuation\">(</span>toggle_out<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 时钟生成：50MHz, 周期 20ns</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        clk <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">forever</span> <span class=\"token number\">#10</span> clk <span class=\"token operator\">=</span> <span class=\"token operator\">~</span>clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 复位生成及初始按键状态（假设未按下时为高）</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        rst_n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 按键释放</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 100 ns 后解除复位</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        rst_n <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">// 按键信号模拟：包含抖动和按下 / 释放过程</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// 等待复位完成后稍作延时</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">// 第一轮：按下时产生抖动，再稳定为低</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating first button press with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token comment\">// 开始按下：从高到低，期间出现短暂反弹</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 首次下降到低</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 短暂反弹为高</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 再次下降为低</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#3</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 又一次反弹</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 最后稳定为低</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token comment\">// 保持低一段足够时间，确保消抖生效</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token comment\">// 第一轮：释放按键时模拟抖动，再稳定为高</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating first button release with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 首次上升到高</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 短暂反弹为低</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 再次上升为高</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#3</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 又一次反弹</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 最后稳定为高</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token comment\">// 保持高一段时间</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token comment\">// 第二轮：再次按下（含抖动）</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating second button press with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 稳定低</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token comment\">// 第二轮：释放按键（含抖动）</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating second button release with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 稳定高</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token comment\">// 第三轮：长按（无明显抖动）</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating long press (no bounce) at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 按下保持较长时间</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 释放保持较长时间</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token comment\">// 结束仿真</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<div class=\"tab\" data-id=\"id3\" data-title=\"同步的tb\">\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_toggle_switch.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> tb_toggle_switch<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">reg</span> clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">reg</span> rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">reg</span> btn<span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 按键输入：低有效表示按下</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">wire</span> toggle_out<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 自锁开关输出状态</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 实例化待测模块（toggle_switch）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    toggle_switch uut <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">clk</span><span class=\"token punctuation\">(</span>clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">rst_n</span><span class=\"token punctuation\">(</span>rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">btn</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">toggle_out</span><span class=\"token punctuation\">(</span>toggle_out<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 时钟生成：50MHz, 周期 20ns</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        clk <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">forever</span> <span class=\"token number\">#10</span> clk <span class=\"token operator\">=</span> <span class=\"token operator\">~</span>clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">// 复位生成及初始按键状态（假设未按下时为高）</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        rst_n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 按键释放</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 100 ns 后解除复位</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        rst_n <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// -------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 按键信号模拟：包含抖动和按下 / 释放过程</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 等待复位完成后稍作延时</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// 第一轮：按下时产生抖动，再稳定为低</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating first button press with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 开始按下：从高到低，期间出现短暂反弹</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 首次下降到低</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 短暂反弹为高</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 再次下降为低</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#8</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 又一次反弹</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 最后稳定为低</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">// 保持低一段足够时间，确保消抖生效</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token comment\">// 第一轮：释放按键时模拟抖动，再稳定为高</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating first button release with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 首次上升到高</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 短暂反弹为低</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 再次上升为高</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#8</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 又一次反弹</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 最后稳定为高</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token comment\">// 保持高一段时间</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token comment\">// 第二轮：再次按下（含抖动）</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating second button press with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 稳定低</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token comment\">// 第二轮：释放按键（含抖动）</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating second button release with bounce at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#30</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 稳定高</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token number\">#100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token comment\">// 第三轮：长按（无明显抖动）</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Simulating long press (no bounce) at time %0t\"</span><span class=\"token punctuation\">,</span> <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 按下保持较长时间</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        btn <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 释放保持较长时间</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token comment\">// 结束仿真</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token number\">#200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure></div>\n<p>实际上两份测试代码基本相同，只是端口不同懒得换。</p>\n<p>仿真结果：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.9.jpg\" title=\"自锁开关仿真结果（异步）\" style=\"max-width: 70%; height: auto;\"></p>\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.10.jpg\" title=\"自锁开关仿真结果（同步）\" style=\"max-width: 70%; height: auto;\"> \n<p>可以发现基本都和预期一致。toggle_out 在每次开关按下松开后，电平不变，只在再次按下松开才发生变化。</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<ol>\n<li>为什么使用了两级寄存器同步外部按键信号（btn）<br />\n外部按钮信号（btn）通常是异步的，即它的变化不与系统时钟对齐。如果直接将这种异步信号用于同步逻辑，很容易引入亚稳态问题，用两级寄存器同步能降低亚稳态风险。</li>\n</ol>\n<ul>\n<li>一级同步器：当异步信号在时钟边沿采样时，如果恰好在时钟切换附近变化，触发器可能进入亚稳态（输出不确定、延迟很长才能恢复到稳定 0 或 1）。</li>\n<li>两级同步器：第一级触发器采样到的信号可能暂时处于亚稳态状态，但给第二级触发器一个完整的时钟周期，让第一级输出有足够时间恢复到稳定状态。第二级触发器采样后，最终输出就会非常可靠。<br />\n如果只用一级同步器，一旦采样发生在临界时间（时钟边沿附近），触发器可能长时间处于不确定状态，这种亚稳态可能传播到整个设计中，导致系统逻辑错误或不确定行为。</li>\n</ul>\n<p><ins class=\"wavy\">亚稳态是数字电路中一种中间状态，当触发器接收到不符合设定时间（setup 和 hold 时间要求）的输入信号时，输出可能无法立即确定为逻辑高或逻辑低，而在一段时间内徘徊在一个模棱两可的状态，直到最终恢复为稳定的 0 或 1。亚稳态可能导致后续逻辑产生错误，因此必须采取措施（如多级同步）来降低风险。</ins></p>\n<p>触发器（Flip-Flop）是数字电路中的基本存储元件，用于<ins class=\"dot\">在时钟信号控制下采样和存储数据</ins>。每当时钟达到其采样边沿（上升沿或下降沿）时，触发器会 “捕获” 数据输入的状态，并将其输出保持到下一个时钟边沿。触发器对输入信号有一定的时序要求，通常包括 Setup Time（建立时间）和 Hold Time（保持时间）：<br />\n<ins class=\"dot\">建立时间要求在时钟边沿之前，输入数据必须稳定一段时间</ins>；<br />\n<ins class=\"dot\">保持时间要求在时钟边沿之后，输入数据仍需保持不变一段时间</ins>。<br />\n如果异步的按键信号（btn）甚至一级同步后的信号<ins class=\"dot\">在时钟边沿附近发生变化，也就是说，数据变化的时刻接近或违反了建立时间和保持时间要求，触发器可能无法及时、正确地捕获一个确定的逻辑电平，而进入一种称为亚稳态的状态。</ins>这时，触发器的输出可能既不是稳定的 0，也不是 1，而是在一段不确定的时间内徘徊，直到最终恢复到稳定状态，但这恢复时间可能比预期的要长。</p>\n<p>同步信号通常由寄存器产生，这些寄存器只在时钟边沿更新输出。由于数据更新严格依赖时钟，这确保了数据在时钟边沿前后不会出现突然变化，从而有助于满足建立和保持时间。（前提是设计正确且不涉及跨时钟域传输）在 FPGA 设计中，通常会<ins class=\"dot\">为时钟、建立时间和保持时间设置约束</ins>。时序分析工具（如 Xilinx Vivado、Intel Quartus 或 Synopsys PrimeTime）会根据设计的路径延迟、时钟频率、时钟偏移等信息进行静态时序分析，验证是否满足建立时间和保持时间要求。</p>\n<p>假设一个寄存器的建立时间要求为 1ns，保持时间要求为 0.5ns。如果系统时钟为 50MHz（周期 20ns），且数据从前一个寄存器经过组合逻辑到达下一个寄存器，其延迟为 5ns。如果所有的路径延迟（包括寄存器输出延迟、逻辑延迟和走线延迟）保证数据在时钟边沿前至少 1ns 就已经稳定，并在时钟边沿后保持稳定至少 0.5ns，那么这个寄存器就能正确采样数据，不会出现时序违例，也就不会引起亚稳态。</p>\n<ol start=\"2\">\n<li>计数方式<br />\n计数器从 0 开始计数，当满足</li>\n</ol>\n<pre><code>if (debounce_cnt &lt; DEBOUNCE_THRESHOLD) begin\n    debounce_cnt &lt;= debounce_cnt + 1;\nend else begin\n    stable_flag &lt;= 1'b1;\n    debounce_cnt &lt;= 0;\nend\n</code></pre>\n<p>时，实际上计数器经历了 DEBOUNCE_THRESHOLD 个完整的时钟周期。</p>\n<p>而对于</p>\n<pre><code>if (cnt &lt; INTERVAL - 1)\n    cnt &lt;= cnt + 1;\nelse\n    cnt &lt;= 0;\n</code></pre>\n<p>INTERVAL 定义为所需总时钟周期数。</p>\n<p>两者的区别在于：第一份代码中参数直接表示需要计数的周期数，即表示需要再过多少个时钟周期再执行某个任务，所以不需要减 1 即可表示还需要走的时钟周期数，如果想在 60ns 后执行某些任务，则需要经历 3 个时间周期，DEBOUNCE_THRESHOLD 设为 3 即可 (0<sub>1，1</sub>2，2~3)；而第二份代码中参数表示总周期数，即从 0 开始，你想要将整个时钟脉冲按想要的时间间隔分割，例如 50MHz，于是想得到 0.5s 的时间就需要分成 25,000,000 个周期，从 0 到 24,999,999 即为一个时间跨度表示 0.5s，需要减 1。</p>\n<p>补充：对于第一份代码，消抖时间的开始是始于两者状态不一致的条件下，当两者不一致开始计数时，此时 cnt 从 0 加 1 变成 1，消抖时间是从 1<sub>DEBOUNCE_THRESHOLD，而不是 0</sub>DEBOUNCE_THRESHOLD，所以不需要减 1。<br />\n3. 赋值问题<br />\n当某个触发条件下状态更新时，例如：</p>\n<pre><code>    always @(posedge clk or negedge rst_n) begin\n        if (!rst_n) begin\n            btn_sync   &lt;= 1'b1;\n            btn_sync_d &lt;= 1'b1;\n        end else begin\n            btn_sync   &lt;= btn;\n            btn_sync_d &lt;= btn_sync;\n        end\n    end\n</code></pre>\n<p>表示：时钟上升沿到来这一刻，把 btn 前一刻的值赋给 btn_sync，且该值保持接下来一个时钟周期，同理，把 btn_sync 前一刻的值赋给 btn_sync_d，该值保持一个时钟周期。<br />\n所以对于：</p>\n<pre><code>    always @(posedge clk or negedge rst_n) begin\n        if (!rst_n)\n            btn_debounced_last &lt;= 1'b1;\n        else\n            btn_debounced_last &lt;= btn_debounced;\n    end\n</code></pre>\n<p>btn_debounced_last 的状态始终比 btn_debounced 慢一个时钟周期。</p>\n<ol start=\"4\">\n<li>补充：同步问题<br />\n前面的同步代码，当极端情况（可以通过仿真特意设置验证）下，也即原始按键信号的变化刚好发生在时钟边沿时，也即导致亚稳态，此时，一级同步的信号很可能也不能捕获到正确信号（仿真下出现一级同步的信号时钟边沿下同步的信号为 btn 后一刻的状态而不是前一刻的状态。），此时导致后续逻辑出现问题。所以，需要进行三级同步，第三级同步的信号才能正确反映原始的按键信号的状态。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/4.11.jpg\" title=\"自锁开关三级同步\" style=\"max-width: 70%; height: auto;\"></li>\n</ol>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC4%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC4%E5%8D%95%E5%85%83/",
            "title": "单元四——小李的公司生活",
            "date_published": "2025-03-13T10:13:00.000Z",
            "content_html": "<h1 id=\"第十三课机つくえの-上に-本が-三冊さつ-あります\"><a class=\"anchor\" href=\"#第十三课机つくえの-上に-本が-三冊さつ-あります\">#</a> 第十三课：<ruby>机<rp> (</rp><rt>つくえ</rt><rp>)</rp></ruby> の　上に　本が　三<ruby>冊<rp> (</rp><rt>さつ</rt><rp>)</rp></ruby>　あります</h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"名数量-动\"><a class=\"anchor\" href=\"#名数量-动\">#</a> [名 (数量)] + [动]</h3>\n<p>数量词用在动词前面，量词因所修饰的事物种类而不同。</p>\n<p>注：询问数量时，在 “<ruby>何<rp> (</rp><rt>なん</rt><rp>)</rp></ruby>” 的后面加量词，如 “<ruby>何個<rp> (</rp><rt>なんこ</rt><rp>)</rp></ruby>（多少个）”“<ruby>何本<rp> (</rp><rt>なんぼん</rt><rp>)</rp></ruby>（多少根）”“<ruby>何冊<rp> (</rp><rt>なんさつ</rt><rp>)</rp></ruby>（多少本）”。</p>\n<table>\n<thead>\n<tr>\n<th>量词</th>\n<th>使用对象</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>~<ruby> 人<rp> (</rp><rt>にん</rt><rp>)</rp></ruby></td>\n<td>人</td>\n</tr>\n<tr>\n<td>~<ruby> 台<rp> (</rp><rt>だい</rt><rp>)</rp></ruby></td>\n<td>机械或车辆：车、机动车、电脑等</td>\n</tr>\n<tr>\n<td>~<ruby> 枚<rp> (</rp><rt>まい</rt><rp>)</rp></ruby></td>\n<td>薄平物品：纸、盘子、邮票、衬衫等</td>\n</tr>\n<tr>\n<td>~<ruby> 冊<rp> (</rp><rt>さつ</rt><rp>)</rp></ruby></td>\n<td>书、笔记本等</td>\n</tr>\n<tr>\n<td>~<ruby> 歳<rp> (</rp><rt>さい</rt><rp>)</rp></ruby></td>\n<td>年龄</td>\n</tr>\n<tr>\n<td>~<ruby> 回<rp> (</rp><rt>かい</rt><rp>)</rp></ruby></td>\n<td>次数</td>\n</tr>\n<tr>\n<td>~<ruby> 着<rp> (</rp><rt>ちゃく</rt><rp>)</rp></ruby></td>\n<td>衣服等</td>\n</tr>\n<tr>\n<td>~<ruby> 個<rp> (</rp><rt>こ</rt><rp>)</rp></ruby></td>\n<td>立体的物品：鸡蛋、饭团子、球等<br>空容器或器皿：箱子、盒子、空罐、玻璃杯等<br>概念性的、抽象的事物：密码等</td>\n</tr>\n<tr>\n<td>~<ruby> 本<rp> (</rp><rt>ぼん</rt><rp>)</rp></ruby></td>\n<td>细长物品：瓶、铅笔、伞、香蕉等</td>\n</tr>\n<tr>\n<td>~<ruby> 杯<rp> (</rp><rt>はい</rt><rp>)</rp></ruby></td>\n<td>容器内的饮料：茶、咖啡、啤酒等</td>\n</tr>\n<tr>\n<td>~<ruby> 匹<rp> (</rp><rt>ひき</rt><rp>)</rp></ruby></td>\n<td>小动物：狗、猫、昆虫、鱼等</td>\n</tr>\n<tr>\n<td>~<ruby> 頭<rp> (</rp><rt>とう</rt><rp>)</rp></ruby></td>\n<td>大动物：牛、马、象等</td>\n</tr>\n<tr>\n<td>~<ruby> 羽<rp> (</rp><rt>わ</rt><rp>)</rp></ruby></td>\n<td>鸟、兔</td>\n</tr>\n<tr>\n<td>~<ruby> 番<rp> (</rp><rt>ばん</rt><rp>)</rp></ruby></td>\n<td>顺序</td>\n</tr>\n<tr>\n<td>~<ruby> 足<rp> (</rp><rt>そく</rt><rp>)</rp></ruby></td>\n<td>成对物品：鞋、袜子等</td>\n</tr>\n<tr>\n<td>~ つ</td>\n<td>1-9 岁的年龄<br>立体的物品：橘子、帽子等<br>抽象的事物：谜、选项等<br>”~ つ “不用于 10 以上的数字</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"名时间-动\"><a class=\"anchor\" href=\"#名时间-动\">#</a> [名 (时间)] + [动]</h3>\n<p>表示时间数量的词语和动词一起使用时，说明动作、状态的持续时间。这时表示时间数量的词语后面不能加に。<br />\neg: 李さんは　毎日　<ruby>七時間<rp> (</rp><rt>しちじかん</rt><rp>)</rp></ruby>　<ruby>働<rp> (</rp><rt>はたら</rt><rp>)</rp></ruby> きます。  小李每天工作 7 小时。</p>\n<h3 id=\"名时间に-名次数-动\"><a class=\"anchor\" href=\"#名时间に-名次数-动\">#</a> [名 (时间)] に　[名 (次数)] + [动]</h3>\n<p>表示在一定时间内进行若干次动作时，使用该句型。<br />\neg: この　<ruby>花<rp> (</rp><rt>はな</rt><rp>)</rp></ruby> は　<ruby>二年<rp> (</rp><rt>にねん</rt><rp>)</rp></ruby> に　<ruby>一度<rp> (</rp><rt>いちど</rt><rp>)</rp></ruby>　<ruby>咲<rp> (</rp><rt>さ</rt><rp>)</rp> きます<rt></rt></ruby>。    这种花每两年开一次。</p>\n<h3 id=\"名场所へ-动に-行いきます来きます\"><a class=\"anchor\" href=\"#名场所へ-动に-行いきます来きます\">#</a> [名 (场所)] へ　[动] に　<ruby>行<rp> (</rp><rt>い</rt><rp>)</rp></ruby> きます /<ruby> 来<rp> (</rp><rt>き</rt><rp>)</rp></ruby> ます</h3>\n<p>“去某地做某事”。 表示移动行为的目的时使用，句型中表示场所的名词为移动行为的目的地；动词为 “ます形” 去掉 “ます” 的形式，表示移动行为的目的。<br />\neg: 李さんは　私の家　へ　<ruby>遊<rp> (</rp><rt>あそ</rt><rp>)</rp> び<rt></rt></ruby>　に　来ました。 小李来我家玩了。 （遊びます　-&gt; 遊び）</p>\n<h3 id=\"名数量-で\"><a class=\"anchor\" href=\"#名数量-で\">#</a> [名 (数量)] + で</h3>\n<p>用于不称重量而以数个的方式售物。<br />\neg: この　ケーキは　<ruby>三個<rp> (</rp><rt>さんこ</rt><rp>)</rp></ruby> で　<ruby>五百円<rp> (</rp><rt>ごひゃくえん</rt><rp>)</rp></ruby> です。 这种蛋糕 3 个 500 日元。</p>\n<p>不过数量是 1 个时，不加で。<br />\neg: この　ケーキは　<ruby>一個<rp> (</rp><rt>いっこ</rt><rp>)</rp></ruby>　二百円です。     这种蛋糕 1 个 200 日元。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>数的数法<br />\n (1) 数词和量词<br />\n日语中，数词和量词读法会因为组合不同发生变化</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>～つ</th>\n<th>～人</th>\n<th>～台</th>\n<th>～個</th>\n<th>～本</th>\n<th>～杯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>ひとつ</td>\n<td>ひとり</td>\n<td>いちだい</td>\n<td>いっこ</td>\n<td>いっぽん</td>\n<td>いっぱい</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ふたつ</td>\n<td>ふたり</td>\n<td>にだい</td>\n<td>にこ</td>\n<td>にほん</td>\n<td>にはい</td>\n</tr>\n<tr>\n<td>3</td>\n<td>みっつ</td>\n<td>さんにん</td>\n<td>さんだい</td>\n<td>さんこ</td>\n<td>さんぼん</td>\n<td>さんばい</td>\n</tr>\n<tr>\n<td>4</td>\n<td>よっつ</td>\n<td>よにん</td>\n<td>よんだい</td>\n<td>よんこ</td>\n<td>よんほん</td>\n<td>よんはい</td>\n</tr>\n<tr>\n<td>5</td>\n<td>いつつ</td>\n<td>ごにん</td>\n<td>ごだい</td>\n<td>ごこ</td>\n<td>ごほん</td>\n<td>ごはい</td>\n</tr>\n<tr>\n<td>6</td>\n<td>むっつ</td>\n<td>ろくにん</td>\n<td>ろくだい</td>\n<td>ろっこ</td>\n<td>ろっぽん</td>\n<td>ろっぱい</td>\n</tr>\n<tr>\n<td>7</td>\n<td>ななつ</td>\n<td>※なナにん</td>\n<td>ななだい</td>\n<td>ななこ</td>\n<td>ななほん</td>\n<td>ななはい</td>\n</tr>\n<tr>\n<td>8</td>\n<td>やっつ</td>\n<td>はちにん</td>\n<td>はちだい</td>\n<td>はっこ</td>\n<td>はっぽん</td>\n<td>はっぱい</td>\n</tr>\n<tr>\n<td>9</td>\n<td>ここのつ</td>\n<td>きゅうにん</td>\n<td>きゅうだい</td>\n<td>きゅうこ</td>\n<td>きゅうほん</td>\n<td>きゅうはい</td>\n</tr>\n<tr>\n<td>10</td>\n<td>とお</td>\n<td>じゅうにん</td>\n<td>じゅうだい</td>\n<td>じゅっこ</td>\n<td>じゅっぽん</td>\n<td>じゅっぱい</td>\n</tr>\n<tr>\n<td>何</td>\n<td>いくつ</td>\n<td>なんにん</td>\n<td>なんだい</td>\n<td>なんこ</td>\n<td>なんぼん</td>\n<td>なんばい</td>\n</tr>\n</tbody>\n</table>\n<p>(2) <ruby>週に<rp> (</rp><rt>しゅう</rt><rp>)</rp></ruby> に　二<ruby>回<rp> (</rp><rt>かい</rt><rp>)</rp></ruby><br />\n“<ruby>週に<rp> (</rp><rt>しゅう</rt><rp>)</rp></ruby> に　二<ruby>回<rp> (</rp><rt>かい</rt><rp>)</rp></ruby>“ 的完整表达时 “<ruby>一週間<rp> (</rp><rt>いっしゅうかん</rt><rp>)</rp></ruby> に　二回 “，像这样以一定期间为基准计算频率时，常常省略数字”1 “和”<ruby> 間<rp> (</rp><rt>かん</rt><rp>)</rp></ruby>“，而使用”<ruby> 週<rp> (</rp><rt>しゅう</rt><rp>)</rp></ruby> に　~<ruby> 回<rp> (</rp><rt>かい</rt><rp>)</rp></ruby>“的形式。“<ruby>一日<rp> (</rp><rt>いちにち</rt><rp>)</rp> に<rt></rt></ruby>” 变成 “<ruby>日<rp> (</rp><rt>ひ</rt><rp>)</rp> に<rt></rt></ruby>”</p>\n<p>(3) <ruby>生<rp> (</rp><rt>なま</rt><rp>)</rp></ruby> ビールを　<ruby>三<rp> (</rp><rt>みっ</rt><rp>)</rp> つ<rt></rt></ruby>       来三杯生啤<br />\n属于省去量词直接使用 “<ruby>一<rp> (</rp><rt>ひと</rt><rp>)</rp> つ<rt></rt></ruby>　<ruby>二<rp> (</rp><rt>ふた</rt><rp>)</rp> つ<rt></rt></ruby>” 等方式计数的情况。</p>\n<ol start=\"2\">\n<li>\n<p>くらい　/ ぐらい<br />\n在表示数量的词后加 “くらい”“ぐらい” 表示大概的数量。有时还与副词 “<ruby>大体<rp> (</rp><rt>だいたい</rt><rp>)</rp></ruby>” 同时使用。<br />\neg:<br />\n この　パソコンは　いくらでしたか。  这台电脑多少钱买的？<br />\n—— だいたい　<ruby>二十万円<rp> (</rp><rt>にじゅうまんえん</rt><rp>)</rp></ruby> ぐらいです。   大约 20 万日元。</p>\n</li>\n<li>\n<p>どのぐらい　かかりますか<br />\n “かかります” 用于时间和钱，相当于 “需要，花费”。（多少时间，多少钱）<br />\neg:<br />\n 家から　会社まで　どのぐらい　かかりますか。    从你家到公司需要多少时间。<br />\n—— 電車で　一時間ぐらい　かかります。       乘电车需要 1 小时左右。</p>\n</li>\n<li>\n<p>飲みに行きます<br />\n不指明说 “お茶を”“ジュースを”，而只说 飲みに行きます ，则指 “去喝酒”。</p>\n</li>\n<li>\n<p>とりあえず<br />\n从具有可能性的几种动作或事项中，暂且选择一种先做。 “暂且先...”</p>\n</li>\n</ol>\n<h1 id=\"第十四课昨日-デパートへ-行って買かい物ものしました\"><a class=\"anchor\" href=\"#第十四课昨日-デパートへ-行って買かい物ものしました\">#</a> 第十四课：昨日　デパートへ　行って，<ruby>買<rp> (</rp><rt>か</rt><rp>)</rp> い<rt></rt>物<rp> (</rp><rt>もの</rt><rp>)</rp></ruby> しました</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"动て-动-相继发生\"><a class=\"anchor\" href=\"#动て-动-相继发生\">#</a> [动] て　[动]    相继发生</h3>\n<p>表达两个以上的动作按照时间相继发生时，可用 “动词て形 + 动词” 表示。 即用一句话表达连续的动作。<br />\neg: 家へ　帰って，<ruby>宿題<rp> (</rp><rt>しゅくだい</rt><rp>)</rp></ruby> を　します。     回家，（然后）写作业。</p>\n<h3 id=\"动て-から-动-相继发生\"><a class=\"anchor\" href=\"#动て-から-动-相继发生\">#</a> [动] て　から　[动]  相继发生</h3>\n<p>也可以表述两个以上动作按照时间顺序相继发生。，和上一点区别是，“てから” 不能再一个句子中反复使用两次以上。 即上一点可以多个て形连用，这个句型只能使用一次て形。</p>\n<p>eg:<br />\n 図書館へ　行って　本を　<ruby>借<rp> (</rp><rt>か</rt><rp>)</rp> りて<rt></rt></ruby>，家へ　帰ります。    去图书馆借书，（然后）回家。<br />\n<ruby>昼<rp> (</rp><rt>ひる</rt><rp>)</rp></ruby> ご飯を　食べてから　<ruby>出<rp> (</rp><rt>で</rt><rp>)</rp></ruby> かけます。  吃了午饭后出门。</p>\n<h3 id=\"动て-ください\"><a class=\"anchor\" href=\"#动て-ください\">#</a> [动] て  ください</h3>\n<p>请求某人做某事。<br />\neg: ここに　<ruby>住所<rp> (</rp><rt>じゅうしょ</rt><rp>)</rp></ruby> と　<ruby>名前<rp> (</rp><rt>なまえ</rt><rp>)</rp></ruby> を　<ruby>書<rp> (</rp><rt>か</rt><rp>)</rp></ruby> いて　ください。    请在这里填写住址和姓名。</p>\n<h3 id=\"名场所を-动-经过-离开\"><a class=\"anchor\" href=\"#名场所を-动-经过-离开\">#</a> [名 (场所)] を　[动]      经过 离开</h3>\n<p>经过的场所用助词を表示，常用动词有 “<ruby>通<rp> (</rp><rt>とお</rt><rp>)</rp> ります<rt></rt></ruby>”“<ruby>渡<rp> (</rp><rt>わた</rt><rp>)</rp> ります<rt></rt></ruby>”“<ruby>過<rp> (</rp><rt>す</rt><rp>)</rp> ぎます<rt></rt></ruby>” 等。此外，を与动词 “<ruby>出<rp> (</rp><rt>で</rt><rp>)</rp> ます<rt></rt></ruby>”“<ruby>卒業<rp> (</rp><rt>そつぎょう</rt><rp>)</rp></ruby> します” 等搭配使用时，表示离开的场所。<br />\neg:<br />\n この　パスは　<ruby>駅前<rp> (</rp><rt>えきまえ</rt><rp>)</rp></ruby>　を　通ります。  这趟公共汽车经过车站一带。</p>\n<div class=\"note info\">\n<p><ruby>駅前<rp> (</rp><rt>えきまえ</rt><rp>)</rp></ruby> 指车站周围的整个区域。明确表示 “车站前” 时使用 “<ruby>駅<rp> (</rp><rt>えき</rt><rp>)</rp></ruby> の　前”</p>\n</div>\n<p>私は　来年　<ruby>大学<rp> (</rp><rt>だいがく</rt><rp>)</rp></ruby>　を　<ruby>卒業<rp> (</rp><rt>そつぎょう</rt><rp>)</rp></ruby> します。  我明年大学毕业。</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p>句子的连接方式<br />\n “~ て” 是一个连续相继发生动作的形式，但连接太多会使人难以理解，所以一般只连接两项或三项，需要连接更多动作时，使用 “それから”。<br />\neg: 図書館へ　行って，勉強を　します。それから　家へ　帰って，手紙を　書きます。    去图书馆学习。然后回家写信。</p>\n</li>\n<li>\n<p><ruby>買<rp> (</rp><rt>か</rt><rp>)</rp> い<rt></rt>物<rp> (</rp><rt>もの</rt><rp>)</rp></ruby> します [三类动词]<br />\n 一般 “します” 前接汉字或外来词可以构成三类动词。<br />\n这种形式也可以说成 “名词 + を + します”（を可不加。）<br />\neg:<br />\n<ruby> 出張<rp> (</rp><rt>しゅっちょう</rt><rp>)</rp></ruby> します　出差；<ruby>仕事<rp> (</rp><rt>しごと</rt><rp>)</rp></ruby> します    工作    （汉字词）<br />\nジョギングします    慢跑；ファックスします  发传真            （外来词）</p>\n</li>\n<li>\n<p>なかなか 表示程度的副词<br />\n一般用于上级对下级。后续接肯定表达时，表示从自己个人角度看程度属于上乘。<br />\neg: 李さんの　日本語は　なかなか　<ruby>上手<rp> (</rp><rt>じょうず</rt><rp>)</rp></ruby> ですね。   小李的日语相当棒！<br />\n该词含有实际情况比自己预想的程度要高的含义，一般用于说话人预想程度较低时。</p>\n</li>\n<li>\n<p>~ て　くださいませんか<br />\n加 “ませんか” 是更为礼貌的形式，请求某人做某事。</p>\n</li>\n<li>\n<p>もう<br />\n前面学过 “已经” 意思，表示事情已经结束，但还有 “马上，就要” 的意思，此时句尾不是用 “ました”，而是 “ます”。<br />\neg: 李さん，もう　会社を　<ruby>出<rp> (</rp><rt>で</rt><rp>)</rp></ruby> ますか。   小李，这就走吗？</p>\n</li>\n<li>\n<p>すみませんが，~      搭话<br />\n请求别人做某事时，句子前面加 “すみません” 或者 “すみませんが”，表示因占用对方时间而感到过意不去，表示 “麻烦你”“不好意思”。一般家人或亲切的朋友间不怎么使用。</p>\n</li>\n<li>\n<p>そうして　ください<br />\n “请那样做 “。这里的” そう “承接了上面的内容，用于指代前面的内容。    其中涉及变形：そうする　-&gt; そうして<br />\n eg:<br />\n<ruby> 速達<rp> (</rp><rt>そくたつ</rt><rp>)</rp></ruby> で　<ruby>出<rp> (</rp><rt>だ</rt><rp>)</rp></ruby> しますか。      寄快件吗？<br />\n—— ええ，そうして　ください。       对，寄快件。</p>\n</li>\n<li>\n<p>お<ruby>金<rp> (</rp><rt>かね</rt><rp>)</rp></ruby> を　<ruby>下<rp> (</rp><rt>お</rt><rp>)</rp></ruby> ろします<br />\n “<ruby>下<rp> (</rp><rt>お</rt><rp>)</rp></ruby> ろします” 表示将上面的东西取下来，这里意为 “把存在银行或邮局的钱从账户中取出来”。</p>\n</li>\n</ol>\n<h1 id=\"第十五课小野さんは-今-新聞しんぶんを-読よんで-います\"><a class=\"anchor\" href=\"#第十五课小野さんは-今-新聞しんぶんを-読よんで-います\">#</a> 第十五课：小野さんは　今　<ruby>新聞<rp> (</rp><rt>しんぶん</rt><rp>)</rp></ruby> を　<ruby>読<rp> (</rp><rt>よ</rt><rp>)</rp></ruby> んで　います</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"动て-います-正在进行\"><a class=\"anchor\" href=\"#动て-います-正在进行\">#</a> [动] て　います      正在进行</h3>\n<p>表示动作或变化正在进行时。“正在做某事”。<br />\neg: 森さんは　今　仕事を　しています。      森先生正在工作。</p>\n<h3 id=\"动ても-いいです\"><a class=\"anchor\" href=\"#动ても-いいです\">#</a> [动] ても　いいです</h3>\n<p>表示许可时，“可以做某事”。[动] ても　いいですか。　“可以做某事吗？”<br />\neg: 家で　仕事を　しても　いいです。    在家里工作也可以。<br />\n家に　帰っても　いいですか。        可以回家吗？<br />\n—— はい，帰っても　いいです。       是的，可以回家。</p>\n<p>其中，” はい，帰っても　いいです “可以省略为” はい，いいです。“<br />\n表示说话人的许可时，使用 “いですよ”，语气更柔和，读升调，但不用于尊长。</p>\n<h3 id=\"动ては-いけません\"><a class=\"anchor\" href=\"#动ては-いけません\">#</a> [动] ては　いけません</h3>\n<p>表示禁止时，“禁止做某事”。<br />\neg:<br />\n この　部屋に　<ruby>入<rp> (</rp><rt>はい</rt><rp>)</rp></ruby> っては　いけませんか。   不能进这个屋子吗？<br />\n—— はい，入っては　いけません。     是的，不能。<br />\n—— いいえ，入っても　いいです。     不，可以进。<br />\n对尊长一般不用 “~ ては　いけません” 而使用 “~ ないで　ください”。</p>\n<h3 id=\"名附着点に-动\"><a class=\"anchor\" href=\"#名附着点に-动\">#</a> [名 (附着点)] に　[动]</h3>\n<p>表示人或物体的附着点，即人或物体停留在交通工具或椅子上等时，附着点用助词 “に” 表示。<br />\neg: 李さんは　電車に　<ruby>乗<rp> (</rp><rt>の</rt><rp>)</rp></ruby> りました。 小李上了电车。<br />\nこの　いす　に　<ruby>座<rp> (</rp><rt>すわ</rt><rp>)</rp></ruby> って　ください。   请坐在这把椅子上。</p>\n<div class=\"note info\">\n<p>不能用を连接！</p>\n</div>\n<h3 id=\"名目的地-に-动\"><a class=\"anchor\" href=\"#名目的地-に-动\">#</a> [名 (目的地)] に　[动]</h3>\n<p>移动行为的目的地既可以用へ表示，也可以用に表示。<br />\neg: 李さんは　<ruby>病院<rp> (</rp><rt>びょういん</rt><rp>)</rp></ruby>　に　行きます。 小李去医院。</p>\n<p>目前为止：<br />\n“に” 的用法包括：</p>\n<ol>\n<li>表示存在的场所，例如 “公園にベンチがあります”（公园里有长椅）。</li>\n<li>表示时间，例如 “5 時に帰ります”（5 点回家）。</li>\n<li>表示动作的对象，例如 “友達に会います”（和朋友见面）。</li>\n<li>表示移动行为的目的，例如 “本を買いに行きます”（去买书）。</li>\n<li>表示附着点，例如 “車に乗ります”（上车）。</li>\n</ol>\n<p>“に” 和 “へ” 只有在表示 “行きます”（去）、“来ます”（来）、“帰ります”（回来）等典型的移动动词的目的地时才可以通用。</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>请求许可时的回答方式<br />\n (1) 肯定的场合<br />\n对 “~ ても　いいですか” 进行肯定回答时，如果根据自己的心情或判断表示许可时，可以回答 “どうぞ (可以)”“かまいません (没关系)” 等。<br />\n如果不是根据自己的判断，而是基于社会惯例或公共准则进行回答时，可以说 “いいです (可以)”“<ruby>大丈夫<rp> (</rp><rt>だいじょうぶ</rt><rp>)</rp></ruby> です (没关系)” 等。</li>\n</ol>\n<p>(2) 否定的场合<br />\n对 “~ ても　いいですか” 进行否定回答时，如果根据自己的心情或判断表示拒绝时，可以回答 “いえ，ちょっと...(不，有点...)” 婉言拒绝，或者使用 “すみません，~ から (对不起，因为...)” 这种陈述理由的拒绝方式。<br />\n如果是根据法律、规章、社会惯例做出判断时，可以回答 “いけません (不可以)”“だめです (不行)” 等。</p>\n<ol start=\"2\">\n<li>\n<p>もちろんです<br />\n “当然可以”。</p>\n</li>\n<li>\n<p><ruby>無理<rp> (</rp><rt>むり</rt><rp>)</rp></ruby> を　しては　いけませんよ<br />\n “不能勉强”，由 “無理を　します (勉强)” 转换而成。“無理を　します (勉强)” 指行为超过了体力或经济能力的界限，可能给身体或事态造成负面效果。</p>\n</li>\n<li>\n<p>ゆっくり<br />\n表示动作速度慢，还可以表示 “好好地” 的意思。<br />\neg: じゅあ，病院へ　行ってから，ゆっくり　<ruby>休<rp> (</rp><rt>やす</rt><rp>)</rp></ruby> んで　ください。 那么，先去医院，然后好好休息一下。</p>\n</li>\n<li>\n<p><ruby>薬<rp> (</rp><rt>くすり</rt><rp>)</rp></ruby> を　<ruby>出<rp> (</rp><rt>だ</rt><rp>)</rp></ruby> します<br />\n医生在医院或诊所给患者开药方。不能用 “<ruby>売<rp> (</rp><rt>う</rt><rp>)</rp></ruby> ります (卖药)” 或者 “あげます (给药)”，只能 “出します”。</p>\n</li>\n<li>\n<p>お<ruby>大事<rp> (</rp><rt>だいじ</rt><rp>)</rp></ruby> に    寒暄语<br />\n是 “どうぞ　お大事に　してください (请多保重)” 的省略形式，用于对生病或受伤的人表示关心。不能对身体健康的人使用。</p>\n</li>\n</ol>\n<h1 id=\"第十六课ホテルの-部屋は-広ひろくて-明あかるいです\"><a class=\"anchor\" href=\"#第十六课ホテルの-部屋は-広ひろくて-明あかるいです\">#</a> 第十六课：ホテルの　部屋は　<ruby>広<rp> (</rp><rt>ひろ</rt><rp>)</rp></ruby> くて　<ruby>明<rp> (</rp><rt>あか</rt><rp>)</rp></ruby> るいです</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"形1て-形1-并列\"><a class=\"anchor\" href=\"#形1て-形1-并列\">#</a> [形 1] て　[形 1]  并列</h3>\n<p>表示 “又～又～”，两个以上一类形容词并列使用时，使用一类形容词的て形，形 1 变て形是：い -&gt; くて。<br />\neg:<br />\n 明るい　-&gt; 明るくて<br />\n<ruby>新<rp> (</rp><rt>あたら</rt><rp>)</rp></ruby> しい　-&gt; 新しくて</p>\n<p>この　本は　<ruby>安<rp> (</rp><rt>やす</rt><rp>)</rp></ruby> くて　おもしろいです。 这本书又便宜又有意思。</p>\n<p>“[形 1] て　[形 1] ” 也可以用于修饰名词。<br />\neg:<ruby> 軽<rp> (</rp><rt>かる</rt><rp>)</rp></ruby> くて　<ruby>暖<rp> (</rp><rt>あたた</rt><rp>)</rp></ruby> かい　コートを　買いました。   买了一件轻巧又暖和的大衣。</p>\n<h3 id=\"形2で-形2-并列\"><a class=\"anchor\" href=\"#形2で-形2-并列\">#</a> [形 2] で　[形 2]  并列</h3>\n<p>两个以上二类形容词并列使用时，使用二类形容词的て形，形 2 变て形是：直接加で。形 1 和形 2 也可以连接使用。<br />\neg:<br />\n<ruby> 簡単<rp> (</rp><rt>かんたん</rt><rp>)</rp></ruby>　-&gt; 簡単で<br />\n<ruby>親切<rp> (</rp><rt>しんせつ</rt><rp>)</rp></ruby>　-&gt; 親切で</p>\n<p>eg: この　公園は　<ruby>静<rp> (</rp><rt>しず</rt><rp>)</rp></ruby> かで　広いです。     这个公园安静而宽敞。</p>\n<h3 id=\"名1で-名2-并列\"><a class=\"anchor\" href=\"#名1で-名2-并列\">#</a> [名 1] で　[名 2]　并列</h3>\n<p>两个以上的名词并列使用时，用 “[名 1] で　[名 2]” 的形式，名词变て形是：直接加で。<br />\neg: この　<ruby>機械<rp> (</rp><rt>きかい</rt><rp>)</rp></ruby> は　<ruby>日中電気<rp> (</rp><rt>にっちゅうでんき</rt><rp>)</rp></ruby> の　<ruby>製品<rp> (</rp><rt>せいひん</rt><rp>)</rp></ruby> で，<ruby>中国製<rp> (</rp><rt>ちゅうごくせい</rt><rp>)</rp></ruby> です。  这台机器是日中电器公司的产品，是中国制造的。</p>\n<h3 id=\"动て-います-结果状态\"><a class=\"anchor\" href=\"#动て-います-结果状态\">#</a> [动] て　います  结果状态</h3>\n<p>“[动] て　います” 除了表示正在进行，还可表示动作结束后留下的结果状态。<br />\neg: 森さんは　<ruby>車<rp> (</rp><rt>くるま</rt><rp>)</rp></ruby> を　<ruby>持<rp> (</rp><rt>も</rt><rp>)</rp></ruby> って　います。   森先生有辆车。</p>\n<p>对用表示结果状态的 “~ て　います” 提问的句子做否定回答时，使用 “~ て　いません”。但是，对 “<ruby>知<rp> (</rp><rt>し</rt><rp>)</rp></ruby> っていますか” 做否定回答时必须使用 “<ruby>知<rp> (</rp><rt>し</rt><rp>)</rp></ruby> りません（不知道，不认识）”</p>\n<h3 id=\"小句が小句-转折\"><a class=\"anchor\" href=\"#小句が小句-转折\">#</a> [小句] が，[小句]    转折</h3>\n<p>表示两个小句的<mark>转折</mark>关系时，用助词 “が”，相当于 “但是，可是”。<br />\neg: この　レストランは　おいしいですが，ちょっと　<ruby>高<rp> (</rp><rt>たか</rt><rp>)</rp></ruby> いです。    这家餐厅的饭菜好吃，但有点贵。</p>\n<h3 id=\"まだ-动否定\"><a class=\"anchor\" href=\"#まだ-动否定\">#</a> まだ + [动 (否定)]</h3>\n<p>表示还没达到所询问的内容的程度，相当于 “还没有”。<br />\neg:<br />\n 何年ぐらい　日本語を　勉強しましたか。                  学了几年日语？<br />\n—— 二年　勉強しました。でも，まだ　あまり　できません。  学了两年，但还不太会。</p>\n<p>此外，对用 “もう” 提问的句子做否定回答时，使用 “まだ　~ て　いません” 的表达形式。<br />\nもう　結婚していますか。    —— いいえ，まだ　結婚していません。</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li><ruby>背<rp> (</rp><rt>せ</rt><rp>)</rp></ruby> が　<ruby>高<rp> (</rp><rt>たか</rt><rp>)</rp></ruby> くて　<ruby>脚<rp> (</rp><rt>あし</rt><rp>)</rp></ruby> が　<ruby>長<rp> (</rp><rt>なが</rt><rp>)</rp></ruby> くて     相貌身材<br />\n日语中描述人的相貌身材时，身体不为名词与相应的形容词组合如下：</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>身体部位</th>\n<th>形容词</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><ruby>脚<rp> (</rp><rt>あし</rt><rp>)</rp></ruby>／<ruby>指<rp> (</rp><rt>ゆび</rt><rp>)</rp></ruby> 腿 / 指头</td>\n<td><ruby>長<rp> (</rp><rt>なが</rt><rp>)</rp></ruby> い／<ruby>太<rp> (</rp><rt>ふと</rt><rp>)</rp></ruby> い：长 / 粗；<ruby>短<rp> (</rp><rt>みじか</rt><rp>)</rp></ruby> い／<ruby>細<rp> (</rp><rt>ほそ</rt><rp>)</rp></ruby> い：短 / 细</td>\n</tr>\n<tr>\n<td><ruby>足<rp> (</rp><rt>あし</rt><rp>)</rp></ruby> 脚</td>\n<td><ruby>大<rp> (</rp><rt>おお</rt><rp>)</rp></ruby> きい：大；<ruby>小<rp> (</rp><rt>ちい</rt><rp>)</rp></ruby> さい：小</td>\n</tr>\n<tr>\n<td><ruby>目<rp> (</rp><rt>め</rt><rp>)</rp></ruby> 眼睛</td>\n<td>大きい：大；小さい／細い：小</td>\n</tr>\n<tr>\n<td><ruby>鼻<rp> (</rp><rt>はな</rt><rp>)</rp></ruby> 鼻子</td>\n<td>高い：高；低い：低</td>\n</tr>\n<tr>\n<td><ruby>顔<rp> (</rp><rt>かお</rt><rp>)</rp></ruby> 脸</td>\n<td>大きい：大；小さい：小</td>\n</tr>\n<tr>\n<td><ruby>背<rp> (</rp><rt>せ</rt><rp>)</rp></ruby> 个子</td>\n<td>高い：高；<ruby>低<rp> (</rp><rt>ひく</rt><rp>)</rp></ruby> い：矮</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li><ruby>入場料<rp> (</rp><rt>にゅうじょうりょう</rt><rp>)</rp></ruby><ruby> 会費<rp> (</rp><rt>かいひ</rt><rp>)</rp></ruby></li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>费用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>～<ruby>費<rp> (</rp><rt>ひ</rt><rp>)</rp></ruby></td>\n<td><ruby>会費<rp> (</rp><rt>かいひ</rt><rp>)</rp></ruby> 会费、<ruby>光熱費<rp> (</rp><rt>こうねつひ</rt><rp>)</rp></ruby> 照明、供热、供暖费、<ruby>交通費<rp> (</rp><rt>こうつうひ</rt><rp>)</rp></ruby> 交通费、<ruby>食費<rp> (</rp><rt>しょくひ</rt><rp>)</rp></ruby> 伙食费</td>\n</tr>\n<tr>\n<td>～<ruby>料<rp> (</rp><rt>りょう</rt><rp>)</rp></ruby></td>\n<td><ruby>入場料<rp> (</rp><rt>にゅうじょうりょう</rt><rp>)</rp></ruby> 门票费、<ruby>使用料<rp> (</rp><rt>しようりょう</rt><rp>)</rp></ruby> 使用费、<ruby>送料<rp> (</rp><rt>そうりょう</rt><rp>)</rp></ruby> 运费、<ruby>手数料<rp> (</rp><rt>てすうりょう</rt><rp>)</rp></ruby> 手续费</td>\n</tr>\n<tr>\n<td>～<ruby>代<rp> (</rp><rt>だい</rt><rp>)</rp></ruby></td>\n<td><ruby>電気代<rp> (</rp><rt>でんきだい</rt><rp>)</rp></ruby> 电费、<ruby>水道代<rp> (</rp><rt>すいどうだい</rt><rp>)</rp></ruby> 水费、<ruby>タクシー代<rp> (</rp><rt>だい</rt><rp>)</rp></ruby> 出租车费、<ruby>食事代<rp> (</rp><rt>しょくじだい</rt><rp>)</rp></ruby> 餐费</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"3\">\n<li>\n<p><ruby>ID<rp>(</rp><rt>アイディー</rt><rp>)</rp></ruby> カードは　ありますか      （ィ li）<br />\n前面学过的 “あります” 包括：表示存在、表示在某处发生某事，这里表示所有，如果所有的对象是人，则用 “います”。<br />\neg:<br />\n 私は　車が　二<ruby>台<rp> (</rp><rt>だい</rt><rp>)</rp></ruby>　あります。     我有两辆车。<br />\n森さんは　弟が　<ruby>二人<rp> (</rp><rt>ふたり</rt><rp>)</rp></ruby>　います。     森先生有两个弟弟。</p>\n</li>\n<li>\n<p>ちゃんと<br />\n副词，表示 “没错” 或 “处于正常状态”，只用于口语。<br />\neg: 皆さん，机の　上を　ちゃんと　<ruby>片付<rp> (</rp><rt>かたづ</rt><rp>)</rp> けて<rt></rt></ruby> くださいね。    请大家把桌上的东西收拾好。（づ du）</p>\n</li>\n<li>\n<p>ほら<br />\n “你看”，用于提醒别人注意。</p>\n</li>\n<li>\n<p>ずいぶん<br />\n表示程度高，内容上无论是好是坏，用于事态的程度大幅超过说话人自身或者一般性的评判标准。<br />\neg: 李さん，日本語が　ずいぶん　<ruby>上手<rp> (</rp><rt>じょうず</rt><rp>)</rp></ruby> ですね。    小李，你的日语真棒啊。</p>\n</li>\n<li>\n<p><ruby>派手<rp> (</rp><rt>はで</rt><rp>)</rp></ruby><br />\n 形容过分鲜艳的色彩或奇特的形状，“耀眼，花哨”，反义词是 “<ruby>地味<rp> (</rp><rt>じみ</rt><rp>)</rp></ruby>（朴素，质朴）”</p>\n</li>\n<li>\n<p><ruby>嫌<rp> (</rp><rt>きら</rt><rp>)</rp> い<rt></rt></ruby>じゃ　ありません<br />\n表示并不十分喜欢，但也不讨厌，形式是否定的，但语义上是正面、肯定的评价。</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%89)-%E6%B5%81%E6%B0%B4%E7%81%AF%E8%AE%BE%E8%AE%A1/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%89)-%E6%B5%81%E6%B0%B4%E7%81%AF%E8%AE%BE%E8%AE%A1/",
            "title": "FPGA学习(三)-流水灯设计",
            "date_published": "2025-03-11T08:53:00.000Z",
            "content_html": "<h1 id=\"目的\"><a class=\"anchor\" href=\"#目的\">#</a> 目的</h1>\n<ol>\n<li>\n<p>基本功能<br />\n让四位的流水灯能按 0.5s 的时间间隔交替闪烁。</p>\n</li>\n<li>\n<p>进阶功能<br />\n进行参数化，流水灯的位数，闪烁的时间间隔，时钟的频率可以调整。</p>\n</li>\n</ol>\n<h1 id=\"实验设计\"><a class=\"anchor\" href=\"#实验设计\">#</a> 实验设计</h1>\n<p>整个代码的实现思路如下图：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/3.1.jpg\" title=\"流水灯设计\" style=\"max-width: 70%; height: auto;\"></p>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<h2 id=\"基本功能\"><a class=\"anchor\" href=\"#基本功能\">#</a> 基本功能</h2>\n<p>对于基本功能，verilog 代码如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>flow_led.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: flow_led</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: flow_led.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 流水灯，每 0.5s 闪烁一次</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.11</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> flow_led <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_clk<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 系统时钟：50Mhz</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">input</span>           sys_rst_n<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 系统复位信号：低有效</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> led        <span class=\"token comment\">//led 灯输出</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt<span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// 计数器计时 0.5s，已知频率为 50MHz，则周期为 20ns，0.5s=25_000_000*20ns</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">25'd0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">25'd25000_000</span><span class=\"token operator\">-</span><span class=\"token number\">25'd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> cnt <span class=\"token operator\">+</span> <span class=\"token number\">25'd1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">25'd0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">//led 灯闪烁</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> <span class=\"token number\">25'd25000_000</span><span class=\"token operator\">-</span><span class=\"token number\">25'd1</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span>led<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> led<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>相应的测试代码为：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>tb_flow_led.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span> <span class=\"token number\">1</span>ns<span class=\"token operator\">/</span><span class=\"token number\">1</span>ns  <span class=\"token comment\">// Time scale is set to 1ns/1ns</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">tb_flow_led</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">parameter</span> CLK_PERIOD <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 50MHz</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_clk<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">reg</span>         sys_rst_n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 时钟周期为 20ns</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>flow_led u_flow_led <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sys_rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">led</span><span class=\"token punctuation\">(</span>led<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><h2 id=\"进阶功能\"><a class=\"anchor\" href=\"#进阶功能\">#</a> 进阶功能</h2>\n<p>代码实现如下：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"><span>flow_led_withparam.v</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Design Name: flow_led_withparam</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// File Name: flow_led_withparam.v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Function: 通过参数化的方式，将时钟频率、闪烁间隔、LED 灯数量等参数化，使得流水灯模块更具通用性。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Coder: Rei</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Date: 2025.03.11</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//-----------------------------------------------------</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">module</span> flow_led_withparam #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">parameter</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">,</span>                <span class=\"token comment\">// 时钟频率（Hz）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">parameter</span> BLINK_INTERVAL <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>                       <span class=\"token comment\">// 闪烁间隔（秒）</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">parameter</span> LED_NUM         <span class=\"token operator\">=</span> <span class=\"token number\">4</span>                        <span class=\"token comment\">// LED 灯数量</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">input</span>  <span class=\"token keyword\">wire</span> sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> led</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 根据时钟频率和闪烁间隔计算计数上限（单位：时钟周期数）</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">localparam</span> INTERVAL  <span class=\"token operator\">=</span> <span class=\"token keyword\">integer</span>'<span class=\"token punctuation\">(</span>CLK_FREQ <span class=\"token operator\">*</span> BLINK_INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 计算计数器所需位宽。通过计算 INTERVAL 的对数值（以 2 为底）。$clog2 函数返回一个整数值，该值是大于或等于 INTERVAL 的对数值的最小整数。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">localparam</span> CNT_WIDTH <span class=\"token operator\">=</span> <span class=\"token kernel-function property\">$clog2</span><span class=\"token punctuation\">(</span>INTERVAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span>CNT_WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// 计数器：从 0 计数到 INTERVAL-1</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">&lt;</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> cnt <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">// 根据 LED_NUM 是否大于 1 分别处理</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">generate</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>LED_NUM <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> <span class=\"token punctuation\">:</span> gen_single_led</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> led<span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span> <span class=\"token punctuation\">:</span> gen_multiple_leds  <span class=\"token comment\">// LED 状态更新：计数器满时进行一次移位（循环左移）</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span> <span class=\"token operator\">&#123;</span><span class=\"token punctuation\">(</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&#123;</span><span class=\"token number\">1'b0</span><span class=\"token operator\">&#125;&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1'b1</span> <span class=\"token operator\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt <span class=\"token operator\">==</span> INTERVAL <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">&#123;</span> led<span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> led<span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    led <span class=\"token operator\">&lt;=</span> led<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">endgenerate</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>测试代码为：tb_flow_led_withparam.v</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">`timescale</span>  <span class=\"token number\">1</span>ns <span class=\"token operator\">/</span> <span class=\"token number\">1</span>ns</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">module</span> tb_flow_led_withparam<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// flow_led_withparam Parameters</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">parameter</span> PERIOD          <span class=\"token operator\">=</span> <span class=\"token number\">20</span>                            <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">parameter</span> CLK_FREQ        <span class=\"token operator\">=</span> <span class=\"token number\">50_000</span><span class=\"token number\">_000</span>                    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">parameter</span> BLINK_INTERVAL  <span class=\"token operator\">=</span> <span class=\"token number\">0.0000008</span>                     <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">parameter</span> LED_NUM         <span class=\"token operator\">=</span> <span class=\"token number\">5</span>                             <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// flow_led_withparam Inputs</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">reg</span>   sys_clk                              <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">reg</span>   sys_rst_n                            <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// flow_led_withparam Outputs</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">wire</span>  <span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  led                   <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token number\">#200</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    sys_rst_n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">&lt;=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>flow_led_withparam #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">.</span>CLK_FREQ       <span class=\"token punctuation\">(</span> CLK_FREQ       <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">.</span>BLINK_INTERVAL <span class=\"token punctuation\">(</span> BLINK_INTERVAL <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">.</span>LED_NUM        <span class=\"token punctuation\">(</span> LED_NUM        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre> u_flow_led_withparam <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_clk                 <span class=\"token punctuation\">(</span> sys_clk                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">.</span>sys_rst_n               <span class=\"token punctuation\">(</span> sys_rst_n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">.</span>led                     <span class=\"token punctuation\">(</span> led        <span class=\"token punctuation\">[</span>LED_NUM<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//// 调试打印：显示模块内部计算的 INTERVAL 与 CNT_WIDTH 参数值</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">// initial begin</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">//     #10;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">//     $display(\"INTERVAL = %0d, CNT_WIDTH = %0d\", </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">//               u_flow_led_withparam.INTERVAL, </span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">//               u_flow_led_withparam.CNT_WIDTH);</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">// end</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">//// 监控内部计数器 cnt 与 led 的变化</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">// initial begin</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">//     $monitor(\"Time = %0t, cnt = %0d, led = %b\", </span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">//              $time, u_flow_led_withparam.cnt, led);</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">// end</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><h1 id=\"仿真结果\"><a class=\"anchor\" href=\"#仿真结果\">#</a> 仿真结果</h1>\n<p>如下图：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/3.2.jpg\" title=\"Modelsim 仿真结果\" style=\"max-width: 70%; height: auto;\"></p>\n<p>设置的参数是 BLINK_INTERVAL = 0.0000008，LED_NUM = 5 ，即每隔 800ns 闪烁一次，LED 位数为 5，由图可见实现了需求。</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<ol>\n<li>\n<p>对于 LED_NUM 为 1 时，进行了特殊处理，此时该 LED 会按一定间隔闪烁。</p>\n</li>\n<li>\n<p>clog2 函数能用于计算 INTERVAL 的对数值（以 2 为底）。$clog2 函数返回一个整数值，该值是大于或等于 INTERVAL 的对数值的最小整数。换句话说，它计算的是 INTERVAL 需要多少位二进制位来表示，从而确定计数器的位宽。</p>\n</li>\n<li>\n<p>在仿真的测试代码中：always 和 forever 都可以用来创建时钟脉冲，但它们的使用方式和语法略有不同。</p>\n<ul>\n<li>always 块通常用于描述时序逻辑和组合逻辑。它在仿真开始时执行一次，然后在每次触发条件满足时重复执行，例如：</li>\n</ul>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token important\">always</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>此时 always 块的触发条件是时间延迟。具体来说，always 块每隔 CLK_PERIOD/2 时间单位触发一次。</p>\n<ul>\n<li>forever 语句用于在仿真期间无限循环执行某些操作。它通常在初始块中使用，例如：</li>\n</ul>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    sys_clk <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">forever</span> #<span class=\"token punctuation\">(</span>CLK_PERIOD<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> sys_clk <span class=\"token operator\">=</span> <span class=\"token operator\">~</span>sys_clk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure></li>\n</ol>\n<p>最大的区别：always 块独立存在，可以在模块中任何地方使用。而 forever 语句必须在 initial 块中使用。</p>\n<ol start=\"4\">\n<li><code>.led(led)</code>  和 <code>.led(led [LED_NUM-1:0])</code></li>\n</ol>\n<ul>\n<li>.led (led)：直接连接信号到端口，前提是信号的宽度与端口的宽度一致。</li>\n<li>.led (led [LED_NUM-1:0])：明确指定信号的位宽，通常在信号宽度是参数化的情况下使用。</li>\n</ul>\n<ol start=\"5\">\n<li>测试文件里的调试代码<br />\n想要观测某些参数的值以及检测端口的信号等等，可以在代码中加入调试代码，例如：</li>\n</ol>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 调试打印：显示模块内部计算的 INTERVAL 与 CNT_WIDTH 参数值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">#10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token kernel-function property\">$display</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INTERVAL = %0d, CNT_WIDTH = %0d\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>              u_flow_led_withparam<span class=\"token punctuation\">.</span>INTERVAL<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>              u_flow_led_withparam<span class=\"token punctuation\">.</span>CNT_WIDTH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 监控内部计数器 cnt 与 led 的变化</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">initial</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token kernel-function property\">$monitor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Time = %0t, cnt = %0d, led = %b\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>             <span class=\"token kernel-function property\">$time</span><span class=\"token punctuation\">,</span> u_flow_led_withparam<span class=\"token punctuation\">.</span>cnt<span class=\"token punctuation\">,</span> led<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>其中 <code>$display</code>  只会输出一次，而 <code>$monitor</code>  会不断监测信号的值。</p>\n<ol start=\"6\">\n<li>初始值<br />\n代码中：<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sys_rst_n<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ol>\n<p>会使 FPGA 将初始状态定为 4'b0001，这相当于上电后一个初始化复位的过程，所以上电后尽管不按下复位按键，也会有一个灯亮。</p>\n<ol start=\"7\">\n<li>参数定义<br />\n <code>localparam</code>  可以更明确地表达出这个值是一个内部计算的常量，不允许外部覆盖，而  <code>parameter</code>  则允许在例化时进行重写。</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%BA%8C)-Verilog%E8%AF%AD%E6%B3%95/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%BA%8C)-Verilog%E8%AF%AD%E6%B3%95/",
            "title": "FPGA学习(二)-Verilog语法",
            "date_published": "2025-03-09T03:30:00.000Z",
            "content_html": "<h1 id=\"基础知识\"><a class=\"anchor\" href=\"#基础知识\">#</a> 基础知识</h1>\n<h2 id=\"常识\"><a class=\"anchor\" href=\"#常识\">#</a> 常识</h2>\n<p>Verilog 的标识符可以是任意一组字母、数字、$ 和_(下划线) 符号的组合，但标识符的第一个字符必须是字母或者下划线。</p>\n<p>Verilog 数字进制格式包括二进制、八进制、十进制和十六进制，当代码中没有指定数字的位宽与进制时，默认为 32 位的十进制，比如 100，实际上表示的值为 32’d100。</p>\n<p>四种逻辑值：</p>\n<ul>\n<li>逻辑 0：表示低电平，也就是对应我们电路的 GND；</li>\n<li>逻辑 1：表示高电平，也就是对应我们电路的 VCC；</li>\n<li>逻辑 X：表示未知，有可能是高电平，也有可能是低电平；</li>\n<li>逻辑 Z：表示高阻态，外部没有激励信号是一个悬空状态。</li>\n</ul>\n<h2 id=\"数据类型\"><a class=\"anchor\" href=\"#数据类型\">#</a> 数据类型</h2>\n<p>在 Verilog 语法中，主要有三大类数据类型，即寄存器类型、线网类型和参数类型。</p>\n<ol>\n<li>寄存器类型<br />\n寄存器类型表示一个抽象的数据存储单元，它<mark>只能在 always 语句和 initial 语句中被赋值</mark>，并且它的值从一个赋值到另一个赋值过程中被保存下来。如果该过程语句描述的是<ins class=\"wavy\">时序逻辑</ins>，即 always 语句带有时钟信号，则该寄存器变量对应为<ins class=\"wavy\">寄存器</ins>；如果该过程语句描述的是<ins class=\"wavy\">组合逻辑</ins>，即 always 语句不带有时钟信号，则该寄存器变量对应为<ins class=\"wavy\">硬件连线</ins>；寄存器类型的<mark>缺省值是 x（未知状态）</mark>。<br />\n寄存器数据类型有很多种，如 reg、integer、real 等，其中最常用的就是 reg 类型，它的使用方法如下：</li>\n</ol>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//reg define </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  delay_cnt<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 延时计数器 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">reg</span> key_flag <span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 按键标志</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>线网类型<br />\n线网表示 Verilog 结构化元件间的<mark>物理连线</mark>。它的值由驱动元件的值决定，例如连续赋值或门的输出。如果没有驱动元件连接到线网，线网的<mark>缺省值为 z（高阻态）</mark>。<br />\n线网类型同寄存器类型一样也是有很多种，如 tri 和 wire 等，其中最常用的就是 wire 类型，它的使用方法如下：</li>\n</ol>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//wire define </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">wire</span>    data_en<span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 数据使能信号 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">wire</span>    <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  data<span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 数据</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>参数类型<br />\n参数其实就是一个<mark>常量</mark>，常被用于定义状态机的状态、数据位宽和延迟大小等，由于它<ins class=\"wavy\">可以在编译时修改参数的值</ins>，因此它又常被用于一些参数可调的模块中，使用户在实例化模块时，可以根据需要配置参数。在定义参数时，我们可以一次定义多个参数，参数与参数之间需要用逗号隔开。<br />\n这里我们需要注意的是参数的定义是局部的，只在当前模块中有效。它的使用方法如下：</li>\n</ol>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//parameter define </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">parameter</span>   DATA_WIDTH <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 数据位宽为 8 位</span></pre></td></tr></table></figure><h2 id=\"运算符\"><a class=\"anchor\" href=\"#运算符\">#</a> 运算符</h2>\n<p>Verilog 中的运算符按照功能可以分为下述类型：1、算术运算符、 2、关系运算符、3、逻辑运算符、 4、条件运算符、 5、位运算符、 6、移位运算符、 7、拼接运算符。</p>\n<ol>\n<li>算术运算符</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>+</td>\n<td>a + b</td>\n<td>a 加上 b</td>\n</tr>\n<tr>\n<td>-</td>\n<td>a - b</td>\n<td>a 减去 b</td>\n</tr>\n<tr>\n<td>*</td>\n<td>a * b</td>\n<td>a 乘以 b</td>\n</tr>\n<tr>\n<td>/</td>\n<td>a / b</td>\n<td>a 除以 b</td>\n</tr>\n<tr>\n<td>%</td>\n<td>a % b</td>\n<td>a 模除 b</td>\n</tr>\n</tbody>\n</table>\n<p>需要注意：，Verilog 实现乘除比较浪费组合逻辑资源，尤其是除法。一般 2 的指数次幂的乘除法使用移位运算来完成运算，非 2 的指数次幂的乘除法一般是调用现成的 IP，不过 IP 也是由最底层的组合逻辑 (与或非门等) 搭建而成的。<br />\n2. 关系运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&gt;</td>\n<td>a &gt; b</td>\n<td>a 大于 b</td>\n</tr>\n<tr>\n<td>&lt;</td>\n<td>a &lt; b</td>\n<td>a 小于 b</td>\n</tr>\n<tr>\n<td>&gt;=</td>\n<td>a &gt;= b</td>\n<td>a 大于等于 b</td>\n</tr>\n<tr>\n<td>&lt;=</td>\n<td>a &lt;= b</td>\n<td>a 小于等于 b</td>\n</tr>\n<tr>\n<td>==</td>\n<td>a == b</td>\n<td>a 等于 b</td>\n</tr>\n<tr>\n<td>!=</td>\n<td>a != b</td>\n<td>a 不等于 b</td>\n</tr>\n</tbody>\n</table>\n<p>在进行关系运算符时，如果声明的关系是假的，则返回值是 0，如果声明的关系是真的，则返回值是 1；所有的关系运算符有着相同的优先级别，关系运算符的优先级低于算术运算符的优先级。<br />\n3. 逻辑运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>!</td>\n<td>!a</td>\n<td>a 的非，如果 a 为 0，那么 a 的非是 1。</td>\n</tr>\n<tr>\n<td>&amp;&amp;</td>\n<td>a &amp;&amp; b</td>\n<td>a 与上 b，如果 a 和 b 都为 1，a&amp;&amp;b 结果才为 1，表示真。</td>\n</tr>\n<tr>\n<td>||</td>\n<td>a || b</td>\n<td>a 或上 b，如果 a 或者 b 有一个为 1，a||b 结果为 1，表示真。</td>\n</tr>\n</tbody>\n</table>\n<p>逻辑运算符是连接多个关系表达式用的，可实现更加复杂的判断。<br />\n4. 条件运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>?:</td>\n<td>a ? b : c</td>\n<td>如果 a 为真，就选择 b，否则选择 c</td>\n</tr>\n</tbody>\n</table>\n<p>条件操作符一般来构建从两个输入中选择一个作为输出的条件选择结构，功能等同于 always 中的 if-else 语句。<br />\n5. 位运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>~</td>\n<td>~a</td>\n<td>将 a 的每个位进行取反</td>\n</tr>\n<tr>\n<td>&amp;</td>\n<td>a &amp; b</td>\n<td>将 a 的每个位与 b 相同的位进行相与</td>\n</tr>\n<tr>\n<td>|</td>\n<td>a | b</td>\n<td>将 a 的每个位与 b 相同的位进行相或</td>\n</tr>\n<tr>\n<td>^</td>\n<td>a ^ b</td>\n<td>将 a 的每个位与 b 相同的位进行异或</td>\n</tr>\n</tbody>\n</table>\n<p>位运算符是一类最基本的运算符，可以认为它们直接对应数字逻辑中的与、或、非门等逻辑门。位运算符的与、或、非与逻辑运算符逻辑与、逻辑或、逻辑非使用时候容易混淆，<ins class=\"dot\">逻辑运算符一般用在条件判断上</ins>，<ins class=\"dot\">位运算符一般用在信号赋值上</ins>。<br />\n6. 移位运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;&lt;</td>\n<td>a &lt;&lt; b</td>\n<td>将 a 左移 b 位</td>\n</tr>\n<tr>\n<td>&gt;&gt;</td>\n<td>a &gt;&gt; b</td>\n<td>将 a 右移 b 位</td>\n</tr>\n</tbody>\n</table>\n<p>这两种移位运算符都用 0 来填补移出的空位。假设 a 有 8bit 数据位宽，那么 a&lt;&lt;2，表示 a 左移 2bit，a 还是 8bit 数据位宽，a 的最高 2bit 数据被移位丢弃了，最低 2bit 数据固定补 0。如果 a 是 3（二进制：00000011），那么 3 左移 2bit，3&lt;&lt;2，就是 12（二<br />\n进制：00001100）。一般使用<ins class=\"dot\">左移位运算代替乘法</ins>，<ins class=\"dot\">右移位运算代替除法</ins>，但是这种也只能表示 2 的指数<br />\n次幂的乘除法。<br />\n7. 位拼接运算符</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>使用方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>{}</td>\n<td>{a, b}</td>\n<td>将 a 和 b 拼接起来，作为一个新信号</td>\n</tr>\n</tbody>\n</table>\n<p>用这个运算符可以把两个或多个信号的某些位拼接起来进行运算操作。<br />\n8. 运算符的优先级</p>\n<table>\n  <tr>\n    <th>运算符</th>\n    <th>优先级</th>\n  </tr>\n  <tr>\n    <td>!、~</td>\n    <td rowspan=\"11\" style=\"text-align: center; vertical-align: middle;\">逐渐递减</td>\n  </tr>\n  <tr><td>*、/、%</td></tr>\n  <tr><td>+、-</td></tr>\n  <tr><td><<、>></td></tr>\n  <tr><td><、<=、>、>=</td></tr>\n  <tr><td>==、!=、===、!==</td></tr>\n  <tr><td>&</td></tr>\n  <tr><td>^、^~</td></tr>\n  <tr><td>|</td></tr>\n  <tr><td>&&</td></tr>\n  <tr><td>||</td></tr>\n  <tr><td>?</td></tr>\n</table>\n<h1 id=\"程序框架\"><a class=\"anchor\" href=\"#程序框架\">#</a> 程序框架</h1>\n<h2 id=\"注释\"><a class=\"anchor\" href=\"#注释\">#</a> 注释</h2>\n<p>Verilog HDL 中有两种注释的方式，一种是以 “/<em>” 符号开始，“</em>/” 结束，在两个符号之间的语句都是注释语句，因此可扩展到多行。<br />\n另一种是以 // 开头的语句，它表示以 // 开始到本行结束都属于注释语句。</p>\n<h2 id=\"关键字\"><a class=\"anchor\" href=\"#关键字\">#</a> 关键字</h2>\n<ol>\n<li>Verilog 的所有关键字</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>and</th>\n<th>always</th>\n<th>assign</th>\n<th>begin</th>\n<th>buf</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bufif0</td>\n<td>bufif1</td>\n<td>case</td>\n<td>casex</td>\n<td>casez</td>\n</tr>\n<tr>\n<td>cmos</td>\n<td>deassign</td>\n<td>default</td>\n<td>defparam</td>\n<td>disable</td>\n</tr>\n<tr>\n<td>edge</td>\n<td>else</td>\n<td>end</td>\n<td>endcase</td>\n<td>endfunction</td>\n</tr>\n<tr>\n<td>endprimitive</td>\n<td>endmodule</td>\n<td>endspecify</td>\n<td>endtable</td>\n<td>endtask</td>\n</tr>\n<tr>\n<td>event</td>\n<td>for</td>\n<td>force</td>\n<td>forever</td>\n<td>fork</td>\n</tr>\n<tr>\n<td>function</td>\n<td>highz0</td>\n<td>highz1</td>\n<td>if</td>\n<td>ifnone</td>\n</tr>\n<tr>\n<td>initial</td>\n<td>inout</td>\n<td>input</td>\n<td>integer</td>\n<td>join</td>\n</tr>\n<tr>\n<td>large</td>\n<td>macromodule</td>\n<td>medium</td>\n<td>module</td>\n<td>nand</td>\n</tr>\n<tr>\n<td>negedge</td>\n<td>nor</td>\n<td>not</td>\n<td>notif0</td>\n<td>notif1</td>\n</tr>\n<tr>\n<td>nmos</td>\n<td>or</td>\n<td>output</td>\n<td>parameter</td>\n<td>pmos</td>\n</tr>\n<tr>\n<td>posedge</td>\n<td>primitive</td>\n<td>pulldown</td>\n<td>pullup</td>\n<td>pull0</td>\n</tr>\n<tr>\n<td>pull1</td>\n<td>rcmos</td>\n<td>real</td>\n<td>realtime</td>\n<td>reg</td>\n</tr>\n<tr>\n<td>release</td>\n<td>repeat</td>\n<td>rnmos</td>\n<td>rpmos</td>\n<td>rtran</td>\n</tr>\n<tr>\n<td>rtranif0</td>\n<td>rtranif1</td>\n<td>scalared</td>\n<td>small</td>\n<td>specify</td>\n</tr>\n<tr>\n<td>specparam</td>\n<td>strength</td>\n<td>strong0</td>\n<td>strong1</td>\n<td>supply0</td>\n</tr>\n<tr>\n<td>supply1</td>\n<td>table</td>\n<td>task</td>\n<td>tran</td>\n<td>tranif0</td>\n</tr>\n<tr>\n<td>tranif1</td>\n<td>time</td>\n<td>tri</td>\n<td>triand</td>\n<td>trior</td>\n</tr>\n<tr>\n<td>trireg</td>\n<td>tri0</td>\n<td>tri1</td>\n<td>vectored</td>\n<td>wait</td>\n</tr>\n<tr>\n<td>wand</td>\n<td>weak0</td>\n<td>weak1</td>\n<td>while</td>\n<td>wire</td>\n</tr>\n<tr>\n<td>wor</td>\n<td>xnor</td>\n<td>xor</td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>常用关键字</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>关键字</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>module</td>\n<td>模块开始定义</td>\n</tr>\n<tr>\n<td>input</td>\n<td>输入端口定义</td>\n</tr>\n<tr>\n<td>output</td>\n<td>输出端口定义</td>\n</tr>\n<tr>\n<td>inout</td>\n<td>双向端口定义</td>\n</tr>\n<tr>\n<td>parameter</td>\n<td>信号的参数定义</td>\n</tr>\n<tr>\n<td>wire</td>\n<td>wire 信号定义</td>\n</tr>\n<tr>\n<td>reg</td>\n<td>reg 信号定义</td>\n</tr>\n<tr>\n<td>always</td>\n<td>产生 reg 信号语句的关键字</td>\n</tr>\n<tr>\n<td>assign</td>\n<td>产生 wire 信号语句的关键字</td>\n</tr>\n<tr>\n<td>begin</td>\n<td>语句的起始标志</td>\n</tr>\n<tr>\n<td>end</td>\n<td>语句的结束标志</td>\n</tr>\n<tr>\n<td>posedge/negedge</td>\n<td>时序电路的标志</td>\n</tr>\n<tr>\n<td>case</td>\n<td>Case 语句起始标记</td>\n</tr>\n<tr>\n<td>default</td>\n<td>Case 语句的默认分支标志</td>\n</tr>\n<tr>\n<td>endcase</td>\n<td>Case 语句结束标记</td>\n</tr>\n<tr>\n<td>if</td>\n<td>if/else 语句标记</td>\n</tr>\n<tr>\n<td>else</td>\n<td>if/else 语句标记</td>\n</tr>\n<tr>\n<td>for</td>\n<td>for 语句标记</td>\n</tr>\n<tr>\n<td>endmodule</td>\n<td>模块结束定义</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"程序框架-2\"><a class=\"anchor\" href=\"#程序框架-2\">#</a> 程序框架</h2>\n<p>以 LED 流水灯程序为例家展示 Verilog 的程序框架：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">led</span><span class=\"token punctuation\">(</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_clk  <span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 系统时钟 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_rst_n<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 系统复位，低电平有效 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">output</span>  <span class=\"token keyword\">reg</span>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  led         <span class=\"token comment\">//4 位 LED 灯 </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//parameter define </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">parameter</span>  WIDTH     <span class=\"token operator\">=</span> <span class=\"token number\">25</span>        <span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">parameter</span>  COUNT_MAX <span class=\"token operator\">=</span> <span class=\"token number\">25_000</span><span class=\"token number\">_000</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 板载 50M 时钟 = 20ns，0.5s/20ns=25000000，需要 25bit </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                     <span class=\"token comment\">// 位宽 </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//reg define </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">reg</span>    <span class=\"token punctuation\">[</span>WIDTH<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  counter     <span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">reg</span>    <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>        led_ctrl_cnt<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//wire define </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">wire</span>                counter_en  <span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//*********************************************************************************** </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//**                                 main code </span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//*********************************************************************************** </span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// 计数到最大值时产生高电平使能信号 </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">assign</span>  counter_en <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>counter <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>COUNT_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">?</span>  <span class=\"token number\">1'b1</span>  <span class=\"token punctuation\">:</span>  <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                                                                                                             </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// 用于产生 0.5 秒使能信号的计数器 </span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sys_rst_n <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter_en<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> counter <span class=\"token operator\">+</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">//led 流水控制计数器 </span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sys_rst_n <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        led_ctrl_cnt <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter_en<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        led_ctrl_cnt <span class=\"token operator\">&lt;=</span> led_ctrl_cnt <span class=\"token operator\">+</span> <span class=\"token number\">2'b1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">// 通过控制 IO 口的高低电平实现发光二极管的亮灭 </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sys_rst_n <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span>led_ctrl_cnt<span class=\"token punctuation\">)</span>                  </pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token number\">2'd0</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token number\">2'd1</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0010</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token number\">2'd2</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b0100</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token number\">2'd3</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4'b1000</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">default</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">endcase</span> </pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><h1 id=\"高级知识点\"><a class=\"anchor\" href=\"#高级知识点\">#</a> 高级知识点</h1>\n<h2 id=\"阻塞赋值blocking\"><a class=\"anchor\" href=\"#阻塞赋值blocking\">#</a> 阻塞赋值（Blocking）</h2>\n<p>即在一个 always 块中，后面的语句会受到前语句的影响，具体来说，在同一个 always 中，一条阻塞赋值语句如果没有执行结束，那么该语句后面的语句就不能被执行，即被 “阻塞”。也就是说 always 块内的语句是一种顺序关系，符号 “=” 用于阻塞的赋值（如:b = a;），阻塞赋值 “=” 在 begin 和 end 之间的语句是顺序执行，属于串行语句。<br />\n示例：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        c <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        a <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        c <span class=\"token operator\">=</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>在复位的时候（rst_n=0），a=1，b=2，c=3；而结束复位之后（波形图中的 0 时刻），当 clk 的上升沿到来时（波形图中的 2 时刻），a=0，b=0，c=0。这是因为阻塞赋值是在当前语句执行完成之后，才会执行后面的赋值语句，因此首先执行的是 a=0，赋值完成后将 a 的值赋值给 b，由于此时 a 的值已经为 0，所以 b=a=0，最后执行的是将 b 的值赋值给 c，而 b 的值已经赋值为 0，所以 c 的值同样等于 0。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.1.jpg\" title=\"阻塞赋值的信号波形图\" style=\"max-width: 70%; height: auto;\"></p>\n<h2 id=\"非阻塞赋值non-blocking\"><a class=\"anchor\" href=\"#非阻塞赋值non-blocking\">#</a> 非阻塞赋值 (Non-Blocking)</h2>\n<p>符号 “&lt;=” 用于非阻塞赋值（如:b &lt;= a;），非阻塞赋值是由时钟节拍决定，在时钟上升到来时，执行赋值语句右边，然后将 begin-end 之间的所有赋值语句同时赋值到赋值语句的左边，注意：是 begin—end 之间的所有语句，一起执行，且一个时钟只执行一次，属于并行执行语句。<br />\n示例：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        a <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        b <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        c <span class=\"token operator\">&lt;=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     <span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        a <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        b <span class=\"token operator\">&lt;=</span> a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        c <span class=\"token operator\">&lt;=</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span>   </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>在复位的时候（rst_n=0），a=1，b=2，c=3；而结束复位之后（波形图中的 0 时刻），当 clk 的上升沿到来时（波形图中的 2 时刻），a=0，b=1，c=2。这是因为非阻塞赋值在计算 RHS 和更新 LHS 期间，允许其它的非阻塞赋值语句同时计算 RHS 和更新 LHS。<br />\n在波形图中的 2 时刻，RHS 的表达是 0、a、b，分别等于 0、1、2，这三条语句是同时更新 LHS，所以 a、b、c 的值分别等于 0、1、2。再经历一个时钟上升沿，变成 0、0、1，再经历一个，变成 0、0、0。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.2.jpg\" title=\"非阻塞赋值的信号波形图\" style=\"max-width: 70%; height: auto;\"></p>\n<p><strong>总结</strong>：一般在描述组合逻辑电路的时候，使用阻塞赋值，比如 assign 赋值语句和不带时钟的 always 赋值语句，这<br />\n种电路结构只与输入电平的变化有关系。在描述时序逻辑的时候，使用非阻塞赋值，综合成时序逻辑的电路结构，比如带时钟的 always 语句；这种电路结构往往与触发沿有关系，只有在触发沿时才可能发生赋值的变化。</p>\n<h2 id=\"assign-和-always-区别\"><a class=\"anchor\" href=\"#assign-和-always-区别\">#</a> assign 和 always 区别</h2>\n<p>assign 语句使用时不能带时钟。<br />\nalways 语句可以带时钟，也可以不带时钟。在 always 不带时钟时，逻辑功能和 assign 完全一致，都是只产生组合逻辑。<br />\n比较简单的组合逻辑推荐使用 assign 语句，比较复杂的组合逻辑推荐使用 always 语句。</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">assign</span>  counter_en <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>counter <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>COUNT_MAX <span class=\"token operator\">-</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">?</span>  <span class=\"token number\">1'b1</span>  <span class=\"token punctuation\">:</span>  <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span>led_ctrl_cnt<span class=\"token punctuation\">)</span>                  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token number\">2'd0</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token number\">2'd1</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0010</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token number\">2'd2</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0100</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token number\">2'd3</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b1000</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">default</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0000</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">endcase</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h2 id=\"带时钟和不带时钟的always\"><a class=\"anchor\" href=\"#带时钟和不带时钟的always\">#</a> 带时钟和不带时钟的 always</h2>\n<p>always 语句可以带时钟，也可以不带时钟。在 always 不带时钟时，逻辑功能和 assign 完全一致，虽然产生的信号定义还是 reg 类型，但是该语句产生的还是组合逻辑。</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">reg</span>   <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> led； </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span>led_ctrl_cnt<span class=\"token punctuation\">)</span>                  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token number\">2'd0</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0001</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token number\">2'd1</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0010</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token number\">2'd2</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0100</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token number\">2'd3</span>    <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b1000</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">default</span> <span class=\"token punctuation\">:</span> led <span class=\"token operator\">=</span> <span class=\"token number\">4'b0000</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">endcase</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>在 always 带时钟信号时，这个逻辑语句才能产生真正的寄存器，如下示例 counter 就是真正的寄存器。</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 用于产生 0.5 秒使能信号的计数器 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> sys_clk <span class=\"token keyword\">or</span> <span class=\"token keyword\">negedge</span> sys_rst_n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sys_rst_n <span class=\"token operator\">==</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter_en<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1'b0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        counter <span class=\"token operator\">&lt;=</span> counter <span class=\"token operator\">+</span> <span class=\"token number\">1'b1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h2 id=\"latch\"><a class=\"anchor\" href=\"#latch\">#</a> Latch</h2>\n<p>latch 是指锁存器，是一种对<mark>脉冲电平敏感</mark>的存储单元电路。锁存器和寄存器都是基本存储单元，锁存器是<mark>电平触发</mark>的存储器，寄存器是<mark>边沿触发</mark>的存储器。两者的基本功能是一样的，都可以存储数据。锁存器是<mark>组合逻辑</mark>产生的，而寄存器是在<mark>时序电路</mark>中使用，由时钟触发产生的。<br />\nlatch 的主要危害是会产生毛刺（glitch），这种毛刺对下一级电路是很危险的。并且其隐蔽性很强，不易查出。因此，在设计中，应尽量避免 latch 的使用。<br />\n代码里面出现 latch 的两个原因是在组合逻辑中，if 或者 case 语句不完整的描述，比如 if 缺少 else 分支，case 缺少 default 分支，导致代码在综合过程中出现了 latch。解决办法就是 if 必须带 else 分支，case 必须带 default 分支。</p>\n<div class=\"note info\">\n<p>注意：只有不带时钟的 always 语句 if 或者 case 语句不完整才会产生 latch，带时钟的语句 if 或者 case 语句不完整描述不会产生 latch。</p>\n</div>\n<h2 id=\"状态机\"><a class=\"anchor\" href=\"#状态机\">#</a> 状态机</h2>\n<p>Verilog 是硬件描述语言，硬件电路是并行执行的，当需要按照流程或者步骤来完成某个功能时，代码中通常会使用很多个 if 嵌套语句来实现，这样就增加了代码的复杂度，以及降低了代码的可读性，这个时候就可以使用状态机来编写代码。状态机相当于一个控制器，它<ins class=\"wavy\">将一项功能的完成分解为若干步</ins>，每一步对应于二进制的一个状态，通过预先设计的顺序在各状态之间进行转换，状态转换的过程就是实现逻辑功能的过程。<br />\n状态机，全称是有限状态机（Finite State Machine，缩写为 FSM），是一种在有限个状态之间按一定规律转换的时序电路，可以认为是组合逻辑和时序逻辑的一种组合。状态机通过控制各个状态的跳转来控制流程。<br />\n根据状态机的输出是否与输入条件相关，可将状态机分为两大类，即摩尔 (Moore) 型状态机和米勒 (Mealy) 型状态机。</p>\n<ol>\n<li>\n<p>Mealy 状态机：组合逻辑的输出不仅取决于当前状态，还取决于输入状态。<br />\n米勒状态机的模型如下图所示，模型中第一个方框是指产生下一状态的组合逻辑 F，F 是当前状态和输入信号的函数，状态是否改变、如何改变，取决于组合逻辑 F 的输出；第二框图是指状态寄存器，其由一组触发器组成，用来记忆状态机当前所处的状态，状态的改变只发生在时钟的跳边沿；第三个框图是指产生输出的组合逻辑 G，状态机的输出是由输出组合逻辑 G 提供的，G 也是当前状态和输入信号的函数。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.3.jpg\" title=\"Mealy 状态机模型\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n<li>\n<p>Moore 状态机：组合逻辑的输出只取决于当前状态。<br />\n摩尔状态机的模型如下图所示，对比米勒状态机的模型可以发现，其区别在于米勒状态机的输出由当前状态和输入条件决定的，而摩尔状态机的输出只取决于当前状态。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.4.jpg\" title=\"Mealy 状态机模型\" style=\"max-width: 70%; height: auto;\"></p>\n</li>\n<li>\n<p>三段式状态机<br />\n一段式：整个状态机写到一个 always 模块里面，在该模块中既描述状态转移，又描述状态的输入和输出。不推荐采用这种状态机，因为从代码风格方面来讲，一般都会要求把组合逻辑和时序逻辑分开；从代码维护和升级来说，组合逻辑和时序逻辑混合在一起不利于代码维护和修改，也不利于约束。</p>\n</li>\n</ol>\n<p>二段式：用两个 always 模块来描述状态机，其中一个 always 模块采用<mark>同步时序描述状态转移</mark>；另一个模块采用<mark>组合逻辑判断状态转移条件，描述状态转移规律以及输出</mark>。不同于一段式状态机的是，它需要定义两个状态，<mark>现态</mark>和<mark>次态</mark>，然后通过现态和次态的转换来实现时序逻辑。</p>\n<p>三段式：在两个 always 模块描述方法基础上，使用三个 always 模块，一个 always 模块采用同步时序描述状态转移，一个 always 采用组合逻辑判断状态转移条件，描述状态转移规律，另一个 always 模块描述状态输出 (可以用组合电路输出，也可以时序电路输出)。</p>\n<p>实际应用中三段式状态机使用最多，因为三段式状态机将组合逻辑和时序分开，有利于综合器分析优化以及程序的维护；并且三段式状态机将状态转移与状态输出分开，使代码看上去更加清晰易懂，提高了代码的可读性。</p>\n<p>三段式状态机的基本格式是：</p>\n<ul>\n<li>第一个 always 语句实现同步状态跳转；</li>\n<li>第二个 always 语句采用组合逻辑判断状态转移条件；</li>\n<li>第三个 always 语句描述状态输出 (可以用组合电路输出，也可以时序电路输出，一般推荐使用时序电路输出，因为状<br />\n态机的设计和其它设计一样，最好使用同步时序方式设计，以提高设计的稳定性，消除毛刺)。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.5.jpg\" title=\"状态机时序电路输出模型\" style=\"max-width: 70%; height: auto;\"></li>\n</ul>\n<p>优点：采用这种描述方法虽然代码结构复杂了一些，但是这样做的好处是可以有效地<mark>滤去组合逻辑输出的毛刺</mark>，同时也可以更好的<mark>进行时序计算与约束</mark>，另外对于总线形式的输出信号来说，容易使总线数据对齐，减小总线数据间的偏移，从而降低接收端数据采样出错的频率。</p>\n<h2 id=\"模块化设计\"><a class=\"anchor\" href=\"#模块化设计\">#</a> 模块化设计</h2>\n<p>划分模块的基本原则是子模块功能相对独立、模块内部联系尽量紧密、模块间的连接尽量简单。<br />\n在进行模块化设计中，对于复杂的数字系统，我们一般采用自顶向下的设计方式。可以把系统划分成几个功能模块，每个功能模块再划分成下一层的子模块；每个模块的设计对应一个 module，一个 module 设计成一个 Verilog 程序文件。因此，对一个系统的顶层模块，我们采用结构化的设计，即顶层模块分别调用了各个功能模块。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.6.jpg\" title=\"模块化设计框图\" style=\"max-width: 70%; height: auto;\"></p>\n<p>一般整个设计的顶层模块只做例化（调用其它模块），不做逻辑。顶层下面会有模块 A、模块 B、模块 C 等，模块 A/B/C 又可以分多个子模块实现。</p>\n<p>以静态数码管显示实验为例，其顶层模块下有两个子模块：计时模块和数码管静态显示模块。<br />\n计时模块部分代码如下所示：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">time_count</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span> clk<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 时钟信号</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span> rst_n<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 复位信号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> flag <span class=\"token comment\">// 一个时钟周期的复位信号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//parameter define</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">parameter</span> MAX_NUM <span class=\"token operator\">=</span> <span class=\"token number\">25000_000</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 计数器最大计数值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>数码管静态显示模块部分代码如下所示：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">seg_led_static</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span> clk<span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 时钟信号</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span> rst_n<span class=\"token punctuation\">,</span>        <span class=\"token comment\">// 复位信号（低有效）</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">input</span> add_flag<span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 数码管变化的通知信号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> sel<span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 数码管位选</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> seg_led    <span class=\"token comment\">// 数码管段选</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>顶层模块代码如下所示：</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">seg_led_static_top</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span> sys_clk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span> sys_rst_n<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> sel<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">output</span> <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> seg_led</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//parameter define </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">parameter</span>  TIME_SHOW <span class=\"token operator\">=</span> <span class=\"token number\">25'd25000_000</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 数码管变化的时间间隔 0.5s </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//wire define </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">wire</span>    add_flag<span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 数码管变化的通知信号 </span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//***************************************************** </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//**                    main code </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//***************************************************** </span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// 例化计时模块</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>time_count #<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">MAX_NUM</span><span class=\"token punctuation\">(</span>TIME_SHOW<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token function\">u_time_count</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">clk</span><span class=\"token punctuation\">(</span>sys_clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">flag</span><span class=\"token punctuation\">(</span>add_flag<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">// 例化数码管静态显示模块 </span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>seg_led_static u_seg_led_static <span class=\"token punctuation\">(</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">clk</span><span class=\"token punctuation\">(</span>sys_clk <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">rst_n</span><span class=\"token punctuation\">(</span>sys_rst_n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">add_flag</span><span class=\"token punctuation\">(</span>add_flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">sel</span><span class=\"token punctuation\">(</span>sel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">seg_led</span><span class=\"token punctuation\">(</span>seg_led<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">endmodule</span></pre></td></tr></table></figure><p>顶层模块对子模块做例化时，只需要知道子模块的端口信号名，而不用关心子模块内部具体是如何实现的。如果子模块内部使用 parameter 定义了一些参数，Verilog 也支持对参数的例化（也叫参数的传递），即顶层模块可以通过例化参数来修改子模块内定义的参数。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.7.jpg\" title=\"模块的例化\" style=\"max-width: 70%; height: auto;\"></p>\n<p>上图右侧是例化的数码管静态显示模块，子模块名是指被例化模块的模块名，而例化模块名相当于标识，当例化多个相同模块时，可以通过例化名来识别哪一个例化，我们一般命名为 “u_”+“子模块名”。信号列表中 “.” 之后的信号是数码管静态显示模块定义的端口信号，<ins class=\"wavy\">括号内的信号则是顶层模块声明的信号</ins>，这样就将顶层模块的信号与子模块的信号一一对应起来，同时需要注意信号的位宽要保持一致。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/2.8.jpg\" title=\"模块参数的例化\" style=\"max-width: 70%; height: auto;\"></p>\n<p>在对参数进行例化时，在模块名的后面加上 “#”，表示后面跟着的是参数列表。计时模块定义的 MAX_NUM 和顶层模块的 TIME_SHOW 都是等于 25000_000，当在顶层模块定义 TIME_SHOW=12500_000 时，那么子模块的 MAX_NUM 的值实际上是也等于 12500_000。当然即使子模块包含参数，在做模块的例化时也可以不添加对参数的例化，这样的话，子模块的参数值等于该模块内部实际定义的值。</p>\n<div class=\"note info\">\n<p>Verilog 语法中的 localparam 代表的意思同样是参数定义，用法和 parameter 基本一致，区别在于 parameter 定义的参数可以做例化，而 localparam 定义的参数是指本地参数，上层模块不可以对 localparam 定义的参数做例化。</p>\n</div>\n<h1 id=\"编程规范\"><a class=\"anchor\" href=\"#编程规范\">#</a> 编程规范</h1>\n<h2 id=\"工程组织形式\"><a class=\"anchor\" href=\"#工程组织形式\">#</a> 工程组织形式</h2>\n<p>工程的组织形式一般包括如下几个部分，分别是 doc、prj、rtl 和 sim 四个部分。<br />\ndoc：一般存放工程相关的文档，包括该项目用到的 datasheet（数据手册）、设计方案等。<br />\nprj：主要存放工程文件和使用到的一些 IP 文件；<br />\nrtl：主要存放工程的 rtl 代码，这是工程的核心，文件名与 module 名称应当一致，建议按照模块的层次分开存放；<br />\nsim：主要存放工程的仿真代码，复杂的工程里面，仿真也是不可或缺的部分，可以极大减少调试的工作量。</p>\n<h2 id=\"文件头声明\"><a class=\"anchor\" href=\"#文件头声明\">#</a> 文件头声明</h2>\n<p>每一个 Verilog 文件的开头，都必须有一段声明的文字。包括文件的版权，作者，创建日期以及内容介绍等。建议一个.v 只包括一个 module，这样模块会比较清晰易懂。</p>\n<h2 id=\"输入输出定义\"><a class=\"anchor\" href=\"#输入输出定义\">#</a> 输入输出定义</h2>\n<p>定义时一般包括 module 名字、输入输出、信号名字、输出类型、注释。</p>\n<figure class=\"highlight verilog\"><figcaption data-lang=\"verilog\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">module</span> <span class=\"token function\">led</span><span class=\"token punctuation\">(</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_clk  <span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 系统时钟 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">input</span>               sys_rst_n<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 系统复位，低电平有效 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">output</span>  <span class=\"token keyword\">reg</span>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  led         <span class=\"token comment\">//4 位 LED 灯 </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>建议：<br />\n① 一行只定义一个信号；<br />\n② 信号全部对齐；<br />\n③ 同一组的信号放在一起。</p>\n<h2 id=\"parameter定义\"><a class=\"anchor\" href=\"#parameter定义\">#</a> parameter 定义</h2>\n<p>① 一般 parameter 定义放在紧跟着 module 的输入输出定义之后；<br />\n② parameter 等常量命名全部使用大写。</p>\n<h2 id=\"wirereg定义\"><a class=\"anchor\" href=\"#wirereg定义\">#</a> wire/reg 定义</h2>\n<p>① 将 reg 与 wire 的定义放在紧跟着 parameter 之后；<br />\n② 建议具有相同功能的信号集中放在一起；<br />\n③ 信号需要对齐，reg 和位宽需要空 2 格，位宽和信号名字至少空四格；<br />\n④ 位宽使用降序描述，[6:0]；<br />\n⑤ 时钟使用前缀 clk，复位使用后缀 rst，低电平有效则加_n；<br />\n⑥ 不能使用 Verilog 关键字作为信号名字；<br />\n⑦ 一行只定义一个信号。</p>\n<h2 id=\"信号命名\"><a class=\"anchor\" href=\"#信号命名\">#</a> 信号命名</h2>\n<p>① 信号命名需要体现其意义，比如 fifo_wr 代表 FIFO 读写使能；<br />\n② 可以使用 “_” 隔开信号，比如 sys_clk；<br />\n③ 内部信号不要使用大写，也不要使用大小写混合，建议全部使用小写；<br />\n④ 模块名字使用小写；<br />\n⑤ 低电平有效的信号，使用_n 作为信号后缀；<br />\n⑥ 异步信号，使用_a 作为信号后缀；<br />\n⑦ 纯延迟打拍信号使用_dly 作为后缀。</p>\n<h2 id=\"其他注意\"><a class=\"anchor\" href=\"#其他注意\">#</a> 其他注意</h2>\n<p>① 时序逻辑使用非阻塞赋值，组合逻辑使用阻塞赋值。<br />\n② moudle 模块例化使用 u_xx 表示。<br />\n③ 避免产生 Latch 锁存器，比如组合逻辑里面的 if 不带 else 分支、case 缺少 default 语句；</p>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%80)-%E5%85%88%E5%AF%BC%E7%9F%A5%E8%AF%86/",
            "url": "https://ei4869.github.io/miyano/Course-Study/FPGA/FPGA%E5%AD%A6%E4%B9%A0(%E4%B8%80)-%E5%85%88%E5%AF%BC%E7%9F%A5%E8%AF%86/",
            "title": "FPGA学习(一)-先导知识",
            "date_published": "2025-03-08T08:22:00.000Z",
            "content_html": "<h1 id=\"导言\"><a class=\"anchor\" href=\"#导言\">#</a> 导言</h1>\n<p>使用的 FPGA 是 Xilinx 的 ZYNQ 系列。所谓 ZYNQ，就是 PS+PL。其中 PS 为 Process System，一般指 Arm 处理器，PL 为 Programmable Logic，一般指 FPGA。可以说，ZYNQ 是一个基于 Arm 的 SOC (片上系统)。</p>\n<p>一些名词解释：<br />\nASIC (Application Specific Integrated Circuit): 专用集成电路<br />\n SOPC (System On Programmable Chip): 可编程片上系统<br />\n APSOC (All Programmable System On Chip): 全可编程片上系统<br />\n FPGA (Field Programmable Gate Array): 现场可编程门阵列</p>\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/ZYNQ.jpg\" title=\"ZYNQ基本架构\" style=\"max-width: 50%; height: auto;\">\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/PL.jpg\" title=\"PL(FPGA)基本结构\" style=\"max-width: 50%; height: auto;\">\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/PS.jpg\" title=\"PS基本结构\" style=\"max-width: 50%; height: auto;\">\n<p>在 PS 和 PL 之间的主要连接是通过一组 9 个 AXI 接口，每个接口有多个通道组成。这些形成了 PS 内部的互联以及与 PL 的连接，如图所示：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/AXI.jpg\" title=\"PS和PL的AXI互联\" style=\"max-width: 50%; height: auto;\"></p>\n<p>单片机和 FPGA 对比：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>单片机</th>\n<th>FPGA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>类型</td>\n<td>ASIC 微处理器</td>\n<td>半定制电路</td>\n</tr>\n<tr>\n<td>结构</td>\n<td>哈佛 / 冯诺依曼结构</td>\n<td>查找表 (LUT)</td>\n</tr>\n<tr>\n<td>执行方式</td>\n<td>顺序执行</td>\n<td>并行执行</td>\n</tr>\n<tr>\n<td>速度</td>\n<td>慢</td>\n<td>快</td>\n</tr>\n<tr>\n<td>灵活性</td>\n<td>低</td>\n<td>高</td>\n</tr>\n</tbody>\n</table>\n<p>FPGA 特点：硬件可重构、开发周期短（无需流片）、并行执行。</p>\n<h1 id=\"开发知识\"><a class=\"anchor\" href=\"#开发知识\">#</a> 开发知识</h1>\n<ol>\n<li>\n<p>一般的开发流程<br />\n流程如图：<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//FPGA/1.1.jpg\" title=\"FPGA开发流程\" style=\"max-width: 50%; height: auto;\"></p>\n</li>\n<li>\n<p>工程管理<br />\n一般一个项目分为四个子文件夹：doc (存放参考资料、文档手册、流程图等)，rtl (存放编写的.v 代码)，sim (tb 文件夹存放.tb 文件；还有其他仿真文件，一般放在 Modelsim 里选择的 work 文件夹里)，prj (存放 Vivado 的工程文件)。</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "FPGA",
                "课程",
                "FPGA"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC3%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC3%E5%8D%95%E5%85%83/",
            "title": "单元三——小李在箱根",
            "date_published": "2025-03-07T09:49:00.000Z",
            "content_html": "<h1 id=\"第九课四川料理しせんりょうりは-辛からいです\"><a class=\"anchor\" href=\"#第九课四川料理しせんりょうりは-辛からいです\">#</a> 第九课：<ruby>四川料理<rp> (</rp><rt>しせんりょうり</rt><rp>)</rp></ruby> は　<ruby>辛<rp> (</rp><rt>から</rt><rp>)</rp> いです<rt></rt></ruby></h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"名は-形一です\"><a class=\"anchor\" href=\"#名は-形一です\">#</a> [名] は　[形一] です</h3>\n<p>形一是以い结尾的形容词，做谓语时后面加です。</p>\n<h3 id=\"形一-做谓语时的否定形式\"><a class=\"anchor\" href=\"#形一-做谓语时的否定形式\">#</a> [形一] 做谓语时的否定形式</h3>\n<p>い变く再加上ないです或ありません。<br />\neg: 今日は　<ruby>寒<rp> (</rp><rt>さむ</rt><rp>)</rp></ruby> くないです。   今天不冷。</p>\n<p>注：いいです的否定形式是よく　ないです或よく　ありません</p>\n<h3 id=\"形一-做谓语时的过去形式\"><a class=\"anchor\" href=\"#形一-做谓语时的过去形式\">#</a> [形一] 做谓语时的过去形式</h3>\n<p>过去形式是：い变かった再加上です。<br />\n过去否定形式是：い变成く　なったです或者く　ありませんでした。<br />\neg：</p>\n<ul>\n<li><ruby>旅行<rp> (</rp><rt>りょこう</rt><rp>)</rp></ruby> は　<ruby>楽<rp> (</rp><rt>たの</rt><rp>)</rp></ruby> しかったです。（过去）    旅行很愉快。</li>\n<li><ruby>昨日<rp> (</rp><rt>きのう</rt><rp>)</rp></ruby> は　<ruby>寒<rp> (</rp><rt>さむ</rt><rp>)</rp></ruby> くなかったです。 （过去否定）   昨天不冷。</li>\n<li>昨日は　寒くありませんでした。    （更正式的表达）</li>\n</ul>\n<p>注：描述过去体验过的事物的性质时，日语需要用过去形式。<br />\n<ruby>美味<rp> (</rp><rt>おい</rt><rp>)</rp> しいです<rt></rt></ruby>。   (正在吃的时候)<br />\n<ruby> 美味<rp> (</rp><rt>おい</rt><rp>)</rp> しかったです<rt></rt></ruby>。   (吃完以后)</p>\n<p>注：いいです的过去形式是よかったです，过去否定形式是よく　ありませんでした。</p>\n<h3 id=\"形一名\"><a class=\"anchor\" href=\"#形一名\">#</a> [形一]+[名]</h3>\n<p>一类形容词可直接修饰名词。但形容词和名词间不加の。<br />\neg: <ruby>広<rp> (</rp><rt>ひろ</rt><rp>)</rp> い<rt></rt>国<rp> (</rp><rt>くに</rt><rp>)</rp></ruby></p>\n<h3 id=\"を-は\"><a class=\"anchor\" href=\"#を-は\">#</a> を -&gt; は</h3>\n<p>例如：原本应该是コーヒーを　飲みます。但当を前面的名词作为话题时，或用于对比时，变为は。例如谈论喝什么时，可以说コーヒーは 飲みます。</p>\n<p>###　あまり　[形一 / 动 的否定]<br />\n あまり后面一定接否定形式，表示程度不高。<br />\neg: この　スープは　あまり　<ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> く<rt></rt></ruby>　ないです。 这个汤不太热。</p>\n<h3 id=\"表示程度的副词\"><a class=\"anchor\" href=\"#表示程度的副词\">#</a> 表示程度的副词</h3>\n<p>程度比较：とても /<ruby> 大変<rp> (</rp><rt>たいへん</rt><rp>)</rp></ruby> &gt; <ruby>少<rp> (</rp><rt>すこ</rt><rp>)</rp> し<rt></rt></ruby> / ちょっと &gt; あまり (~ ません) &gt; <ruby>全然<rp> (</rp><rt>ぜんぜん</rt><rp>)</rp></ruby>(~ ません)<br />\n 分别是：很，非常 一点儿 不太... 根本不...</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>多<rp> (</rp><rt>おお</rt><rp>)</rp> い<rt></rt></ruby>　和 <ruby>少<rp> (</rp><rt>すく</rt><rp>)</rp> ない<rt></rt></ruby><br />\n不同于其他一类形容词，以上两个不能单独修饰名词。<br />\neg: 公園に　たくさんの　人が　います。  公园里人很多。</p>\n</li>\n<li>\n<p><ruby>子供用<rp> (</rp><rt>こどもよう</rt><rp>)</rp></ruby><br />\n&quot;x <ruby>用<rp> (</rp><rt>よう</rt><rp>)</rp></ruby>&quot; 表示 “x 用的”。如<ruby>子供用<rp> (</rp><rt>こどもよう</rt><rp>)</rp></ruby> 表示 “孩子用的 “。</p>\n</li>\n<li>\n<p>あら<br />\n女性感到惊讶或疑惑使用的词。</p>\n</li>\n<li>\n<p><ruby>熱<rp> (</rp><rt>あつ</rt><rp>)</rp> く<rt></rt></ruby>　ないですか　[否定疑问句]<br />\n 表示 “水不烫吗”，在日语中可以用两种方式回答：<br />\n- はい、熱くないです。   是的，不烫。（对不烫这件事，回答是）<br />\n- いいえ、熱くないです。 不，不烫。（对于烫不烫，回答不）</p>\n</li>\n<li>\n<p>ちょうど　いい<br />\n “正合适”，表示时间或分量合适。</p>\n</li>\n<li>\n<p><ruby>お<rt></rt>湯<rp> (</rp><rt>ゆ</rt><rp>)</rp></ruby>　和 <ruby>水<rp> (</rp><rt>みず</rt><rp>)</rp></ruby><br />\n 日语中，<ruby>お<rt></rt>湯<rp> (</rp><rt>ゆ</rt><rp>)</rp></ruby> 指热水或开水。<ruby>水<rp> (</rp><rt>みず</rt><rp>)</rp></ruby> 仅指凉水。因此可以说 &quot;熱い　お湯（热水）&quot; 和 &quot;<ruby> 冷<rp> (</rp><rt>つめ</rt><rp>)</rp> たい<rt></rt></ruby>　<ruby>水<rp> (</rp><rt>みず</rt><rp>)</rp></ruby>&quot;，但不能说&quot; 熱い <ruby>水<rp> (</rp><rt>みず</rt><rp>)</rp></ruby>&quot;。</p>\n</li>\n<li>\n<p>味道的表达方式<br />\n<ruby>甘<rp> (</rp><rt>あま</rt><rp>)</rp> い<rt></rt></ruby> (甜的)　(<ruby>塩<rp> (</rp><rt>しお</rt><rp>)</rp></ruby>)<ruby> 辛<rp> (</rp><rt>から</rt><rp>)</rp> い<rt></rt></ruby> (咸的)　<ruby>酸<rp> (</rp><rt>す</rt><rp>)</rp> っぱい<rt></rt></ruby> (酸的)　<ruby>辛<rp> (</rp><rt>から</rt><rp>)</rp> い<rt></rt></ruby> (辣的)　<ruby>苦<rp> (</rp><rt>にが</rt><rp>)</rp> い<rt></rt></ruby> (苦的)。<br />\n其中，<ruby>辛<rp> (</rp><rt>から</rt><rp>)</rp> い<rt></rt></ruby>有咸和辣两种意思，需要特别区分时，“咸” 可以说成 &quot;<ruby> 塩<rp> (</rp><rt>しお</rt><rp>)</rp></ruby><ruby> 辛<rp> (</rp><rt>から</rt><rp>)</rp> い<rt></rt></ruby> &quot;或&quot; しょっぱい &quot;，&quot; しょっぱい &quot; 只用于口语。<br />\n此外，おいしい（好吃）和まずい（不好吃）表达的是食物或饮料（包括水）放到口中的感觉，因此可以用于修饰水等表达感觉。</p>\n</li>\n</ol>\n<h1 id=\"第十课京都きょうとの-紅葉もみじは-有名ゆうめいです\"><a class=\"anchor\" href=\"#第十课京都きょうとの-紅葉もみじは-有名ゆうめいです\">#</a> 第十课：<ruby>京都<rp> (</rp><rt>きょうと</rt><rp>)</rp></ruby> の　<ruby>紅葉<rp> (</rp><rt>もみじ</rt><rp>)</rp></ruby> は　<ruby>有名<rp> (</rp><rt>ゆうめい</rt><rp>)</rp></ruby> です</h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"名は-形2ですでした\"><a class=\"anchor\" href=\"#名は-形2ですでした\">#</a> [名] は　[形 2] です / でした</h3>\n<p>二类形容词是不以い结尾的形容词。分别是二类形容词做谓语时的一般形式和过去形式。<br />\neg: この　<ruby>通<rp> (</rp><rt>とお</rt><rp>)</rp> り<rt></rt></ruby>は　<ruby>静<rp> (</rp><rt>しず</rt><rp>)</rp> か<rt></rt></ruby>　です。    这条街很安静。</p>\n<h3 id=\"名は-形2では-ありませんではありませんでした\"><a class=\"anchor\" href=\"#名は-形2では-ありませんではありませんでした\">#</a> [名] は　[形 2] では　ありません / ではありませんでした</h3>\n<p>分别是二类形容词做谓语时的否定形式和过去形式的否定形式。在口语里，では可以说成じゃ。</p>\n<h3 id=\"名は-形2な-名です\"><a class=\"anchor\" href=\"#名は-形2な-名です\">#</a> [名] は　[形 2] な　[名] です</h3>\n<p>二类形容词修饰名词词，用な连接。<br />\neg: <ruby>奈良<rp> (</rp><rt>なら</rt><rp>)</rp></ruby> は　にぎやか　な　<ruby>町<rp> (</rp><rt>まち</rt><rp>)</rp></ruby> では　ありません。 奈良不是热闹的城市。</p>\n<h3 id=\"名でした\"><a class=\"anchor\" href=\"#名でした\">#</a> [名] でした</h3>\n<p>名词做谓语时的过去形式是 “名词 + でした”，否定形式是 “名词 + では (じゃ)　ありませんでした”。<br />\neg: おとといは　<ruby>曇<rp> (</rp><rt>くも</rt><rp>)</rp> り<rt></rt></ruby>　じゃ　ありませんでした。 前天不是阴天。</p>\n<h3 id=\"どんな-名\"><a class=\"anchor\" href=\"#どんな-名\">#</a> どんな　[名]</h3>\n<p>询问人或事物的性质时使用，相当于 “什么样的”。<br />\neg: <ruby>張<rp> (</rp><rt>ちょう</rt><rp>)</rp> さん<rt></rt></ruby>は　どんな　人ですか。  小张是什么样的人？</p>\n<p>注：</p>\n<ul>\n<li>何のなんの　有询问内容和材料两种用法。例如：何の　本ですか　——<ruby> 自動車<rp> (</rp><rt>じどうしゃ</rt><rp>)</rp></ruby> の　本です。 （什么书？—— 关于汽车的书。），这里即询问内容。 再例如：何の　<ruby>料理<rp> (</rp><rt>りょうり</rt><rp>)</rp></ruby> ですか　——<ruby> 魚<rp> (</rp><rt>さかな</rt><rp>)</rp></ruby> の料理です。 （什么菜啊？—— 鱼。），这里即询问材料。</li>\n<li>どんな只用于询问性质。往往用形容词回答。例如：どんな　本ですか　—— おもしろい　本です。 （什么样的书？—— 非常有趣的书。）</li>\n</ul>\n<h3 id=\"どうですか\"><a class=\"anchor\" href=\"#どうですか\">#</a> どうですか</h3>\n<p>用于询问对方对某状态的意见或感想时，如果询问的是现在或未来的事情则用どうですか，询问的是过去的事情时则用どうでしたか。  另外どうですか有时用于劝诱对方进行某动作。</p>\n<h3 id=\"でも-和-そして\"><a class=\"anchor\" href=\"#でも-和-そして\">#</a> でも　和 そして</h3>\n<p>でも表示转折关系，一般用于口语，书面语用しかし。<br />\nそして表示并列关系。</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>綺麗<rp> (</rp><rt>きれい</rt><rp>)</rp></ruby> です<br />\n注意虽然以い结尾，但其实是二类形容词，きれい的い是綺麗汉字读音的一部分。<br />\neg: きれいな　<ruby>服<rp> (</rp><rt>ふく</rt><rp>)</rp></ruby>  漂亮的衣服</p>\n</li>\n<li>\n<p>おとといは　<ruby>雨<rp> (</rp><rt>あめ</rt><rp>)</rp></ruby> でした<br />\n表示 “下雨”“下雪” 等自然现象时，日语里通常用 “<ruby>雨<rp> (</rp><rt>あめ</rt><rp>)</rp></ruby> です”“<ruby>雪<rp> (</rp><rt>ゆき</rt><rp>)</rp></ruby> です”。</p>\n</li>\n<li>\n<p>あれえ<br />\n感到吃惊和意外情不自禁发出的声音。</p>\n</li>\n<li>\n<p>ところで<br />\n转换话题时使用。<br />\neg: ああ、そうですか。ところで、この　<ruby>美術館<rp> (</rp><rt>びじゅつかん</rt><rp>)</rp></ruby> には　どんな<ruby>作品<rp> (</rp><rt>さくひん</rt><rp>)</rp></ruby> が　ありますか。  噢，是吗。哎，请问这个美术馆里都有什么作品？</p>\n</li>\n<li>\n<p><ruby>世界中<rp> (</rp><rt>せかいじゅう</rt><rp>)</rp></ruby><br />\n&quot;[场所]+<ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby>&quot;表示其场所范围内的全部。&quot;[时间 / 期间]+<ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby>&quot;时则用&quot;<ruby> 一<rp> (</rp><rt>いち / ひと</rt><rp>)</rp></ruby>~<ruby> 中<rp> (</rp><rt>じゅう</rt><rp>)</rp></ruby>&quot; 的形式，表示 “在某个期间一直”。</p>\n</li>\n<li>\n<p>形容词 + の<br />\n一般用于避免重复使用词语，用の指代了前面谈话的内容。如：おもしろいのが　ありますよ（还有很有趣的），这里的有趣指的是前面谈到过的雕刻等话题。<br />\n对于二类形容词，要在の前加な，如 “<ruby>簡単<rp> (</rp><rt>かんたん</rt><rp>)</rp></ruby> なの（简单的）”。</p>\n</li>\n</ol>\n<h1 id=\"第十一课小野さんは-歌うたが-好きです\"><a class=\"anchor\" href=\"#第十一课小野さんは-歌うたが-好きです\">#</a> 第十一课：小野さんは　<ruby>歌<rp> (</rp><rt>うた</rt><rp>)</rp></ruby> が　好きです</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"名1は-名2が-形1形2です\"><a class=\"anchor\" href=\"#名1は-名2が-形1形2です\">#</a> [名 1] は　[名 2] が　[形 1]/[形 2] です</h3>\n<p>形容词 1 和形容词 2 为表达情感的形容词。<br />\n名词 1 表示情感的主题，名词 2 表示情感的对象。<br />\neg: <ruby>林<rp> (</rp><rt>はやし</rt><rp>)</rp></ruby> さんは　<ruby>犬<rp> (</rp><rt>いぬ</rt><rp>)</rp></ruby>　が　<ruby>怖<rp> (</rp><rt>こわ</rt><rp>)</rp> い<rt></rt></ruby>です。   林先生害怕狗。</p>\n<h3 id=\"名1は-名2が-分わかりますできます\"><a class=\"anchor\" href=\"#名1は-名2が-分わかりますできます\">#</a> [名 1] は　[名 2] が　<ruby>分<rp> (</rp><rt>わ</rt><rp>)</rp></ruby> かります / できます</h3>\n<p>分かります（明白）　できます（会）　<ruby>上手<rp> (</rp><rt>じょうず</rt><rp>)</rp></ruby> です（擅长）　<ruby>下手<rp> (</rp><rt>へた</rt><rp>)</rp></ruby> です（不擅长（客观上）） <ruby>苦手<rp> (</rp><rt>にがて</rt><rp>)</rp></ruby> です（不擅长（主观情感上）） 等表达能力的词语也可用该句型。<br />\neg: 私は　コンピュータ　が　できません。　  我不会用电脑。</p>\n<h3 id=\"名や-名\"><a class=\"anchor\" href=\"#名や-名\">#</a> [名] や　[名]</h3>\n<p>や也可用于连接名词，但と用于列举所有的项目，や只用于列举许多项目中的两项，相当于 “<sub>呀</sub>什么的”，常与など（等等）呼应使用。<br />\neg: 私は　<ruby>お<rt></rt>店<rp> (</rp><rt>みせ</rt><rp>)</rp></ruby> で　<ruby>野菜<rp> (</rp><rt>やさい</rt><rp>)</rp></ruby> や　<ruby>果物<rp> (</rp><rt>くだもの</rt><rp>)</rp></ruby> などを　買いました。 我在店里买了蔬菜呀水果等等。</p>\n<h3 id=\"~から-和-だから-原因-理由\"><a class=\"anchor\" href=\"#~から-和-だから-原因-理由\">#</a> ~ から　和 だから    [原因、理由]</h3>\n<p>から需要接在表示原因、理由小句的句尾。一般形 1 / 动词 + から。<br />\neg: 森さんは　<ruby>お<rt></rt>酒<rp> (</rp><rt>さけ</rt><rp>)</rp></ruby> が　好きですから、毎日　飲みます。  森先生喜欢喝酒，每天都喝。</p>\n<p>ですから更有礼貌。</p>\n<p>だから是表示原因、理由的连词，相当于 “所以”，一般用在结果的句子的前面。礼貌的说法是ですから。<br />\neg: <ruby>明日<rp> (</rp><rt>あした</rt><rp>)</rp></ruby> は　休みです。ですから、子供と　<ruby>動物園<rp> (</rp><rt>どうぶつえん</rt><rp>)</rp></ruby> へ　行きます。    明天休息，所以我跟孩子去动物园。</p>\n<h3 id=\"表示频率的副词\"><a class=\"anchor\" href=\"#表示频率的副词\">#</a> 表示频率的副词</h3>\n<p>いつも　よく　<ruby>時<rp> (</rp><rt>ときどき</rt><rp>)</rp>々<rt></rt></ruby>　たまに　あまり　<ruby>全然<rp> (</rp><rt>ぜんぜん</rt><rp>)</rp></ruby> 等为表示频率的副词。あまり、全然后面接否定形式。</p>\n<h3 id=\"どうしてですか\"><a class=\"anchor\" href=\"#どうしてですか\">#</a> どうしてですか</h3>\n<p>询问事由时使用，相当于 “为什么”。回答时在谓语后面加から。<br />\neg:<br />\n- ぼくは　<ruby>来月<rp> (</rp><rt>らいげつ</rt><rp>)</rp></ruby>　また　ここへ　来きますよ。    我下个月还来这里。<br />\n- どうしてですか。   为什么？<br />\n- ここで　友達の　<ruby>結婚式<rp> (</rp><rt>けっこんしき</rt><rp>)</rp></ruby> が　ありますから。    因为朋友要在这里举行结婚典礼。</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>僕<rp> (</rp><rt>ぼく</rt><rp>)</rp></ruby><br />\n 男性对关系比较亲密的人自称时使用的第一人称代词。</p>\n</li>\n<li>\n<p>ホテルで　<ruby>写真展<rp> (</rp><rt>しゃしんてん</rt><rp>)</rp></ruby> が　あります<br />\n某处发生某事，某事发生的场所用で。  区分之前：[场所] に　[物] が　あります。</p>\n</li>\n<li>\n<p>いかがですか<br />\n是どうですか的礼貌表达，对上级或长辈使用。表示 “~ 怎么样”。<br />\neg:<br />\n- コーヒーは　いかがですか。<br />\n接受时：どうも  ありがとう　ございます　いただきます。<br />\n拒绝时：今は　<ruby>結構<rp> (</rp><rt>けっこう</rt><rp>)</rp></ruby> です。（现在不用了。）</p>\n</li>\n<li>\n<p>そうですね<br />\n可以表示同意对方提议，也可用在疑问句后面，表示说话人在思考接下来要说的内容。</p>\n</li>\n<li>\n<p><ruby>迷<rp> (</rp><rt>まよ</rt><rp>)</rp> います<rt></rt></ruby><br />\n用于难以立即做出选择的场合。表示犹豫。也可以表示 “迷路”。</p>\n</li>\n<li>\n<p><ruby>気<rp> (</rp><rt>き</rt><rp>)</rp> に<rt></rt></ruby>　<ruby>入<rp> (</rp><rt>い</rt><rp>)</rp></ruby> りました<br />\n相当于 “喜欢”，但不表示自己原有的爱好，仅用于第一次见到时感到中意，对象用が，且只用于朋友或熟人之间。<br />\n表达持续性的爱好用好きです。</p>\n</li>\n</ol>\n<h1 id=\"第十二课李さんは-森さんより-若わかいです\"><a class=\"anchor\" href=\"#第十二课李さんは-森さんより-若わかいです\">#</a> 第十二课：李さんは　森さんより　<ruby>若<rp> (</rp><rt>わか</rt><rp>)</rp> いです<rt></rt></ruby></h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"名1は-名2より-形1形2-です\"><a class=\"anchor\" href=\"#名1は-名2より-形1形2-です\">#</a> [名 1] は　[名 2] より　[形 1]/[形 2] です</h3>\n<p>“名 1 比名 2 更～”。<br />\neg: <ruby>上海<rp> (</rp><rt>シャンハイ</rt><rp>)</rp></ruby> は　<ruby>北京<rp> (</rp><rt>ペキン</rt><rp>)</rp></ruby> より　にぎやかですか。    上海比北京热闹吗？</p>\n<p>程度差异较大时用副词 “ずっと” 强调。<br />\neg: 中国は　日本より　ずっと　<ruby>広<rp> (</rp><rt>ひろ</rt><rp>)</rp> い<rt></rt></ruby>です。       中国比日本辽阔得多。</p>\n<h3 id=\"名1より-名2の-はうが-形1形2です\"><a class=\"anchor\" href=\"#名1より-名2の-はうが-形1形2です\">#</a> [名 1] より　[名 2] の　はうが　[形 1]/[形 2] です</h3>\n<p>“与名 1 相比，名 2 更～”。<br />\neg: <ruby>大阪<rp> (</rp><rt>おおさか</rt><rp>)</rp></ruby> より　<ruby>東京<rp> (</rp><rt>とうきょう</rt><rp>)</rp></ruby> の　ほうが　にぎやかですか。  与大阪相比，东京更热闹吗？</p>\n<h3 id=\"名1は-名2ほど-形1く-ないです形2では-ありません\"><a class=\"anchor\" href=\"#名1は-名2ほど-形1く-ないです形2では-ありません\">#</a> [名 1] は [名 2] ほど [形 1] く ないです /[形 2] では　ありません</h3>\n<p>“名 1 没有名 2 那么～”。<br />\neg: 東京の　<ruby>冬<rp> (</rp><rt>ふゆ</rt><rp>)</rp></ruby> は　北京の　冬ほど　寒く　ないです。   东京的冬天没有北京的冬天那么冷。（形 1）<br />\n<ruby>神戸<rp> (</rp><rt>こうべ</rt><rp>)</rp></ruby> は　大阪　ほど　にぎやか　ではありません。     神户没有大阪那么繁华。 （形 2）</p>\n<h3 id=\"名1の-中なかで-名2が-一番いちばん-形1形2です\"><a class=\"anchor\" href=\"#名1の-中なかで-名2が-一番いちばん-形1形2です\">#</a> [名 1] の　<ruby>中<rp> (</rp><rt>なか</rt><rp>)</rp></ruby> で　[名 2] が　<ruby>一番<rp> (</rp><rt>いちばん</rt><rp>)</rp></ruby>　[形 1]/[形 2] です</h3>\n<p>“在名 1 中，名 2 是最～的”。<br />\neg: 日本<ruby>料理<rp> (</rp><rt>りょうり</rt><rp>)</rp></ruby> の　中で　<ruby>寿司<rp> (</rp><rt>すし</rt><rp>)</rp></ruby> が　いちばん　おいしいです。     日式饭菜中，寿司最好吃。</p>\n<p>注：如果 名词 1 表示场所或时间，则后面不加 “の　<ruby>中<rp> (</rp><rt>なか</rt><rp>)</rp></ruby>”，而使用 “[名 1 (场所、时间)] で　いちばん　[形 1 / 形 2] [名 2] は　[名 3]　です”。　　表示：在 场所 / 时间 ，最～的名 2 是名 3。<br />\neg: 日本で　いちばん　<ruby>高<rp> (</rp><rt>たか</rt><rp>)</rp> い<rt></rt></ruby>　<ruby>山<rp> (</rp><rt>やま</rt><rp>)</rp></ruby> は　<ruby>富士山<rp> (</rp><rt>ふじさん</rt><rp>)</rp></ruby> です。   日本最高的山是富士山。</p>\n<p>注：日语中的 “いちばん” 只能用于 “~ の　中で”　“~ で” 等明确指出比较对象和范围的情况。</p>\n<h3 id=\"名1と-名2と-どちらが-形1形2ですか\"><a class=\"anchor\" href=\"#名1と-名2と-どちらが-形1形2ですか\">#</a> [名 1] と　[名 2] と　どちらが　[形 1]/[形 2] ですか</h3>\n<p>询问两种事物当中哪一种更<sub>怎么样。“どちら” 是两者二选一时使用的疑问词，回答时使用 “</sub>の　ほうが...”。如果两者程度相当，则使用 “どちらも　~ です”。“どちら” 在口语中可说成 “どっち”。<br />\neg:<br />\n- 日本語と　英語と　どちらが　<ruby>難<rp> (</rp><rt>むずか</rt><rp>)</rp> しい<rt></rt></ruby>ですか。 日语和英语，哪个难学？<br />\n—— 日本語の　ほうが　難しいです。　  日语难学。</p>\n<p>询问的范围为两种事物时，无论是人是物还是时间，都可用 “どちらが”。但询问的范围为三种以上的事物时，不能用 “どちら”。</p>\n<h3 id=\"どの-名-いつどれだれ何なに-が-いちばん-形1形2ですか\"><a class=\"anchor\" href=\"#どの-名-いつどれだれ何なに-が-いちばん-形1形2ですか\">#</a> どの　[名] / いつ / どれ / だれ /<ruby> 何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> 　が　いちばん　[形 1]/[形 2] ですか</h3>\n<p>询问三个以上事物中哪个最～时，根据询问对象不同需要区分：是人则使用 “だれが”，是物则使用 “どの　~ が” “どれが” 或者 “何が”，是时间则使用 “いつが”。<br />\neg：<br />\n- この　中で　どの　料理　が　いちばん　おいしいですか。     在这些菜当中，哪个菜最好吃？<br />\n—— この　料理　が　いちばん　おいしいです。             这个菜最好吃。</p>\n<p>-<ruby> 季節<rp> (</rp><rt>きせつ</rt><rp>)</rp></ruby> の　中で　いつが　いちばん　好きですか。      四个季节当中，你最喜欢哪一个？<br />\n——　私は　<ruby>春<rp> (</rp><rt>はる</rt><rp>)</rp></ruby>　が　いちばん　好きです。           我喜欢春天。</p>\n<p>被选择的事物已见于上下文或存在于眼前时，使用 “どの　～が” 或 “どれが”，反之则使用 “何が”。<br />\neg: リンゴと　ナシと　バナナの　中で　どれが　いちばん　好きですか。    苹果、梨和香蕉当中你最喜欢什么？</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>最近<rp> (</rp><rt>さいきん</rt><rp>)</rp></ruby><br />\n 表示从较近的过去到现在为止的一段时间。由于是说话人自己的判断，所以所指时间长短因人而异。且 “<ruby>最近<rp> (</rp><rt>さいきん</rt><rp>)</rp></ruby>” 不能表示将来的时间。<br />\neg: 最近　<ruby>十年間<rp> (</rp><rt>じゅうねんかん</rt><rp>)</rp></ruby> は　<ruby>元気<rp> (</rp><rt>げんき</rt><rp>)</rp></ruby> でした。  最近 10 年身体都很好。</p>\n</li>\n<li>\n<p>~ か　いいです<br />\n根据上下文判断意思，例如：<br />\n-<ruby> 箱根<rp> (</rp><rt>はこね</rt><rp>)</rp></ruby> の　<ruby>お<rt></rt>土産<rp> (</rp><rt>みやげ</rt><rp>)</rp></ruby> は　何が　いいですか。   箱根的礼品什么好？<br />\n—— <ruby>寄木細工<rp> (</rp><rt>よせぎざい</rt><rp>)</rp></ruby> が　いいです。      木片儿拼花工艺品比较好。      （表示选择）</p>\n</li>\n</ol>\n<p>- 私は　<ruby>肉<rp> (</rp><rt>にく</rt><rp>)</rp></ruby> より　<ruby>魚<rp> (</rp><rt>さかな</rt><rp>)</rp></ruby>　ほうが　いいです。   比起肉来我更喜欢吃鱼。 （表示喜欢）</p>\n<ol start=\"3\">\n<li>\n<p>やっぱり<br />\n是 “やはり” 较随便的说法，表示 “正如自己预料的那样”。也可表示 “预测了各种各样的结局，结果还是～” 的意思，表示经过一番考虑确定了某个想法。</p>\n</li>\n<li>\n<p>~ が...   [说半句话时]<br />\n 话不说完，用が结尾，通常在遇到难以启齿的事或拒绝别人的请求时这样做，给对方委婉、含蓄的印象。<br />\neg: あのう、それは　私の　<ruby>席<rp> (</rp><rt>せき</rt><rp>)</rp></ruby> ですが...        对不起，那是我的座位......<br />\n 也可用于补充和前面所说内容有出入的情况。<br />\neg: どちらが　おいしいですか。　——　どちらも　おいしいですよ。私は　ジャスミン<ruby>茶<rp> (</rp><rt>ちゃ</rt><rp>)</rp></ruby> が　好きですが...。<br />\n(哪种好喝？—— 哪种都好喝，不过我更喜欢喝茉莉花茶。)</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%89)/",
            "url": "https://ei4869.github.io/miyano/Engine-Translation/KrKr%E5%BC%95%E6%93%8E%E6%B1%89%E5%8C%96(%E4%B8%89)/",
            "title": "KrKr引擎汉化(三)",
            "date_published": "2025-03-05T03:05:00.000Z",
            "content_html": "<details class=\"info\"><summary>编辑记录</summary><div>\n<div class=\"note info\">\n<p>2025-03-05 11:05:00 第一次编辑</p>\n</div>\n<ul>\n<li>正文</li>\n</ul>\n</div></details>\n<h1 id=\"简介\"><a class=\"anchor\" href=\"#简介\">#</a> 简介</h1>\n<p>  本文章为对 <strong>KrKr 引擎</strong> 游戏的解包封包的一些方法的对于 (二) 的补充。</p>\n<h1 id=\"教程\"><a class=\"anchor\" href=\"#教程\">#</a> 教程</h1>\n<h2 id=\"示例一\"><a class=\"anchor\" href=\"#示例一\">#</a> 示例一</h2>\n<p>以游戏《恋愛、はじめまして》为例介绍解包方法。</p>\n<ol>\n<li>直接使用 <strong>KrkrExtract.exe</strong>、<strong>KrkrExtract.dll</strong> 进行解包，拖入游戏时会报错：&quot;access violation : the thread attempts to read from or write to a virtual address for which it does not have access&quot;。解决方法是：把 <strong>KrkrExtract.dll</strong> 重命名为 <strong>wuvorbis.dll</strong> 就能解决，之后能正常解包。</li>\n<li>或者使用 <strong>GarBro</strong> 解包，密钥选择：&quot;Kari Gurashi Ren'ai&quot;，也能解包成功。</li>\n<li>对于该游戏，可以使用 KrkrExtract 进行  <code>Make Universal Patch</code>  得到 <code>_patch.exe</code>  文件，然后新建文件夹  <code>ProjectDir</code>  用于存放修改的文件，即可实现免封包读取。不过要保留 KrkrExtract.db 和 KrkrUniversalPatch.dll，另外两个 KrkrExtract.exe 和 wuvorbis.dll 删去即可。</li>\n<li>还可使用 winhex 修改 游戏 exe 的 forcedataxp3 相关值为 0（这里已经为 0 不用修改），之后则可直接新建 data 文件夹存放 data.xp3 解包的 data 文件夹里的文件，可以修改里面的文件，不过会优先读取 data.xp3 所以需要移出去，才能读取 data 文件夹。</li>\n<li>本游戏不能用 Xp3Viewer 解封包，不会弹出那个窗口，但有一个方便的方法制作补丁，<a href=\"https://github.com/arcusmaximus/KirikiriTools\">工具</a>，下载 <strong>Xp3Pack.exe</strong> 和 <strong>version.dll</strong> ，把 version.dll 放在游戏目录下（其实对该游戏可以不放），作用是令读取加密 xp3 包的游戏去读取未加密的包。然后 xp3packer 就是个封未加密的包的工具，与 version.dll 配合使用。 只需要把修改的文件放到一个 patch 的文件夹，然后拖到 Xp3Pack.exe* 就可打包为 xp3 文件，如果游戏中已经有 patch.xp3，则命名为 patch2.xp3，以此类推。对于原本的文件例如 data.xp3,patch.xp3 不用处理。  该工具里的 <strong>KirikiriDescrambler.exe</strong> 是用于解密加密的脚本的。</li>\n<li>对于该游戏，需要在中文环境下打开，才能显示出中文汉字，如果在日文区域打开，如果是 shiftjis 不支持的汉字，会变成点。之前我的系统由于配置了日文区域和环境，导致一直解决不了变成点的问题。</li>\n</ol>\n<h2 id=\"示例二\"><a class=\"anchor\" href=\"#示例二\">#</a> 示例二</h2>\n<p>以游戏《見上げた空におちていく》为例。</p>\n<ol>\n<li>之前遇到的字体一粗一浅，winhex 修改编码无效，原来就是因为环境问题，需要在中文环境下打开 exe 才能成功。然后直接打开该游戏，原来的日文字符会乱码。需要中文环境下转日区运行，才能正常显示日文，而中文字体也正常。</li>\n<li>要想直接打开不乱码，需要对各种文本文件进行转换编码。脚本的中文汉字之所以能正常显示，就是因为在汉化打包回 ks 文件时编码已经变成了 UTF-16 LE with BOM。所以，需要对游戏内所有文本文件，后缀例如：.tjs，.ks，.scn，.csv，.txt，.ini，.func，.asd，.sinfo，.stand，找到这些文件，拖入 EmEditor ，注意，需要在 EmEditor 正确识别编码的情况下，再统一进行编码转换为 UTF-16 LE with Bom。这里有坑是针对 csv 文件，一般用于立绘，可能会不能正常显示，需要额外处理，对于该游戏没有 csv 文件所以不需要处理，详情参考<a href=\"https://www.bilibili.com/video/BV1m64y187df/?share_source=copy_web&amp;vd_source=8e65c67310132c58d9f9eae499cda356\"> Gal 汉化入门 #9 KiriKiri2/Z  脚本编码转换</a>。</li>\n<li>之后，对于所有需要修改的文件，还是可以都拖到一个 patch2 文件夹（因为目录里有 patch.xp3），然后 Xp3Pack.exe 打包为 patch2.xp3 放在游戏目录即可。游戏就能读取并看到修改的效果。</li>\n</ol>\n<h2 id=\"字体的修改\"><a class=\"anchor\" href=\"#字体的修改\">#</a> 字体的修改</h2>\n<ol>\n<li>首先就是 winhex 修改 exe：搜索 C6431780 把 80 -&gt; 86，8A401A8845D7 -&gt; C645D7869090。然后保存。</li>\n<li>修改游戏字体。方法为：\n<ul>\n<li>\n<p>用 krkrfont.exe 制作 krkr 预渲染 tft 字体，首先电脑要安装想用的字体，再在 krkrfont.exe 里选择该字体（注意还是得中文环境打开）。例如这里选择 “霞骛文楷”，然后选择保存目录，再点击创建。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//engine_tools/krkr9.jpg\" style=\"max-width: 80%; height: auto;\"></p>\n</li>\n<li>\n<p>把字体放到 data 文件夹内，确保与 startup.tjs 在同一目录下，然后找到 first.ks 文件，在最初加上例如：</p>\n</li>\n</ul>\n<pre><code>[mappfont storage=&quot;xw.tft&quot;]     //前面保存的字体名词\n[font face=&quot;rei&quot;]               //随便写\n</code></pre>\n这里生效的只是脚本的字体。\n<ul>\n<li>要是 BackLog 也生效，需要修改文件： <code>data\\system\\HistoryLayer.tjs</code> ，找到 <code>function HistoryLayer(win, par)</code> ，然后进行下列修改：</li>\n</ul>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>var myfont = 'xw.tft';      //增加的内容</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>function HistoryLayer(win, par)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsuper.Layer(...);</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t(HistoryLayer_config incontextof this)(); // configuration</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t(HistoryLayer_config_override incontextof this)()</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tif typeof global.HistoryLayer_config_override != \"undefined\";</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tname = \"メッセージ履歴レイヤ\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tsetImageSize(parent.width, parent.height);</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tsetSizeToImageSize();</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\thitType = htMask;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\thitThreshold = 1;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t/**/font.height = fontHeight-4;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t/**/lineHeight = fontHeight-2;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tfont.bold = fontBold;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tif(verticalView)</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t&#123;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tfont.angle = 2700;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tfont.face = '@' + fontName;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tfont.mapPrerenderedFont(myfont);    //增加的内容</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t&#125;</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\telse</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t&#123;</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tfont.angle = 0;</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\tfont.face = fontName;</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\tfont.mapPrerenderedFont(myfont);    //增加的内容</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t&#125;</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>...</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>&#125;</pre></td></tr></table></figure>这样 History 的字体也会修改。</li>\n<li>打包的话，就是把字体文件和修改的例如 first.ks 和 HistoryLayer.tjs 都扔到 patch 文件夹里，再 Xp3Pack.exe 打包即可。</li>\n</ol>\n<h2 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h2>\n<p>1.<a href=\"https://peanutmelonseedbigalmond.pages.dev/2021/02/24/krkr%E5%BC%95%E6%93%8E%E7%A0%94%E7%A9%B6%E8%AE%B0%E5%BD%95/\">krkr 引擎研究记录</a> | <a href=\"/miyano/html/krkr引擎研究记录 _ 子虚乌有的剪切板.html\" onclick=\"window.location.href=this.href; event.stopPropagation(); return false;\">网页备份</a></p>\n<p>2.<a href=\"https://www.bilibili.com/opus/746093964791119991\">Krkr 引擎工具合集（一）—— 解包封包</a> | <a href=\"/miyano/html/Krkr引擎工具合集（一）——解包封包 - 哔哩哔哩.html\" onclick=\"window.location.href=this.href; event.stopPropagation(); return false;\">网页备份</a></p>\n<p>3.<a href=\"http://asmodean.reverse.net/pages/tools_index.html\"> 各引擎工具包集合</a> | <a href=\"/miyano/html/asmodean's reverse engineering page - index of tools.html\" onclick=\"window.location.href=this.href; event.stopPropagation(); return false;\">网页备份</a></p>\n",
            "tags": [
                "引擎汉化",
                "工具"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Scientific-Notes/Opening-Report/%E5%BC%80%E9%A2%98%E6%8A%A5%E5%91%8A-%E7%AD%94%E8%BE%A9%E7%A8%BF/",
            "url": "https://ei4869.github.io/miyano/Scientific-Notes/Opening-Report/%E5%BC%80%E9%A2%98%E6%8A%A5%E5%91%8A-%E7%AD%94%E8%BE%A9%E7%A8%BF/",
            "title": "开题报告-答辩稿",
            "date_published": "2025-03-04T02:14:52.000Z",
            "content_html": "<hr />\n<p><strong>开场白</strong><br />\n各位老师好！我是 2021 级本科生 XXX，我的毕业设计题目是《脉冲激光沉积 SrCoOx 薄膜的电致阻变性能及机理研究》，指导教师为 XXX 老师。下面我将从研究目的、现状、方案、内容及进度安排五个部分展开汇报。</p>\n<p><strong>研究目的</strong><br />\n优化脉冲激光沉积（PLD）工艺，探讨氧分压、温度等对薄膜微结构的影响，并制备高质量 SrCoOx 薄膜，探究其作为阻变层在电致阻变现象中的内在物理机制，为高性能存储器的设计与应用提供理论和实验依据。</p>\n<p><strong>研究现状</strong></p>\n<ul>\n<li>\n<p>目前，高密度非易失性存储器和存算一体化技术备受关注。已有研究中，Saito 等通过优化相变材料结构提高了器件的耐久性；Husremović 等利用杂化异质结构实现了多级电阻调控；而 Zhou 等的工作则展示了低能耗、高速编程的光子存储器。<br />\n图 1 展示的是 Saito 的工作，他们根据密度变化与光学对比度之间的关系，使用密度泛函理论（DFT）模拟预测反射率，再计算光学对比度，从而预测了多种过渡金属化合物的密度变化。图中的预测值以红色菱形符号表示。蓝色圆圈代表实验数据。根据预测结果使用 Cr₂Ge₂Te₆进行对比实验，发现制得的薄膜在非晶态和晶态之间转化的厚度变化几乎可以忽略不计，验证了其高耐久性。</p>\n</li>\n<li>\n<p>针对 BM–SrCoOx 薄膜的晶体结构和拓扑相变，我们知道，完全氧化状态下，SrCoO3 PV-SCO 呈现钙钛矿结构，由连续的氧八面体构成，氧空位含量极低，在此结构中，Co 的氧化态为 Co4+，材料表现出铁磁金属性。当氧含量降低时，PV-SCO 会转变为钙铁石结构 SrCoO2.5 (BM- SCO)。BM-SCO 的特点是氧四面体（CoO4）和氧八面体（CoO6）沿晶体生长方向周期性堆叠，这种结构导致氧空位的有序排列，氧离子的迁移受到限制，在 BM-SCO 中，Co 的氧化态降低至 Co3+，表现为反铁磁性和绝缘性。<br />\n但 PV-SCO 中由于高价态 Co4 + 的高吉布斯自由能和较低的氧空位形成能，其合成通常需要在高温高氧压下。而清华大学课题组提出了两种温和快速的合成方法：一种是碱溶液门控（AAG），在大约 - 0.6V 下触发相变，-1V 时相变时间约 2 分钟；另一种是酸溶液反应（ASR），在室温下仅需 2 秒即可完成相变。<br />\n图 2 展示的是这些方法的示意图，可以发现 AAG 方法的核心是提供丰富的羟基离子（OH−），从而促进了反应速率，导致临界电压降低和氧化速度加快。而 ASR 方法的核心是利用氧四面体的 Co 离子相比氧八面体的 Co 离子对酸的抵抗力更差，导致发生了一种歧化反应，BM-SCO 与质子发生反应，其中一半的 Co 离子被还原为可溶的 Co2+，而另一半则被氧化为以 PV-SCO 形式存在的 Co4+。<br />\n进一步地，Miao 等人的工作展示了在离子液体栅极作用下，SrCoO₂.₅与 SrCoO₃之间的可逆相变，并揭示了氧离子在 BM-SCO 中的各向异性迁移。<br />\n图 3 表示的是 BM-SCO 双通道器件中突触权重的调制。图 a 展示的是通道沿着 110 和 100 方向，图 b-d 表示不同的 Vg 栅电压下。图 b 表示此时通道 1 的 [110] 直接受到电场的影响，电导率变化大，而此时电压不足以引起通道内氧离子迁移所以通道 2 的两个方向都没有电导率变化。图 c 表示电压增大，通道 1 电导率变化更大转变为长期可塑性，而同样是通道 2，110 方向已经有电导率变化，更敏感。 图 d 表示电压继续增大下，通道 2 的 100 也开始表现出短期可塑性。 由此表明了氧离子迁移的各向异性， 适合构建人工突触。<br />\n注：<br />\n(001 指沿衬底 001 方向生长的膜)<br />\n(通道 1 与离子液体直接接触可通过离子液体门控，电导率可以被门电压（Vg）调制，通道 2 是不与离子液体接触的通道，因此其电导率不受离子液体门控效应的直接影响，但可以通过通道 I 中的氧离子浓度梯度间接受到影响)</p>\n</li>\n<li>\n<p>在薄膜制备方面，文献表明氧分压与温度显著影响薄膜结晶性、结构等。<br />\n如图 4，是不同氧分压下生长的 STO 薄膜的 AFM 二维和三维图像，表明氧分压较低时，晶粒尺寸细小，但有比较大的晶粒<br />\n分布范围。氧分压增大后，薄膜晶粒由小变大相互融合，形成明显的大尺寸晶粒。而且颗粒的平均面积逐渐变大，同时颗粒数目也逐渐减少。<br />\n而图 5 展示的是不同后退火温度下，薄膜发生的由钙铁石相到钙钛矿相的拓扑相变。<br />\n当退火温度 T ≥ 250℃ 时，SrCoO2.5 特有的 (006)、(0010) 衍射峰强度明显降低，并逐渐右移，(008) 衍射峰消失，并出现钙钛矿型 SrCoO3–δ 特有的衍射峰 (002)。当退火温度达到 600℃ 时，BM-SCO 特征峰 (006)、(0010) 完全消失，即样品完全转变为 P-SCO。</p>\n</li>\n<li>\n<p>在拓扑相变忆阻器研究上，Lo 等人利用 PLD 制备的 Au/SCO/Nb-STO 结构展示了高循环耐久性和良好的数据保持特性；而 Mou 等人则开发了基于有序氧空位通道的双模式 TPT-RAM，实现了模拟开关特性的可重复调控。<br />\n图 6 展示了器件从形成、复位到设置的电阻开关过程，在器件的初始状态下，未施加偏压时，BM-SCO 呈现多晶结构并均匀分布，没有 P-SCO，在形成过程中，当对 Au 顶电极施加正偏压时，BM-SCO 的结构将重排为单晶，电场诱导氧离子从 Nb-STO 表面迁移到顶电极，并占据 BM-SCO 中的缺氧层，从而形成 P-SCO 导电路径，当对 Au 施加负偏压时，纳米丝从上到下断裂，因为氧离子将从顶电极被排除到底电极，直到器件处于高阻态（HRS）。靠近顶电极的断裂纳米丝区域转变回 BM-SCO，其交替堆叠完全氧化的八面体和缺氧的四面体亚层，通过一系列电学测量，P-SCO 纳米丝将变得比之前测量中观察到的更强。因此，低阻态（LRS）中的电阻更低。器件需要更高的电压以排除更多的氧离子，从而使器件切换回高阻态。</p>\n</li>\n</ul>\n<p><strong>研究方案</strong><br />\n本课题采用 “工艺优化 - 器件制备 - 性能表征 - 机理分析” 的技术路线。具体是：</p>\n<ol>\n<li>通过 PLD 调控氧分压、温度等参数，优化 SrCoOx 薄膜质量。</li>\n<li>结合光刻与电子束蒸镀技术，制备 Au/SrCoOx/SrRuO₃/SrTiO₃阻变器件。</li>\n<li>通过 I-V 曲线、循环耐久性测试评估器件阻变特性。</li>\n<li>借助 XRD、TEM、XPS 等手段，揭示氧空位分布与阻变机制的内在关联。</li>\n</ol>\n<p><strong>研究内容</strong></p>\n<ol>\n<li>理解 PLD 设备原理与薄膜生长动力学，优化制备工艺；</li>\n<li>制备阻变器件，优化器件结构和界面；</li>\n<li>通过系统电学测试，评估器件的阻变性能；</li>\n<li>结合多种表征技术，分析薄膜结构、表面形貌和氧空位分布，探讨阻变机理并确定最优沉积条件。</li>\n</ol>\n<p>注：<br />\nXRD:X 射线衍射 研究材料的晶体结构和相组成<br />\n TEM: 透射电子显微镜  观察到样品内部的微观结构<br />\n AFM: 原子力显微镜 获得高分辨率的三维形貌图像，并测量表面粗糙度、力学性能等信息<br />\n XPS:X 射线光电子能谱 分析样品表面的化学成分及其化学状态</p>\n<p><strong>进度安排</strong><br />\n我的进度安排是分为四个阶段：分别是搜集资料；设计实验方案；开始制备薄膜和阻变器件，进行微观表征和电学测试；收集整理数据，进行分析，准备论文。</p>\n<p><strong>结语</strong><br />\n以上是我的开题汇报内容，恳请各位老师批评指正！谢谢！</p>\n<hr />\n<p><strong>模拟问答环节（导师提问 → 学生回答）：</strong><br />\n<strong>导师</strong>：你为什么选择脉冲激光沉积（PLD）作为制备 SrCoOx 薄膜的方法？<br />\n<strong>学生</strong>：PLD 具有优良的厚度控制和高结晶性优势，能精确调控沉积参数（如氧分压和温度），这对于研究薄膜相变和电致阻变性能至关重要。此外，已有文献证明 PLD 在类似体系中的成功应用，为我们提供了很好的技术借鉴。</p>\n<hr />\n<p><strong>导师</strong>：你提到要通过调控氧分压和温度来优化薄膜质量。具体来说，你打算如何确定最佳工艺参数？<br />\n<strong>学生</strong>：我计划先进行一系列参数预实验，系统改变氧分压和沉积温度，利用 XRD 和 AFM 表征薄膜的晶体结构与表面形貌。结合电学测试，如 I-V 曲线和循环耐久性测试，我将建立参数与器件性能之间的关系，从中筛选出最优条件。</p>\n<hr />\n<p><strong>导师</strong>：在器件制备过程中，如何保证电极与薄膜之间的界面质量？<br />\n<strong>学生</strong>：我将采用光刻和电子束蒸镀技术，确保电极图案的精确性和薄膜沉积的均匀性。针对界面问题，我会优化沉积顺序和预处理工艺，如表面清洗和热处理，以增强界面结合，同时利用 TEM 和 XPS 对界面结构进行深入分析。</p>\n<hr />\n<p><strong>导师</strong>：关于电致阻变机理，你计划如何利用表征手段揭示氧空位分布和迁移规律？<br />\n<strong>学生</strong>：我将结合 XRD、TEM、AFM 和 XPS 等多种表征手段进行交叉验证。具体来说，XPS 能帮助我们了解氧化态的变化，TEM 和 AFM 则可直观观察薄膜微观结构，而电学测试中得到的阻变特性数据可以与这些结构特征对应，从而揭示氧空位在相变和电阻切换中的具体作用。</p>\n<hr />\n<p><strong>导师</strong>：最后，你预期的研究成果将如何推动高密度非易失性存储器或神经形态计算的发展？<br />\n<strong>学生</strong>：通过精细调控 SrCoOx 薄膜的相变过程，我们有望实现器件在多级电阻状态下的稳定转换，这将大幅提升存储器的耐久性和数据保持能力。同时，深入理解氧离子迁移机制也为构建人工突触提供了物理基础，为神经形态计算提供低功耗、高效能的硬件支撑，具有较高的应用前景。</p>\n<hr />\n<p><strong>导师</strong>：好的，整体方案思路清晰，问题也考虑得很全面。希望你在后续实验中能进一步细化参数，并密切关注数据与结构表征之间的关联。<br />\n<strong>学生</strong>：非常感谢老师的指导，我会继续努力完善实验设计，期待后续能得到更多有价值的实验数据和结论。</p>\n<hr />\n<p><strong>导师 A</strong>：<br />\n你的研究中提到要通过优化 PLD 工艺参数来提升薄膜质量。但已有文献（如清华团队的工作）已实现了快速相变，你的研究创新点具体体现在哪里？</p>\n<p><strong>学生</strong>：<br />\n感谢老师的提问。现有研究主要聚焦于相变速率的提升，例如通过 AAG 或 ASR 方法实现秒级相变。但本研究的创新点在于：</p>\n<ol>\n<li><strong>工艺协同优化</strong>：我们不仅关注相变速率，还通过调控氧分压和温度，平衡薄膜的结晶性与氧空位分布，以提高阻变器件的循环稳定性。</li>\n<li><strong>界面工程</strong>：在器件制备中，我们重点优化电极与薄膜的接触质量，这可能是现有文献中未充分解决的瓶颈问题。</li>\n<li><strong>机理深度关联</strong>：结合 XPS 和原位 TEM，我们将建立氧空位迁移路径与电致阻变性能的直接关联，为机理模型提供新证据。</li>\n</ol>\n<hr />\n<p><strong>导师 B</strong>：<br />\n你计划用 XRD 和 TEM 分析氧空位分布，但这些手段可能无法直接观测动态迁移过程。是否考虑补充其他表征方法？</p>\n<p><strong>学生</strong>：<br />\n老师的问题非常关键。除了 XRD 和 TEM，我们计划引入：</p>\n<ol>\n<li><strong>原位 XPS</strong>：在施加电场条件下实时监测氧空位的价态变化。</li>\n<li><strong>导电原子力显微镜（C-AFM）</strong>：在纳米尺度下观察氧空位通道的形成与断裂过程。<br />\n这些方法可以弥补传统表征的不足，更动态地揭示阻变机制。</li>\n</ol>\n<hr />\n<p><strong>导师 C</strong>：<br />\n你提到要将 SrCoOx 应用于存算一体化，但实验中仅设计了阻变器件测试。如何体现与神经形态计算的关联性？</p>\n<p><strong>学生</strong>：<br />\n目前我们以基础性能测试为主，但后续计划通过两类实验体现应用潜力：</p>\n<ol>\n<li><strong>突触模拟</strong>：利用器件的多级阻变特性，模拟突触权重调制（参考 Miao 等人的双通道设计）。</li>\n<li><strong>脉冲时序依赖可塑性（STDP）测试</strong>：通过特定电压脉冲序列验证器件是否具备类脑学习能力。<br />\n若时间允许，我们将在论文中补充这部分结果。</li>\n</ol>\n<hr />\n<p><strong>导师 D</strong>：<br />\n电极与薄膜的接触质量优化是难点，你提到 “结构稳定性” 具体指什么？如何量化评估？</p>\n<p><strong>学生</strong>：<br />\n“结构稳定性” 主要指电极与薄膜界面在多次阻变循环后的物理和化学稳定性，具体通过以下指标量化：</p>\n<ol>\n<li><strong>接触电阻变化率</strong>：循环测试前后电阻值的标准差。</li>\n<li><strong>界面形貌分析</strong>：通过 AFM 和 SEM 观察电极剥离或薄膜裂纹情况。</li>\n<li><strong>元素扩散检测</strong>：EDX 表征电极金属（如 Au）是否向薄膜层扩散。</li>\n</ol>\n<hr />\n<p><strong>导师 A（总结）</strong>：<br />\n好的，请继续关注实验细节的可行性，期待你的阶段性成果！</p>\n<p><strong>学生</strong>：<br />\n谢谢各位老师的建议！我会进一步完善方案，争取高质量完成研究！</p>\n<hr />\n<p><strong>导师 A（总结）</strong>：<br />\nAu/SrCoOx/SrRuO3/SrTiO3 各层的功能是什么？</p>\n<p><strong>学生</strong>：<br />\nAu 层：作为上电极，Au 具有优良的导电性和化学稳定性，用于提供电信号的输入和输出，同时保证器件界面不发生氧化或其他化学反应。</p>\n<p>SrCoOx 层：这是器件的核心活性层，负责实现阻变效应。SrCoOx 的氧化态和氧空位分布可以在电场作用下发生可逆变化，形成或断开导电通道，从而改变器件的电阻状态。</p>\n<p>SrRuO₃层：作为底电极，SrRuO₃不仅具有较好的导电性，还与上层的 SrCoOx 和下层的 SrTiO₃具有良好的晶格匹配，能够提供稳定的电流传输和优质的界面，帮助降低接触电阻及器件的不均匀性。</p>\n<p>SrTiO₃层：作为衬底，SrTiO₃提供了一个高质量、结构稳定的生长平台，有利于薄膜的外延生长，从而保证整体器件的晶体质量和性能一致性。</p>\n<hr />\n",
            "tags": [
                "科研笔记",
                "开题报告",
                "毕设"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC2%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC2%E5%8D%95%E5%85%83/",
            "title": "单元二——小李的公司生活",
            "date_published": "2025-03-03T09:49:00.000Z",
            "content_html": "<h1 id=\"第五课森もりさんは-七時しちじに-起おきます\"><a class=\"anchor\" href=\"#第五课森もりさんは-七時しちじに-起おきます\">#</a> 第五课：<ruby>森<rp> (</rp><rt>もり</rt><rp>)</rp> さん<rt></rt></ruby>は　<ruby>七時<rp> (</rp><rt>しちじ</rt><rp>)</rp></ruby> に　<ruby>起<rp> (</rp><rt>お</rt><rp>)</rp> きます<rt></rt></ruby></h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"今いま-x時じ-x分ふんです\"><a class=\"anchor\" href=\"#今いま-x時じ-x分ふんです\">#</a> <ruby>今<rp> (</rp><rt>いま</rt><rp>)</rp></ruby>　x<ruby> 時<rp> (</rp><rt>じ</rt><rp>)</rp></ruby>　x<ruby> 分<rp> (</rp><rt>ふん</rt><rp>)</rp></ruby> です</h3>\n<p>用于表示现在的时间。询问时间用　<ruby>何時<rp> (</rp><rt>なんじ</rt><rp>)</rp></ruby><br />\n 上午八点半 -&gt; <ruby>午前<rp> (</rp><rt>ごぜん</rt><rp>)</rp></ruby>　<ruby>八時半<rp> (</rp><rt>はちじはん</rt><rp>)</rp></ruby>　です      不加の</p>\n<h3 id=\"动ます-动ません-动ました-动ませんでした\"><a class=\"anchor\" href=\"#动ます-动ません-动ました-动ませんでした\">#</a> [动] ます　/[动] ません /[动] ました /[动] ませんでした</h3>\n<p>都是礼貌的形式。 肯定地叙述现在的习惯性动作、状态、未来的动作时用 ます　，否定用 ません；肯定地叙述过去的动作时用 ました，否定用 ませんでした。</p>\n<table>\n<thead>\n<tr>\n<th>ます</th>\n<th>ません</th>\n<th>ました</th>\n<th>ませんでした</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><ruby>働<rp> (</rp><rt>はたら</rt><rp>)</rp> きます<rt></rt></ruby></td>\n<td><ruby>働<rp> (</rp><rt>はたら</rt><rp>)</rp> きません<rt></rt></ruby></td>\n<td><ruby>働<rp> (</rp><rt>はたら</rt><rp>)</rp> きました<rt></rt></ruby></td>\n<td><ruby>働きませんでした<rp> (</rp><rt>はたらきせんでした</rt><rp>)</rp></ruby></td>\n</tr>\n<tr>\n<td><ruby>休<rp> (</rp><rt>やす</rt><rp>)</rp> みます<rt></rt></ruby></td>\n<td><ruby>休<rp> (</rp><rt>やす</rt><rp>)</rp> みません<rt></rt></ruby></td>\n<td><ruby>休<rp> (</rp><rt>やす</rt><rp>)</rp> みました<rt></rt></ruby></td>\n<td><ruby>休<rp> (</rp><rt>やす</rt><rp>)</rp> みませんでした<rt></rt></ruby></td>\n</tr>\n</tbody>\n</table>\n<p>疑问句则在句尾加 か</p>\n<h3 id=\"名时间-に-动\"><a class=\"anchor\" href=\"#名时间-に-动\">#</a> [名 (时间)] に　[动]</h3>\n<p>表示动作发生的时间时，要在具体的时间词语后加助词 に<br />\n注:</p>\n<ul>\n<li>叙述包含数字的时间后一定加 に，如：&quot;<ruby> 三月十四日<rp> (</rp><rt>さんがつじゅうよっか</rt><rp>)</rp></ruby> に &quot;</li>\n<li><ruby>今<rp> (</rp><rt>いま</rt><rp>)</rp></ruby>　<ruby>昨日<rp> (</rp><rt>きのう</rt><rp>)</rp></ruby>  <ruby>今日<rp> (</rp><rt>きょう</rt><rp>)</rp></ruby>　<ruby>明日<rp> (</rp><rt>あした</rt><rp>)</rp></ruby>　<ruby>毎日<rp> (</rp><rt>まいにち</rt><rp>)</rp></ruby>  <ruby>去年<rp> (</rp><rt>きょねん</rt><rp>)</rp></ruby>　<ruby>来年<rp> (</rp><rt>らいねん</rt><rp>)</rp></ruby> 等词后不能加に</li>\n<li>星期后可加可不加。</li>\n</ul>\n<p>该句式可换为：[时间]、[名] は　[动]</p>\n<h3 id=\"名时间から-名时间まで-动\"><a class=\"anchor\" href=\"#名时间から-名时间まで-动\">#</a> [名 (时间)] から　[名 (时间)] まで　[动]</h3>\n<p>表示某动作发生在某个期间时。<br />\neg: わたしは　<ruby>九時<rp> (</rp><rt>くじ</rt><rp>)</rp></ruby> から　<ruby>働<rp> (</rp><rt>はたら</rt><rp>)</rp> きます<rt></rt></ruby>。    我从九点开始工作。</p>\n<h3 id=\"いつ-动-ますか\"><a class=\"anchor\" href=\"#いつ-动-ますか\">#</a> いつ　[动] ますか</h3>\n<p>询问某动作或事态进行的时间。<br />\n询问时间很具体时加に，如：<ruby>何時<rp> (</rp><rt>になんじに</rt><rp>)</rp></ruby>　<ruby>何曜日<rp> (</rp><rt>なんようび</rt><rp>)</rp> に<rt></rt></ruby>　<ruby>何日<rp> (</rp><rt>なんにち</rt><rp>)</rp> に<rt></rt></ruby><br />\n<ruby>試験<rp> (</rp><rt>しけん</rt><rp>)</rp></ruby> は　いつ　<ruby>始<rp> (</rp><rt>はじ</rt><rp>)</rp></ruby> まりますか。 什么时候开始考试？</p>\n<p>询问持续性动作或事态的起点或终点时，用 いつから　<ruby>何曜日<rp> (</rp><rt>なんようび</rt><rp>)</rp> まで<rt></rt></ruby>等。</p>\n<h3 id=\"は\"><a class=\"anchor\" href=\"#は\">#</a> は</h3>\n<p>は 还可用于对比<br />\n eg: <ruby>小野<rp> (</rp><rt>おの</rt><rp>)</rp> さん<rt></rt></ruby>は　今日は　休みます。  小野女士今天休息。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>毎朝<rp> (</rp><rt>まいあさ</rt><rp>)</rp></ruby>　<ruby>何時<rp> (</rp><rt>になんじ</rt><rp>)</rp></ruby> に <ruby>起<rp> (</rp><rt>お</rt><rp>)</rp></ruby> きますか<br />\n当两个名词都表示时间，而前面的名词中包含 &quot;<ruby> 毎<rp> (</rp><rt>まい</rt><rp>)</rp></ruby>&quot;时，名词见不加の；前面的名词中不包含&quot;<ruby> 毎<rp> (</rp><rt>まい</rt><rp>)</rp></ruby>&quot; 时，可加可不加。</p>\n</li>\n<li>\n<p>ごろ<br />\n接在时间之后，表示大致的时间范围。后面一般不加に<br />\n eg: <ruby>昨日<rp> (</rp><rt>きのう</rt><rp>)</rp></ruby>　<ruby>12<rt></rt> 時半<rp> (</rp><rt>じゅうにじはん</rt><rp>)</rp></ruby> ごろ　<ruby>寝<rp> (</rp><rt>ね</rt><rp>)</rp> ました<rt></rt></ruby>。  昨晚，十二点半睡觉。</p>\n</li>\n</ol>\n<h1 id=\"第六课吉田よしださんは-来月らいげつ-中国ちゅうごくへ-行いきます\"><a class=\"anchor\" href=\"#第六课吉田よしださんは-来月らいげつ-中国ちゅうごくへ-行いきます\">#</a> 第六课：<ruby>吉田…… よしだ} さんは　{来月<rp> (</rp><rt>らいげつ</rt><rp>)</rp></ruby>　<ruby>中国<rp> (</rp><rt>ちゅうごく</rt><rp>)</rp></ruby> へ　<ruby>行<rp> (</rp><rt>い</rt><rp>)</rp> きます<rt></rt></ruby></h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"名场所-へ-动\"><a class=\"anchor\" href=\"#名场所-へ-动\">#</a> [名 (场所)] へ　[动]</h3>\n<p>使用 行きます　<ruby>帰<rp> (</rp><rt>かえ</rt><rp>)</rp> ります<rt></rt></ruby>　等表示移动的动词时，行为的目的地用助词 へ 表示。</p>\n<h3 id=\"名场所から-动\"><a class=\"anchor\" href=\"#名场所から-动\">#</a> [名 (场所)] から　[动]</h3>\n<p>使用移动动词时，移动的起点用助词 から。</p>\n<h3 id=\"名人と-动\"><a class=\"anchor\" href=\"#名人と-动\">#</a> [名 (人)] と　[动]</h3>\n<p>和某人一起做某事。<br />\neg: <ruby>小野<rp> (</rp><rt>おの</rt><rp>)</rp> さん<rt></rt></ruby>は　<ruby>友達<rp> (</rp><rt>ともだち</rt><rp>)</rp></ruby>　と　<ruby>帰<rp> (</rp><rt>かえ</rt><rp>)</rp> りました<rt></rt></ruby>。 小野女士和朋友一起回去了。</p>\n<h3 id=\"名交通工具で-动\"><a class=\"anchor\" href=\"#名交通工具で-动\">#</a> [名 (交通工具)] で　[动]</h3>\n<p>交通手段用助词 で，而不使用交通工具而步行时，用<ruby>歩<rp> (</rp><rt>ある</rt><rp>)</rp> いて<rt></rt></ruby><br />\n eg: 私は　バス　で　家へ　帰ります。    我乘公共汽车回家。</p>\n<h3 id=\"名场所から-名场所まで-动\"><a class=\"anchor\" href=\"#名场所から-名场所まで-动\">#</a> [名 (场所)] から　[名 (场所)] まで　[动]</h3>\n<p>表示移动的范围时，起点から终点まで。</p>\n<h3 id=\"にでへからまでとは\"><a class=\"anchor\" href=\"#にでへからまでとは\">#</a> &quot;に / で / へ / から / まで / と&quot;+ は</h3>\n<p>は　加在这些副词后面表示一种复合形式。</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p>たしか<br />\n &quot;好像是...&quot;，表示不完全有把握的记忆。<br />\n- あの　人は　だれですか。　—— たしか　李さんの　会社の　人です。</p>\n</li>\n<li>\n<p><ruby>家<rp> (</rp><rt>いえ</rt><rp>)</rp></ruby>　和 うち<br />\n意指建筑物时一般用<ruby>家<rp> (</rp><rt>いえ</rt><rp>)</rp></ruby>，着重指家人时一般用うち。うち有 “我家” 的意思，但用<ruby>家<rp> (</rp><rt>いえ</rt><rp>)</rp></ruby> 时必须用 &quot;私の家&quot;。</p>\n</li>\n<li>\n<p>まっすく　帰りました<br />\n &quot;径直回家&quot;，まっすく　表示 “笔直” 的意思。</p>\n</li>\n<li>\n<p><ruby>お<rt></rt>疲<rp> (</rp><rt>つか</rt><rp>)</rp> れ<rt></rt>様<rp> (</rp><rt>さま</rt><rp>)</rp> でした<rt></rt></ruby><br />\n寒暄用语，“辛苦了”。</p>\n</li>\n</ol>\n<h1 id=\"第七课李さんは-毎日-コーヒーを-飲のみます\"><a class=\"anchor\" href=\"#第七课李さんは-毎日-コーヒーを-飲のみます\">#</a> 第七课：李さんは　毎日　コーヒーを　<ruby>飲<rp> (</rp><rt>の</rt><rp>)</rp> みます<rt></rt></ruby></h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"名を-动\"><a class=\"anchor\" href=\"#名を-动\">#</a> [名] を　[动]</h3>\n<p>动词的对象用助词 を。</p>\n<h3 id=\"名场所で-动\"><a class=\"anchor\" href=\"#名场所で-动\">#</a> [名 (场所)] で　[动]</h3>\n<p>动作的场所用助词 で　表示。 注：日语中存在的场所用に，动作的场所用で。</p>\n<h3 id=\"名か-名\"><a class=\"anchor\" href=\"#名か-名\">#</a> [名] か　[名]</h3>\n<p>“或者”，对若干名词进行选择时。<br />\neg: 私は　<ruby>毎朝<rp> (</rp><rt>まいあさ</rt><rp>)</rp></ruby>　パンか　<ruby>お<rt></rt>粥<rp> (</rp><rt>かゆ</rt><rp>)</rp></ruby> を　食べます。 我每天早上吃面包或粥。</p>\n<h3 id=\"名を-ください\"><a class=\"anchor\" href=\"#名を-ください\">#</a> [名] を　ください</h3>\n<p>“请给我～”。</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>&quot;何&quot; 的读法：なん　和 なに</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>形式</th>\n<th>例句</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>なにと</td>\n<td><ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> と<ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> を　買いますか。</td>\n</tr>\n<tr>\n<td>なにが</td>\n<td>あそこに　<ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> が　ありますか。</td>\n</tr>\n<tr>\n<td>なにを</td>\n<td><ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> を　食べますか。</td>\n</tr>\n<tr>\n<td>なにで / なんで</td>\n<td><ruby>何<rp> (</rp><rt>なに / なん</rt><rp>)</rp></ruby> で　会社へ　いきますか。</td>\n</tr>\n<tr>\n<td>なんの</td>\n<td>それは　<ruby>何<rp> (</rp><rt>なん</rt><rp>)</rp></ruby> の　本ですか。</td>\n</tr>\n<tr>\n<td>なん時刻 / 星期等</td>\n<td>李さんは　<ruby>何<rp> (</rp><rt>なん</rt><rp>)</rp></ruby> 時に　来ますか。</td>\n</tr>\n</tbody>\n</table>\n<p>对于で，虽然都可用，但最好用<ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> で。</p>\n<ol start=\"2\">\n<li>\n<p>そうですか<br />\n “是吗”。句尾降调表示理解了所听到的信息，句尾升调表示对对方内容有疑问。</p>\n</li>\n<li>\n<p>そうですね<br />\n “好啊”。</p>\n</li>\n<li>\n<p>じゃあ<br />\n “那么”，接过对方的话。正式场合用では。</p>\n</li>\n<li>\n<p>寒暄语<br />\n (1) 失礼します　<br />\n“打搅了”“告辞了”。</p>\n</li>\n</ol>\n<p>(2) いってらっしゃい　いってまいります / いってきます<br />\n以还要返回该处为前提，要离开的人一般是 &quot;いってまいります&quot;（我走了），&quot;いってきます&quot; 是较为随便的说法，对方回答 “いってらっしゃい”，意为 “去吧”，其中含有盼望对方 “早点回来” 的心情。</p>\n<p>(3) ただいま　お帰りなさい<br />\n回到家或单位时，回来的人说 &quot;ただいま&quot;(我回来了)，在家或单位的人说 &quot;お帰りなさい&quot;(你回来啦)</p>\n<p>(4) いらっしゃいませ　かしこまりました<br />\nいらっしゃいませ 为店员对顾客说的寒暄语 “欢迎光临”。<br />\nかしこまりました 为店员对顾客使用，“明白了”。<br />\nいらっしゃい　语气较随便，用于欢迎朋友或亲近的人来家里做客。</p>\n<p>(5) すみません<br />\n除了表示 “对不起” 等道歉的意思外，还有向别人搭话时使用的 “请问” 的意思。</p>\n<h1 id=\"第八课李さんは-日本語で-手紙てがみを-書かきます\"><a class=\"anchor\" href=\"#第八课李さんは-日本語で-手紙てがみを-書かきます\">#</a> 第八课：李さんは　日本語で　<ruby>手紙<rp> (</rp><rt>てがみ</rt><rp>)</rp></ruby> を　<ruby>書<rp> (</rp><rt>か</rt><rp>)</rp></ruby> きます</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"名工具で-动\"><a class=\"anchor\" href=\"#名工具で-动\">#</a> [名 (工具)] で　[动]</h3>\n<p>で　还可用于表示其他其他手段以及原材料。<br />\neg: <ruby>何<rp> (</rp><rt>なに</rt><rp>)</rp></ruby> で　うどんを　<ruby>作<rp> (</rp><rt>つく</rt><rp>)</rp></ruby> りますか。 用什么做面条？</p>\n<h3 id=\"名1人は-名2人に-名3物を-あげます\"><a class=\"anchor\" href=\"#名1人は-名2人に-名3物を-あげます\">#</a> [名 1 (人)] は [名 2 (人)] に [名 3 (物)] を　あげます</h3>\n<p>あげます 相当于 “给”。1 给 2 某物。<br />\n用于：我 (也可以是我亲近的人) 给某人某物 以及 某人给某人某物。<br />\neg: 私は　<ruby>小野<rp> (</rp><rt>おの</rt><rp>)</rp> さん<rt></rt></ruby>に　<ruby>お<rt></rt>土産<rp> (</rp><rt>みやげ</rt><rp>)</rp></ruby> を　あげます。 我送给小野女士礼物。<br />\n小野さんは　<ruby>森<rp> (</rp><rt>もり</rt><rp>)</rp> さん<rt></rt></ruby>に　チョコレートを　あげました。  小叶女士给了森先生巧克力。</p>\n<p><ruby>母<rp> (</rp><rt>はは</rt><rp>)</rp></ruby> は　<ruby>長島<rp> (</rp><rt>ながしま</rt><rp>)</rp></ruby> さんに　ワインを　あげました。    母亲送葡萄酒给长岛先生。 (母亲是自己人)</p>\n<p>注：别人给我 (或我亲近的人) 要用くれます。eg: 王さんは　私に　本を　くれます。</p>\n<h3 id=\"名1人は-名2人に-名3物を-もらいます\"><a class=\"anchor\" href=\"#名1人は-名2人に-名3物を-もらいます\">#</a> [名 1 (人)] は [名 2 (人)] に [名 3 (物)] を　もらいます</h3>\n<p>もらいます　相当于 “得到”。1 从 2 得到了某物。<br />\n用于：我 (或我亲近的人) 得到了某人的某物 以及 某人得到了某人的某物。 赠送者后可接に也可接から。<br />\neg: 私は　小野さんに　<ruby>辞書<rp> (</rp><rt>じしょ</rt><rp>)</rp></ruby> を　もらいます。 我从小野女士那得到了一本词典。<br />\n森さんは　長島さんから　パンフレットを　もらいます。　森先生从长岛先生那得到了小册子。</p>\n<p><ruby>弟<rp> (</rp><rt>おとうと</rt><rp>)</rp></ruby> は　長島さんから　本を　もらいました。    弟弟从长岛先生那得到了一本书。</p>\n<h3 id=\"名人に-会あいます\"><a class=\"anchor\" href=\"#名人に-会あいます\">#</a> [名 (人)] に　<ruby>会<rp> (</rp><rt>あ</rt><rp>)</rp></ruby> います</h3>\n<p>“见了某人”。见到的对象用助词に。</p>\n<h3 id=\"よ\"><a class=\"anchor\" href=\"#よ\">#</a> よ</h3>\n<p>句尾升调，提醒对方注意其不知道的事。<br />\neg: もう　帰りましたよ。</p>\n<h3 id=\"もう\"><a class=\"anchor\" href=\"#もう\">#</a> もう</h3>\n<p>“已经”。</p>\n<h2 id=\"表达-4\"><a class=\"anchor\" href=\"#表达-4\">#</a> 表达</h2>\n<ol>\n<li>\n<p>x から　もらいます<br />\n从 x 接受 / 得到某物时，如果是从人得到，则可以に / から，如果是从<ruby>会社<rp> (</rp><rt>かいしゃ</rt><rp>)</rp></ruby>/<ruby> 学校<rp> (</rp><rt>がっこう</rt><rp>)</rp></ruby> 之类的组织或团体得到时，只能用から。</p>\n</li>\n<li>\n<p>あげます<br />\n送别人东西时，为了不给人强加于人的印象，可以用 &quot;どうぞ&quot;&quot; どうですか &quot; 比较适合。</p>\n</li>\n<li>\n<p>さっき / たった<ruby>今<rp> (</rp><rt>いま</rt><rp>)</rp></ruby><br />\n 都表示离现在很近的过去，后续动词接过去式，如果说话人觉得离现在非常近，用 たった今 (刚刚)，稍前一点用 さっき (刚才)，这两种都是比较随便的说法，用于日常会话。</p>\n</li>\n<li>\n<p>通讯手段<br />\n<ruby>電話<rp> (</rp><rt>でんわ</rt><rp>)</rp></ruby>/ ファックス / メールを　もらいます。　收到电话 / 传真 / 邮件。<br />\n電話を　かけます / 電話します     打电话<br />\nファックス / メール /<ruby> 手紙<rp> (</rp><rt>てがみ</rt><rp>)</rp></ruby> を　<ruby>送<rp> (</rp><rt>おく</rt><rp>)</rp> ります<rt></rt></ruby>    发传真 / 邮件 / 信<br />\n手紙を　<ruby>出<rp> (</rp><rt>だ</rt><rp>)</rp> します<rt></rt></ruby>     寄信</p>\n</li>\n<li>\n<p><ruby>お<rt></rt>願<rp> (</rp><rt>ねが</rt><rp>)</rp> いします<rt></rt></ruby><br />\n请求对方做某事时用 “名词 +(を)　お願いします”。</p>\n</li>\n<li>\n<p><ruby>分<rp> (</rp><rt>わ</rt><rp>)</rp> かりました<rt></rt></ruby><br />\n “明白了”，还可用于对对方说的话的承诺和应答。</p>\n</li>\n<li>\n<p>前にまえに　<br />\n表示时间，“以前”，其中に有时可不用。<br />\neg: 前に　<ruby>田中<rp> (</rp><rt>たなか</rt><rp>)</rp> さん<rt></rt></ruby>に　メールを　もらいました。   以前收到过田中先生的电子邮件。</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Scientific-Notes/Opening-Report/%E5%BC%80%E9%A2%98%E6%8A%A5%E5%91%8A-%E5%8F%82%E8%80%83%E8%AE%BA%E6%96%87(%E5%9B%9B)/",
            "url": "https://ei4869.github.io/miyano/Scientific-Notes/Opening-Report/%E5%BC%80%E9%A2%98%E6%8A%A5%E5%91%8A-%E5%8F%82%E8%80%83%E8%AE%BA%E6%96%87(%E5%9B%9B)/",
            "title": "开题报告-参考论文(四)",
            "date_published": "2025-03-03T02:05:52.000Z",
            "content_html": "<hr />\n<h1 id=\"observing-topotactic-phase-transformation-and-resistive-switching-behaviors-in-low-power-srcoox-memristor\"><a class=\"anchor\" href=\"#observing-topotactic-phase-transformation-and-resistive-switching-behaviors-in-low-power-srcoox-memristor\">#</a> Observing topotactic phase transformation and resistive switching behaviors in low power SrCoOx memristor</h1>\n<p><strong>在低功耗 SrCoOx 忆阻器中观察拓扑相变与电阻切换行为</strong></p>\n<p>亮点</p>\n<ul>\n<li>通过原位透射电子显微镜（TEM）直接观察了 SrCoOx 的拓扑转变和电阻切换行为。</li>\n<li>Au/SrCoOx/Nb-STO 阻变存储器（RRAM）器件表现出优异的电学性能。</li>\n<li>在非原位分析中，TEM、高分辨率扫描透射电子显微镜（HR-STEM）图像和电子能量损失谱（EELS）证实纳米细丝由 P-SCO 组成。</li>\n<li>原位 TEM 实验结果验证了 SCO 的切换行为直接由电偏置引起。</li>\n<li>这项工作不仅制备了新型 RRAM 器件，还利用 TEM/STEM 分析了切换机制。</li>\n</ul>\n<hr />\n<p>In this study, we deposited SrCoOx (SCO) on a niobium-doped SrTiO3 substrate as the dielectric layer via pulsed laser deposition (PLD). The novel SCO device possesses excellent RRAM properties, high cycling endurance, a long data retention time, and uniform distributions of the high resistance state (HRS) and low resistance state (LRS) resistance and Set/Reset voltage. Furthermore, the switching mechanism was investigated by using transmission electron microscopy (TEM) and scanning transmission electron microscopy (STEM), which showed that the switching behavior resulted from the topotactic phase transformation. In addition, the whole switching process was observed through in situ TEM, and the results strengthened the findings of the ex situ experiment.<br />\n 在本研究中，我们通过脉冲激光沉积（PLD）技术将 SrCoOx（SCO）沉积在掺铌的 SrTiO3（Nb-STO）衬底上作为介电层。这种新型 SCO 器件展现出优异的阻变存储器（RRAM）特性，包括高循环耐久性、长数据保持时间以及高阻态（HRS）和低阻态（LRS）电阻与 Set/Reset 电压的均匀分布。此外，通过透射电子显微镜（TEM）和扫描透射电子显微镜（STEM）对开关机制进行了研究，结果表明开关行为源于拓扑相变。同时，通过原位 TEM 观察了整个开关过程，结果进一步验证了非原位实验的发现。</p>\n<p>According to previous literature, conducting filament theory is the most widely accepted theory to explain the switching mechanism. The formation/rupture of the filament will result in different resistance states of the device. When the filaments connect two electrodes, the device is in a LRS; in contrast, when the filament ruptures, it is known as a HRS.<br />\n 根据已有文献，导电细丝理论是解释开关机制最广泛接受的理论。细丝的形成 / 断裂会导致器件的不同电阻态。当细丝连接两个电极时，器件处于低阻态（LRS）；相反，当细丝断裂时，器件处于高阻态（HRS）。</p>\n<p>Based on the composition of the conducting filament, the switching behaviors can be distinguished as an electrochemical metallization mechanism (ECM) and a valence change mechanism (VCM). An ECM device is composed of an MIM in which one electrode is an inert metal (ex., Pt or Au) and the other electrode is an active metal (ex., Cu or Ag). On the other hand, the two electrodes of a VCM device are composed of an inert metal or an inactive conducting material. The reliability of a VCM-based device is generally higher than that of an ECM-based device because the diffusion coefficient of an active metal ion is large in the dielectric layer, where Ag+ and Cu2+ are estimated to be ≈ 10−13 cm2 s−1, which is likely to cause the hard breakdown of the device<br />\n 根据导电细丝的组成，开关行为可分为电化学金属化机制（ECM）和价态变化机制（VCM）。ECM 器件由金属 - 绝缘体 - 金属（MIM）结构组成，其中一个电极为惰性金属（如 Pt 或 Au），另一个电极为活性金属（如 Cu 或 Ag）。而 VCM 器件的两个电极均由惰性金属或不活泼导电材料组成。基于 VCM 的器件可靠性通常高于基于 ECM 的器件，因为活性金属离子在介电层中的扩散系数较大，例如 Ag + 和 Cu2 + 的扩散系数约为 10−13 cm2 s−1，这可能导致器件的硬击穿。</p>\n<p>many transition metal oxides used for VCM-based RRAM dielectric materials have been broadly studied, such as HfO2, TiO2, Ta2O5, etc.. Because of the diffusion of the oxygen vacancies, the transition metal oxides will become oxygen nonstoichiometric, which leads to the setting of the devices. More recently, complex oxides, such as SrFeOx, SrTiO3, and La2/3Sr1/3MnO3, have also drawn great attention in RRAM applications. When the oxygen ions diffuse, the structure of the complex oxides will transform between brownmillerite and perovskite, where brownmillerite is generally insulating and perovskite is conducting, and this transformation is the so-called topotactic phase transformation<br />\n 许多用于 VCM 基 RRAM 介电材料的过渡金属氧化物已被广泛研究，如 HfO2、TiO2、Ta2O5 等。由于氧空位的扩散，过渡金属氧化物会变成非化学计量比的氧化物，从而导致器件的设置。近年来，复杂氧化物如 SrFeOx、SrTiO3 和 La2/3Sr1/3MnO3 在 RRAM 应用中也引起了广泛关注。当氧离子扩散时，复杂氧化物的结构会在钙铁石（brownmillerite）和钙钛矿（perovskite）之间发生转变，其中钙铁石通常为绝缘态，而钙钛矿为导电态，这种转变被称为拓扑相变。</p>\n<p>BM-SCO stacks with alternating octahedral CoO6 and tetrahedral CoO4 layers, which will result in the insulating property of BM-SCO; however, P–SCO stacks with octahedral CoO6 layers, which makes the electrical and magnetic properties of P–SCO and BM-SCO different<br />\n 钙铁石结构的 SCO（BM-SCO）由交替的八面体 CoO6 层和四面体 CoO4 层堆叠而成，这导致 BM-SCO 具有绝缘性；而钙钛矿结构的 SCO（P-SCO）由八面体 CoO6 层堆叠而成，这使得 P-SCO 和 BM-SCO 的电学和磁学性质有所不同。</p>\n<p>In this work, a complex oxide SrCoOx (SCO) was introduced as the dielectric layer, which was deposited on a niobium-doped SrTiO3 (Nb-STO) substrate with Au as the inert top electrode to produce Au/SCO/Nb-STO RRAM devices. The SCO devices possessed very uniform RRAM properties and high reliability. In addition, the topotactic phase transformation phenomenon and formation/rupture of the conducting filaments were investigated by high-resolution (HR) TEM/STEM images, an energy dispersive spectrometer (EDS) and electron energy loss spectroscopy (EELS) after the electrical measurements in the atmosphere. Furthermore, the behavior of the topotactic phase transformation from BM-SCO to P–SCO was directly observed by in situ TEM, which operated in a high vacuum environment.<br />\n 在本工作中，我们引入复杂氧化物 SrCoOx（SCO）作为介电层，并将其沉积在掺铌的 SrTiO3（Nb-STO）衬底上，以 Au 作为惰性顶电极，制备了 Au/SCO/Nb-STO RRAM 器件。SCO 器件表现出非常均匀的 RRAM 特性和高可靠性。此外，通过高分辨率（HR）TEM/STEM 图像、能谱仪（EDS）和电子能量损失谱（EELS）在电学测量后对拓扑相变现象和导电细丝的形成 / 断裂进行了研究。同时，通过原位 TEM 在高真空环境下直接观察了从 BM-SCO 到 P-SCO 的拓扑相变行为。</p>\n<p>The SCO thin film was deposited on the Nb-STO(001) substrate. Fig. 1(a) shows the cross-sectional TEM image of the Au/SCO/Nb-STO devices, which demonstrates the good contact of the SCO/Nb-STO interface<br />\nSCO 薄膜沉积在 Nb-STO (001) 衬底上。图 1 (a) 展示了 Au/SCO/Nb-STO 器件的横截面 TEM 图像，显示出 SCO/Nb-STO 界面的良好接触。</p>\n<p>The schematic diagram of the device is shown in Fig. 1(b). When we applied the positive bias to the Au top-electrodes and grounded the Nb-STO bottom-electrodes, the current progressed from the Au top-electrode to the Nb-STO bottom-electrode during the Forming process. An atomic force microscope (AFM) was used to investigate the SCO surface morphology. Because the surface morphology of the dielectric layer will affect the RRAM properties, a smoother surface will lead to uniform electrical properties. As shown in Fig. 1(c), the AFM image shows that SCO exhibit the very smooth surface; therefore, the devices could be expected to possess great RRAM properties. Fig. 1(d) shows the XRD spectra of Au/SCO/Nb-STO devices, revealing the components by the (080) diffraction peak of BM-SCO and the (200) peak of Nb-STO. In addition, the distances between the Nb-STO peaks were constant, indicating that the Nb-STO substrate is a single crystal, while the other peak (042) of BM-SCO that was observed indicated that BM-SCO is polycrystalline. The inconsistency of the XRD and TEM result is observed because the TEM sample may be damaged by an ion beam during preparation. According to the XRD analysis, we confirmed that the dielectric layer is composed of SrCoO2.5 (BM-SCO) and it is polycrystalline.<br />\n 该装置的示意图如图 1 (b) 所示。当我们在 Au 顶部电极施加正偏压并将 Nb-STO 底部电极接地时，在形成过程中电流从 Au 顶部电极流向 Nb-STO 底部电极。使用原子力显微镜（AFM）研究了 SCO 的表面形貌。由于介电层的表面形貌会影响 RRAM 的性能，更光滑的表面将导致均匀的电性能。如图 1 (c) 所示，AFM 图像显示 SCO 表面非常光滑；因此，可以预期该器件具有良好的 RRAM 性能。图 1 (d) 显示了 Au/SCO/Nb-STO 器件的 XRD 光谱，通过 BM-SCO 的 (080) 衍射峰和 Nb-STO 的 (200) 峰揭示了其组成。此外，Nb-STO 峰之间的距离是恒定的，表明 Nb-STO 基底是单晶，而观察到的 BM-SCO 的另一个峰 (042) 表明 BM-SCO 是多晶的。由于 TEM 样品在制备过程中可能受到离子束的损伤，因此观察到 XRD 和 TEM 结果的不一致性。根据 XRD 分析，我们确认介电层由 SrCoO2.5（BM-SCO）组成，并且它是多晶的。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//open-report/1-s2.0-S2211285520302408-gr1_lrg.jpg\" title=\"Au/SCO/Nb-STO RRAM器件结构的基本识别及SCO介电层的分析。(a) 初始器件的横截面TEM图像。插入部分为SCO的FFT-DP。(b) 器件示意图。偏压施加于Au电极，Nb-STO电极接地。(c) SCO的AFM分析，显示出非常光滑的表面。(d) SCO薄膜的XRD结果，表明其结构为多晶。\" style=\"max-width: 80%; height: auto;\"></p>\n<p>The SCO exhibits a unique bipolar resistive switching behavior, as shown in Fig. 2(a); the orange, red and blue current-voltage (I–V) curves representing the Forming voltage, the average of the first 100 cycles measurements, and the last 100 cycles, respectively. A positive bias was applied to the Au electrode with a compliance current of 20 mA in order to prevent the devices from experiencing an electrical breakdown. The Forming voltage was 12.5 V. At the beginning of the Forming process, the devices were in a HRS, there were no filaments in the BM-SCO dielectric layer, and the BM-SCO was polycrystalline. In Fig. 2(a), the current of forming process is “gradually” increased until the current suddenly increased at the 12.5 V and form the filaments, which switched the devices into a LRS. From the aspect of materials science, the resistance of single crystal is generally lower than the polycrystalline. And this result expected that the crystallinity of BM-SCO is enhanced. In the first 100 cycles measurements (red curve), because of the negative bias (−4.5 V) applied to the Au top-electrode when we switched the devices back to a HRS, which is called the “Reset”, the filaments were broken, and the resistance increased from 1.57 × 104 Ω to 8.72 × 107 Ω; additionally, because there were residual filaments in the BM-SCO dielectric layer, the device did not need such a high voltage to “Set’ the device from a HRS into a LRS, and the required Set voltage was only 1 V. After the 100 cycle measurements (blue curve), the I–V curves of the Au/SCO/Nb-STO devices were slightly different, the Reset voltage increased from −4.5 V to −5.5 V, and the LRS resistance decreased from 2.48 × 105 Ω to 3.70 × 104 Ω. Because the conducting filaments became stronger and more stable during the repeated measurements, the LRS resistance is lower, and the devices need higher energy (Reset voltage) to break off the filaments.<br />\nSCO 表现出独特的双极电阻切换行为，如图 2 (a) 所示；橙色、红色和蓝色的电流 - 电压（I-V）曲线分别代表形成电压、前 100 次测量的平均值和最后 100 次测量。为了防止器件发生电击穿，在 Au 电极上施加了 20 mA 的限流正偏压。形成电压为 12.5 V。在形成过程开始时，器件处于高阻态（HRS），BM-SCO 介电层中没有导电丝，BM-SCO 是多晶的。在图 2 (a) 中，形成过程的电流 “逐渐” 增加，直到电流在 12.5 V 时突然增加并形成导电丝，将器件切换到低阻态（LRS）。从材料科学的角度来看，单晶的电阻通常低于多晶。这一结果预期 BM-SCO 的结晶度会增强。在前 100 次测量（红色曲线）中，由于在将器件切换回高阻态（称为 “复位”）时在 Au 顶部电极上施加了负偏压（-4.5 V），导电丝断裂，电阻从 1.57 × 10^4 Ω 增加到 8.72 × 10^7 Ω；此外，由于 BM-SCO 介电层中存在残留的导电丝，器件不需要如此高的电压来将器件从高阻态 “设置” 到低阻态，所需的设置电压仅为 1 V。在 100 次测量后（蓝色曲线），Au/SCO/Nb-STO 器件的 I-V 曲线略有不同，复位电压从 - 4.5 V 增加到 - 5.5 V，低阻态电阻从 2.48 × 10^5 Ω 降低到 3.70 × 10^4 Ω。由于在重复测量过程中导电丝变得更加强大和稳定，低阻态电阻降低，器件需要更高的能量（复位电压）来断开导电丝。</p>\n<p>However, in order to show the completed voltage sweep, the operation voltage was higher in Fig. 2(a), and the following discussion was focused on the larger measurement range. Fig. 2(b) shows the retention test of the Au/SCO/Nb-STO device: the retention time was 104 s, exhibiting the nonvolatile characteristic of SCO devices when the read voltage was 0.2 V. As time passed, the resistance of the LRS would slightly increase at 103 s. Furthermore, the HRS/LRS ratio was more than 103 and remained stable without obvious degradation over 104 s, showing that the Au/SCO/Nb-STO devices were highly reliable. The cumulative probability of the LRS and HRS is shown in Fig. 2(c), where the read voltages were both 0.1 V. The ratio of the HRS/LRS fluctuated very little (103) during the whole cycling measurements, and the distributions of the LRS and HRS fluctuated little. The LRS ranged from 104 to 106 Ω, and the HRS ranged from 107 to 109 Ω. Fig. 2(d) shows the cumulative probability of the Set and Reset voltages in our devices. Both voltage distributions were narrow due to the very smooth surface of SCO, as mentioned above. The Set voltage was 1 V, and the Reset voltages were −4.5 V and −5.5 V, where −4.5 V was obtained for the first 100 cycles and −5.5 V was obtained in the last 100 cycles. In Fig. 2(e and f), The SCO devices exhibited the great device-to-device stability, the ON/OFF ratio kept above 103 and the SET/RESET voltage were approximately at 1/-4.5 V under the measurement of 20 devices. Moreover, the HRS/LRS of the bipolar resistance switching exhibited a very uniform distribution over more than 700 cycles, as shown in Figs. S5(a and b). These results indicated that SCO was an excellent RRAM dielectric layer, which demonstrated its great endurance, long retention time, and high stability. In Fig. S5(c), even if the devices have been placed in atmosphere for more than a year, The SET, REST and ON/OFF ratio are similar with the original devices;<br />\n 然而，为了显示完整的电压扫描，图 2 (a) 中的操作电压较高，接下来的讨论集中在更大的测量范围上。图 2 (b) 显示了 Au/SCO/Nb-STO 器件的保持测试：保持时间为 10<sup>4</sup>秒，当读取电压为 0.2 V 时，表现出 SCO 器件的非挥发性特性。随着时间的推移，低阻态的电阻在 10<sup>3</sup>秒时会略微增加。此外，高阻态 / 低阻态比率超过 10<sup>3</sup>，并且在 10<sup>4</sup>秒内保持稳定，没有明显的退化，表明 Au/SCO/Nb-STO 器件具有高度的可靠性。图 2 (c) 显示了低阻态和高阻态的累积概率，读取电压均为 0.1 V。在整个循环测量过程中，高阻态 / 低阻态比率的波动非常小（10<sup>3</sup>），低阻态和高阻态的分布波动也很小。低阻态范围在 10<sup>4</sup>到 10<sup>6</sup> Ω 之间，高阻态范围在 10<sup>7</sup>到 10<sup>9</sup> Ω 之间。图 2 (d) 显示了我们器件中设置和复位电压的累积概率。由于 SCO 表面非常光滑，两种电压分布都很窄。设置电压为 1 V，复位电压为 - 4.5 V 和 - 5.5 V，其中 - 4.5 V 是在前 100 次测量中获得的，-5.5 V 是在最后 100 次测量中获得的。在图 2 (e 和 f) 中，SCO 器件表现出极好的器件间稳定性，在 20 个器件的测量中，ON/OFF 比率保持在 10<sup>3</sup>以上，SET/RESET 电压大约在 1/-4.5 V。此外，双极电阻切换的高阻态 / 低阻态在超过 700 次循环中表现出非常均匀的分布，如图 S5 (a 和 b) 所示。这些结果表明 SCO 是一种优秀的 RRAM 介电层，展示了其出色的耐久性、长保持时间和高稳定性。在图 S5 (c) 中，即使器件在大气中放置了一年多，SET、REST 和 ON/OFF 比率与原始器件相似；<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//open-report/1-s2.0-S2211285520302408-gr2_lrg.jpg\" title=\"Au/SCO/Nb-STO器件的系列电学测量结果。(a) 电阻开关行为的电学测量显示了典型的形成（Forming）、置位（Set）和复位（Reset）过程。红色和蓝色曲线分别表示前100次和最后100次循环测试。(b) 器件的保持特性测量。(c) 电阻的累积概率分布。高阻态（HRS）与低阻态（LRS）的比值高达10³。(d) 置位/复位电压的累积概率分布。(e) 器件间的高阻态/低阻态电阻。(f) 器件间的置位/复位电压。\" style=\"max-width: 80%; height: auto;\"></p>\n<p>In the series of electrical measurements shown in Fig. 2, the Au/SCO/Nb-STO RRAM devices exhibited excellent switching characteristics. To figure out the switching mechanism, we investigated the filament on the nanoscale via TEM. As we discussed in Fig. 2(a), the electrical properties different between the first and the last 100 cycles were due to the filaments size. Comparing with Fig. S8(a) and (c-e), the TEM images shows that the density of nanofilaments in SCO also increased after cycles measurement. In addition, the nanofilaments size also increased that the former and later are range from 30 to 45 nm and 54–400 nm, respectively. It verifies our previous assumption, the filaments size would grow with the measurement times and affect the resistance of the device. Furthermore, we kept the device in a LRS and observed that there was more than one nanofilament form in the dielectric layer, as shown in Figs. S7(c–e); moreover, the chemical composition of the nanofilament is shown in Fig. 3(a). Compared to the initial device, there were some dark contrast areas that appeared in the dielectric layer, which indicated that the structure of the BM-SCO had changed. According to Fig. 3(b), the dark contrast area was composed of P–SCO with relatively low resistance, and the d-spacing of the P–SCO (011) plane was 0.269 nm, corresponding to the theoretical value (0.271 nm). It is worth noting that the other area remained BM-SCO, but the crystallinity increased. BM-SCO was polycrystalline at first and transformed to a single crystal after the bias was applied to the device, where the d-spacing of the BM-SCO (021) plane was 0.458 nm, corresponding to the theoretical value (0.455 nm). Therefore, the Forming process requires relatively high voltage to change the crystallinity of BM-SCO. When the devices were Reset and retained in the HRS, the P–SCO conducting nanofilaments were ruptured, as shown in Fig. 3(c). The P–SCO nanofilament was ruptured in half in the dielectric layer with trapezoidal shape, and the remaining part connected to the Nb-STO electrode. According to Fig. 3(d), after the Reset process, part of the P–SCO transformed back to BM-SCO, which increased the resistance of the device. On the other hand, the residual P–SCO nanofilament would not only slightly decrease the resistance of device (the initial state and the HRS after repeated measurements were 4.88 × 108 and 8.72 × 107 Ω, respectively) but also decrease the Set voltage, as mentioned above. Further, the STEM image also showed the detailed information about the nanofilament, as shown in Fig. 3(e and f).<br />\n 在图 2 所示的系列电学测量中，Au/SCO/Nb-STO RRAM 器件表现出优异的开关特性。为了探究其开关机制，我们通过透射电子显微镜（TEM）在纳米尺度上研究了导电细丝。正如我们在图 2 (a) 中讨论的，前 100 次循环与最后 100 次循环之间电学性能的差异源于导电细丝的尺寸变化。与图 S8 (a) 和 (c-e) 相比，TEM 图像显示，经过多次循环测量后，SCO 中的纳米细丝密度也有所增加。此外，纳米细丝的尺寸也增大了，前期的尺寸范围在 30 至 45 纳米之间，后期则扩大至 54 至 400 纳米。这验证了我们之前的假设，即导电细丝的尺寸会随着测量次数的增加而增长，并影响器件的电阻。进一步，我们将器件保持在低阻态（LRS），并观察到在介质层中形成了不止一条纳米细丝，如图 S7 (c-e) 所示；同时，图 3 (a) 展示了纳米细丝的化学成分。与初始器件相比，介质层中出现了一些暗对比区域，表明 BM-SCO 的结构发生了变化。根据图 3 (b)，暗对比区域由电阻相对较低的 P-SCO 组成，且 P-SCO (011) 晶面的 d 间距为 0.269 纳米，与理论值（0.271 纳米）相符。值得注意的是，其他区域仍为 BM-SCO，但结晶度有所提高。BM-SCO 最初为多晶态，在施加偏压后转变为单晶态，其中 BM-SCO (021) 晶面的 d 间距为 0.458 纳米，与理论值（0.455 纳米）一致。因此，形成过程需要较高的电压来改变 BM-SCO 的结晶度。当器件被复位并保持在高阻态（HRS）时，P-SCO 导电纳米细丝断裂，如图 3 (c) 所示。P-SCO 纳米细丝在介质层中呈梯形断裂为两半，剩余部分连接到 Nb-STO 电极。根据图 3 (d)，复位过程后，部分 P-SCO 重新转变为 BM-SCO，从而增加了器件的电阻。另一方面，残留的 P-SCO 纳米细丝不仅会略微降低器件的电阻（初始状态和多次测量后的 HRS 电阻分别为 4.88 × 10^8 Ω 和 8.72 × 10^7 Ω），还会降低设定电压，如上所述。此外，STEM 图像还提供了纳米细丝的详细信息，如图 3 (e-f) 所示。</p>\n<p>and verified that the nanofilaments were composed of P–SCO (SrCoO3). From Fig. 3(a–g), we confirmed that the switching behavior of Au/SCO/Nb-STO RRAM device was resulted from the topotactic phase transformation of the SCO; in other words, the formation and rupture of P–SCO will determine the resistance state of a device. In addition, in order to verify the topotactic phase transformation, a new HR-TEM image of interface of BM-SCO and substrate has been provided in Fig. S8. In Fig. S8, the BM-SCO shows highly crystallized relationship with the substrate, which demonstrated that the BM-SCO could transform to P–SCO nanofilaments topotactically through the oxygen ions diffusion.<br />\n 并验证了纳米细丝由 P-SCO（SrCoO3）组成。从图 3 (a-g) 中，我们确认了 Au/SCO/Nb-STO RRAM 器件的开关行为源于 SCO 的拓扑相变；换言之，P-SCO 的形成与断裂决定了器件的电阻状态。此外，为了验证拓扑相变，图 S8 提供了 BM-SCO 与基底界面的新 HR-TEM 图像。在图 S8 中，BM-SCO 与基底显示出高度结晶的关系，这表明 BM-SCO 可以通过氧离子扩散拓扑地转变为 P-SCO 纳米细丝。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//open-report/1-s2.0-S2211285520302408-gr3_lrg.jpg\" title=\"在施加偏压后，对Au/SCO/Nb-STO器件进行了非原位TEM/STEM观察和EELS分析，并探讨了其开关机制。(a) 器件处于低阻态(LRS)。(b) 蓝色和紫色框分别为与(a)对应的P-SCO纳米线和BM-SCO的高分辨透射电镜(HR-TEM)图像。(c) 器件处于高阻态(HRS)。(d) 绿色和蓝色框分别为与(c)对应的残余P-SCO纳米线和BM-SCO断裂区域的HR-TEM图像。(e) 纳米线区域的STEM图像。(f) P-SCO纳米线与STO电极界面的高分辨STEM(HR-STEM)图像。(g) 纳米线区域的Co L边EELS谱。(h) BM-SCO与P-SCO之间拓扑相变示意图。\" style=\"max-width: 80%; height: auto;\"></p>\n<p>Fig. 3(h) is the schematic diagram of the topotactic phase transformation behavior of BM-SCO and P–SCO. BM-SCO is formed by the alternate stacking of fully oxygenated octahedral and oxygen-deficient tetrahedral sublayers; in contrast, P–SCO is formed by the stacking of layers that are all fully oxygenated octahedral layers. Since the positive bias that we applied to Au and Nb-STO was grounded, the oxygen ions would occupy the oxygen vacancies in the tetrahedral layers and then transform to fully oxygenated octahedral layers to form the P–SCO filaments. Then, when we applied the negative bias to Au, the oxygen ions would migrate toward the Nb-STO substrate due to the electric field, contributing to the fully oxygenated layer transforming back to an oxygen-deficient layer and rupturing the P–SCO filaments. Hence, the oxygen ions play an important role in our Au/SCO/Nb-STO RRAM devices. In addition, by inserting and releasing the oxygen ions in SCO, the topotactic phase transformation can be reversibly completed without breaking the lattice architecture framework. It is worth mentioning that there were some trapezoidal nanofilaments with an opposite direction in Fig. 3(a) and Fig. S7(c)–(e). We considered that it is caused by the defect (ex. vacancies) in the Au/SCO interface affect the evolution of nanofilaments. Therefore, during the electrical measurement, some nanofilaments may easier to generate at the Au/SCO interface, resulted in the opposite side trapezoidal nanofilaments in the TEM images.<br />\n 图 3 (h) 展示了 BM-SCO 与 P-SCO 拓扑相变行为的示意图。BM-SCO 由完全氧化的八面体层和缺氧的四面体层交替堆叠而成；而 P-SCO 则由完全氧化的八面体层堆叠而成。由于我们施加到 Au 和 Nb-STO 的偏压为正，氧离子会占据四面体层中的氧空位，然后转变为完全氧化的八面体层，形成 P-SCO 细丝。随后，当我们在 Au 上施加负偏压时，氧离子会在电场作用下向 Nb-STO 基底迁移，导致完全氧化层重新转变为缺氧层，并断裂 P-SCO 细丝。因此，氧离子在 Au/SCO/Nb-STO RRAM 器件中起着重要作用。此外，通过在 SCO 中插入和释放氧离子，拓扑相变可以在不破坏晶格结构框架的情况下可逆地完成。值得一提的是，图 3 (a) 和图 S7 (c-e) 中出现了一些方向相反的梯形纳米细丝。我们认为这是由于 Au/SCO 界面处的缺陷（如空位）影响了纳米细丝的演化。因此，在电学测量过程中，一些纳米细丝可能更容易在 Au/SCO 界面处生成，导致 TEM 图像中出现相反方向的梯形纳米细丝。</p>\n<p>At the beginning of the experiment, the structure of the BM-SCO was amorphous because of the ion damage by the FIB, and the device was in a HRS where the resistance was approximately 5 × 108 Ω, as shown in Fig. 4(a).<br />\n 实验开始时，由于聚焦离子束（FIB）的离子损伤，BM-SCO 的结构为无定形态，器件处于 HRS，电阻约为 5 × 10^8 Ω，如图 4 (a) 所示。</p>\n<p>we also observed the white particles emerged in the SCO, and they were composed of the Au. Because the Au content is very little, we believe that these white particles wouldn't affect the electrical properties of devices, because the discontinuous distribution of particle and very little content of Au Afterward, the positive bias was applied to the Au. There was no structural change at first, and only the expansion of the nitride membrane caused a different contrast on the substrate; however, when the voltage increased to 7.9 V, the SCO structure suddenly transformed, as shown in Fig. 4(b)<br />\n 我们还在 SCO 中观察到了白色颗粒的出现，这些颗粒由金（Au）组成。由于金的含量非常少，我们认为这些白色颗粒不会影响器件的电学性能，因为颗粒的分布不连续且金的含量极低。随后，我们对 Au 施加了正偏压。起初没有发生结构变化，仅仅是氮化物膜的膨胀导致了基底上的对比度差异；然而，当电压增加到 7.9 V 时，SCO 结构突然发生了转变，如图 4 (b) 所示。</p>\n<p>The corresponding electrical properties of the in situ device are shown in Fig. 4(c), where the current also dramatically increased at 7.9 V and the resistance decreased to 3.04 × 106 Ω at 7.9 V. The current of the in situ electrical measurement is sharper than the ex situ, we considered that it is due to the oxygen pressure.<br />\n 相应的原位器件的电学特性如图 4 (c) 所示，电流在 7.9 V 时也急剧增加，电阻在 7.9 V 时降至 3.04 × 10^6 Ω。原位电学测量的电流比非原位的更尖锐，我们认为这是由于氧气压力的影响。</p>\n<p>Fig. 4(d–f) exhibit the HR-TEM images of the dielectric layer after the in situ electrical measurement. Fig. 4(d) demonstrates the single crystal of BM-SCO, and it confirms that some energy was required to rearrange the polycrystalline BM-SCO into single crystal. In addition, we directly observed the transformation of SCO from BM-SCO to P–SCO as nanofilaments, as shown in Fig. 4(e and f), which verified the switching mechanism of the Au/SCO/Nb-STO RRAM device.<br />\n 图 4 (d–f) 展示了原位电学测量后介电层的高分辨透射电子显微镜（HR-TEM）图像。图 4 (d) 显示了 BM-SCO 的单晶结构，证实了将多晶 BM-SCO 重排为单晶需要一定的能量。此外，我们直接观察到了 SCO 从 BM-SCO 向 P-SCO 转变的纳米丝，如图 4 (e 和 f) 所示，这验证了 Au/SCO/Nb-STO RRAM 器件的开关机制。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//open-report/1-s2.0-S2211285520302408-gr4_lrg.jpg\" title=\"原位透射电子显微镜（TEM）观察到的RRAM的拓扑相变和开关现象。(a) 器件的初始状态，SCO（切换氧化层）呈现非晶态。(b) 当对Au施加正向偏压至7.9 V后，SCO结构发生了转变。红色框标出了P-SCO（极化SCO）细丝区域。(c) 通过TEM获取的Forming过程的相应I-V测量结果。(d)-(f) 介电层的高分辨TEM图像，显示P-SCO纳米细丝形成，且BM-SCO（基底材料SCO）结构转变为单晶。\" style=\"max-width: 80%; height: auto;\"></p>\n<p>It is remarkable that the device couldn't RESET in this experiment, because the ion concentration is significantly low due to thinner sample as well as the high vacuum system, resulting in difficulty for rupturing the nanofilaments to complete the in situ RESET. On the other hand, the SET process in the in situ experiment caused the irreversible resistive change and hard electrical breakdown<br />\n 值得注意的是，在本实验中，器件无法实现 RESET，因为样品较薄以及高真空系统导致离子浓度显著降低，使得纳米丝难以断裂以完成原位 RESET。另一方面，原位实验中的 SET 过程导致了不可逆的电阻变化和硬电击穿。</p>\n<p>We demonstrated the conducting nanofilament formation process of the Au/SCO/Nb-STO RRAM devices in our case. The switching process could be simplified into four steps. First, in the initial state of the device, without applying bias, the BM-SCO exhibited a polycrystalline structure and was uniformly distributed without P–SCO, as illustrated in Fig. 5(a). Second, during the Forming process, as the positive bias was applied to the Au top-electrode, the structure of the BM-SCO would be rearranged into a single crystal, as illustrated in Fig. 5(b). In addition, the electric field induced the migration of oxygen ions from the Nb-STO surface to the top-electrode and occupied the oxygen-deficient layer in the BM-SCO, thus generating the P–SCO conducting path. Third, in Fig. 5(c), when the negative bias was applied to the Au, the nanofilaments ruptured from top to bottom since the oxygen ions would be excluded from the top to bottom electrodes until the devices were in HRSs. The ruptured nanofilament region near the top electrode transformed back to BM-SCO, which alternately stacks fully oxygenated octahedral and oxygen-deficient tetrahedral sublayers. Finally, as shown through the series of electrical measurements, the P–SCO nanofilaments would become stronger than those observed in the previous measurement, as illustrated in Fig. 5(d). Therefore, the resistance in the LRS was lower. The device required a higher voltage to exclude more oxygen ions, which switched the devices back to a HRS.<br />\n 我们展示了 Au/SCO/Nb-STO RRAM 器件中导电纳米丝的形成过程。开关过程可以简化为四个步骤。首先，在器件的初始状态下，未施加偏压时，BM-SCO 呈现多晶结构并均匀分布，没有 P-SCO，如图 5 (a) 所示。其次，在形成过程中，当对 Au 顶电极施加正偏压时，BM-SCO 的结构将重排为单晶，如图 5 (b) 所示。此外，电场诱导氧离子从 Nb-STO 表面迁移到顶电极，并占据 BM-SCO 中的缺氧层，从而形成 P-SCO 导电路径。第三，如图 5 (c) 所示，当对 Au 施加负偏压时，纳米丝从上到下断裂，因为氧离子将从顶电极被排除到底电极，直到器件处于高阻态（HRS）。靠近顶电极的断裂纳米丝区域转变回 BM-SCO，其交替堆叠完全氧化的八面体和缺氧的四面体亚层。最后，如图 5 (d) 所示，通过一系列电学测量，P-SCO 纳米丝将变得比之前测量中观察到的更强。因此，低阻态（LRS）中的电阻更低。器件需要更高的电压以排除更多的氧离子，从而使器件切换回高阻态。<br />\n<img loading=\"lazy\" loading=\"lazy\" data-src=\"/miyano/img/post//open-report/1-s2.0-S2211285520302408-gr5_lrg.jpg\" title=\"电阻开关过程的示意图，包括形成（Forming）、复位（Reset）和设置（Set）过程。八面体层和四面体层分别用蓝色正方形和红色三角形表示。(a) 器件的初始状态。(b) 形成过程后，由于氧离子的向外扩散，氧空位被填充，随后形成纳米细丝。(c) 当施加反向偏压时，氧离子在电场作用下向基板移动，导致纳米细丝断裂。(d) 将器件再次设置为低电阻状态（LRS）后，纳米细丝可能比之前更强。\" style=\"max-width: 80%; height: auto;\"></p>\n<p>In summary, the asymmetric Au/SCO/Nb-STO RRAM devices with an atomically uniform thickness exhibited bipolar switching characteristics and also possessed highly endurable and excellent stability. The electrical measurement results of the polycrystalline-SCO demonstrated that the Set and Reset voltages had narrow distributions, the retention time reached more than 104 s, and the ON/OFF ratio was as high as 103. We further investigated and analyzed the switching behavior and the composition of the conducting nanofilaments by using ex situ and in situ TEM. The TEM/STEM images of the ex situ sample indicate that the nanofilaments are composed of P–SCO, and the rupture and formation lead to switching the devices between a HRS and a LRS. The switching mechanism is that the oxygen-deficient tetrahedral layer of BM-SCO could be occupied by oxygen ions and then transformed into a fully oxygenated octahedral layer of P–SCO as conducting nanofilaments. In addition, we successfully observed the evolution of the P–SCO nanofilaments, the topotactic transform of its crystallinity, and the rearrangement of the BM-SCO structure through in situ TEM. In the high vacuum environment, the oxygen resource comes from the Nb-STO substrate, which provides the oxygen ions for the transformation of SCO.<br />\n 总之，具有原子级均匀厚度的非对称 Au/SCO/Nb-STO RRAM 器件表现出双极开关特性，并且具有高度的耐久性和优异的稳定性。多晶 SCO 的电学测量结果表明，Set 和 Reset 电压分布较窄，保持时间超过 10^4 s，开关比高达 10^3。我们通过非原位和原位 TEM 进一步研究和分析了开关行为和导电纳米丝的组成。非原位样品的 TEM/STEM 图像表明，纳米丝由 P-SCO 组成，其断裂和形成导致器件在高阻态和低阻态之间切换。开关机制是 BM-SCO 的缺氧四面体层可以被氧离子占据，然后转变为完全氧化的八面体层 P-SCO，形成导电纳米丝。此外，我们通过原位 TEM 成功观察到了 P-SCO 纳米丝的演变、其结晶度的拓扑转变以及 BM-SCO 结构的重排。在高真空环境中，氧源来自 Nb-STO 基底，为 SCO 的转变提供了氧离子。</p>\n<p>The 25 nm polycrystalline brownmillerite SrCoO2.5 thin films were grown with pulsed laser deposition (PLD) using a KrF excimer laser (λ = 248 nm) on a 10 × 10 mm2 0.5 wt% Nb-doped SrTiO3 substrate at a temperature of 650 °C and a pressure of 100 mTorr, and the target is bulk SrCoO2.5. Then, a 130-nm-thick Au top electrode was deposited on the SCO via an electron beam evaporation system (E-gun). The devices were defined as having a top electrode 200 μm in diameter through a shadow mask.<br />\n25 nm 厚的多晶布朗米勒石 SrCoO2.5 薄膜是通过脉冲激光沉积（PLD）在 10 × 10 mm² 的 0.5 wt% Nb 掺杂 SrTiO3 基底上生长的，使用 KrF 准分子激光器（λ = 248 nm），温度为 650 °C，压力为 100 mTorr，靶材为块体 SrCoO2.5。然后，通过电子束蒸发系统（E-gun）在 SCO 上沉积了 130 nm 厚的 Au 顶电极。器件通过阴影掩模定义为直径为 200 μm 的顶电极。</p>\n",
            "tags": [
                "科研笔记",
                "开题报告",
                "毕设"
            ]
        },
        {
            "id": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC1%E5%8D%95%E5%85%83/",
            "url": "https://ei4869.github.io/miyano/Course-Study/Japanese/%E5%88%9D%E7%BA%A7%E4%B8%8A-%E7%AC%AC1%E5%8D%95%E5%85%83/",
            "title": "单元一——小李赴日",
            "date_published": "2025-03-02T08:28:00.000Z",
            "content_html": "<h1 id=\"第一课李りさんは-中国人ちゅうごくじん-です\"><a class=\"anchor\" href=\"#第一课李りさんは-中国人ちゅうごくじん-です\">#</a> 第一课：<ruby>李<rp> (</rp><rt>り</rt><rp>)</rp> さんは　<rt></rt>中国人<rp> (</rp><rt>ちゅうごくじん</rt><rp>)</rp>　です<rt></rt></ruby></h1>\n<h2 id=\"语法\"><a class=\"anchor\" href=\"#语法\">#</a> 语法</h2>\n<h3 id=\"名-は-名です\"><a class=\"anchor\" href=\"#名-は-名です\">#</a> [名] は　[名] です</h3>\n<p>eg: 私　は　<ruby>王<rp> (</rp><rt>おう</rt><rp>)</rp></ruby> です。</p>\n<h3 id=\"名-は-名-ではありません\"><a class=\"anchor\" href=\"#名-は-名-ではありません\">#</a> [名] は　[名] ではありません</h3>\n<p>“では”　口语中有时为 “じゃ”</p>\n<h3 id=\"名-は-名-ですか\"><a class=\"anchor\" href=\"#名-は-名-ですか\">#</a> [名] は　[名] ですか</h3>\n<p>x 是 x 吗？ 回答为 はい　或 いいえ<br />\n - はい、そうです<br />\n - いいえ、ちがいます</p>\n<h3 id=\"名-の-名\"><a class=\"anchor\" href=\"#名-の-名\">#</a> [名] の [名]</h3>\n<p>eg: 李さん　は　<ruby>JC<rt></rt> 企画<rp> (</rp><rt>ジェーシー企画</rt><rp>)</rp></ruby>　の　<ruby>社員<rp> (</rp><rt>しゃいん</rt><rp>)</rp></ruby>　です。</p>\n<h1 id=\"第二课これは-本ほんです\"><a class=\"anchor\" href=\"#第二课これは-本ほんです\">#</a> 第二课：<ruby>これは　<rt></rt>本<rp> (</rp><rt>ほん</rt><rp>)</rp> です<rt></rt></ruby></h1>\n<h2 id=\"语法-2\"><a class=\"anchor\" href=\"#语法-2\">#</a> 语法</h2>\n<h3 id=\"これそれあれ-は-名-です\"><a class=\"anchor\" href=\"#これそれあれ-は-名-です\">#</a> これ / それ / あれ　は　[名] です</h3>\n<p>(1) A (说话人) 和 B (听话人) 相隔一段距离，面对面时：<br />\nこれ：离 A 近<br />\nそれ：离 B 近<br />\nあれ：离两人都远<br />\n (2) A (说话人) 和 B (听话人) 在同一位置，面向同一方向时：<br />\nこれ：离 A、B 近<br />\nそれ：离 A、B 近<br />\nあれ：离两人都远</p>\n<h3 id=\"だれですか何なんですか\"><a class=\"anchor\" href=\"#だれですか何なんですか\">#</a> だれですか /<ruby> 何<rp> (</rp><rt>なん</rt><rp>)</rp> ですか<rt></rt></ruby></h3>\n<p>不知什么人用 だれ；不知什么事物用 <ruby>何<rp> (</rp><rt>なん</rt><rp>)</rp></ruby><br />\n だれ 更有礼貌应该用 どなた</p>\n<h3 id=\"名の-名-所属\"><a class=\"anchor\" href=\"#名の-名-所属\">#</a> [名] の　[名]     [所属]</h3>\n<p>eg: わたし　の　かぎ。</p>\n<h3 id=\"このそのあの-名は-名-です\"><a class=\"anchor\" href=\"#このそのあの-名は-名-です\">#</a> この / その / あの　[名] は [名]　です</h3>\n<p>eg: あの　ノートは　だれのですか。</p>\n<h3 id=\"どれどの-名\"><a class=\"anchor\" href=\"#どれどの-名\">#</a> どれ / どの [名]</h3>\n<p>eg: <ruby>小野<rp> (</rp><rt>おの</rt><rp>)</rp></ruby> さんの　<ruby>机<rp> (</rp><rt>つくえ</rt><rp>)</rp></ruby>　は　どの　<ruby>机<rp> (</rp><rt>つくえ</rt><rp>)</rp></ruby>　ですか。</p>\n<h2 id=\"表达\"><a class=\"anchor\" href=\"#表达\">#</a> 表达</h2>\n<ol>\n<li><ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby><br />\n この / その / あの　<ruby>人<rp> (</rp><rt>ひと</rt><rp>)</rp></ruby>　-&gt; この / その / あの　<ruby>方<rp> (</rp><rt>かた</rt><rp>)</rp></ruby>   更加礼貌</li>\n<li>询问年龄</li>\n</ol>\n<ul>\n<li><ruby>何歳<rp> (</rp><rt>なんさい</rt><rp>)</rp> ですか<rt></rt></ruby></li>\n<li>おいくつですか  比较礼貌</li>\n<li>直接问小孩子时，いくつ？　<ruby>何歳<rp> (</rp><rt>なんさい</rt><rp>)</rp></ruby></li>\n</ul>\n<ol start=\"3\">\n<li>どうぞ<br />\n给对方物品，劝对方进餐。</li>\n<li>どうもありがとうございます<br />\n表示感谢，感情很强。</li>\n</ol>\n<h1 id=\"第三课ここは-デパート-です\"><a class=\"anchor\" href=\"#第三课ここは-デパート-です\">#</a> 第三课：ここは　デパート　です</h1>\n<h2 id=\"语法-3\"><a class=\"anchor\" href=\"#语法-3\">#</a> 语法</h2>\n<h3 id=\"ここそこあそこ-は-名です\"><a class=\"anchor\" href=\"#ここそこあそこ-は-名です\">#</a> ここ / そこ / あそこ　は　[名] です</h3>\n<p>用于指示场所。</p>\n<h3 id=\"名-は-名场所-です\"><a class=\"anchor\" href=\"#名-は-名场所-です\">#</a> [名] は　[名 (场所)]　です</h3>\n<p>表示 “名词” 存在于 “名词（场所）”。<br />\neg: トイレ　は　ここ　です。    厕所在这儿。</p>\n<h3 id=\"名-は-どこですか\"><a class=\"anchor\" href=\"#名-は-どこですか\">#</a> [名] は　どこですか</h3>\n<p>用于询问存在的场所。<br />\neg: トイレは　どこですか？  ―あちらです。</p>\n<h3 id=\"名も-名-です\"><a class=\"anchor\" href=\"#名も-名-です\">#</a> [名] も [名]　です</h3>\n<p>x 也是 x。</p>\n<h3 id=\"名は-名ですか-名ですか\"><a class=\"anchor\" href=\"#名は-名ですか-名ですか\">#</a> [名] は [名] ですか、 [名] ですか</h3>\n<p>eg: かばん　<ruby>売<rp> (</rp><rt>う</rt><rp>)</rp> り<rt></rt>場<rp> (</rp><rt>ば</rt><rp>)</rp></ruby> は　<ruby>一階<rp> (</rp><rt>いっかい</rt><rp>)</rp></ruby>　ですか、<ruby>二階<rp> (</rp><rt>にかい</rt><rp>)</rp></ruby>　ですか。  卖包的柜台在一层还是二层。</p>\n<h3 id=\"名は-いくらですか\"><a class=\"anchor\" href=\"#名は-いくらですか\">#</a> [名] は　いくらですか</h3>\n<p>询问价钱时，用 いくら</p>\n<h2 id=\"表达-2\"><a class=\"anchor\" href=\"#表达-2\">#</a> 表达</h2>\n<ol>\n<li>\n<p>こちら / そちら / あちら / どちら<br />\n是ここ / そこ / あそこ / どこ的礼貌说法</p>\n</li>\n<li>\n<p>あのう<br />\n用于向对方搭话或想引起对方注意。或者想对对方说难以启齿的事等等。</p>\n</li>\n</ol>\n<h1 id=\"第四课-部屋へや-に-机つくえと-いすが-あります\"><a class=\"anchor\" href=\"#第四课-部屋へや-に-机つくえと-いすが-あります\">#</a> 第四课： <ruby>部屋<rp> (</rp><rt>へや</rt><rp>)</rp></ruby>　に　<ruby>机<rp> (</rp><rt>つくえ</rt><rp>)</rp></ruby> と　いすが　あります</h1>\n<h2 id=\"语法-4\"><a class=\"anchor\" href=\"#语法-4\">#</a> 语法</h2>\n<h3 id=\"あります和います\"><a class=\"anchor\" href=\"#あります和います\">#</a> あります和います</h3>\n<p>あります 用于不具有意志的事物<br />\nいます 用于具有意志的人、动物等</p>\n<ol>\n<li>\n<p>[名 (场所)] に　[名 (物 / 人)] が　あります / います<br />\n表示事物存在： x 有 x   某地有某物<br />\n eg: ここに　本ほん　が　あります。<br />\n<ruby>公園<rp> (</rp><rt>こうえん</rt><rp>)</rp></ruby> に　<ruby>猫<rp> (</rp><rt>ねこ</rt><rp>)</rp></ruby>　が　います</p>\n</li>\n<li>\n<p>[名 (物 / 人)] は [名 (场所)] に　あります / います<br />\n表示位置： x 在 x   某物在某地<br />\n eg: いすは　<ruby>部屋<rp> (</rp><rt>へや</rt><rp>)</rp></ruby> に　あります。<br />\n<ruby>子供<rp> (</rp><rt>こども</rt><rp>)</rp></ruby> は　<ruby>公園<rp> (</rp><rt>こうえん</rt><rp>)</rp></ruby> に　います。</p>\n</li>\n</ol>\n<p>之前的 x は　どこですか　可以用 x は　どこに　ありますか / いますか　表示。</p>\n<h3 id=\"名と-名-并列\"><a class=\"anchor\" href=\"#名と-名-并列\">#</a> [名] と　[名]    [并列]</h3>\n<p>表示并列，“和”</p>\n<h3 id=\"上うえ-下した-前まえ-後うしろ-隣となり-中なか-外そと\"><a class=\"anchor\" href=\"#上うえ-下した-前まえ-後うしろ-隣となり-中なか-外そと\">#</a> <ruby>上<rp> (</rp><rt>うえ</rt><rp>)</rp></ruby>　<ruby>下<rp> (</rp><rt>した</rt><rp>)</rp></ruby>　<ruby>前<rp> (</rp><rt>まえ</rt><rp>)</rp></ruby>　<ruby>後<rp> (</rp><rt>うし</rt><rp>)</rp> ろ<rt></rt></ruby>　<ruby>隣<rp> (</rp><rt>となり</rt><rp>)</rp></ruby>　<ruby>中<rp> (</rp><rt>なか</rt><rp>)</rp></ruby>　<ruby>外<rp> (</rp><rt>そと</rt><rp>)</rp></ruby></h3>\n<p>方位词</p>\n<h3 id=\"ね\"><a class=\"anchor\" href=\"#ね\">#</a> ね</h3>\n<p>当说话人征求听话人的同意时，句尾用助词 &quot;ね&quot;，升调</p>\n<h3 id=\"疑问词-も-动否定\"><a class=\"anchor\" href=\"#疑问词-も-动否定\">#</a> 疑问词 も [动 (否定)]</h3>\n<p>表示全面否定。<br />\n{教室…… きょうしつ} に　だれも　いません。</p>\n<h2 id=\"表达-3\"><a class=\"anchor\" href=\"#表达-3\">#</a> 表达</h2>\n<ol>\n<li>\n<p><ruby>上<rp> (</rp><rt>うえ</rt><rp>)</rp></ruby><br />\n 只表示垂直上方的范围，不能用作表示表面。</p>\n</li>\n<li>\n<p>ええと<br />\n被别人问及某事时思考如何回答说的话。</p>\n</li>\n<li>\n<p><ruby>ご<rt></rt>家族<rp> (</rp><rt>かぞく</rt><rp>)</rp></ruby>　<ruby>ご<rt></rt>兄弟<rp> (</rp><rt>きょうだい</rt><rp>)</rp></ruby>　<ruby>ご<rt></rt>両親<rp> (</rp><rt>りょうしん</rt><rp>)</rp></ruby><br />\n 说到别人亲属时的礼貌用法，指对方的家人。<ruby>家族<rp> (</rp><rt>かぞく</rt><rp>)</rp></ruby> 指自己的家人。</p>\n</li>\n<li>\n<p><ruby>兄弟<rp> (</rp><rt>きょうだい</rt><rp>)</rp></ruby><br />\n 指同一父母的人，也可以同父或同母，包括兄弟姐妹。</p>\n</li>\n<li>\n<p><ruby>一人暮<rp> (</rp><rt>ひとりく</rt><rp>)</rp> らし<rt></rt></ruby><br />\n指离开家一个人生活。</p>\n</li>\n</ol>\n",
            "tags": [
                "课程学习",
                "日语",
                "课程"
            ]
        }
    ]
}